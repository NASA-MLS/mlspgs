head	1.7;
access;
symbols
	v5-02-NRT-19:1.7
	v6-00:1.7
	v5-02-NRT-18:1.7
	v5-02:1.7
	v5-01-NRT-17:1.7
	v5-01-NRT-16:1.7
	v5-01-NRT-15:1.7
	v5-01-NRT-14:1.7
	neuralnetworks-1-0:1.7.0.16
	cfm-single-freq-0-1:1.7.0.14
	v5-01:1.7
	v5-00:1.7
	v4-23-TA133:1.7.0.12
	mus-emls-1-70:1.7.0.10
	rel-1-0-englocks-work:1.7.0.8
	VUMLS1-00:1.7
	VPL1-00:1.7
	V4-22-NRT-08:1.7
	VAM1-00:1.7
	V4-21:1.7.0.6
	V4-13:1.7
	V4-12:1.7
	V4-11:1.7
	V4-10:1.7
	V3-43:1.7
	M4-00:1.7
	V3-41:1.7
	V3-40-PlusGM57:1.7.0.4
	V2-24-NRT-04:1.7
	V3-33:1.7
	V2-24:1.7
	V3-31:1.7
	V3-30-NRT-05:1.7
	cfm-01-00:1.7
	V3-30:1.7
	V3-20:1.7
	V3-10:1.7
	V2-23-NRT-02:1.7
	V2-23:1.7
	V2-22-NRT-01:1.7
	V2-22:1.7
	V2-21:1.7
	V2-20:1.7
	V2-11:1.7
	V2-10:1.7
	V2-00:1.7
	V1-51:1.7
	V1-50:1.7
	V1-45:1.7
	V1-44:1.7
	V1-43:1.7
	V1-32:1.7
	V1-31:1.7
	V1-30:1.7
	V1-13:1.7
	V1-12:1.7
	V1-11:1.7
	V1-10:1.7
	newfwm-feb03:1.7.0.2;
locks; strict;
comment	@# @;


1.7
date	2002.11.06.23.10.01;	author pwagner;	state Exp;
branches;
next	1.6;

1.6
date	2002.06.04.21.38.33;	author livesey;	state Exp;
branches;
next	1.5;

1.5
date	2002.05.23.17.51.07;	author livesey;	state Exp;
branches;
next	1.4;

1.4
date	2002.05.22.00.50.16;	author livesey;	state Exp;
branches;
next	1.3;

1.3
date	2002.05.21.18.04.21;	author livesey;	state Exp;
branches;
next	1.2;

1.2
date	2002.05.21.18.03.57;	author livesey;	state Exp;
branches;
next	1.1;

1.1
date	2002.05.17.20.24.09;	author livesey;	state Exp;
branches;
next	;


desc
@@


1.7
log
@Changed leapsecfile to point at newer file on server
@
text
@; This template l2cf performs a sids calculation for one band or
; sideband, defined by the macro band, for the day defined by the
; macro day.

; First some m4 directives
include(m4defs.l2cf)

; Get a default for date and band if not already supplied
!ifdef(day,{},{!define(day,{1996d051})})
!ifdef(band,{},{!define(band,{1})})
!ifdef(l1boaversion,{},{!define(l1boaversion,{s5--t})})
!ifdef(l1bradversion,{},{!define(l1bradversion,{s5-f6--t})})

; Now define our directories
!define(inpathl1boa,{/data/emls/l1boa/!l1boaversion/!year(!day)/})
!define(outpathl1brad,{/bigdata/livesey/misc})
!include(clarifypaths.l2cf)

; ----------------------------------- Boiler plate l2cf stuff -------

; Retrieval macros, defines bands
!include(retrievalmacros.l2cf)

; Valid signals database
!include(!signalsL2cf)

; Spectroscopy and molecule/isotope information
!include(!spectroscopyL2cf)

; Sideband ratio information
!include(!sidebandL2cf)

; System temperature information
!include(!systempL2cf)

; Noise bandwidth information
!include(!nbwL2cf)

; Now include some minor calibration parameters
!include(lesserparams.l2cf)

; Now read the l2gp files for each species
!include(readtruthl2gpfiles.l2cf)

; -------------------------------------------- Global settings ------
begin GlobalSettings

  ;; Setup the stuff for reading and dealing with l1b files
  l1boa, file='!inpathl1boa/MLS-Aura_L1BOA-Full_s5--t_!day.h4'
  startTime = '!year(!day)-!doy(!day)T00:00:00.0000'
  endTime = '!year(!day)-!doy(!day)T23:59:59.9999'
  leapsecfile = '/software/SRC/HDF-EOS/TOOLKIT-5.2.8v2.00/database/common/TD/leapsec.dat'

  ;; Setup our vertical grids
  vGridStandard: vGrid, type=Logarithmic, coordinate=Zeta, $
    start=1000mb, formula=[73:12]
  vGridHiRes: vGrid, type=Logarithmic, coordinate=Zeta, $
    start=1000mb, formula=[73:12]
  vGridBaseline: vGrid, type=Logarithmic, coordinate=Zeta, $
    start=1000mb, formula=[73:12]
  vGridExtinction: vGrid, type=Logarithmic, coordinate=Zeta, $
    start=1000mb, formula=[73:12]
  vGridRefGPH: vGrid, type=Explicit, coordinate=Zeta, values=100 mb

  ;; Setup our emiprical geometry.  This is for getting an empirical
  ;; value for longitude as a function of geodetic cangle
  empiricalGeometry, terms=[ $
    -1.06863, 43.0943, -16.2062, 8.12730, -4.58416, 2.75786, -1.72880, $
    1.11523, -0.733464, 0.489792, -0.331852, 0.227522, -0.156428, $
    0.108031, -0.0757825, 0.0536980, -0.0375161, 0.0260555, $
    -0.0188811, 0.0138453, -0.00959350], $
    iterations=10

  ;; Define the frequency grids for the extinciton quantities
  !include(extinctionfgrids.l2cf)

  ;; Load our forward model databases
  ForwardModelGlobal, $
    antennaPatterns=!antennaFile, $
    filterShapes=!filterFile, $
    pointingGrids=!pfgFile

  ;; Setup the particular forward model we're going to want
  sidsFwm: forwardModel, type=full,  $
    signals = !signal(!band), $
    molecules = !molecules(!band), $
    phiWindow=5, $
    /skipOverlaps, $
    integrationGrid=vGridStandard, $
    tangentGrid=vGridStandard, /do_conv, /do_freq_avg

end GlobalSettings

; ------------------------------------------ Chunk divide  ----
!include(chunkdivide8th.l2cf)

; ------------------------------------------- Construct sections --

begin Construct
  hGridStandard: hGrid, type=regular, spacing=1.5 degrees, origin=0 degrees, $
    module=GHz, /forbidOverspill
end Construct

!include(constructstandardspecies.l2cf)

begin Construct
  yTemplate: VectorTemplate, quantities = [ band!band ]
end Construct

; --------------------------------------- Define and fill vectors --

; This next lot of stuff may seem a little long winded, but
; we do it this way to make the l2cf similar to others, and thus
; containing more in common with them.

; Define and fill the apriori vector
!include(fillapriori.l2cf)

; Define and fill the truth vector
!include(filltruth.l2cf)

; Define radiance vectors and noise vector
begin Fill
  y: Vector, template=yTemplate
  yNoise: Vector, template=yTemplate
end Fill

; -------------------------------------------- Forward model ----

begin Retrieve
 sids, fwdModelIn=truth, fwdModelOut=y,$
   forwardModel=[sidsFwm]
end Retrieve

; ------------------------------------------- Work out the noise level

; begin Fill
;   Fill, quantity=yNoise.band!band, method=estimatedNoise, $
;     radianceQuantity=y.band!band,  noiseBandwidth=state.noiseBandwidth!band, $
;     systemTemperature=state.sysTemp!band, integrationTime=0.162 s    
; end Fill

; ------------------------------------------ Join the chunks

begin Join
  ;; Don't do anything if we've not defined an output version, to
  ;; help avoid overwriting old data in one off tests.
  !ifdef(l1bradversion,{

  !define(outfile,{'!outpathl1brad/MLS-Aura_L1BRAD-band!band-clean_!l1bradversion_!day.h4'})
  directWrite, source=y.band!band, /prefixSignal, sdName='', file=!outfile
  directWrite, source=yNoise.band!band, /prefixSignal, sdName=' precision', file=!outfile
  directWrite, source=truth.ptanGHz, sdName='GHz.ptan', file=!outfile
  directWrite, source=truth.ptanTHz, sdName='THz.ptan', file=!outfile

})
end Join

; ---------------------------------------  Output the result
begin Output
end Output




@


1.6
log
@Regular updates
@
text
@d52 1
a52 1
  leapsecfile = '/software/SRC/TOOLKIT-5.2.7.4v1.00/database/common/TD/leapsec.dat'
@


1.5
log
@Changed to directwrite
@
text
@d21 3
d146 4
d155 2
d162 4
@


1.4
log
@L2CFs no longer belong in l2
@
text
@d12 1
a12 1
!ifdef(l1bradversion,{},{!define(l1bradversion,{s5-f2--t})})
d22 1
a22 1
!include(!calpath/MLS-Aura_L2Cal-Signals_v1-0-0_0000d000.l2cf)
d25 1
a25 1
!include(!calpath/MLS-Aura_L2Cal-Spectroscopy_v1-0-0_0000d000.l2cf)
d28 1
a28 1
!include(!calpath/MLS-Aura_L2Cal-SBRatio_v1-0-0_0000d000.l2cf)
d31 1
a31 1
!include(!calpath/MLS-Aura_L2Cal-Tsys_v1-0-0_0000d000.l2cf)
d34 1
a34 1
!include(!calpath/MLS-Aura_L2Cal-NBW_v1-0-0_0000d000.l2cf)
d76 3
a78 3
    antennaPatterns='!calpath/MLS-Aura_L2Cal-AAAP_v1-0-0_0000d000.txt', $
    filterShapes='!calpath/MLS-Aura_L2Cal-Filters_v1-0-1_0000d000.txt', $
    pointingGrids='!calpath/MLS-Aura_L2Cal-PFG_v1-0-1_0000d000.txt'
d143 5
a147 4
  radL2AUX: l2aux, source=y.band!band, /prefixSignal, sdName=''
  noiseL2AUX: l2aux, source=yNoise.band!band, /prefixSignal, sdName=' precision'
  ptanGHzL2AUX: l2aux, source=truth.ptanGHz
  ptanTHzL2AUX: l2aux, source=truth.ptanTHz
a151 4
  output, file='!outpathl1brad/MLS-Aura_L1BRAD-band!band-clean_!l1bradversion_!day.dat', $
    quantities=  $
    [ ptanGHzL2AUX, ptanTHzL2AUX, radL2AUX, noiseL2AUX ], type=l2aux, $
    /writeCounterMAF
@


1.3
log
@New filter shapes
@
text
@d145 2
a146 2
  ptanGHzL2AUX: l2aux, source=apriori.ptanGHz
  ptanTHzL2AUX: l2aux, source=apriori.ptanTHz
@


1.2
log
@New pointing grid
@
text
@d77 1
a77 1
    filterShapes='!calpath/MLS-Aura_L2Cal-Filters_v1-0-0_0000d000.txt', $
@


1.1
log
@First consolidated version
@
text
@d78 1
a78 1
    pointingGrids='!calpath/MLS-Aura_L2Cal-PFG_v1-0-0_0000d000.txt'
@

