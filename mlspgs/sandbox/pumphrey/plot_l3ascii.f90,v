head	1.4;
access;
symbols
	v5-02-NRT-19:1.4
	v6-00:1.4
	v5-02-NRT-18:1.4
	v5-02:1.4
	v5-01-NRT-17:1.4
	v5-01-NRT-16:1.4
	v5-01-NRT-15:1.4
	v5-01-NRT-14:1.4
	neuralnetworks-1-0:1.4.0.16
	cfm-single-freq-0-1:1.4.0.14
	v5-01:1.4
	v5-00:1.4
	v4-23-TA133:1.4.0.12
	mus-emls-1-70:1.4.0.10
	rel-1-0-englocks-work:1.4.0.8
	VUMLS1-00:1.4
	VPL1-00:1.4
	V4-22-NRT-08:1.4
	VAM1-00:1.4
	V4-21:1.4.0.6
	V4-13:1.4
	V4-12:1.4
	V4-11:1.4
	V4-10:1.4
	V3-43:1.4
	M4-00:1.4
	V3-41:1.4
	V3-40-PlusGM57:1.4.0.4
	V2-24-NRT-04:1.4
	V3-33:1.4
	V2-24:1.4
	V3-31:1.4
	V3-30-NRT-05:1.4
	cfm-01-00:1.4
	V3-30:1.4
	V3-20:1.4
	V3-10:1.4
	V2-23-NRT-02:1.4
	V2-23:1.4
	V2-22-NRT-01:1.4
	V2-22:1.4
	V2-21:1.4
	V2-20:1.4
	V2-11:1.4
	V2-10:1.4
	V2-00:1.4
	V1-51:1.4
	V1-50:1.4
	V1-45:1.4
	V1-44:1.4
	V1-43:1.4
	V1-42:1.4
	V1-41:1.4
	V1-32:1.4
	V1-40:1.4
	V1-31:1.4
	V1-13:1.4
	V1-12:1.4
	V1-11:1.4
	V1-10:1.4
	newfwm-feb03:1.4.0.2
	V1-04:1.4
	V1-03:1.4
	V1-02:1.4
	V1-00:1.4
	newfwm-sep01:1.3.0.2
	V0-7:1.3
	V0-5-Level2:1.3
	V0-5-SIPS:1.3
	V0_1:1.3;
locks; strict;
comment	@# @;


1.4
date	2001.11.15.11.27.10;	author pumphrey;	state Exp;
branches;
next	1.3;

1.3
date	2000.02.02.16.30.49;	author pumphrey;	state Exp;
branches;
next	1.2;

1.2
date	99.12.20.14.06.21;	author pumphrey;	state Exp;
branches;
next	1.1;

1.1
date	99.12.06.14.27.17;	author pumphrey;	state Exp;
branches;
next	;


desc
@@


1.4
log
@Dredging up to see if it still works.
@
text
@program test_l3ascii

  use l3ascii
  use plplot_module
  use MLSCommon
  character(len=80)::filename
  integer::unit
  logical::endoffile
  type(GriddedData_T)::field

  real(kind=r8)::outval,mult!,pressure,lat
  ! variables for plotting section
  integer::ic,nperdec,nlevs,nlats,firstlat,lastlat,i,j
  real(kind=PLFLT),allocatable,dimension(:,:)::z
  real(kind=PLFLT),allocatable,dimension(:)::x,y
  real(kind=PLFLT),parameter,dimension(25)::clev=0.2*(/ (ic,ic=0,24) /)+2.0
  !  real(kind=PLFLT),parameter,dimension(25)::clev=5*(/ (ic,ic=0,24) /)+180.0
  character(len=20)::multstring
  print*,"Enter l3ascii file name  "
  read "(a)" ,filename

  !open(file="deleteme",unit=1,status="replace",action="write")

  call l3ascii_open(filename,unit)
  print*,"Using unit",unit  
  print*,"Reading file"
  fieldsloop:do
     call l3ascii_read_field(unit,field,endoffile)
     print*,"Quantity: ",field%quantityName
     print*,"Description: ",field%description
     print*,"Units: ",field%units
     print*,"No of Heights: ",field%noHeights
     print*,"Vert coord type: ",field%verticalCoordinate
     print*,"Heights: ",field%heights
     print*,"No of Lats",field%noLats
     print*,"Lats: ",field%lats
     print*,"No of Lons",field%noLons
     print*,"Lons: ",field%lons
     print*,"No of Lsts",field%noLsts
     print*,"Lsts: ",field%lsts
     print*,"No of Szas",field%noSzas
     print*,"Szas: ",field%szas
     print*,"No. of dates",field%noDates
     print*,"start Dates:",field%dateStarts/(24*60*60)
     print*,"end Dates:",field%dateEnds/(24*60*60)

     print*,"Shape of Field:",shape(field%field)
     print*,"Shape of lats :",shape(field%lats)


     ! graphical test section. Uses plplot. Replace with calls to your 
     ! preferred graphics package. 

     ! Test interpolator

     nlats=85
     firstlat=-88.0
     lastlat=88.0
     nlevs=49+24
     nperdec=12
     call plsdev("xwin")
     call plinit() ! initiates PLPLOT

     allocate(z(1:nlats,1:nlevs),x(1:nlats),y(1:nlevs))
     x=firstlat+(/ (ic,ic=0,nlats-1) /)*(lastlat-firstlat)/ &
          real(nlats-1,kind=r8)
     y=-3.0 + (/ (ic/real(nperdec),ic=0,nlevs-1) /)
     y=10.0**(-y)
     !  print*,"Lats are",x
     do i=1,nlats
        do j=1,nlevs
           call l3ascii_interp_field(field,outval,lat=x(i),pressure=y(j), &
                date=0.0_r8)
           z(i,j)=outval
        enddo
     enddo
     z=z/l3ascii_get_multiplier(field)
     y=-log10(y)
     if(maxval(z)  >  1.0e-2) then
        mult=1
        multstring=" "
     else if(maxval(z)  >  1.0e-5) then
        mult=1.0e3
        multstring=" x 1.e3 "
     else if(maxval(z)  >  1.0e-8) then
        mult=1.0e6
        multstring=" x 1.e6 "
     else if(maxval(z)  >  1.0e-11) then
        mult=1.0e9
        multstring=" x 1.e9 "
     else if(maxval(z)  >  1.0e-14) then
        mult=1.0e12
        multstring=" x 1.e12 "
     endif
     z=z*mult
     !Makes contour plot
     call plfcp(z,x,y,xtitle="Latitude",ytitle="Log pressure",&
          title=trim(field%quantityName)//" / "//trim(field%units) & 
          // trim(multstring)) 
     
     deallocate(z,x,y)
     call plend()!ends PLPLOT



  end do fieldsloop
  
  close(unit=unit)

end program test_l3ascii
@


1.3
log
@Added titles as optional args
@
text
@d3 1
a3 1
  use gridded_data_module
d8 1
d28 1
a28 1
     call l3ascii_read_field(unit,field)
@


1.2
log
@Changed plot_l3ascii to work with MLSCommon
@
text
@d7 1
a7 1
  integer::unit,counter
d9 2
a10 2
  logical :: doleak
  real(kind=r8)::outval!,pressure,lat
d16 2
a17 2
!  real(kind=PLFLT),parameter,dimension(25)::clev=5*(/ (ic,ic=0,24) /)+180.0

d26 76
a101 118
  call l3ascii_read_field(unit,field)
  print*,"Quantity: ",field%quantityName
  print*,"Description: ",field%description
  print*,"Units: ",field%units
  print*,"No of Heights: ",field%noHeights
  print*,"Vert coord type: ",field%verticalCoordinate
  print*,"Heights: ",field%heights
  print*,"No of Lats",field%noLats
  print*,"Lats: ",field%lats
  print*,"No of Lons",field%noLons
  print*,"Lons: ",field%lons
  print*,"No of Lsts",field%noLsts
  print*,"Lsts: ",field%lsts
  print*,"No of Szas",field%noSzas
  print*,"Szas: ",field%szas
  print*,"No. of dates",field%noDates
  print*,"start Dates:",field%dateStarts/(24*60*60)
  print*,"end Dates:",field%dateEnds/(24*60*60)
  close(unit=unit)
  
  ! test intrpolate routine
!  lat=30.0
!  pressure=1.0
!  inttest:do 
!      call l3ascii_interp_field(field,outval,lat=lat,pressure=pressure)
!      print*,"Lat=",lat,"pr=",pressure," value=",outval
!      if (lat > 99.0) then 
!         exit inttest
!      endif
!      print*,"Enter another lat and pressure"
!      read*,lat,pressure
!  enddo inttest

  doleak=.false.
  if (doleak) then 
     print*," Applying leakage test. Type Ctrl-C to stop"
     print*," While this is running, run top and check the size"
     print*," of this program's process. If the process keeps getting bigger"
     print*," then there is a memory leak in this program "
     print*," (or maybe your Fortran 90 compiler.......)"
     counter=0
     leak:do counter=1,800
         call l3ascii_open(filename,unit)
         call l3ascii_read_field(unit,field)
         call l3ascii_read_field(unit,field)
!   call l3ascii_interp_field(field,outval,lat=30.0_r8,pressure=45.0_r8)
         close(unit=unit)
         if (modulo(counter,100) == 0) then
            print*,"Done ",counter," open/read/close cycles"
         endif
     end do leak
  end if
 
  ! graphical test section. Uses plplot. Replace with calls to your 
  ! preferred graphics package. 

  ! Test interpolator

  call plsdev("xwin")
  call plinit()
  allocate(z(field%noLats,field%noHeights),x(field%noLats),y(field%noHeights))
  z=transpose(field%field(:,:,1,1,1,1))
  x=field%lats
  y=-log10(field%heights)
  call plfcp(z,x,y,clevels=clev)
  deallocate(z,x,y)

  call plend() ! An obscure X error happens if you don't do this
  call plsdev("xwin")
  call plinit()! but only if you are in true colour mode. These two lines
  !              are unnecessary in 8-bit colour mode

  allocate(z(field%noDates,field%noHeights),x(field%noDates),&
       y(field%noHeights))
  z=transpose(field%field(:,1,1,1,1,:))
  x=field%dateStarts
  y=-log10(field%heights)
  call plfcp(z,x,y,clevels=clev)
  deallocate(z,x,y)
  call plend() ! An obscure X error happens if you don't do this
  call plsdev("xwin")
  call plinit()! but only if you are in true colour mode. These two lines
  !              are unnecessary in 8-bit colour mode(or 16-bit colour mode)
  
  allocate(z(field%noDates,field%noLats),x(field%noDates),&
       y(field%noLats))
  z=transpose(field%field(1,:,1,1,1,:))
  x=field%dateStarts
  y=field%lats
  call plfcp(z,x,y,clevels=clev)
  deallocate(z,x,y)

  
  nlats=85
  firstlat=-88.0
  lastlat=88.0
  nlevs=49
  nperdec=12
  call plend()
  call plsdev("xwin")
  call plinit() ! initiates PLPLOT
  
  allocate(z(1:nlats,1:nlevs),x(1:nlats),y(1:nlevs))
  x=firstlat+(/ (ic,ic=0,nlats-1) /)*(lastlat-firstlat)/real(nlats-1,kind=r8)
  y=-3.0 + (/ (ic/real(nperdec),ic=0,nlevs-1) /)
  y=10.0**(-y)
!  print*,"Lats are",x
  do i=1,nlats
      do j=1,nlevs
          call l3ascii_interp_field(field,outval,lat=x(i),pressure=y(j), &
               date=10.0_r8)
          z(i,j)=outval
      enddo
  enddo
  y=-log10(y)
  call plfcp(z,x,y,clevels=clev) !Makes contour plot
  deallocate(z,x,y)
  call plend()!ends PLPLOT
a103 3
  print*,"Shape of Field:",shape(field%field)
  print*,"Shape of lats :",shape(field%lats)

d105 1
d107 1
@


1.1
log
@Added a bunch of files to the sandbox: mostly files for testing
the l3ascii stuff.
@
text
@d5 1
a5 1
  use kinds_module
@

