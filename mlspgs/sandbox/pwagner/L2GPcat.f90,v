head	1.3;
access;
symbols
	v5-02-NRT-19:1.3
	v6-00:1.3
	v5-02-NRT-18:1.3
	v5-02:1.3
	v5-01-NRT-17:1.3
	v5-01-NRT-16:1.3
	v5-01-NRT-15:1.3
	v5-01-NRT-14:1.3
	neuralnetworks-1-0:1.3.0.14
	cfm-single-freq-0-1:1.3.0.12
	v5-01:1.3
	v5-00:1.3
	v4-23-TA133:1.3.0.10
	mus-emls-1-70:1.3.0.8
	rel-1-0-englocks-work:1.3.0.6
	VUMLS1-00:1.3
	VPL1-00:1.3
	V4-22-NRT-08:1.3
	VAM1-00:1.3
	V4-21:1.3.0.4
	V4-13:1.3
	V4-12:1.3
	V4-11:1.3
	V4-10:1.3
	V3-43:1.3
	M4-00:1.3
	V3-41:1.3
	V3-40-PlusGM57:1.3.0.2
	V2-24-NRT-04:1.3
	V3-33:1.3
	V2-24:1.3
	V3-31:1.3
	V3-30-NRT-05:1.3
	cfm-01-00:1.3
	V3-30:1.3
	V3-20:1.3
	V3-10:1.3
	V2-23-NRT-02:1.3
	V2-23:1.3
	V2-22-NRT-01:1.3
	V2-22:1.3
	V2-21:1.3
	V2-20:1.3
	V2-11:1.3
	V2-10:1.3
	V2-00:1.3
	V1-51:1.3
	V1-50:1.3
	V1-45:1.2
	V1-44:1.2
	V1-43:1.2;
locks; strict;
comment	@# @;


1.3
date	2004.09.10.20.25.16;	author pwagner;	state Exp;
branches;
next	1.2;

1.2
date	2004.03.03.19.11.17;	author pwagner;	state Exp;
branches;
next	1.1;

1.1
date	2004.02.25.00.03.34;	author pwagner;	state Exp;
branches;
next	;


desc
@@


1.3
log
@Many new options; however superseded by util/l2gpcat.f90
@
text
@! Copyright (c) 2004, California Institute of Technology.  ALL RIGHTS RESERVED.
! U.S. Government Sponsorship under NASA Contract NAS7-1407 is acknowledged.

!=================================
program L2GPcat ! catenates split L2GPData files, e.g. dgg
!=================================

   use Hdf, only: DFACC_CREATE, DFACC_RDWR, DFACC_READ
   use HDF5, only: h5fopen_f, h5fclose_f, h5fis_hdf5_f   
   use HDFEOS5, only: HE5T_NATIVE_CHAR
   use L2GPData, only: cpL2GPData, L2GPData_T, ReadL2GPData, DestroyL2GPContents, &
     & L2GPNameLen, MAXSWATHNAMESBUFSIZE
   use MACHINE, only: FILSEP, HP, IO_ERROR, GETARG
   use MLSCommon, only: R8
   use MLSFiles, only: mls_exists, MLS_IO_GEN_OPENF, MLS_IO_GEN_CLOSEF, &
     & HDFVERSION_4, HDFVERSION_5, MLS_INQSWATH
   use MLSMessageModule, only: MLSMessageConfig
   use MLSStrings, only: GetStringElement, NumStringElements
   use output_m, only: output
   use PCFHdr, only: GlobalAttributes
   use Time_M, only: Time_Now, USE_WALL_CLOCK
   
   implicit none

!------------------- RCS Ident Info -----------------------
   CHARACTER(LEN=130) :: Id = &                                                    
   "$Id: L2GPcat.f90,v 1.2 2004/03/03 19:11:17 pwagner Exp $"
   CHARACTER (LEN=*), PARAMETER :: ModuleName= "$RCSfile: L2GPcat.f90,v $"
!----------------------------------------------------------

! Brief description of program
! Catenate L2GPData from list of input files to a single output file
! May thus "unsplit" the dgg files

! To use this, copy it into
! mlspgs/tests/lib
! then enter "make depends" followed by "make"


! Then run it
! LF95.Linux/test [options] [input files] -o [output file]
  type options_T
    logical     :: verbose = .false.
    character(len=255) :: outputFile= 'default.he5'        ! output filename
    logical ::          columnsOnly = .false.
    character(len=3) :: convert= ' '                       ! e.g., '425'
  end type options_T
  
  type ( options_T ) :: options

  integer, parameter ::          MAXFILES = 100
  ! logical ::          columnsOnly
  character(len=255) :: filename          ! input filename
  ! character(len=255) :: outputFile= 'default.he5'        ! output filename
  character(len=255), dimension(MAXFILES) :: filenames
  integer            :: n_filenames
  integer     ::  i, count, status, error ! Counting indices & Error flags
  integer     ::  hdfversion1
  integer     ::  hdfversion2
  logical     :: is_hdf5
  ! logical     :: verbose = .false.
  real        :: t1
  real        :: t2
  real        :: tFile
  ! 
  MLSMessageConfig%useToolkit = .false.
  MLSMessageConfig%logFileUnit = -1
  USE_WALL_CLOCK = .true.
  CALL h5open_f(error)
  n_filenames = 0
  do      ! Loop over filenames
     call get_filename(filename, n_filenames, options)
     if ( filename(1:1) == '-' ) cycle
     if ( filename == ' ' ) exit
     if ( mls_exists(trim(filename)) /= 0 ) then
       print *, 'Sorry--file not found: ', trim(filename)
       cycle
     endif
     n_filenames = n_filenames + 1
     filenames(n_filenames) = filename
  enddo
  if ( n_filenames == 0 ) then
    if ( options%verbose ) print *, 'Sorry no input files to copy'
  else
    ! Check that the hdfversions of the input files accord with convert mode
    status = 0
    do i=1, n_filenames
     call h5fis_hdf5_f(filenames(i), is_hdf5, error)
     select case (options%convert)
     case ('425')
       if ( is_hdf5 ) then
         print *, 'Sorry--not recognized as hdf4 file: ', trim(filenames(i))
         status = 1
         cycle
       else
         hdfVersion1 = HDFVERSION_4
         hdfVersion2 = HDFVERSION_5
       endif
     case ('524')
       if ( .not. is_hdf5 ) then
         print *, 'Sorry--not recognized as hdf5 file: ', trim(filenames(i))
         status = 1
         cycle
       else
         hdfVersion1 = HDFVERSION_5
         hdfVersion2 = HDFVERSION_4
       endif
     case default
       if ( .not. is_hdf5 ) then
         hdfVersion1 = HDFVERSION_4
       else
         hdfVersion1 = HDFVERSION_5
       endif
       hdfVersion2 = hdfVersion1
     end select
    enddo
    call time_now ( t1 )
    if ( options%verbose ) print *, 'Copy l2gp data to: ', trim(options%outputFile)
    do i=1, n_filenames
      call time_now ( tFile )
      if ( options%verbose ) print *, 'Copying from: ', trim(filenames(i))
      call cpL2GPData(trim(filenames(i)), &
        & trim(options%outputFile), create2=(i==1), &
        & hdfVersion1=hdfVersion1, hdfVersion2=hdfVersion2, &
        & notUnlimited=.true., andGlAttributes=.true.)
      call sayTime('copying this file', tFile)
    enddo
    call sayTime('copying all files')
  endif
  call h5close_f(error)
contains
!------------------------- get_filename ---------------------
    subroutine get_filename(filename, n_filenames, options)
    ! Added for command-line processing
     character(LEN=255), intent(out) :: filename          ! filename
     integer, intent(in)             :: n_filenames
     type ( options_T ), intent(inout) :: options
     ! character(LEN=*), intent(inout) :: outputFile        ! output filename
     ! logical, intent(inout)          :: verbose
     ! Local variables
     integer ::                         error = 1
     integer, save ::                   i = 1
  ! Get inputfile name, process command-line args
  ! (which always start with -)
    do
      call getarg ( i+hp, filename )
      ! print *, i, ' th Arg: ', trim(filename)
      error = 0
      if ( filename(1:1) /= '-' ) exit
      if ( filename(1:3) == '-h ' ) then
        call print_help
      elseif ( filename(1:3) == '-o ' ) then
        call getarg ( i+1+hp, options%outputFile )
        i = i + 1
        exit
      elseif ( filename(1:5) == '-425 ' ) then
        options%convert = '425'
        exit
      elseif ( filename(1:5) == '-524 ' ) then
        options%convert = '524'
        exit
      elseif ( filename(1:3) == '-v ' ) then
        options%verbose = .true.
        exit
      else if ( filename(1:3) == '-f ' ) then
        call getarg ( i+1+hp, filename )
        i = i + 1
        exit
      else
        call print_help
      end if
      i = i + 1
    end do
    if ( error /= 0 ) then
      call print_help
    endif
    i = i + 1
    if (trim(filename) == ' ' .and. n_filenames == 0) then

    ! Last chance to enter filename
      print *,  "Enter the name of the HDFEOS4 or 5 L2GP file. " // &
       &  "The default output file name will be used."
      read(*,'(a)') filename
    endif
    
  end subroutine get_filename
!------------------------- print_help ---------------------
  subroutine print_help
  ! Print brief but helpful message
      write (*,*) &
      & 'Usage:l2gpcat [options] [filenames]'
      write (*,*) &
      & ' If no filenames supplied, you will be prompted to supply one'
      write (*,*) ' Options: -f filename => add filename to list of filenames'
      write (*,*) '                         (can do the same w/o the -f)'
      write (*,*) '          -o ofile    => copy swaths to ofile'
      write (*,*) '          -425        => convert from hdf4 to hdf5'
      write (*,*) '          -524        => convert from hdf5 to hdf4'
      write (*,*) '          -v          => switch on verbose mode'
      write (*,*) '          -h          => print brief help'
      stop
  end subroutine print_help
!------------------------- SayTime ---------------------
  subroutine SayTime ( What, startTime )
    character(len=*), intent(in) :: What
    real, intent(in), optional :: startTime
    real :: myt1
    if ( present(startTime) ) then
      myt1 = startTime
    else
      myt1 = t1
    endif
    call time_now ( t2 )
    call output ( "Timing for " // what // " = " )
    call output ( dble(t2 - myt1), advance = 'yes' )
  end subroutine SayTime

!==================
end program L2GPcat
!==================

! $Log: L2GPcat.f90,v $
! Revision 1.2  2004/03/03 19:11:17  pwagner
! Knows to write error messages to stdout
!
! Revision 1.1  2004/02/25 00:03:34  pwagner
! First commit
!

@


1.2
log
@Knows to write error messages to stdout
@
text
@d15 1
a15 1
   use MLSFiles, only: MLS_IO_GEN_OPENF, MLS_IO_GEN_CLOSEF, &
d27 1
a27 1
   "$Id: L2GPcat.f90,v 1.1 2004/02/25 00:03:34 pwagner Exp $"
d42 8
d52 1
a52 1
  logical ::          columnsOnly
d54 1
a54 1
  character(len=255) :: outputFile= 'default.he5'        ! output filename
d58 2
d61 1
a61 1
  logical     :: verbose = .false.
d72 1
a72 1
     call get_filename(filename, n_filenames, outputFile, verbose)
d75 2
a76 3
     call h5fis_hdf5_f(trim(filename), is_hdf5, error)
     if ( .not. is_hdf5 ) then
       print *, 'Sorry--not recognized as hdf5 file: ', trim(filename)
d83 1
a83 1
    if ( verbose ) print *, 'Sorry no input files to copy'
d85 32
d118 1
a118 1
    if ( verbose ) print *, 'Copy l2gp data to: ', trim(outputFile)
d121 1
a121 1
      if ( verbose ) print *, 'Copying from: ', trim(filenames(i))
d123 3
a125 2
        & trim(outputFile), create2=(i==1), &
        & hdfVersion=HDFVERSION_5, notUnlimited=.true., andGlAttributes=.true.)
d133 1
a133 1
    subroutine get_filename(filename, n_filenames, outputFile, verbose)
d137 3
a139 2
     character(LEN=*), intent(inout) :: outputFile        ! output filename
     logical, intent(inout)          :: verbose
d153 1
a153 1
        call getarg ( i+1+hp, outputFile )
d156 6
d163 1
a163 1
        verbose = .true.
d181 1
a181 1
      print *,  "Enter the name of the HDFEOS5 L2GP file. " // &
d197 2
d223 3
@


1.1
log
@First commit
@
text
@d16 2
a17 3
    & HDFVERSION_4, HDFVERSION_5, MLS_INQSWATH
   use MLSMessageModule, only: MLSMessage, MLSMSG_Allocate, MLSMSG_DeAllocate, &
    & MLSMSG_Error, MLSMSG_Warning, MLSMSG_Debug
d27 2
a28 2
   "$Id: L2GPtest.f90,v 1.4 2003/04/10 17:12:10 pwagner Exp $"
   CHARACTER (LEN=*), PARAMETER :: ModuleName= "$RCSfile: L2GPtest.f90,v $"
d56 2
d171 4
a174 1
! $Log: L2GPtest.f90,v $
@

