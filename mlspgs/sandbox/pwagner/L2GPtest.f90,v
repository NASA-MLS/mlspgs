head	1.5;
access;
symbols
	v5-02-NRT-19:1.5
	v6-00:1.5
	v5-02-NRT-18:1.5
	v5-02:1.5
	v5-01-NRT-17:1.5
	v5-01-NRT-16:1.5
	v5-01-NRT-15:1.5
	v5-01-NRT-14:1.5
	neuralnetworks-1-0:1.5.0.14
	cfm-single-freq-0-1:1.5.0.12
	v5-01:1.5
	v5-00:1.5
	v4-23-TA133:1.5.0.10
	mus-emls-1-70:1.5.0.8
	rel-1-0-englocks-work:1.5.0.6
	VUMLS1-00:1.5
	VPL1-00:1.5
	V4-22-NRT-08:1.5
	VAM1-00:1.5
	V4-21:1.5.0.4
	V4-13:1.5
	V4-12:1.5
	V4-11:1.5
	V4-10:1.5
	V3-43:1.5
	M4-00:1.5
	V3-41:1.5
	V3-40-PlusGM57:1.5.0.2
	V2-24-NRT-04:1.5
	V3-33:1.5
	V2-24:1.5
	V3-31:1.5
	V3-30-NRT-05:1.5
	cfm-01-00:1.5
	V3-30:1.5
	V3-20:1.5
	V3-10:1.5
	V2-23-NRT-02:1.5
	V2-23:1.5
	V2-22-NRT-01:1.5
	V2-22:1.5
	V2-21:1.5
	V2-20:1.5
	V2-11:1.5
	V2-10:1.5
	V2-00:1.5
	V1-51:1.5
	V1-50:1.5
	V1-45:1.5
	V1-44:1.5
	V1-43:1.5
	V1-42:1.5
	V1-41:1.5
	V1-32:1.5
	V1-40:1.5
	V1-31:1.5
	V1-13:1.3
	V1-12:1.3
	V1-11:1.3
	V1-10:1.3
	newfwm-feb03:1.3.0.2;
locks; strict;
comment	@# @;


1.5
date	2003.10.23.22.25.15;	author pwagner;	state Exp;
branches;
next	1.4;

1.4
date	2003.04.10.17.12.10;	author pwagner;	state Exp;
branches;
next	1.3;

1.3
date	2003.01.31.00.32.43;	author pwagner;	state Exp;
branches;
next	1.2;

1.2
date	2003.01.16.01.05.02;	author pwagner;	state Exp;
branches;
next	1.1;

1.1
date	2003.01.15.19.25.56;	author pwagner;	state Exp;
branches;
next	;


desc
@@


1.5
log
@Added test of AppendL2GPData
@
text
@! Copyright (c) 2003, California Institute of Technology.  ALL RIGHTS RESERVED.
! U.S. Government Sponsorship under NASA Contract NAS7-1407 is acknowledged.

!=================================
PROGRAM L2GPtest ! tests L2GPData routines
!=================================

   use Hdf, only: DFACC_CREATE, DFACC_RDWR, DFACC_READ
   use HDFEOS5, only: HE5T_NATIVE_CHAR
   use L2GPData, only: Dump, L2GPData_T, ReadL2GPData, WriteL2GPData, &
     SetupNewL2GPRecord, AppendL2GPData
   use MLSCommon, only: R8
   use MLSFiles, only: MLS_IO_GEN_OPENF, MLS_IO_GEN_CLOSEF, &
    & HDFVERSION_4, HDFVERSION_5
   use MLSStrings, only: GetStringElement, readIntsFromChars
   use PCFHdr, only: GlobalAttributes
   
   IMPLICIT NONE

!------------------- RCS Ident Info -----------------------
   CHARACTER(LEN=130) :: Id = &                                                    
   "$Id: L2GPtest.f90,v 1.4 2003/04/10 17:12:10 pwagner Exp $"
   CHARACTER (LEN=*), PARAMETER :: ModuleName= "$RCSfile: L2GPtest.f90,v $"
!----------------------------------------------------------

! Brief description of program
! This program tests the L2GPData subroutines.

! To use this, copy it into
! mlspgs/tests/lib
! then enter "make depends" followed by "make"


! Then run it
! rm -f l2gp.h4 l2gptest.out ; echo "1,4" | LF95.Linux.atlas/test > l2gptest.out

! Variables
   type (L2GPData_T)            :: l2gp, read_l2gp, alias_l2gp
   integer                      :: hdfVersion
   integer                      :: nTimes, time, freq, level
   integer                      :: returnStatus, swfid, record_length, swid
   integer, parameter           :: nFreqs = 10
   integer, parameter           :: nLevels = 10
   character(len=*), parameter  :: l2gpFilename_h4 = 'l2gp.h4'
   character(len=*), parameter  :: l2gpFilename_h5 = 'l2gp.h5'
   character(len=len(l2gpFilename_h4))  :: l2gpFilename
   character(len=*), parameter  :: swathName = 'test swath'
   character(len=*), parameter  :: aliasName = 'swath alias'
   character(len=80)            :: inputString
   character(len=8), dimension(2) :: int_chars
   integer, dimension(2)        :: the_ints
   real(r8)                     :: diff
   integer, external            :: he5_swwrlattr, he5_swopen, he5_EHwrglatt, &
     &                             HE5_SWattach, HE5_SWdetach, he5_SWsetalias, &
     &                             HE5_SWrdfld 
   character(len=*), parameter  :: alphabet = &
     & 'abcdefghijklmnopqrstuvwxyz'
   character(len=40000)         :: big_file
    real, allocatable :: real3(:,:,:)
   ! Some extra assigments
   GlobalAttributes%InstrumentName = 'Totally bogus name'
   GlobalAttributes%ProcessLevel = 'Level 9'
   GlobalAttributes%InputVersion = 'v 2.001'
   GlobalAttributes%PGEVersion = 'v 1.1'
   GlobalAttributes%StartUTC = '01012999T00:00:00Z'
   GlobalAttributes%EndUTC = '01012999T23:59:59.9Z'
   ! Executable
   call h5open_f(returnStatus)

   hdfVersion = HDFVERSION_5
   print *, 'How many profiles (e.g., 100), hdf version (4 or 5)'
   read(*, '(a80)') inputString
   the_ints = 0
   call GetStringElement( inputString, int_chars(1), 1, .FALSE.)
   call GetStringElement( inputString, int_chars(2), 2, .FALSE.)
   call readIntsFromChars ( int_chars, the_ints, ' ,')
   nTimes = the_ints(1)
   if ( the_ints(2) /= 0 ) hdfVersion = the_ints(2)
   if ( hdfVersion == HDFVERSION_4 ) then
     l2gpFilename = l2gpFilename_h4
   else
     l2gpFilename = l2gpFilename_h5
   endif
   print *,'input string  : ', inputString
   print *,'int_chars     : ', int_chars
   print *,'ints          : ', the_ints
   print *,'hdf version   : ', hdfVersion
   print *,'file name     : ', l2gpFilename
   print *,'num profiles  : ', nTimes
   call SetupNewL2GPRecord(l2gp, nFreqs, nLevels, nTimes)
   l2gp%name = swathName
   do time=1, nTimes
     do level=1, nLevels
       do freq=1, nFreqs
         l2gp%l2gpValue(freq, level, time) = freq + 100*level
       enddo
     enddo
     l2gp%latitude(time) = time
     l2gp%longitude(time) = time
     l2gp%solarTime(time) = time
     l2gp%solarZenith(time) = time
     l2gp%losAngle(time) = time
     l2gp%geodAngle(time) = time
     l2gp%time(time) = time
     l2gp%chunkNumber(time) = time
   enddo
   l2gp%l2gpPrecision = l2gp%l2gpValue/10000
   do level=1, nLevels
     l2gp%pressures(level) = level
   enddo
   do freq=1, nFreqs
     l2gp%frequency(freq) = freq
   enddo
   print *, 'Frequencies: (before writeL2GPData)'
   print *, l2gp%frequency
   swfid = mls_io_gen_openF('swopen', .TRUE., returnStatus, &         
    & record_length, DFACC_CREATE, FileName=l2gpFilename, &
    & hdfVersion=hdfVersion, debugOption=.false. )

   call writeL2GPData ( l2gp, swfid, swathName, &
    & hdfVersion=hdfVersion )             

   print *, 'Frequencies: (after writeL2GPData)'
   print *, l2gp%frequency
   ! Test some extra attribute stuff'
   if ( hdfVersion == HDFVERSION_5 ) then
     big_file = alphabet
     big_file = adjustr(big_file(1:len(big_file)-len(alphabet)))
     big_file = alphabet // big_file
     swid = HE5_SWattach (swfid, trim(swathName))
     returnStatus = he5_swwrlattr(swid, "L2gpValue", "attr_1char", &
       & HE5T_NATIVE_CHAR, 1, alphabet(1:1))
     returnStatus = he5_swwrlattr(swid, "L2gpValue", "attr_13chars", &
       & HE5T_NATIVE_CHAR, 13, alphabet(1:13))
     returnStatus = he5_swwrlattr(swid, "L2gpValue", "attr_26chars", &
       & HE5T_NATIVE_CHAR, len(alphabet), alphabet)
     returnStatus = he5_swwrlattr(swid, "L2gpValue", "attr_big_file", &
       & HE5T_NATIVE_CHAR, len(big_file), big_file)
     returnStatus = he5_SWdetach(swid)
     returnStatus = he5_EHwrglatt(swfid, 'attr_1char', &
       & HE5T_NATIVE_CHAR, 1, alphabet(1:1))
     returnStatus = he5_EHwrglatt(swfid, 'attr_13chars', &
       & HE5T_NATIVE_CHAR, 13, alphabet(1:13))
     returnStatus = he5_EHwrglatt(swfid, 'attr_26chars', &
       & HE5T_NATIVE_CHAR, len(alphabet), alphabet)
     returnStatus = he5_EHwrglatt(swfid, 'attr_big_file', &
       & HE5T_NATIVE_CHAR, len(big_file), big_file)
   ! And test the alias or soft link
     swid = HE5_SWattach (swfid, trim(swathName))
     returnStatus = he5_SWsetalias(swid, "L2gpValue", aliasName)
     returnStatus = he5_swwrlattr(swid, aliasName, "alias_attr_1char", &
       & HE5T_NATIVE_CHAR, 1, alphabet(1:1))
     returnStatus = he5_swwrlattr(swid, aliasName, "alias_attr_13chars", &
       & HE5T_NATIVE_CHAR, 13, alphabet(1:13))
     returnStatus = he5_swwrlattr(swid, aliasName, "alias_attr_26chars", &
       & HE5T_NATIVE_CHAR, len(alphabet), alphabet)
     returnStatus = he5_swwrlattr(swid, aliasName, "alias_attr_big_file", &
       & HE5T_NATIVE_CHAR, len(big_file), big_file)
     returnStatus = he5_SWdetach(swid)
   endif
   call AppendL2GPData(l2gp, swfid, &
    & swathName, offset=nTimes, TotNumProfs=2*nTimes, hdfVersion=hdfVersion)
   returnStatus = mls_io_gen_closeF('swclose', swfid, &
    & hdfVersion=hdfVersion)
   ! Now read what we just wrote and see if it's the same
   swfid = mls_io_gen_openF('swopen', .TRUE., returnStatus, &
        & record_length, DFACC_READ, FileName=l2gpFilename, &
        & hdfVersion=hdfVersion, debugOption=.false. )
   call ReadL2GPData ( swfid, swathName, read_l2gp, &
    & hdfVersion=hdfVersion )
   read_l2gp%name = swathName // ' (read)'
   if ( hdfVersion == HDFVERSION_5 ) then
     allocate(real3(nFreqs, nLevels, nTimes))
     swid = HE5_SWattach (swfid, trim(swathName))
     call SetupNewL2GPRecord(alias_l2gp, &
       & nFreqs, nLevels, nTimes)
     alias_l2gp = read_l2gp
     returnStatus = HE5_SWrdfld(swid, aliasName, &
       & (/0,0,0/), (/1,1,1/), (/nFreqs, nLevels, nTimes/), real3)
     if (returnStatus == -1) then
        print *, 'Tough luck reading field ' // aliasName
        stop
     endif
     alias_l2gp%l2gpValue = real3
     alias_l2gp%name = aliasName // ' (read)'
     returnStatus = he5_SWdetach(swid)
     deallocate(real3)
   endif
   returnStatus = mls_io_gen_closeF('swclose', swfid, &
    & hdfVersion=hdfVersion)

   ! Dump 2 l2gps and accumulate differences
   call dump(l2gp)
   call dump(read_l2gp)
   if ( hdfVersion == HDFVERSION_5 ) call dump(alias_l2gp)
   diff = 0.
   do time=1, nTimes
     do level=1, nLevels
       do freq=1, nFreqs
         diff = diff + &
          & abs( &
          & l2gp%l2gpValue(freq, level, time) &
          & - &
          & read_l2gp%l2gpValue(freq, level, time) &
          & )
       enddo
     enddo
   enddo
   print *, 'diff: ', diff
   call h5close_f(returnStatus)
!==================
END PROGRAM L2GPtest
!==================

! $Log: L2GPtest.f90,v $
! Revision 1.4  2003/04/10 17:12:10  pwagner
! Test some extra attribute stuff
!
! Revision 1.3  2003/01/31 00:32:43  pwagner
! Added Global attributes for writing
!
! Revision 1.2  2003/01/16 01:05:02  pwagner
! added h5open/close_f calls
!
! Revision 1.1  2003/01/15 19:25:56  pwagner
! First commit
!

@


1.4
log
@Test some extra attribute stuff
@
text
@d11 1
a11 1
     SetupNewL2GPRecord 
d22 1
a22 1
   "$Id: L2GPtest.f90,v 1.3 2003/01/31 00:32:43 pwagner Exp $"
d161 2
d216 3
@


1.3
log
@Added Global attributes for writing
@
text
@d9 1
d22 1
a22 1
   "$Id: L2GPtest.f90,v 1.2 2003/01/16 01:05:02 pwagner Exp $"
d38 1
a38 1
   type (L2GPData_T)            :: l2gp, read_l2gp
d41 1
a41 1
   integer                      :: returnStatus, swfid, record_length
d48 1
d53 7
d65 2
a66 2
   GlobalAttributes%StartUTC = '01012999Z00:00:00.0'
   GlobalAttributes%EndUTC = '01012999Z23:59:59.9'
d125 36
d170 17
d193 1
d214 3
@


1.2
log
@added h5open/close_f calls
@
text
@d15 1
d21 1
a21 1
   "$Id: L2GPtest.f90,v 1.1 2003/01/15 19:25:56 pwagner Exp $"
d51 7
d151 3
@


1.1
log
@First commit
@
text
@d20 2
a21 2
   "$Id: blastest.f90,v 1.1 2002/09/25 23:01:56 pwagner Exp $"
   CHARACTER (LEN=*), PARAMETER :: ModuleName= "$RCSfile: blastest.f90,v $"
d50 2
d137 1
d142 4
a145 1
! $Log: blastest.f90,v $
@

