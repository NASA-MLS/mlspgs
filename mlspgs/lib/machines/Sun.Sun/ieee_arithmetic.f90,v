head	1.10;
access;
symbols
	v5-02-NRT-19:1.10
	v6-00:1.10
	v5-02-NRT-18:1.10
	v5-02:1.10
	v5-01-NRT-17:1.10
	v5-01-NRT-16:1.10
	v5-01-NRT-15:1.10
	v5-01-NRT-14:1.10
	neuralnetworks-1-0:1.10.0.14
	cfm-single-freq-0-1:1.10.0.12
	v5-01:1.10
	v5-00:1.10
	v4-23-TA133:1.10.0.10
	mus-emls-1-70:1.10.0.8
	rel-1-0-englocks-work:1.10.0.6
	VUMLS1-00:1.10
	VPL1-00:1.10
	V4-22-NRT-08:1.10
	VAM1-00:1.10
	V4-21:1.10.0.4
	V4-13:1.10
	V4-12:1.10
	V4-11:1.10
	V4-10:1.10
	V3-43:1.10
	M4-00:1.10
	V3-41:1.10
	V3-40-PlusGM57:1.10.0.2
	V2-24-NRT-04:1.8
	V3-33:1.10
	V2-24:1.8
	V3-31:1.10
	V3-30-NRT-05:1.10
	cfm-01-00:1.10
	V3-30:1.10
	V3-20:1.10
	V3-10:1.9
	V2-23-NRT-02:1.8
	V2-23:1.8
	V2-22-NRT-01:1.8
	V2-22:1.8
	V2-21:1.8
	V2-20:1.8
	V2-11:1.8
	V2-10:1.8
	V2-00:1.8
	V1-51:1.6
	V1-50:1.6
	V1-45:1.6
	V1-44:1.6
	V1-43:1.6
	V1-42:1.5
	V1-41:1.5
	V1-32:1.5
	V1-40:1.5
	V1-31:1.5
	V1-30:1.5
	V1-13:1.3
	V1-12:1.3
	V1-11:1.3
	V1-10:1.3
	newfwm-feb03:1.3.0.2
	V1-04:1.3
	V1-03:1.3
	V1-02:1.3
	V1-00:1.3;
locks; strict;
comment	@# @;


1.10
date	2009.11.21.00.25.30;	author pwagner;	state Exp;
branches;
next	1.9;

1.9
date	2009.06.23.19.58.53;	author pwagner;	state Exp;
branches;
next	1.8;

1.8
date	2005.06.22.20.27.58;	author pwagner;	state Exp;
branches;
next	1.7;

1.7
date	2005.05.12.20.39.11;	author pwagner;	state Exp;
branches;
next	1.6;

1.6
date	2004.05.24.18.21.55;	author pwagner;	state Exp;
branches;
next	1.5;

1.5
date	2003.07.03.19.25.24;	author vsnyder;	state Exp;
branches;
next	1.4;

1.4
date	2003.07.03.19.11.57;	author vsnyder;	state Exp;
branches;
next	1.3;

1.3
date	2001.09.18.17.18.12;	author pwagner;	state Exp;
branches;
next	1.2;

1.2
date	2001.09.14.17.35.33;	author pwagner;	state Exp;
branches;
next	1.1;

1.1
date	2001.09.13.23.18.37;	author pwagner;	state Exp;
branches;
next	;


desc
@@


1.10
log
@Improved speed for ieee_is_finite
@
text
@! Copyright 2005, by the California Institute of Technology. ALL
! RIGHTS RESERVED. United States Government Sponsorship acknowledged. Any
! commercial use must be negotiated with the Office of Technology Transfer
! at the California Institute of Technology.

! This software may be subject to U.S. export control laws. By accepting this
! software, the user agrees to comply with all applicable U.S. export laws and
! regulations. User has the responsibility to obtain export licenses, or other
! export authority as may be required before exporting such information to
! foreign countries or providing access to foreign persons.

!=============================================================================
MODULE IEEE_ARITHMETIC              ! Common utilities for the MLSL1 program
!=============================================================================

!  use SUNSOWNIEEE, only: ir_isnan, ir_isinf, r_quiet_nan

  implicit NONE
  private

  ! These are the ieee functions and constants needed in MLS
  ! that Sun fails to supply.

  public :: IEEE_Class_Type
  public :: IEEE_Is_finite, IEEE_Is_NaN, IEEE_Quiet_NaN, IEEE_Support_NaN
  public :: IEEE_Value

!---------------------------- RCS Module Info ------------------------------
  character (len=*), private, parameter :: ModuleName= &
       "$RCSfile: ieee_arithmetic.f90,v $"
  private :: not_used_here 
!---------------------------------------------------------------------------

  ! This module contains glue routines for Sun's own f95 compiler
  ! since it fails to conform to ISO/IEC TR15580:1998(E).
  ! If we should ever obtain one that conforms we may cheerfully
  ! dispose of this crude hack

  type IEEE_Class_Type
    private
    integer :: What        ! 1 = IEEE_Quiet_Nam
                           ! 2 = IEEE_Signaling_Nan
  end type IEEE_Class_Type

  type(ieee_class_type), parameter :: ieee_quiet_nan = ieee_class_type(1)
  type(ieee_class_type), parameter :: ieee_signaling_nan = ieee_class_type(2)

!  real, parameter :: ieee_quiet_nan = r_quiet_nan()

  interface IEEE_Is_NaN
    module procedure IEEE_Is_NaN_D, IEEE_Is_NaN_S
  end interface

  interface IEEE_Support_NaN
    module procedure IEEE_Support_NaN_All
    module procedure IEEE_Support_NaN_D, IEEE_Support_NaN_S
  end interface

  interface IEEE_IS_FINITE
    module procedure IEEE_IS_FINITE_D, IEEE_IS_FINITE_S
  end interface

  interface IEEE_Value
    module procedure IEEE_Value_D, IEEE_Value_S
  end interface

CONTAINS

  elemental logical function IEEE_IS_FINITE_S( ARG )
  ! Formal args
    real, intent(in) ::          arg
  ! Private
    
    IEEE_IS_FINITE_S = ( abs(arg) <= Huge(arg) )
  END FUNCTION IEEE_IS_FINITE_S
  
  elemental logical function IEEE_IS_FINITE_D( ARG )
  ! Formal args
    double precision, intent(in) ::          arg
  ! Private
    
    IEEE_IS_FINITE_D = ( abs(arg) <= Huge(arg) )
  END FUNCTION IEEE_IS_FINITE_D
  
  elemental logical function IEEE_Is_Inf_io_D ( X ) result(res)
    double precision, intent(in) :: X
    character(len=80) :: reschar
    write(reschar, *) x
    res = ( index(reschar, 'Inf') > 0 .or. &
      & index(reschar, 'inf') > 0 .or. index(reschar, 'INF') > 0 )
  end function IEEE_Is_Inf_io_D

  elemental logical function IEEE_Is_Inf_io_S ( X ) result(res)
    real, intent(in) :: X
    character(len=80) :: reschar
    write(reschar, *) x
    res = ( index(reschar, 'Inf') > 0 .or. &
      & index(reschar, 'inf') > 0 .or. index(reschar, 'INF') > 0 )
  end function IEEE_Is_Inf_io_S

  elemental logical function IEEE_Is_NaN_D ( X )
    double precision, intent(in) :: X
    IEEE_Is_NaN_D = .not. ( x <= 0.0 .or. x >= 0.0 )
  end function IEEE_Is_NaN_D

  elemental logical function IEEE_Is_NaN_S ( X )
    real, intent(in) :: X
    IEEE_Is_NaN_S = .not. ( x <= 0.0 .or. x >= 0.0 )
  end function IEEE_Is_NaN_S

  logical function IEEE_Support_NaN_All ( )
    IEEE_Support_NaN_All = .true.
  end function IEEE_Support_NaN_All

  logical function IEEE_Support_NaN_D ( X )
    double precision, intent(in) :: X
    IEEE_Support_NaN_D = .true.
  end function IEEE_Support_NaN_D

  logical function IEEE_Support_NaN_S ( X )
    real, intent(in) :: X
    IEEE_Support_NaN_S = .true.
  end function IEEE_Support_NaN_S

  FUNCTION IEEE_VALUE_D ( X, CLASS ) result ( the_value )
  ! Formal args
    double precision, intent(in) ::      X
    type(ieee_class_type), intent(in) :: CLASS
    double precision ::                  the_value
    
  ! Private

  ! The following is made necessary only because Sun's own f95
  ! fails to comply--this obviously fails if any number ever matches this
    select case ( class%what )
    case ( ieee_quiet_nan%what )     ! IEEE_Quiet_NaN
      the_value = -9.e19
    case ( ieee_signaling_nan%what ) ! IEEE_Signaling_NaN
      the_value = 9.e19
    end select
  END FUNCTION IEEE_VALUE_D

  FUNCTION IEEE_VALUE_S ( X, CLASS ) result ( the_value )
  ! Formal args
    real, intent(in) ::                  X
    type(ieee_class_type), intent(in) :: CLASS
    real ::                              the_value
    
  ! Private

  ! The following is made necessary only because Sun's own f95
  ! fails to comply--this obviously fails if any number ever matches this
    select case ( class%what )
    case ( ieee_quiet_nan%what )     ! IEEE_Quiet_NaN
      the_value = -9.e19
    case ( ieee_signaling_nan%what ) ! IEEE_Signaling_NaN
      the_value = 9.e19
    end select
  END FUNCTION IEEE_VALUE_S

! ----------------------------------------------  not_used_here  -----
!--------------------------- end bloc --------------------------------------
  logical function not_used_here()
  character (len=*), parameter :: IdParm = &
       "$Id: ieee_arithmetic.f90,v 1.9 2009/06/23 19:58:53 pwagner Exp $"
  character (len=len(idParm)) :: Id = idParm
    not_used_here = (id(1:1) == ModuleName(1:1))
    print *, Id ! .mod files sometimes change if PRINT is added
  end function not_used_here
!---------------------------------------------------------------------------

END MODULE IEEE_ARITHMETIC

!
! $Log: ieee_arithmetic.f90,v $
! Revision 1.9  2009/06/23 19:58:53  pwagner
! Prevent Intel from optimizing ident string away
!
! Revision 1.8  2005/06/22 20:27:58  pwagner
! Reworded Copyright statement, moved rcs id
!
! Revision 1.7  2005/05/12 20:39:11  pwagner
! Made ieee_is_finite elemental
!
! Revision 1.6  2004/05/24 18:21:55  pwagner
! IEEE_Is_NaN can handle both single, double precision
!
! Revision 1.5  2003/07/03 19:25:24  vsnyder
! Remove some comments that are no longer true
!
! Revision 1.4  2003/07/03 19:11:57  vsnyder
! Add IEEE_Support_NaN, IEEE_Is_NaN, IEEE_Class_Type.
! Make IEEE_Quiet_NaN to be of IEEE_Class_Type.
! Make IEEE_Value more like the IEEE TR and Fortran 2003 standard.
!
! Revision 1.3  2001/09/18 17:18:12  pwagner
! Strictly so the darn thing compiles--let others (or Sun) make it work
!
! Revision 1.2  2001/09/14 17:35:33  pwagner
! Fixed an obvious blunder; expanded some comments
!
! Revision 1.1  2001/09/13 23:18:37  pwagner
! First commit
!
@


1.9
log
@Prevent Intel from optimizing ident string away
@
text
@d30 1
a30 1
       "$RCSfile: $"
a71 2
!    integer, external ::         ir_isnan
!    integer, external ::         ir_isinf
d74 1
a74 6
    IEEE_IS_FINITE_S = .FALSE.
    if( IEEE_Is_NaN_S(arg) ) RETURN
    if( IEEE_Is_Inf_io_S(arg) ) RETURN
!    if( ir_isnan(arg) == 1 ) RETURN
!    if( ir_isinf(arg) == 1 ) RETURN
    IEEE_IS_FINITE_S = .TRUE.
a79 2
!    integer, external ::         ir_isnan
!    integer, external ::         ir_isinf
d82 1
a82 6
    IEEE_IS_FINITE_D = .FALSE.
    if( IEEE_Is_NaN_D(arg) ) RETURN
    if( IEEE_Is_Inf_io_D(arg) ) RETURN
!    if( ir_isnan(arg) == 1 ) RETURN
!    if( ir_isinf(arg) == 1 ) RETURN
    IEEE_IS_FINITE_D = .TRUE.
d165 1
a165 1
       "$Id: read_apriori.f90 is it here $"
d176 3
@


1.8
log
@Reworded Copyright statement, moved rcs id
@
text
@d176 1
a177 1
!---------------------------- RCS Ident Info -------------------------------
d179 2
a180 3
       "$Id: $"
  character (len=len(idParm)), save :: Id = idParm
!---------------------------------------------------------------------------
d182 1
d184 1
d190 3
@


1.7
log
@Made ieee_is_finite elemental
@
text
@d1 10
a10 2
! Copyright (c) 2005, California Institute of Technology.  ALL RIGHTS RESERVED.
! U.S. Government Sponsorship under NASA Contracts NAS7-1407/NAS7-03001 is acknowledged.
d28 1
a28 4
!---------------------------- RCS Ident Info -------------------------------
  character (len=*), private, parameter :: IdParm = &
       "$Id: ieee_arithmetic.f90,v 1.6 2004/05/24 18:21:55 pwagner Exp $"
  character (len=len(idParm)), private :: Id = idParm
d30 2
a31 1
       "$RCSfile: ieee_arithmetic.f90,v $"
d175 10
d189 3
@


1.6
log
@IEEE_Is_NaN can handle both single, double precision
@
text
@d1 2
a2 2
! Copyright (c) 2000, California Institute of Technology.  ALL RIGHTS RESERVED.
! U.S. Government Sponsorship under NASA Contract NAS7-1407 is acknowledged.
d22 1
a22 1
       "$Id: ieee_arithmetic.f90,v 1.5 2003/07/03 19:25:24 vsnyder Exp $"
d63 1
a63 1
  LOGICAL FUNCTION IEEE_IS_FINITE_S( ARG )
d78 1
a78 1
  LOGICAL FUNCTION IEEE_IS_FINITE_D( ARG )
d93 1
a93 1
  logical function IEEE_Is_Inf_io_D ( X ) result(res)
d101 1
a101 1
  logical function IEEE_Is_Inf_io_S ( X ) result(res)
d173 3
@


1.5
log
@Remove some comments that are no longer true
@
text
@d22 1
a22 1
       "$Id: ieee_arithmetic.f90,v 1.4 2003/07/03 19:11:57 vsnyder Exp $"
d53 4
d63 1
a63 1
  LOGICAL FUNCTION IEEE_IS_FINITE( ARG )
d70 3
a72 1
    IEEE_IS_FINITE = .FALSE.
d75 2
a76 2
    IEEE_IS_FINITE = .TRUE.
  END FUNCTION IEEE_IS_FINITE
d78 31
d173 3
@


1.4
log
@Add IEEE_Support_NaN, IEEE_Is_NaN, IEEE_Class_Type.
Make IEEE_Quiet_NaN to be of IEEE_Class_Type.
Make IEEE_Value more like the IEEE TR and Fortran 2003 standard.
@
text
@d10 1
a10 1
  IMPLICIT NONE
d13 1
a13 1
  ! These are the ieee functions and constants needed in mls
d15 1
a15 2
  ! An improvement might be to introduce function interfaces to allow
  ! both single and double precision versions.
d22 1
a22 1
       "$Id: machine.f90,v 1.6 2002/02/05 00:38:39 pwagner Exp $"
d25 1
a25 1
       "$RCSfile: machine.f90,v $"
a32 3
  ! The following is made necessary only because Sun's own f95
  ! fails to comply--this obviously fails if any number ever matches this

d103 3
d121 3
d136 5
@


1.3
log
@Strictly so the darn thing compiles--let others (or Sun) make it work
@
text
@d11 1
d17 11
a27 8
  public :: ieee_value, ieee_quiet_nan, ieee_is_finite

  PRIVATE :: Id, ModuleName
  !---------------------------- RCS Ident Info -------------------------------
  CHARACTER (LEN=256) :: Id = &
       "$Id: ieee_arithmetic.f90,v 1.2 2001/09/14 17:35:33 pwagner Exp $"
  CHARACTER (LEN=*), PARAMETER :: ModuleName= "$RCSFile:$"
  !---------------------------------------------------------------------------
a33 2
  private

d37 9
a45 1
  real, parameter :: ieee_quiet_nan = -9.E19
d48 13
a62 10
  FUNCTION IEEE_VALUE( ARG1, ARG2 ) result ( the_value )
  ! Formal args
    real, intent(in) ::          arg1
    real, intent(in) ::          arg2
    real ::                      the_value
    
  ! Private
    the_value = arg2
  END FUNCTION IEEE_VALUE
  
d76 54
d134 3
@


1.2
log
@Fixed an obvious blunder; expanded some comments
@
text
@d21 1
a21 1
       "$Id: ieee_arithmetic.f90,v 1.1 2001/09/13 23:18:37 pwagner Exp $"
d32 2
a33 3
  ! The following should work because r_quiet_nan() is 
  ! an intrinsic Sun f95 function (under other compilers it may not be
  ! but then this whole shmeer wouldn't be necessary, either)
d35 2
a36 1
  real, parameter :: ieee_quiet_nan = r_quiet_nan()
d53 2
d58 2
a59 2
    if( ir_isnan(arg) ) RETURN
    if( ir_isinf(arg) ) RETURN
d67 3
@


1.1
log
@First commit
@
text
@d8 2
d12 4
d21 1
a21 1
       "$Id: ieee_arithmetic.f90,v 2.1 2001/02/23 20:52:08 perun Exp $"
d27 2
d32 4
d59 1
a59 1
  END FUNCTION IEEE_VALUE
d65 3
@

