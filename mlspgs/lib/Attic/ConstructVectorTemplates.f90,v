head	1.4;
access;
symbols
	V0_1:1.3;
locks; strict;
comment	@# @;


1.4
date	2000.09.05.17.19.22;	author dcuddy;	state dead;
branches;
next	1.3;

1.3
date	2000.06.19.23.44.18;	author lungu;	state Exp;
branches;
next	1.2;

1.2
date	2000.01.11.22.51.34;	author livesey;	state Exp;
branches;
next	1.1;

1.1
date	99.12.18.03.00.45;	author livesey;	state Exp;
branches;
next	;


desc
@@


1.4
log
@moved to mlspgs/l2
@
text
@! Copyright (c) 1999, California Institute of Technology.  ALL RIGHTS RESERVED.
! U.S. Government Sponsorship under NASA Contract NAS7-1407 is acknowledged.

!=============================================================================
MODULE ConstructVectorTemplates ! Construct a template for a vector
!=============================================================================

  USE MLSCommon
  USE MLSMessageModule
  USE VectorsModule
  USE QuantityTemplates
  USE MLSCF

  IMPLICIT NONE
  PUBLIC
  
  PRIVATE :: Id, ModuleName
  !---------------------------- RCS Ident Info -------------------------------
  CHARACTER (LEN=256) :: Id = &
       "$Id: ConstructVectorTemplates.f90,v 1.3 2000/06/19 23:44:18 lungu Exp $"
  CHARACTER (LEN=*), PARAMETER :: ModuleName= "$RCSfile: ConstructVectorTemplates.f90,v $"
  !---------------------------------------------------------------------------

  ! This module performs the vector template aspects of the construct task

CONTAINS

  ! This is the main routine for this module

  SUBROUTINE CreateVecTemplateFromMLSCfInfo(cfInfo,vectorTemplate,&
       & quantityTemplates)

    ! Dummy arguments
    TYPE(mlscfEntry_T), INTENT(IN) :: cfInfo
    TYPE (VectorTemplate_T), INTENT(OUT) :: vectorTemplate
    TYPE (QuantityTemplate_T), DIMENSION(:) :: quantityTemplates

    ! Local variables
    INTEGER :: keyNo,status,quantityNo
    CHARACTER (LEN=NameLen) :: name=""
    LOGICAL, DIMENSION(:), ALLOCATABLE :: selected
    TYPE (MLSCFCell_T) :: cell
    Character*80 errstr
    ! Executable code

    ALLOCATE(selected(SIZE(quantityTemplates)), STAT=status)
    IF (status/=0) CALL MLSMessage(MLSMSG_Error,ModuleName,MLSMSG_Allocate//&
         & "selected")
    selected=.FALSE.

    ! Simply loop through the mlscf information supplied.
    !  If it's a NAME= then copy it to name, else it's a
    ! quantityTemplate name.

    DO keyNo=1,cfInfo%mlscfEntryNoKeys
       cell=cfInfo%cells(keyNo)
       IF (TRIM(cell%keyword)=="NAME") THEN
          name=cell%charValue
       ELSE
          quantityNo=LinearSearchStringArray(quantityTemplates%name,&
               & cell%charValue,caseInsensitive=.TRUE.)
          IF (quantityNo==0) CALL MLSMessage(MLSMSG_Error,ModuleName,&
               & "No such quantityTemplate: "//cell%charValue)
          selected(quantityNo)=.TRUE.
       ENDIF
    END DO

    IF (LEN_TRIM(name)==0) CALL MLSMessage(MLSMSG_Error,ModuleName,&
         & "No name given for vector")
    IF (COUNT(selected)==0) CALL MLSMessage(MLSMSG_Error,ModuleName,&
         & "No quantities chosen for vector: "//name)

    ! Now finally construct the vector template

    CALL ConstructVectorTemplate(name,PACK(quantityTemplates,selected),&
         & vectorTemplate)
    DEALLOCATE(selected, STAT=status)
    IF (status/=0) CALL MLSMessage(MLSMSG_Error,ModuleName,MLSMSG_DeAllocate//& 
         & "selected")

  END SUBROUTINE CreateVecTemplateFromMLSCfInfo

!=============================================================================
END MODULE ConstructVectorTemplates
!=============================================================================

!
! $Log: ConstructVectorTemplates.f90,v $
! Revision 1.3  2000/06/19 23:44:18  lungu
! Added status check after deallocate.
!
! Revision 1.2  2000/01/11 22:51:34  livesey
! Dealt with ramifications of change from read_parse_l2cf to MLSCF
!
! Revision 1.1  1999/12/18 03:00:45  livesey
! First version
!
!
@


1.3
log
@Added status check after deallocate.
@
text
@d20 1
a20 1
       "$Id: ConstructVectorTemplates.f90,v 1.2 2000/01/11 22:51:34 livesey Exp $"
d89 3
@


1.2
log
@Dealt with ramifications of change from read_parse_l2cf to MLSCF
@
text
@d20 1
a20 1
       "$Id: ConstructVectorTemplates.f90,v 1.1 1999/12/18 03:00:45 livesey Exp $"
d43 1
a43 1

d46 1
a46 1
    ALLOCATE(selected(SIZE(quantityTemplates)),STAT=status)
d77 3
d89 3
@


1.1
log
@First version
@
text
@d12 1
a12 1
  USE Temporary_Types
d20 2
a21 2
       "$Id: $"
  CHARACTER (LEN=*), PARAMETER :: ModuleName= "$RCSfile$"
d34 1
a34 1
    TYPE(l2cfEntry), INTENT(IN) :: cfInfo
d42 1
a42 1
    TYPE (L2CFCell) :: cell
d51 1
a51 1
    ! Simply loop through the l2cf information supplied.
d55 1
a55 1
    DO keyNo=1,cfInfo%l2cfEntryNoKeys
d85 4
a88 1
! $Log$
@

