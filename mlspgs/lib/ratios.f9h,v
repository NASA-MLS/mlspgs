head	2.2;
access;
symbols
	v5-02-NRT-19:2.2
	v6-00:2.2
	v5-02-NRT-18:2.2
	v5-02:2.2
	v5-01-NRT-17:2.2
	v5-01-NRT-16:2.2
	v5-01-NRT-15:2.2
	v5-01-NRT-14:2.2
	neuralnetworks-1-0:2.2.0.14
	cfm-single-freq-0-1:2.2.0.12
	v5-01:2.2
	v5-00:2.2
	v4-23-TA133:2.2.0.10
	mus-emls-1-70:2.2.0.8
	rel-1-0-englocks-work:2.2.0.6
	VUMLS1-00:2.2
	VPL1-00:2.2
	V4-22-NRT-08:2.2
	VAM1-00:2.2
	V4-21:2.2.0.4
	V4-13:2.2
	V4-12:2.2
	V4-11:2.2
	V4-10:2.2
	V3-43:2.2
	M4-00:2.2
	V3-41:2.2
	V3-40-PlusGM57:2.2.0.2
	V2-24-NRT-04:2.1
	V3-33:2.2
	V2-24:2.1
	V3-31:2.2
	V3-30-NRT-05:2.2
	cfm-01-00:2.2
	V3-30:2.2
	V3-20:2.2
	V3-10:2.1
	V2-23-NRT-02:2.1
	V2-23:2.1
	V2-22-NRT-01:2.1
	V2-22:2.1;
locks; strict;
comment	@# @;


2.2
date	2009.09.29.23.37.04;	author pwagner;	state Exp;
branches;
next	2.1;

2.1
date	2007.07.16.23.33.59;	author pwagner;	state Exp;
branches;
next	;


desc
@@


2.2
log
@Some extra debugging
@
text
@! Copyright 2007, by the California Institute of Technology. ALL
! RIGHTS RESERVED. United States Government Sponsorship acknowledged. Any
! commercial use must be negotiated with the Office of Technology Transfer
! at the California Institute of Technology.

! This software may be subject to U.S. export control laws. By accepting this
! software, the user agrees to comply with all applicable U.S. export laws and
! regulations. User has the responsibility to obtain export licenses, or other
! export authority as may be required before exporting such information to
! foreign countries or providing access to foreign persons.

! $Id: ratios.f9h,v 2.1 2007/07/16 23:33:59 pwagner Exp $
      ! ------------------- ratios -----------------------
      ! subroutine ratios( array1, array2, exvalues, exratios, &
      !  & minratio, maxratio, meanratio, stddevratio, rmsratio, medianratio, &
      !  & fillValue, op )
      !  integer, parameter                             :: KINDVALUE = r4
      !  ! Args
      real(KINDVALUE), dimension(:), intent(in)      :: array1, array2
      real(KINDVALUE), dimension(2), intent(out)     :: exvalues
      real(KINDVALUE), dimension(2), intent(out)     :: exratios
      real(KINDVALUE), optional, intent(out)         :: minratio
      real(KINDVALUE), optional, intent(out)         :: maxratio
      real(KINDVALUE), optional, intent(out)         :: meanratio
      real(KINDVALUE), optional, intent(out)         :: stddevratio
      real(KINDVALUE), optional, intent(out)         :: rmsratio
      real(KINDVALUE), optional, intent(out)         :: medianratio
      real(KINDVALUE), optional, intent(in)          :: FillValue
      character, optional, intent(in)                :: op
      ! Internal variables
      integer                                        :: i
      integer, dimension(1)                          :: lmax
      real(KINDVALUE)                                :: myFillValue
      character                                      :: operator
      real(KINDVALUE)                                :: rmin, rmax, rmean, &
        & rstddev, rrms, rmedian
      real(KINDVALUE), dimension(size(array1))       :: tarray1, tarray2
      real(KINDVALUE)                                :: vmax
      real(KINDVALUE)                                :: Zero
      logical, parameter                             :: DEBUG = .false.
      ! Executable
      ! 1st--no matter what, let every returned arg be given some value
      exvalues = 0._KINDVALUE
      exratios = -1._KINDVALUE
      if ( present(minratio   ) ) minratio    = -1._KINDVALUE
      if ( present(maxratio   ) ) maxratio    = -1._KINDVALUE
      if ( present(meanratio  ) ) meanratio   = -1._KINDVALUE
      if ( present(stddevratio) ) stddevratio = -1._KINDVALUE
      if ( present(rmsratio   ) ) rmsratio    = -1._KINDVALUE
      if ( present(medianratio) ) medianratio = -1._KINDVALUE
      operator = ' '
      if ( present(op) ) operator = op
      if ( size(array1) < 1 .or. size(array2) < 0 ) return
      select case (operator)
      case ('-')
        tarray1 = array1 - array2
        tarray2 = max( abs(array1), abs(array2) )
      case ('+')
        tarray1 = array1 + array2
        tarray2 = max( abs(array1), abs(array2) )
      case ('<')
        tarray1 = min( abs(array1), abs(array2) )
        tarray2 = max( abs(array1), abs(array2) )
      case default
        tarray1 = array1
        tarray2 = array2
      end select
      if ( DEBUG ) then
        call outputNamedValue( 'operator', operator )
        call output( 'array1', advance='yes' )
        call output( array1, advance='yes' )
        call output( 'array2', advance='yes' )
        call output( array2, advance='yes' )
        call output( 'tarray1', advance='yes' )
        call output( tarray1, advance='yes' )
        call output( 'tarray2', advance='yes' )
        call output( tarray2, advance='yes' )
      endif
      vmax = maxval( abs(tarray1) )
      if ( vmax <= 0._KINDVALUE ) return
      exvalues(1) = vmax
      lmax = maxloc( abs(tarray1) )
      if ( abs(tarray2(lmax(1))) /= 0._KINDVALUE ) &
        & exratios(1) = vmax / abs(tarray2(lmax(1)))
      vmax = 0._KINDVALUE
      do i=1, min( size(tarray1), size(tarray2) )
        if ( tarray2(i) == 0._KINDVALUE ) cycle
        if ( abs(tarray1(i) / tarray2(i)) > vmax ) then
          vmax = abs(tarray1(i) / tarray2(i))
          exvalues(2) = abs(tarray1(i))
          exratios(2) = vmax
        endif
      enddo
      if ( DEBUG ) then
        call outputNamedValue( 'vmax', vmax )
        call outputNamedValue( 'lmax', lmax )
        call outputNamedValue( 'exvalues(1)', exvalues(1) )
        call outputNamedValue( 'exvalues(2)', exvalues(1) )
      endif
      
      if ( present(minratio) .or. present(maxratio) .or. present(meanratio) .or. &
        & present(stddevratio) .or. present(rmsratio) .or. present(medianratio) ) then
        myFillValue = -999.99
        Zero = 0.
        ! ratio = myFillValue
        where ( tarray2 /= Zero )
          ! ratio = abs( tarray1 / tarray2 )
          tarray1 = abs( tarray1 / tarray2 )
        elsewhere
          tarray1 = myFillValue
        end where
        call allstats( tarray1, min=rmin, max=rmax, mean=rmean, &
          & stddev=rstddev, rms=rrms, median=rmedian, fillValue=myFillValue )
        if ( present(minratio   ) ) minratio    = rmin
        if ( present(maxratio   ) ) maxratio    = rmax
        if ( present(meanratio  ) ) meanratio   = rmean
        if ( present(stddevratio) ) stddevratio = rstddev
        if ( present(rmsratio   ) ) rmsratio    = rrms
        if ( present(medianratio) ) medianratio = rmedian
      endif
      
      ! end subroutine ratios
!
! $Log: ratios.f9h,v $
! Revision 2.1  2007/07/16 23:33:59  pwagner
! First commit
!
@


2.1
log
@First commit
@
text
@d12 1
a12 1
! $Id: ratios.f9h,v 2.3 2006/03/08 01:13:38 pwagner Exp $
d40 1
d68 11
d94 6
d125 3
@

