head	1.11;
access;
symbols
	v5-02-NRT-19:1.11
	v6-00:1.11
	v5-02-NRT-18:1.11
	v5-02:1.11
	v5-01-NRT-17:1.11
	v5-01-NRT-16:1.11
	v5-01-NRT-15:1.11
	v5-01-NRT-14:1.11
	neuralnetworks-1-0:1.11.0.8
	cfm-single-freq-0-1:1.11.0.6
	v5-01:1.11
	v5-00:1.11
	v4-23-TA133:1.11.0.4
	mus-emls-1-70:1.11.0.2
	rel-1-0-englocks-work:1.8.0.2
	VUMLS1-00:1.8
	VPL1-00:1.8
	V4-22-NRT-08:1.8
	VAM1-00:1.8
	V4-21:1.7.0.2
	V4-13:1.7
	V4-12:1.6
	V4-11:1.6
	V4-10:1.6
	V3-43:1.6
	M4-00:1.6
	V3-41:1.6
	V3-40-PlusGM57:1.6.0.2
	V2-24-NRT-04:1.6
	V3-33:1.6
	V2-24:1.6
	V3-31:1.6
	V3-30-NRT-05:1.6
	cfm-01-00:1.6
	V3-30:1.6
	V3-20:1.6
	V3-10:1.6
	V2-23-NRT-02:1.6
	V2-23:1.6
	V2-22-NRT-01:1.6
	V2-22:1.6
	V2-21:1.6
	V2-20:1.6
	V2-11:1.6
	V2-10:1.6
	V2-00:1.6
	V1-51:1.5
	V1-50:1.5
	V1-45:1.5
	V1-44:1.5
	V1-43:1.5
	V1-42:1.5
	V1-41:1.5
	V1-32:1.5
	V1-40:1.5
	V1-31:1.5
	V1-30:1.5
	V1-13:1.5
	V1-12:1.5
	V1-11:1.5
	V1-10:1.5
	newfwm-feb03:1.5.0.2
	V1-04:1.4
	V1-03:1.4
	V1-02:1.4
	V1-00:1.4
	newfwm-sep01:1.4.0.2
	V0-7:1.4
	V0-5-Level2:1.3
	V0-5-SIPS:1.3;
locks; strict;
comment	@# @;


1.11
date	2018.04.19.00.43.00;	author vsnyder;	state Exp;
branches;
next	1.10;

1.10
date	2018.04.11.22.04.14;	author vsnyder;	state Exp;
branches;
next	1.9;

1.9
date	2018.04.11.20.32.04;	author vsnyder;	state Exp;
branches;
next	1.8;

1.8
date	2015.03.28.00.54.34;	author vsnyder;	state Exp;
branches;
next	1.7;

1.7
date	2014.09.04.23.53.35;	author vsnyder;	state Exp;
branches;
next	1.6;

1.6
date	2005.06.22.20.03.55;	author pwagner;	state Exp;
branches;
next	1.5;

1.5
date	2002.10.02.16.00.09;	author bwknosp;	state Exp;
branches
	1.5.2.1;
next	1.4;

1.4
date	2001.06.07.21.56.55;	author pwagner;	state Exp;
branches;
next	1.3;

1.3
date	2001.03.28.02.57.49;	author vsnyder;	state Exp;
branches;
next	1.2;

1.2
date	2000.12.04.23.31.58;	author vsnyder;	state Exp;
branches;
next	1.1;

1.1
date	2000.11.17.20.50.54;	author pwagner;	state Exp;
branches;
next	;

1.5.2.1
date	2003.04.16.17.32.37;	author vsnyder;	state Exp;
branches;
next	1.5.2.2;

1.5.2.2
date	2003.04.30.01.56.45;	author vsnyder;	state Exp;
branches;
next	;


desc
@@


1.11
log
@Turn on address computation for tracking
@
text
@! Copyright 2005, by the California Institute of Technology. ALL
! RIGHTS RESERVED. United States Government Sponsorship acknowledged. Any
! commercial use must be negotiated with the Office of Technology Transfer
! at the California Institute of Technology.

! This software may be subject to U.S. export control laws. By accepting this
! software, the user agrees to comply with all applicable U.S. export laws and
! regulations. User has the responsibility to obtain export licenses, or other
! export authority as may be required before exporting such information to
! foreign countries or providing access to foreign persons.

! Needs: 
  ! use Allocate_Deallocate, only: Test_Allocate, Test_DeAllocate
! in the including scoping unit or its host.

! $Id: addItemToDatabase.f9h,v 1.10 2018/04/11 22:04:14 vsnyder Exp $

    integer :: NewSize, Status
    character(127) :: ERMSG

    ! Executable code

    newSize = 1
    if ( associated(database) )  newSize = newsize + size(database)

    block
      use, intrinsic :: ISO_C_Binding, only: C_Intptr_t, C_Loc
      integer(C_Intptr_t) :: Addr
      allocate ( tempDatabase(newSize), STAT=status, ERRMSG=ermsg )
      addr = 0
      if ( status == 0 ) addr = transfer ( c_loc(tempDatabase(1)), addr )
      call test_allocate ( status, moduleName, "tempDatabase", uBounds = newSize, &
        & elementSize = storage_size(tempDatabase) / 8, &
        & ERMSG=ERMSG, Address=addr )

      if ( newSize>1 ) tempDatabase(1:newSize-1) = database
      if ( associated(database) ) then
        addr = 0
        if ( size(database) > 0 ) &
          & addr = transfer ( c_loc(Database(lbound(database,1))), addr )
        deallocate ( database, STAT=status, ERRMSG=ermsg )
        call test_deallocate ( status, moduleName, "database", &
          & (newSize-1) * storage_size(tempDatabase) / 8, ermsg, addr )
      end if
      database => tempDatabase
      database(newSize) = item
    end block

! $Log: addItemToDatabase.f9h,v $
! Revision 1.10  2018/04/11 22:04:14  vsnyder
! Remove declaration for unused variable
!
! Revision 1.9  2018/04/11 20:32:04  vsnyder
! Compute the address for allocate/deallocate logging
!
! Revision 1.8  2015/03/28 00:54:34  vsnyder
! Stuff to trace allocate/deallocate addresses -- mostly commented out
! because NAG build 1017 doesn't yet allow arrays as arguments to C_LOC.
!
! Revision 1.7  2014/09/04 23:53:35  vsnyder
! Add allocate/deallocate size tracking
!
! Revision 1.6  2005/06/22 20:03:55  pwagner
! Reworded Copyright statement, moved rcs id
!
! Revision 1.5  2002/10/02 16:00:09  bwknosp
! Added Id and RCS info
!
! Revision 1.4  2001/06/07 21:56:55  pwagner
! Added Copyright statement
!
! Revision 1.3  2001/03/28 02:57:49  vsnyder
! Setup CVS to use IdParm
!
! Revision 1.2  2000/12/04 23:31:58  vsnyder
! Move more common code into include; add Id variable.
!
! Revision 1.1  2000/11/17 20:50:54  pwagner
! Moved here from lib & l2
!
! Revision 2.1  2000/09/15 21:50:19  livesey
! New version of L2GP data, moved some stuff from l2 to lib
!
! Revision 2.1  2000/09/11 17:49:53  vsnyder
! Initial code.
!
@


1.10
log
@Remove declaration for unused variable
@
text
@d16 1
a16 1
! $Id: addItemToDatabase.f9h,v 1.9 2018/04/11 20:32:04 vsnyder Exp $
d23 2
a24 5
    if ( associated(database) ) then ! tree_checker prevents duplicate names
      newSize=SIZE(database)+1
    else
      newSize=1
    end if
d50 3
@


1.9
log
@Compute the address for allocate/deallocate logging
@
text
@d13 1
a13 2
  ! use MLSMessageModule, only: MLSMessage, MLSMSG_Allocate, MLSMSG_DeAllocate, &
  !            & MLSMSG_Error
d16 1
a16 1
! $Id: addItemToDatabase.f9h,v 1.8 2015/03/28 00:54:34 vsnyder Exp $
d18 1
a18 2
    integer :: newSize, status
    integer(selected_int_kind(18)) :: Addr
d32 1
a32 1
      allocate ( tempDatabase(newSize), STAT=status, ERRMSG=ERMSG )
d44 1
a44 1
        deallocate ( database, stat=status, ERRMSG=ERMSG )
d53 3
@


1.8
log
@Stuff to trace allocate/deallocate addresses -- mostly commented out
because NAG build 1017 doesn't yet allow arrays as arguments to C_LOC.
@
text
@d17 1
a17 1
! $Id: addItemToDatabase.f9h,v 1.7 2014/09/04 23:53:35 vsnyder Exp $
d31 3
a33 6
! Intel 14 doesn't allow the BLOCK construct
!     block
!       Intel ifort 15.0 doesn't allow USE inside BLOCK, so put it in
!       every subprogram that includes this file, at least for now (2015/02/13).
!       use, intrinsic :: ISO_C_Binding, only: C_Intptr_t, C_Loc
!       integer(C_Intptr_t) :: Addr
d36 1
a36 1
!       if ( status == 0 ) addr = transfer ( c_loc(tempDatabase(1)), addr )
d44 2
a45 2
!         if ( size(database) > 0 ) &
!           & addr = transfer ( c_loc(Database(lbound(database,1))), addr )
d52 1
a52 1
!     end block
d55 4
@


1.7
log
@Add allocate/deallocate size tracking
@
text
@d17 1
a17 1
! $Id: addItemToDatabase.f9h,v 1.6 2005/06/22 20:03:55 pwagner Exp $
d20 2
d31 25
a55 12
    allocate(tempDatabase(newSize),STAT=status)
    call test_allocate ( status, moduleName, "tempDatabase", &
      & uBounds = newSize, elementSize = storage_size(tempDatabase) / 8 )

    if ( newSize>1 ) tempDatabase(1:newSize-1) = database
    if ( associated(database) ) then   
      deallocate ( database, stat=status )
      call test_deallocate ( status, moduleName, "database", &
        & (newSize-1) * storage_size(tempDatabase) / 8 )
    end if
    database => tempDatabase
    database(newSize) = item
d58 3
@


1.6
log
@Reworded Copyright statement, moved rcs id
@
text
@d17 1
a17 1
! $Id: updatediagonalvec_0.f9h,v 2.3 2005/06/22 17:44:11 pwagner Exp $
d30 2
a31 2
    if ( status/=0 ) call MLSMessage ( MLSMSG_Error, ModuleName, &
      & MLSMSG_Allocate // "tempDatabase")
d34 5
a38 3
    if ( ASSOCIATED(database) ) deallocate ( database, stat=status )
    if ( status /= 0 ) call MLSMessage ( MLSMSG_Error, ModuleName, &
      & MLSMSG_DeAllocate // "database" )
d43 3
@


1.5
log
@Added Id and RCS info
@
text
@d1 10
a10 2
! Copyright (c) 1999, California Institute of Technology.  ALL RIGHTS RESERVED.
! U.S. Government Sponsorship under NASA Contract NAS7-1407 is acknowledged.
d17 2
a18 7
!---------------------------- RCS Ident Info -------------------------------
  character (len=*), parameter :: IdParm = &
       "$Id: addItemToDatabase.f9h,v 1.3 2002/09/13 22:47:14 pwagner Exp $"
  character (len=len(idParm)) :: Id = idParm
  character (len=*), parameter :: ModuleName= &
       "$RCSfile: addItemToDatabase.f9h,v $"
!---------------------------------------------------------------------------
d41 3
@


1.5.2.1
log
@Remove ModuleName from CVS ident stuff.  Make RCSFile stuff a comment so
that the ModuleName in the enclosing module will be used in error messages.
@
text
@d11 1
a11 1
       "$Id: addItemToDatabase.f9h,v 1.5 2002/10/02 16:00:09 bwknosp Exp $"
d13 2
a14 1
!       $RCSfile: addItemToDatabase.f9h,v $
a37 3
! Revision 1.5  2002/10/02 16:00:09  bwknosp
! Added Id and RCS info
!
@


1.5.2.2
log
@Minor improvement, remove bogus comment
@
text
@d11 1
a11 1
       "$Id: addItemToDatabase.f9h,v 1.5.2.1 2003/04/16 17:32:37 vsnyder Exp $"
d19 1
a19 1
    if ( associated(database) ) then
d29 4
a32 6
    if ( associated(database) ) then
      tempDatabase(1:newSize-1) = database
      deallocate ( database, stat=status )
      if ( status /= 0 ) call MLSMessage ( MLSMSG_Error, ModuleName, &
        & MLSMSG_DeAllocate // "database" )
    end if
a36 4
! Revision 1.5.2.1  2003/04/16 17:32:37  vsnyder
! Remove ModuleName from CVS ident stuff.  Make RCSFile stuff a comment so
! that the ModuleName in the enclosing module will be used in error messages.
!
@


1.4
log
@Added Copyright statement
@
text
@d9 7
a15 6

  !---------------------------- RCS Ident Info -------------------------------
    character(len=*), parameter :: IdParm = &
      & "$Id: addItemToDatabase.f9h,v 1.3 2001/03/28 02:57:49 vsnyder Exp $"
    character(len=len(idParm)) :: Id = idParm
  !---------------------------------------------------------------------------
d38 3
@


1.3
log
@Setup CVS to use IdParm
@
text
@d1 3
d12 1
a12 1
      & "$Id: addItemToDatabase.f9h,v 1.2 2000/12/04 23:31:58 vsnyder Exp $"
d37 3
@


1.2
log
@Move more common code into include; add Id variable.
@
text
@d8 3
a10 2
    character(len=130) :: Id = &
      & "$Id: $"
d34 3
@


1.1
log
@Moved here from lib & l2
@
text
@d6 5
d30 1
d33 3
@

