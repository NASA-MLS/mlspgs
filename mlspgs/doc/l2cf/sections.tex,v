head	1.2;
access;
symbols
	v5-02-NRT-19:1.2
	v6-00:1.2
	v5-02-NRT-18:1.2
	v5-02:1.2
	v5-01-NRT-17:1.2
	v5-01-NRT-16:1.2
	v5-01-NRT-15:1.2
	v5-01-NRT-14:1.2
	neuralnetworks-1-0:1.2.0.8
	cfm-single-freq-0-1:1.2.0.6
	v5-01:1.2
	v5-00:1.2
	v4-23-TA133:1.2.0.4
	mus-emls-1-70:1.2.0.2;
locks; strict;
comment	@% @;


1.2
date	2018.06.22.23.27.17;	author pwagner;	state Exp;
branches;
next	1.1;

1.1
date	2018.06.15.23.09.24;	author pwagner;	state Exp;
branches;
next	;


desc
@@


1.2
log
@Brought up-to-date
@
text
@\section{Sections}
\label{sec:Sections}

With the exception of the cursory treatment meted out to
 \snippet{MLSSignals}, and  \snippet{Spectroscopy} 
 our goal is to explain the purpose and use of each Section type in enough detail
 so that you can read an l2cf with understanding and one day write your own.
 
Let's assume you're already familiar with terminology like \emph{l2cf, template,
expand, macro, include, toolkit}.

\subsection{Our wiki pages}

The MLS wiki pages contain a lot of material on the l2cf. Please read them. If
you discover that they are in error or out-of-date, please correct them.

\citet{MLSWikiSections}
\subsection{\snippet{MLSSignals}}
\label{sec:MLSSignals}
Unless you are crafting an l2cf for a new instrument you will include an
existing \snippet{MLSSignals} section in your template. For reasons that are not quite
clear even to us we show below the section included in most MLS-Aura l2cfs.

\lstinputlisting{Signals.l2cf}

\subsection{\snippet{Spectroscopy}}
Like the previous section type you will simply include 
the \snippet{Spectroscopy}. How it appears will depend on whether you are
using an hdf-formatted version and whether your run will use the toolkit panoply

We show only the example you are most likely to encounter.

\lstinputlisting{Spectroscopy.l2cf}

\subsection{\snippet{ReadApriori}}
The \snippet{ReadApriori} section can appear multiple times. Its purpose is to
declare and read \snippet{GriddedData\_T} data type used to hold daylong
values of climatology, meteorology, and a priori vmr quantities.

Before being expanded, here is the \snippet{readclimatology.l2cf}

\lstinputlisting{readclimatology.l2cf}

After being expanded it becomes
\lstinputlisting{readclimatology-exp.l2cf}

The above examples declare and read the \snippet{GriddedData\_T} type with a
single line. It is sometimes better to declare the \snippet{GriddedData\_T} on
one line but read it on a later line. That's how we cope with the possibility
that the meteorology might be read from any one of four different file types.

\lstinputlisting{readandmergegeos59.l2cf}

\subsection{\snippet{MergeGrids}}
The last example furnished previews of the \snippet{MergeGrids} section type.
Like the \snippet{ReadApriori} section, \snippet{MergeGrids} can declare a new
\snippet{GriddedData\_T}. Instead of reading it directly from an external file,
the special tricks \snippet{MergeGrids} can play are \snippet{MergeGrids},
\snippet{Concatenate}, \snippet{ConvertEtaToP}, and \snippet{wmoTropFromGrids}.

\subsubsection{\snippet{Special commands}}
So far we omitted mentioning the following:

\subsubsection{\snippet{ChangeSettings}}
This command can appear in either \snippet{ReadApriori} or \snippet{MergeGrids}.
Among the settings it allows you to change, the \snippet{/silent} flag
turns off the warning messages printed by the hdf library as your l2cf feels
around to decide what kind of meteorology files it was given.

\subsubsection{\snippet{ReadGriddedData}}
Tries to read the values field of the \snippet{GriddedData\_T}. If it fails it
will fail gracefully, leaving the \snippet{GriddedData\_T} in an
\snippet{empty} state.

\subsubsection{\snippet{IsGridEmpty}}
Sets the value of the \snippet{Run-time flag} given in the Boolean
field. The flag is set to \snippet{true} if the \snippet{GriddedData\_T} is
\snippet{empty}. Otherwise it is set to \snippet{false}.

\subsubsection{\snippet{Delete}}
Deallocates the values field of a \snippet{GriddedData\_T}. Afterward it is
\snippet{empty}.

More than that, it is a very flexible command, able to free up memory by
\snippet{Delete}-ing other derived data types.

\subsubsection{\snippet{Dump, Diff}}
Prints the values field of a \snippet{GriddedData\_T}. 

More than that, it is a very flexible command, able to print almost any derived
type, and even basic data types like strings and numbers.

\subsection{\snippet{GlobalSettings}}
This section sets values and settings affecting the entire run. Unless you are
using the \emph{toolkit} panoply, here is where you set the \emph{date, start} and
\emph{end times},
names and locations of the level 1 files, \emph{etc}.

We have worked hard to enable this section to be completed automatically. Unless
we failed, the relevant lines in your template will be simply

\lstinputlisting{globalsettings-short.l2cf}

Otherwise you'll need to edit a section looking like the following

\lstinputlisting{globalsettings.l2cf}

\subsection{\snippet{ChunkDivide}}
This section determines how \emph{mlsl2} divides the level 1 data into independent
\snippet{chunks}.

You will always include the same \snippet{ChunkDivide} section. In fact we have
made it so that you can easily switch between a \emph{Snoop} size chunk and
standard production size by setting or unsetting an \emph{m4 macro}, namely
\snippet{flagDoingSnoop}.

Here is an example drawn from a template


\lstinputlisting{chunkdivideplushgrid.l2cf}

Here is the same example after being expanded
\lstinputlisting{chunkdivide-exp.l2cf}
After the \snippet{ChunkDivide} section, every section before \snippet{Output}
is within the loop of \emph{chunks}. That means that for a \emph{serial} run,
the sections are looped over as many times as there are chunks. For a
\emph{parallel} run the master ignores the loop and instead organizes and
manages \emph{slave} tasks. Each \emph{slave} carries out the commands in the
l2cf for just its chunk of data.

\subsection{\snippet{Construct}}
The last examples stole a little bit of our thunder. The \snippet{Construct} is
indeed the section where you can define the \snippet{HGrid}. It is also where
you can define many other data templates, in particular
\snippet{QuantityTemplates} and
\snippet{VectorTemplates}.

The \emph{include} statement at the end of the example above does all this for
\emph{standard species}.

The following highly artificial example shows some of the types of
commands and definitions that can appear in this section type.
\lstinputlisting{construct-exp.l2cf}

\subsection{\snippet{Fill}}
Compared with other section types, there are more
\snippet{Fill} sections in the average l2cf and there are more types of commands that can
appear in a \snippet{Fill} section.

The following artificial example is hopefully illustrative.
\lstinputlisting{fill-exp.l2cf}


\subsection{\snippet{Join}}
Almost as common as the \snippet{Fill}, \snippet{Join} is primarily where
\emph{mlsl2} has a chance to write its results to product files. The following
artificial example may show this.

\lstinputlisting{join-exp.l2cf}

\subsection{\snippet{Retrieve}}
Where the heavy lifting is done. Despite that, \snippet{Retrieve} is the least
documented part of the l2cf, meriting no pages in our wiki. For the sake of
completeness and to salve a sore conscience we will include two examples
below without comment

\lstinputlisting{retrieve-1.l2cf}
\lstinputlisting{retrieve-2.l2cf}

\subsection{\snippet{Output}}
In a parallel run this phase is executed only by the master task. We worked hard
to make the template able to configure itself. Unless we failed, your template
should just contain these lines

\lstinputlisting{output.l2cf}
Otherwise, it will look more like this
\lstinputlisting{output-exp.l2cf}

%\citet{MLSWiki}

%\cite{MLSWikiSections}
%\citet{ReadEtal06}

%%% Local Variables: 
%%% mode: latex
%%% TeX-master: "cfm"
%%% End: 
@


1.1
log
@First commit
@
text
@d7 1
a7 2
 so that you can read an l2cf with understanding and one day write one
 yourself.
d47 4
a50 4
The above examples declare and read the GriddedData type with a single line. It
is sometimes better to declare the GriddedData on one line but read it on a
later line. That's especially true when coping with the possibility that the
meteorology might be read from any one of four different file types.
d55 5
a59 6
That last example furnishes examples of the \snippet{MergeGrids} section type.
although prematurely. Like the \snippet{ReadApriori} section,
\snippet{MergeGrids} can declare a new \snippet{GriddedData\_T}. Instead
of reading it directly from an external file, the special tricks \snippet{MergeGrids}
can play are \snippet{MergeGrids}, \snippet{Concatenate}, \snippet{ConvertEtaToP},
and \snippet{wmoTropFromGrids}.
d66 1
a66 1
Among the setting it allows you to change, the \snippet{/silent} flag
d72 2
a73 2
will fail gracefully, leaving the \snippet{GriddedData\_T} in a state of
\snippet{empty}.
d81 1
a81 1
Deallocates the values field of a \snippet{GriddedData\_T}. Afterwards it is
d84 3
d88 4
a91 4
Prints the values field of a \snippet{GriddedData\_T}. Actually it is a very
flexible command, able
to print almost any data type, and even basic data types like strings and
numbers.
d94 5
d109 3
d114 1
a114 1
standard production size by setting or unsetting an \emph{m4 macros},
d122 1
a122 1
Here is that example after being expanded
d125 5
a129 6
is
within the loop of \emph{chunks}. That means that for a \emph{serial} run, the
sections are looped over as many times as there are chunks. For a
\emph{parallel} run the master ignores the l2cf and instead organizes and
manages \emph{slave} tasks. Each \emph{slave} carries out the commands
in the l2cf for just its chunk of data.
d134 3
a136 2
you can define many other data templates, in particular QuantityTemplates and
VectorTemplates.
d141 2
a142 2
The following example is artificial, but it does show some of the types of
command and definitions that can appear in this section type.
a144 3
Note that these would never appear in the same \snippet{Construct} or even in
the same \emph{phase}.

d146 1
a146 1
The most flexible type of section, it is also the most common. There are more
d148 1
a148 1
appear in a \snippet{Fill} than in any other type of section.
d150 1
a150 1
The following example is artificial but hopefully illustrative.
d157 1
a157 1
example is artificial, too.
d162 2
a163 2
Where the heavy work is done. Despite that, \snippet{Retrieve} is the least
documented part of l2cf, meriting no pages in our wiki. For the sake of
@

