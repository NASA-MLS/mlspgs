head	1.1;
access;
symbols
	v5-02-NRT-19:1.1
	v6-00:1.1
	v5-02-NRT-18:1.1
	v5-02:1.1
	v5-01-NRT-17:1.1
	v5-01-NRT-16:1.1
	v5-01-NRT-15:1.1
	v5-01-NRT-14:1.1
	neuralnetworks-1-0:1.1.0.14
	cfm-single-freq-0-1:1.1.0.12
	v5-01:1.1
	v5-00:1.1
	v4-23-TA133:1.1.0.10
	mus-emls-1-70:1.1.0.8
	rel-1-0-englocks-work:1.1.0.6
	VUMLS1-00:1.1
	VPL1-00:1.1
	V4-22-NRT-08:1.1
	VAM1-00:1.1
	V4-21:1.1.0.4
	V4-13:1.1
	V4-12:1.1
	V4-11:1.1
	V4-10:1.1
	V3-43:1.1
	M4-00:1.1
	V3-41:1.1
	V3-40-PlusGM57:1.1.0.2
	V3-33:1.1
	V3-31:1.1
	V3-30-NRT-05:1.1
	cfm-01-00:1.1
	V3-30:1.1
	V3-20:1.1
	V3-10:1.1;
locks; strict;
comment	@% @;


1.1
date	2008.06.11.20.14.53;	author vsnyder;	state Exp;
branches;
next	;


desc
@@


1.1
log
@Initial commit
@
text
@\documentclass[11pt]{article}
\usepackage[fleqn]{amsmath}\textwidth 6.5in
\oddsidemargin -0.25in
%\evensidemargin -0.5in
\topmargin -0.25in
\textheight 9in

\newcommand{\docname}{\bf wvs-056}
\newcommand{\docdate}{6 July 2007}

\begin{document}

%\tracingcommands=1
\newlength{\hW} % heading box width
\newlength{\pW} % page number field width
\settowidth{\hW}{\docname}
\settowidth{\pW}{Page \pageref{lastpage}\ of \pageref{lastpage}}
\ifdim \pW > \hW \setlength{\hW}{\pW} \fi
\makeatletter
\def\@@biblabel#1{#1.}
\newcommand{\ps@@twolines}{%
  \renewcommand{\@@oddhead}{%
    \docdate\hfill\parbox[t]{\hW}{{\hfill\docname}\newline
                          Page \thepage\ of \pageref{lastpage}}}%
\renewcommand{\@@evenhead}{}%
\renewcommand{\@@oddfoot}{}%
\renewcommand{\@@evenfoot}{}%
}%
\makeatother
\pagestyle{twolines}

\vspace{-10pt}
\begin{tabbing}
\phantom{References: }\= \\
To: \>Bill\\
Subject: \>Refractive correction\\
From: \>Van Snyder\\
%References: \>wvs-051
\end{tabbing}

\parindent 0pt \parskip 6pt
\vspace{-10pt}

The {\tt comp\_refcor} subroutine evaluates the integral in Equation 10.12
of the 10 August 2004 MLS Forward Model ATBD, page 45, \emph{viz.}

\begin{equation}\label{one}
I = \Delta s^{\text{refr}}_{i\rightarrow i-1} =
\int_{H_{i-1}}^{H_i} \frac{\mathcal{N}(H) H}
                          {\sqrt{\mathcal{N}(H)^2 H^2 - \mathcal{N}_t^2 H_t^2}}
                     \,\text{d} H
\end{equation}

using Gauss-Legendre quadrature.

We have $\mathcal{N}(H)$ at $H_i$ for $1 \leq i \leq n$, and will assume a
functional form for $\mathcal{N}(H)$, $H_{i-1} \leq H \leq H_i$, in Equation
(\ref{three}).

The integrand has an integrable singularity at $H=H_t$, which causes problems
for quadrature.  To eliminate it, substitute $x = \sqrt{\mathcal{N}(H)^2 H^2 -
\mathcal{N}_t^2 H_t^2}$ in Equation (\ref{one}) giving
\begin{equation}\label{two}
I = \int_{x_{i-1}}^{x_i}
      \frac{\text{d}x}
           {\mathcal{N}(h)+h\frac{\text{d}}{\text{d}h}\mathcal{N}(h)}
   = \int_{x_{i-1}}^{x_i}
      \frac{\text{d}x}{\frac{\text{d}}{\text{d}h} h \mathcal{N}(h)}
\end{equation}
where $h$ is the solution of $h \mathcal{N}(h) = \sqrt{H_t^2 \mathcal{N}_t^2 + x^2}$ and
$x_i = \sqrt{|H_i^2 \mathcal{N}_i^2 - H_t^2 \mathcal{N}_t^2|}$

Let $n_i = \mathcal{N}_i-1$ and assume a functional form
\begin{equation}\begin{split}\label{three}
\mathcal{N}(h) = \,&1+E \text{ where}\\
E =\,& n_{i-1} e^{\epsilon(h-H_{i-1})}
   = n_{i-1} \left( \frac{n_i}{n_{i-1}} \right) ^ {\left(\frac{h-H_{i-1}}
                                                             {H_i-H_{i-1}}
                                                             \right)}
   = n_i^{\left(\frac{h-H_{i-1}}{H_i-H_{i-1}}\right)}
     n_{i-1}^{\left(\frac{H_i-h}{H_i-H_{i-1}}\right)}
   = n_i^p n_{i-1}^{1-p}\\
p =\,& \frac{h-H_{i-1}}{H_i-H_{i-1}} \text{, and}\\
\epsilon =\,& \frac{\log \frac{n_i}{n_{i-1}}}{H_i-H_{i-1}}
\end{split}\end{equation}

Let $q_j$ = Gauss-Legendre abscissa between $x_{i-1}$ and $x_i$ and
$R = \sqrt{H_t^2 \mathcal{N}_t^2 + q_j^2}$, and $h$ be the solution of
\begin{equation}\label{four}
h \mathcal{N}(h) = h \left(1+n_{i-1} e^{\epsilon(h-H_{i-1})}\right) = R\,.
\end{equation}

The transformed integral is $\int_{x_{i-1}}^{x_i} f(x) \text{d}x$ where $f(x) =
\frac1{\mathcal{N}(h) + h \epsilon E} = \frac1{1 + E(1 + h \epsilon)}$ and
$\epsilon E = \frac{\text{d}N}{\text{d}h}$.  Remember that $h$ is a function of
$x$.

When $n_{i-1} \approx n_i,\, \epsilon \approx 0$, and therefore
$N \approx \mathcal{N}_{i-1}$ throughout the interval, which allows to evaluate
the integral explicitly
$\left.I \approx \frac1{\mathcal{N}} \sqrt{\mathcal{N}^2 H^2 -
\mathcal{N}_t^2H_t^2} \right|_{H=H_{i-1}}^{H_i}$.

Evaluating the integral in Equation (\ref{two}) using Gauss-Legendre quadrature
gives $I = \int_{x_{i-1}}^{x_i}\frac1{1+E+h\epsilon E}\,\text{d}x
\approx (x_i-x_{i-1}) \sum_{j=1}^3 f_j\, \omega_j$,
where $f_j = f(q_j)$ and $\omega_j$ is a Gauss-Legendre weight.

If $\frac{\text{d}}{\text{d}h} h \mathcal{N}$ changes sign between $H_{i-1}$
and $H_i$ the solution of Equation (\ref{four}) is ambiguous, so points
interior to the interval shouldn't be used.

Using the trapezoidal rule we have $I \approx \frac\delta2 (f_i + f_{i-1})$,
where $\delta = x_i - x_{i-1}$ and $f_i$ is $f$ evaluated on the end of the
interval.  At the ends of the interval, $h = H_i$, and $E_i = n_i$, so $f_i =
\frac1{\mathcal{N}_i + H_i \epsilon n_i} = \frac1{1+n_i(1+\epsilon H_i)}$.  If
better accuracy than the trapezoidal rule is needed, the Euler-Maclaurin
summation formula for moderate $m$, say 1 or 2, \emph{viz.} $I \approx
\frac\delta2 (f_i + f_{i-1}) - \sum_{k=1}^m \frac{B_{2k} \delta^{2k}}{(2k)!}
\left( f^{(2k-1)}_i - f^{(2k-1)}_{i-1}\right)$ where $B_{2k}$ are Bernoulli
numbers (see 25.4.7 on page 886 of Abramowitz and Stegun), would be simpler
than Gauss-Legendre, avoid the need for interior points, and therefore avoid
the need to solve Equation (\ref{four}).

However the integral is evaluated, the refractive correction $C_i =
\frac{I}{\Delta s_{i\rightarrow i-1}}$ where
\begin{equation}
\Delta s_{i\rightarrow i-1} =
\left| \sqrt{|H_i^2-H_t^2|} - \sqrt{|H_{i-1}^2-H_t^2|} \right|
\end{equation}
is the line-of-sight path length from $H_{i-1}$ to $H_i$.

\label{lastpage} \end{document}
% $Id: $
@
