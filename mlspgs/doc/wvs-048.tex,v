head	1.13;
access;
symbols
	v5-02-NRT-19:1.13
	v6-00:1.13
	v5-02-NRT-18:1.13
	v5-02:1.10
	v5-01-NRT-17:1.13
	v5-01-NRT-16:1.13
	v5-01-NRT-15:1.13
	v5-01-NRT-14:1.13
	neuralnetworks-1-0:1.13.0.4
	cfm-single-freq-0-1:1.13.0.2
	v5-01:1.10
	v5-00:1.10
	v4-23-TA133:1.10.0.8
	mus-emls-1-70:1.10.0.6
	rel-1-0-englocks-work:1.10.0.4
	VUMLS1-00:1.10
	VPL1-00:1.10
	V4-22-NRT-08:1.10
	VAM1-00:1.10
	V4-21:1.10.0.2
	V4-13:1.10
	V4-12:1.10
	V4-11:1.10
	V4-10:1.10
	V3-43:1.9
	M4-00:1.10
	V3-41:1.9
	V3-40-PlusGM57:1.9.0.2
	V3-33:1.9
	V3-31:1.9
	V3-30-NRT-05:1.9
	cfm-01-00:1.9
	V3-30:1.9
	V3-20:1.9
	V3-10:1.9;
locks; strict;
comment	@% @;


1.13
date	2020.06.10.05.19.52;	author vsnyder;	state Exp;
branches;
next	1.12;

1.12
date	2020.06.09.22.56.51;	author vsnyder;	state Exp;
branches;
next	1.11;

1.11
date	2020.04.14.22.45.41;	author vsnyder;	state Exp;
branches;
next	1.10;

1.10
date	2012.03.30.20.41.42;	author vsnyder;	state Exp;
branches;
next	1.9;

1.9
date	2009.05.12.23.41.09;	author vsnyder;	state Exp;
branches;
next	1.8;

1.8
date	2009.04.30.23.34.53;	author vsnyder;	state Exp;
branches;
next	1.7;

1.7
date	2009.04.30.02.45.11;	author vsnyder;	state Exp;
branches;
next	1.6;

1.6
date	2009.04.30.02.40.29;	author vsnyder;	state Exp;
branches;
next	1.5;

1.5
date	2009.04.29.22.35.08;	author vsnyder;	state Exp;
branches;
next	1.4;

1.4
date	2009.04.28.02.55.18;	author vsnyder;	state Exp;
branches;
next	1.3;

1.3
date	2009.04.28.00.41.58;	author vsnyder;	state Exp;
branches;
next	1.2;

1.2
date	2009.04.23.22.33.31;	author vsnyder;	state Exp;
branches;
next	1.1;

1.1
date	2008.06.11.20.14.53;	author vsnyder;	state Exp;
branches;
next	;


desc
@@


1.13
log
@Add zeta_1...zeta_m given
@
text
@\documentclass[11pt]{article}
\usepackage{alltt}
\usepackage[fleqn]{amsmath}
\usepackage{floatflt}
\usepackage{graphicx}
\usepackage{longtable}
\usepackage{srcltx}
\usepackage[strings]{underscore}

\textwidth 6.5in
\oddsidemargin -0.25in
%\evensidemargin -0.5in
\topmargin -0.5in
\textheight 9in

\newcommand{\docname}{\bf wvs-048r11}
\newcommand{\docdate}{9 June 2020}

\ifx\pdfoutput\undefined
  \pdfoutput=0
  \usepackage[hypertex,plainpages,hyperindex=true]{hyperref}
  \hypersetup{%
    hypertexnames=false%
  }
  % Specify the driver for the color package
  \ExecuteOptions{dvips}
  %\ExecuteOptions{xdvi}
\else
  \ifnum\pdfoutput>0
    \usepackage[pdftex,plainpages,hyperindex=true,pdfpagelabels]{hyperref}
    \hypersetup{%
      hypertexnames=false,%
      colorlinks=true,%
      linktocpage=true,%
    }
    % Specify the driver for the color package
    \ExecuteOptions{pdftex}
  \else
    \usepackage[hypertex,plainpages,hyperindex=true]{hyperref}
    \hypersetup{%
      hypertexnames=false%
    }
    % Specify the driver for the color package
    \ExecuteOptions{dvips}
    %\ExecuteOptions{xdvi}
  \fi
\fi

\hyperbaseurl{}
\newcommand\hr[1]{\href{#1.dvi}{dvi}, \href{#1.pdf}{pdf}}
\newcommand\h[1]{#1 (\hr{#1})}

\begin{document}

%\tracingcommands=1
\newlength{\hW} % heading box width
\newlength{\pW} % page number field width
\settowidth{\hW}{\docname}
\settowidth{\pW}{Page \pageref{lastpage}\ of \pageref{lastpage}}
\ifdim \pW > \hW \setlength{\hW}{\pW} \fi
\makeatletter
\def\@@biblabel#1{#1.}
\newcommand{\ps@@twolines}{%
  \renewcommand{\@@oddhead}{%
    \docdate\hfill\parbox[t]{\hW}{{\hfill\docname}\newline
                          Page \thepage\ of \pageref{lastpage}}}%
\renewcommand{\@@evenhead}{}%
\renewcommand{\@@oddfoot}{}%
\renewcommand{\@@evenfoot}{}%
}%
\makeatother
\pagestyle{twolines}

\vspace{-10pt}
\begin{tabbing}
\phantom{References: }\= \\
To: \>Bill\\
Subject: \>Different solution for $\phi$--$H$ calculation in {\tt metrics\_m}\\
From: \>Van Snyder\\
\end{tabbing}

\parindent 0pt \parskip 10pt
\vspace{-20pt}

\newcommand\Req{R^\oplus_{\text{eq}}}
\newcommand\Reqs{{\Req}_s}

\begin{floatingfigure}{3.65in}
{\includegraphics[width=3.5in,height=4.5in,clip]{./wvs-048-grid2}}
\end{floatingfigure}

We want to solve for $\phi$ and $H$ at the intersections of the line of
sight with constant-$\zeta$ surfaces.

Normally one thinks of the line of sight as a straight line, and
constant-$\zeta$ surfaces as approximate circles roughly concentric with
the earth.

This diagram shows the line of sight intersecting the constant-$\zeta$
surfaces in cartesian $\phi$--$H$ co\"{o}rdinates instead of polar 
$\phi$--$\zeta$ co\"{o}rdinates.  The heights on con\-stant-$\zeta$
surfaces are the green lines (straight lines because we use linear
interpolation in $\phi$, instead of approximate circles), the lines of
sight are the red lines (secant curves instead of straight lines), and the
temperature $\phi$ basis $\phi_1 \dots \phi_n$ is the vertical black
lines.  The quantity $H-\Req$, where $\Req$ is the equivalent circular
earth radius, is given at specified values of $\phi$ and $\zeta$, i.e., at
the intersections of the green and black lines, by the array {\tt
H\_ref}.  The tangent angle $\phi_t$, the tangent height $H_t$, $\Req$,
$\zeta_1\dots\zeta_m$, and $\phi_1 \dots \phi_n$ are given.

Denote {\tt H\_ref} by $H_{ij}$.  Each row of {\tt H\_ref} gives the
endpoints of piecewise-linear heights on a con\-stant-$\zeta$ surface. 
Writing the intersection of that line with the line of sight expressed as
a function of $\phi$, \emph{viz.}\ $H = H_t \sec \phi$, interpolating $H$
linearly in $\phi$ between $H_{ij}$ and $H_{i,j+1}$, using $H_\text{tan} =
H_t - \Req$, and subtracting $H_t$ from both sides to cancel $\Req$ on the
left side, we need to solve

\begin{equation}\begin{split}\label{one}
H_{ij} + \Req + (H_{i,j+1}-H_{ij})
                  \frac{\phi-\phi_j}
                       {\phi_{j+1}-\phi_j} -
                  ( H_\text{tan} + \Req ) \,&= \\
H_{ij} + (H_{i,j+1}-H_{ij})
                  \frac{\phi-\phi_j}
                       {\phi_{j+1}-\phi_j} -
                  H_\text{tan} \,&= \\
H_{ij} + (H_{i,j+1}-H_{ij})
                  \frac{(\phi-\phi_t)-(\phi_j-\phi_t)}
                       {\phi_{j+1}-\phi_j} -
                  H_\text{tan} \,&=
H_t(\sec ( \phi - \phi_t ) - 1) \\
\end{split}\end{equation}

for $\phi$ when $\phi_1 \leq \phi \leq \phi_n$, where $n$ is the number
of columns in {\tt H\_ref}, for all $i$ and $j$.  For $\phi < \phi_1$ or
$\phi > \phi_n$ assume constant-$\zeta$ surfaces are also constant-$H$
surfaces, i.e., $H_{i0} = H_{i1}$ and $H_{in} = H_{i,n+1}$, which reduces
the above to $H_{i0} = H_t \sec(\phi-\phi_t)$ or $H_{in} = H_t
\sec(\phi-\phi_t)$.

An added complication is that we refer all measurements to the one bar
pressure surface $H_s$, which is gotten by interpolating $H_{1,1\dots n}$
or a given array of surface heights to $\phi_t$.  Using $H_{ts} =
H_\text{tan} - H_s$, $\Reqs = \Req + H_s$, $H_t = H_{ts} + \Reqs$, adding
and subtracting $H_s$ from its left side, and using $H^-_{ij} =
H_{ij}-H_s$ etc., Equation (\ref{one}) becomes

\begin{equation}\label{two}
H^-_{ij} + (H^-_{i,j+1}-H^-_{ij})
                  \frac{(\phi-\phi_t)-(\phi_j-\phi_t)}
                       {\phi_{j+1}-\phi_j} -
                  H_{ts} =
H_t(\sec ( \phi - \phi_t ) - 1)\,.
\end{equation}

The angle $\phi_t$ is the one for the ray segment being calculated.  For
Earth-reflecting rays, the tangent points on the incident and reflected
segments are different by $2 \cos^{-1} \frac{H_t}\Reqs$.

We write Equation (\ref{two}) as a zero-finding problem

\begin{equation}\label{three}
d(\delta\phi) = a\, (\sec\delta\phi-1) + b\, \delta\phi + c = 0
\end{equation}

where

\begin{equation}\begin{split}
\delta\phi =\,& \phi - \phi_t\,, \,\, \Delta\phi = \phi_{j+1}-\phi_j\\
a =\,& H_t \Delta\phi\,, \\
b =\,& -(H^-_{i,j+1}-H^-_{ij}) = -(H_{i,j+1}-H_{ij})
   \text{ (}H_s\text{ cancels here), and} \\
c =\,& \phi_j (H^-_{i,j+1}-H_{ts}) -\phi_{j+1} (H^-_{ij}-H_{ts})
   + b\,\phi_t \\
  =\,& H^-_{i,j+1} ( \phi_j - \phi_t ) - H^-_{ij} ( \phi_{j+1}-\phi_t )
   + H_{ts} \Delta\phi\,. \\
\end{split}\end{equation}

To start a Newton iteration to solve Equation(\ref{three}), use
$\sec\delta\phi \approx 1 + \frac12 \delta\phi^2$, and solve for
$\delta\phi$ in

\begin{equation}
 \frac12 a\, \delta\phi^2 + b \, \delta\phi + c = 0\,.
\end{equation}

To the left of the tangent point, choose the minimum of the two
solutions; otherwise, choose the maximum.  This potentially has two
solutions at the tangent point unless the tangent point is at one of the
reference $\zeta$ values.  The existing code forces $\delta\phi$ to be
zero at the tangent.  If this has complex roots, or $\delta\phi < \phi_j$
or $\delta\phi > \phi_{j+1}$, assume $b=0$ and use $\delta\phi = \cos^{-1}
\frac{2 H_t}{H_{ij}+H_{i,j+1}}$.

When $|\delta\phi| < 0.2$ radians use an $8^\text{th}$-order polynomial

\begin{equation}
\sec\delta\phi - 1 \approx P_8(\delta\phi) =
 \frac12 \delta\phi^2 + \frac5{24} \delta\phi^4
 + \frac{61}{720} \delta\phi^6 + \frac{277}{8064} \delta\phi^8
\end{equation}

to approximate $\sec \delta \phi -1$ because the latter suffers
cancellation when $\delta\phi \approx 0$, giving

\begin{equation}
a\, P_8(\delta\phi) + b\, \delta\phi + c \approx 0\,.
\end{equation}

Using 16-digit arithmetic, $-1.5 \times 10^{-9} < P_8(\delta\phi) -
\sec(\delta\phi) + 1 \leq 0$ for $|\delta\phi| \leq 0.2$.

For the Newton iteration $\delta\phi_{n+1} = \delta\phi_n - d(\delta\phi_n) /
d^\prime(\delta\phi_n)$, the derivatives

\begin{equation}
d^\prime(\delta\phi) = a\, \sec \delta\phi \tan \delta\phi + b \approx
 P_8^\prime(\delta\phi) + b
\end{equation}

are necessary.  Remember, $\tan\delta\phi = \text{signum}(\delta\phi)
\sqrt{\sec^2 \delta\phi - 1}$, not simply $\left|\sqrt{\sec^2 \delta\phi -
1}\right|$.

\label{lastpage}
\end{document}
% $Id: wvs-048.tex,v 1.11 2020/04/14 22:45:41 vsnyder Exp $

% $Log: wvs-048.tex,v $
% Revision 1.11  2020/04/14 22:45:41  vsnyder
% Remove .eps from graphic filename because pdflatex wants to convert it itself
%
% Revision 1.10  2012/03/30 20:41:42  vsnyder
% Repair graphics stuff
%
% Revision 1.9  2009/05/12 23:41:09  vsnyder
% Remark about different tangent angles for incident and reflected rays, more cleanup
%
% Revision 1.8  2009/04/30 23:34:53  vsnyder
% Need abs around 'delta phi'
%
% Revision 1.7  2009/04/30 02:45:11  vsnyder
% Write Newton iteration correctly
%
% Revision 1.6  2009/04/30 02:40:29  vsnyder
% Correct a sign error, derivatives
%
% Revision 1.5  2009/04/29 22:35:08  vsnyder
% Clarify and simplify
%
% Revision 1.4  2009/04/28 02:55:18  vsnyder
% Make notation more consistent
%
% Revision 1.3  2009/04/28 00:41:58  vsnyder
% Undo erroneous sign change - wvs-048r2 is correct
%
@


1.12
log
@Some clarification, some type correction
@
text
@d110 1
a110 1
and $\phi_1 \dots \phi_n$ are given.
@


1.11
log
@Remove .eps from graphic filename because pdflatex wants to convert it itself
@
text
@d7 1
d16 2
a17 2
\newcommand{\docname}{\bf wvs-048r10}
\newcommand{\docdate}{12 May 2009}
d88 1
a88 1
\begin{floatingfigure}{3.75in}
d101 10
a110 10
$\phi$--$\zeta$ co\"{o}rdinates.  The con\-stant-$\zeta$ surfaces are the
green lines (straight lines because we use linear interpolation in
$\phi$, instead of approximate circles), the lines of sight are the red
lines (secant curves instead of straight lines), and the temperature
$\phi$ basis $\phi_1 \dots \phi_n$ is the vertical black lines.  The
quantity $H-\Req$, where $\Req$ is the equivalent circular earth radius,
is given at specified values of $\phi$ and $\zeta$, i.e., at the
intersections of the green and black lines, by the array {\tt H\_ref}. 
The tangent angle $\phi_t$, the tangent height $H_t$, $\Req$, and $\phi_1
\dots \phi_n$ are given.
d113 6
a118 6
endpoints of a piecewise-linear con\-stant-$\zeta$ surface.  Writing the
intersection of that line with the line of sight expressed as a function
of $\phi$, \emph{viz.}\ $H = H_t \sec \phi$, interpolating $H$ linearly in
$\phi$ between $H_{ij}$ and $H_{i,j+1}$, using $H_\text{tan} = H_t -
\Req$, and subtracting $H_t$ from both sides to cancel $\Req$ on the left
side, we need to solve
d136 6
a141 5
when $\phi_1 \leq \phi \leq \phi_n$, where $n$ is the number of columns
in {\tt H\_ref}, for all $i$ and $j$.  For $\phi < \phi_1$ or $\phi >
\phi_n$ assume constant-$\zeta$ surfaces are also constant-$H$ surfaces,
i.e., $H_{i0} = H_{i1}$ and $H_{in} = H_{i,n+1}$, which reduces the above
to $H_{i0} = H_t \sec(\phi-\phi_t)$ or $H_{in} = H_t \sec(\phi-\phi_t)$.
d216 1
a216 1
d^\prime(\delta\phi_n)$ the derivatives
d229 1
a229 1
% $Id: wvs-048.tex,v 1.10 2012/03/30 20:41:42 vsnyder Exp $
d232 3
@


1.10
log
@Repair graphics stuff
@
text
@d88 1
a88 1
{\includegraphics[width=3.5in,height=4.5in,clip]{./wvs-048-grid2.eps}}
d227 1
a227 1
% $Id: wvs-048.tex,v 1.9 2009/05/12 23:41:09 vsnyder Exp $
d230 3
@


1.9
log
@Remark about different tangent angles for incident and reflected rays, more cleanup
@
text
@d2 8
a9 1
\usepackage[fleqn]{amsmath}\textwidth 6.5in
d12 2
a13 2
\topmargin -0.25in
\textheight 9.0in
d18 33
a50 3
\usepackage{graphicx}

\usepackage{floatflt}
d227 1
a227 1
% $Id: wvs-048.tex,v 1.8 2009/04/30 23:34:53 vsnyder Exp $
d230 3
@


1.8
log
@Need abs around 'delta phi'
@
text
@d8 2
a9 2
\newcommand{\docname}{\bf wvs-048r8}
\newcommand{\docdate}{30 April 2009}
d48 1
d64 3
a66 1
green lines, the lines of sight are the red lines, and the temperature
d69 1
a69 1
is given at specified values of $\phi$ and $\zeta$, i.e. at the
d71 2
a72 1
The tangent height $H_t$, $\Req$, and $\phi_1 \dots \phi_n$ are given.
d77 1
a77 1
of $\phi$, \emph{viz.} $H = H_t \sec \phi$, interpolating $H$ linearly in
d104 6
a109 1
We write Equation (\ref{one}) as a zero-finding problem
d112 14
d132 8
a139 5
\delta\phi =\,& \phi - \phi_t\,, \\
a =\,& (\phi_{j+1}-\phi_j) H_t\,, \\
b =\,& -(H_{i,j+1}-H_{ij})\,, \text{ and} \\
c =\,& - H_{ij} (\phi_{j+1}-\phi_t) + H_{i,j+1} (\phi_j-\phi_t) +
(\phi_{j+1}-\phi_j) H_\text{tan} \,.\\
d142 1
a142 1
To start a Newton iteration to solve Equation(\ref{two}), use
d154 3
a156 1
zero at the tangent.
d176 2
a177 2
For the Newton iteration $\delta\phi_{n+1} = \delta\phi_n - d(\delta\phi) /
d^\prime(\delta\phi)$ the derivatives
d185 2
a186 1
\sqrt{\sec^2 \delta\phi - 1}$, not simply $\sqrt{\sec^2 \delta\phi - 1}$.
d190 1
a190 1
% $Id: wvs-048.tex,v 1.7 2009/04/30 02:45:11 vsnyder Exp $
d193 3
@


1.7
log
@Write Newton iteration correctly
@
text
@d8 2
a9 2
\newcommand{\docname}{\bf wvs-048r7}
\newcommand{\docdate}{29 April 2009}
d130 1
a130 1
When $\delta\phi < 0.2$ radians use an $8^\text{th}$-order polynomial
d161 1
a161 1
% $Id: wvs-048.tex,v 1.6 2009/04/30 02:40:29 vsnyder Exp $
d164 3
@


1.6
log
@Correct a sign error, derivatives
@
text
@d148 1
a148 1
For the Newton iteration $\delta\phi_{n+1} = \delta\phi - d(\delta\phi) /
d161 1
a161 1
% $Id: wvs-048.tex,v 1.5 2009/04/29 22:35:08 vsnyder Exp $
d164 3
@


1.5
log
@Clarify and simplify
@
text
@d8 1
a8 1
\newcommand{\docname}{\bf wvs-048r6}
d103 1
a103 1
a\, (\sec\delta\phi-1) + b\, \delta\phi + c = 0
d112 1
a112 1
c =\,& - H_{ij} (\phi_{j+1}-\phi_t) + H_{i,j+1} (\phi_j-\phi_t) -
d148 11
d161 1
a161 1
% $Id: wvs-048.tex,v 1.4 2009/04/28 02:55:18 vsnyder Exp $
d164 3
@


1.4
log
@Make notation more consistent
@
text
@d8 2
a9 2
\newcommand{\docname}{\bf wvs-048r5}
\newcommand{\docdate}{27 April 2009}
d47 2
d56 21
a76 20
I drew the picture of the line of sight intersecting the $\zeta$ surfaces
in cartesian $\phi$--$H$ co\"{o}rdinates instead of polar 
$\phi$--$\zeta$ co\"{o}rdinates.  In this diagram, the con\-stant-$\zeta$
surfaces are the green lines, the line of sight is the red line, and the
temperature $\phi$ basis $\phi_1 \dots \phi_n$ is the vertical black
lines.  Therefore the values of $H$ in the {\tt H\_ref} array appear at
the intersections of the green lines and the vertical black lines.

Assuming the constant-$\zeta$ surfaces to be piecewise linear, this
suggests a simple algorithm to solve for the $\phi$ coordinate of each
intersection of the red line (the line of sight) with the green lines (the
constant-$\zeta$ surfaces).

Denote {\tt H\_ref} by $H_{ij}$ and the tangent height by $H_t$.  Between two
consecutive columns of a row of {\tt H\_ref} there is a line segment of a
constant-$\zeta$ surface.  Writing the intersection of that line with the
line of sight expressed as a function of $\phi$, \emph{viz.} $H-H_t =
H_t(\sec \phi - 1)$, interpolating $H$ between $H_{ij}$ and $H_{i,j+1}$
linearly in $\phi-\phi_t$, and assuming the tangent $\phi_t=0$, we need to
solve
d78 5
a82 1
\begin{equation*}
d85 30
a114 28
                       {\phi_{j+1}-\phi_j} - H_t
= H_t(\sec \phi - 1)
\end{equation*}

when $\phi_1 \leq \phi \leq \phi_n$ or, using $\sec\phi \approx 1 +
\frac12 \phi^2$ and putting the resulting polynomial in standard form,

\begin{equation*}
\frac12 (\phi_{j+1}-\phi_j) H_t \phi^2 -
(H_{i,j+1}-H_{ij})\phi -
H_{ij} \phi_{j+1} + H_{i,j+1} \phi_j -
(\phi_{j+1}-\phi_j)H_t
\approx 0
\end{equation*}

for all $i$ and $j$.  If $1<j<n$, where $n$ is the number of columns in
{\tt H\_ref}, solutions for which $\phi<\phi_j$ or $\phi>\phi_{j+1}$ are
discarded.  To the left of the tangent point, choose the minimum of the
two solutions; otherwise, choose the maximum.  For $\phi < \phi_1$ or
$\phi > \phi_n$ assume constant-$\zeta$ surfaces are also constant-$H$
surfaces, i.e., $H_{i0} = H_{i1}$ and $H_{in} = H_{i,n+1}$, which reduces
the above to $H_{i0} = H_t \sec\phi$ or $H_{in} = H_t \sec\phi$, both of
which are trivial to solve for $\phi$.

The code references {\tt H\_ref} and $H_t$ from the equivalent earth
radius $R^\oplus_{\text{eq}}$, which makes things a bit messier.  Writing
$H_\text{tan} = H_t - R^\oplus_{\text{eq}}$ and no longer assuming
$\phi_t=0$, we have
d116 2
a117 14
\begin{equation*}
H_{ij} + (H_{i,j+1}-H_{ij})
                  \frac{\phi-\phi_t-(\phi_j-\phi_t)}
                       {\phi_{j+1}-\phi_t-(\phi_j-\phi_t)} - H_\text{tan}
= H_t(\sec (\phi-\phi_t) - 1)\,.
\end{equation*}

where $H_{ij}$ and $H_{i,j+1}$ here are different from above, having had
$R^\oplus_{\text{eq}}$ subtracted from them.  This doesn't change
anything because $R^\oplus_{\text{eq}}$ cancels everywhere on the
left-hand side, which is the reason for writing $H-H_t = H_t(\sec
\phi-1)$ at the outset instead of $H = H_t \sec\phi$.  Using $\sec\phi
\approx 1 + \frac12 \phi^2$, writing $\delta\phi=\phi-\phi_t$  and
putting the resulting polynomial in standard form, we solve for
d120 3
a122 7
\begin{equation*}
\frac12 (\phi_{j+1}-\phi_j) H_t \delta\phi^2 -
(H_{i,j+1}-H_{ij})\delta\phi -
H_{ij} (\phi_{j+1}-\phi_t) + H_{i,j+1} (\phi_j-\phi_t) -
(\phi_{j+1}-\phi_j) H_\text{tan}
\approx 0
\end{equation*}
d124 2
a125 1
and then we have $\phi = \delta\phi + \phi_t$.  This potentially has two
d130 14
a143 2
This solution for $\delta\phi$ provides a starting point for Newton
iteration, in which we use an $8^\text{th}$-order polynomial
d145 2
a146 18
\begin{equation*}
P_8(\delta\phi) = \frac12 \delta\phi^2 + \frac5{24} \delta\phi^4
+ \frac{61}{720} \delta\phi^6 + \frac{277}{8064} \delta\phi^8
\end{equation*}

to approximate $\sec(\delta \phi)-1$:

\begin{equation*}
(\phi_{j+1}-\phi_j) H_t P_8(\delta\phi) -
(H_{i,j+1}-H_{ij})\delta\phi -
H_{ij} (\phi_{j+1}-\phi_t) + H_{i,j+1} (\phi_j-\phi_t) +
(\phi_{j+1}-\phi_j)H_{\text{tan}}
\approx 0
\end{equation*}

We use $P_8(\delta\phi)$ instead of $\sec(\delta\phi)-1$ in the Newton
iteration because the latter suffers cancellation when $\delta\phi
\approx 0$.
d150 1
a150 1
% $Id: wvs-048.tex,v 1.3 2009/04/28 00:41:58 vsnyder Exp $
d153 3
@


1.3
log
@Undo erroneous sign change - wvs-048r2 is correct
@
text
@d8 1
a8 1
\newcommand{\docname}{\bf wvs-048r4}
d51 3
d55 6
a60 6
in cartesian $\phi$--$H$ co\"{o}rdinates instead of polar  $\phi$--$\zeta$
co\"{o}rdinates.  In this diagram, the con\-stant-$\zeta$ surfaces are the
green lines, the line of sight is the red line, and the temperature $\phi$
basis is the vertical black lines.  Therefore the values of $H$ in the
{\tt H\_ref} array appear at the intersections of the green lines and the
vertical black lines.
d67 7
a73 5
Denote {\tt H\_ref} by $H$.  Between two consecutive columns of a row of
$H$ there is a line segment of a constant-$\zeta$ surface.  Writing the
intersection of that line with the line of sight expressed as a function
of $\phi$, \emph{viz.} $H-H_t = H_t(\sec \phi - 1)$ and assuming $\phi=0$
at the tangent, we need to solve
d82 2
a83 2
or, using $\sec\phi \approx 1 + \frac12 \phi^2$ and putting the resulting
polynomial in standard form,
d96 10
a105 9
two solutions; otherwise, choose the maximum.

The next term in the expansion of $\sec\phi$ is $\frac5{24}\phi^4$ for
$\phi$ in radians, or $\frac5{24}\left(\frac{\pi}{180}\right)^4\phi^4
\approx 9.3\times10^{-8}\phi^4$ for $\phi$ in degrees, so this simple
quadratic equation is probably accurate enough.

Putting $\phi=\phi_t$ at the tangent and referencing $H$ from
$R^\oplus_{\text{eq}}$, things are a bit messier
d110 2
a111 2
                       {\phi_{j+1}-\phi_t-(\phi_j-\phi_t)} - H_t
= (H_t+R^\oplus_{\text{eq}})(\sec (\phi-\phi_t) - 1)\,.
d114 7
a120 4
Notice that $R^\oplus_{\text{eq}}$ cancels everywhere on the left-hand
side.  Using $\sec\phi \approx 1 + \frac12 \phi^2$, writing
$\delta\phi=\phi-\phi_t$ and $H_{\text{tan}}=H_t+R^\oplus_{\text{eq}}$,
and putting the resulting polynomial in standard form, we solve for
d124 1
a124 1
\frac12 (\phi_{j+1}-\phi_j) H_{\text{tan}} \delta\phi^2 -
d127 1
a127 1
(\phi_{j+1}-\phi_j)H_t
d136 2
a137 2
This provides a starting point for Newton iteration, in which we use an
$8^\text{th}$-order polynomial to approximate $\sec(\delta \phi)-1$.
d140 8
a147 1
\frac12 (\phi_{j+1}-\phi_j) H_{\text{tan}} P_8(\delta\phi) -
d150 1
a150 1
(\phi_{j+1}-\phi_j)H_t
d154 3
a156 2
We $P_8(\delta\phi)$ instead of $\sec(\delta\phi)-1$ because the latter
suffers cancellation when $\delta\phi \approx 0$.
d160 1
a160 1
% $Id: wvs-048.tex,v 1.2 2009/04/23 22:33:31 vsnyder Exp $
d162 4
a165 1
% $Log: $
@


1.2
log
@Correct sign error
@
text
@d8 2
a9 2
\newcommand{\docname}{\bf wvs-048r3}
\newcommand{\docdate}{23 April 2009}
d133 1
a133 1
H_{ij} (\phi_{j+1}-\phi_t) + H_{i,j+1} (\phi_j-\phi_t) -
d143 3
a145 1
% $Id: wvs-048.tex,v 1.1 2008/06/11 20:14:53 vsnyder Exp $
@


1.1
log
@Initial commit
@
text
@d8 2
a9 2
\newcommand{\docname}{\bf wvs-048r2}
\newcommand{\docdate}{26 October 2006}
d83 1
a83 1
H_{ij} \phi_{j+1} + H_{i,j+1} \phi_j +
d117 1
a117 1
H_{ij} (\phi_{j+1}-\phi_t) + H_{i,j+1} (\phi_j-\phi_t) +
d127 14
d143 1
a143 1
% $Id: wvs-048r3.tex,v 1.1 2008/06/11 20:14:53 vsnyder Exp $
@

