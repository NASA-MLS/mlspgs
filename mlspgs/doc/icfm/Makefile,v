head	1.5;
access;
symbols
	v5-02-NRT-19:1.5
	v6-00:1.5
	v5-02-NRT-18:1.5
	v5-02:1.3
	v5-01-NRT-17:1.5
	v5-01-NRT-16:1.5
	v5-01-NRT-15:1.4
	v5-01-NRT-14:1.4
	neuralnetworks-1-0:1.3.0.4
	cfm-single-freq-0-1:1.3.0.2
	v5-01:1.3
	v5-00:1.3
	v4-23-TA133:1.1.0.6
	mus-emls-1-70:1.1.0.4
	rel-1-0-englocks-work:1.1.0.2
	VUMLS1-00:1.1
	VPL1-00:1.1
	V4-22-NRT-08:1.1
	VAM1-00:1.1;
locks; strict;
comment	@# @;


1.5
date	2022.02.15.00.34.05;	author pwagner;	state Exp;
branches;
next	1.4;

1.4
date	2021.04.21.23.44.13;	author pwagner;	state Exp;
branches;
next	1.3;

1.3
date	2019.06.27.21.09.08;	author pwagner;	state Exp;
branches;
next	1.2;

1.2
date	2019.06.24.17.45.48;	author pwagner;	state Exp;
branches;
next	1.1;

1.1
date	2015.08.11.00.26.36;	author pwagner;	state Exp;
branches;
next	;


desc
@@


1.5
log
@Uses LATEX and BIBTEX variables
@
text
@# "$Id: Makefile,v 1.4 2021/04/21 23:44:13 pwagner Exp $"
#	Makefile
#
# Copyright 2011, by the California Institute of Technology. ALL
# RIGHTS RESERVED. United States Government Sponsorship acknowledged. Any
# commercial use must be negotiated with the Office of Technology Transfer
# at the California Institute of Technology.

# This software may be subject to U.S. export control laws. By accepting this
# software, the user agrees to comply with all applicable U.S. export laws and
# regulations. User has the responsibility to obtain export licenses, or other
# export authority as may be required before exporting such information to
# foreign countries or providing access to foreign persons.

# ---------------------- The name of this file (is the right-hand-side below)
MakeFName = Makefile
# If the right-hand-side is not Makefile
# then to make mls with this file you must instead  of bare "make" use
#     make -f $(MakeFName)

# where to store .configure; 
CONFDIR=../..

UTILDIR=$(CONFDIR)/util

# reecho.sh can filter out globbed file expansions that fail
# e.g., '*.f90 *.f' -> '*.f90" if there aren't any .f files
REECHO=$(UTILDIR)/reecho.sh

# Most source files match one of the following patterns
pro_sources := $(shell ${REECHO} *.pro)
tex_sources := $(shell ${REECHO} *.tex)

ifdef LATEXPATH
   BIBTEX=$(LATEXPATH)/bibtex
   LATEX=$(LATEXPATH)/latex
   DVIPDF=$(LATEXPATH)/dvipdfm
   PDFLATEX=$(LATEXPATH)/pdflatex
else
   BIBTEX=bibtex
   LATEX=latex
   DVIPDF=dvipdfm
   PDFLATEX=pdflatex
endif

# Set paths for finding source files

DVIDIR = ./dvi/
LOGDIR = ./log/
PDFDIR = ./pdf/
AUX=icfm.aux
BIB=icfmbib.bib
BBL=icfm.bbl

vpath %.f9h ./
vpath %.tex ./
vpath %.dvi $(DVIDIR)
vpath %.l2cf $(CONFDIR)/l2/l2cf/lib
vpath %.log $(LOGDIR)
vpath %.pdf $(PDFDIR)

# Define some suffix rules

.SUFFIXES:
.SUFFIXES: .tex .dvi .pdf
.tex.dvi:
	$(LATEX) $<
	$(LATEX) $<
	mv $@@ $(DVIDIR)
	mv $*.log $(LOGDIR)

.dvi.pdf:
	# $(DVIPDF) $(DVIDIR)/$*.dvi
	$(PDFLATEX) $*.tex
	mv $@@ $(PDFDIR)

# Bugs and limitations:
# (1) We are assuming latex and dvipdf are both available
# An alternative approach would skip building dvi files; e.g.
#   pdflatex icfm
#   bibtex icfm
#   pdflatex icfm
#   pdflatex icfm
# (2) Dependencies can be traced from .tex file using makemake.sh
# It cannot track .f9h nor .f90 files yet, which is why we use the 
# f9h_sources mechanism
# (3) Nor can it handle .bib files, and thus we resort to the BIB mechanism

icfm:

-include Makefile.dep

all: icfm

icfm: ${NEAROBJS} ${OBJS} ${BBL}
	date > icfm; echo $(OBJS) >> icfm; \
   touch ${BBL}; touch $(DVIDIR)/*; touch $(PDFDIR)/*

${AUX}: icfm.tex
	$(LATEX) icfm

${BBL}: ${BIB} ${AUX}
	$(BIBTEX) icfm

${NEAROBJS}: ${BBL} ${pro_sources}
# ========================================================================

clean:
	rm -fr *.dvi *.pdf Makefile.dep $(DVIDIR) $(PDFDIR) ${AUX} ${BBL} icfm

depends:
	$(UTILDIR)/makemakedep.sh -s tex -o dvi -p Makefile.dep.1 -S icfm.tex \
     -i '\\input\{([^)]+)}' \
     $(OMIT_PREFXD) $(OMIT_PREFXD_REV)
	sed 's/OBJS =/NEAROBJS =/' Makefile.dep.1 > Makefile.dep.2
	$(UTILDIR)/makemakedep.sh -s tex -o pdf -p Makefile.dep.1 -S icfm.tex \
     -i '\\input\{([^)]+)}' \
     $(OMIT_PREFXD) $(OMIT_PREFXD_REV)
	cat Makefile.dep.1 Makefile.dep.2 > Makefile.dep
	if [ ! -d $(DVIDIR) ] ; then \
	  		mkdir $(DVIDIR) ;\
			fi ; \
	if [ ! -d $(PDFDIR) ] ; then \
	  		mkdir $(PDFDIR) ;\
			fi ; \
	if [ ! -d $(LOGDIR) ] ; then \
	  		mkdir $(LOGDIR) ;\
			fi
tar:
	rm -f icfm.tgz
	tar hcvzf icfm.tgz * --exclude \*.dvi --exclude \*.pdf --exclude icfm

update: 
	$(MAKE) -f $(MakeFName) depends

.PHONY: all clean depends tar update icfm \

# ========================================================================
# $Log: Makefile,v $
# Revision 1.4  2021/04/21 23:44:13  pwagner
# Added some robustness
#
# Revision 1.3  2019/06/27 21:09:08  pwagner
# make clean more thorough
#
# Revision 1.2  2019/06/24 17:45:48  pwagner
# Works more reliably like this
#
# Revision 1.1  2015/08/11 00:26:36  pwagner
# After switching away from MakeFC
#
# Revision 1.1  2011/05/31 22:10:47  pwagner
# First commit
#
@


1.4
log
@Added some robustness
@
text
@d1 1
a1 1
# "$Id: Makefile,v 1.3 2019/06/27 21:09:08 pwagner Exp $"
d100 1
a100 1
	latex icfm
d103 1
a103 1
	bibtex icfm
d140 3
@


1.3
log
@make clean more thorough
@
text
@d1 1
a1 1
# "$Id: Makefile,v 1.2 2019/06/24 17:45:48 pwagner Exp $"
d34 12
d67 2
a68 2
	latex $<
	latex $<
d73 2
a74 1
	dvipdf $(DVIDIR)/$*.dvi
d140 3
@


1.2
log
@Works more reliably like this
@
text
@d1 1
a1 1
# "$Id: Makefile,v 1.1 2015/08/11 00:26:36 pwagner Exp $"
d96 1
a96 1
	rm -fr *.dvi *.pdf $(DVIDIR) $(PDFDIR) ${AUX} ${BBL} icfm
d127 3
@


1.1
log
@After switching away from MakeFC
@
text
@d1 1
a1 1
# "$Id: MakeFC,v 1.1 2011/05/31 22:10:47 pwagner Exp $"
d61 1
a61 1
	dvipdf $(DVIDIR)/$<
d126 4
a129 1
# $Log: MakeFC,v $
@

