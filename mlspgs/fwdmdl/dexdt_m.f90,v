head	2.6;
access;
symbols
	v5-02-NRT-19:2.6
	v6-00:2.6
	v5-02-NRT-18:2.6
	v5-02:2.6
	v5-01-NRT-17:2.6
	v5-01-NRT-16:2.6
	v5-01-NRT-15:2.6
	v5-01-NRT-14:2.6
	neuralnetworks-1-0:2.6.0.14
	cfm-single-freq-0-1:2.6.0.12
	v5-01:2.6
	v5-00:2.6
	v4-23-TA133:2.6.0.10
	mus-emls-1-70:2.6.0.8
	rel-1-0-englocks-work:2.6.0.6
	VUMLS1-00:2.6
	VPL1-00:2.6
	V4-22-NRT-08:2.6
	VAM1-00:2.6
	V4-21:2.6.0.4
	V4-13:2.6
	V4-12:2.6
	V4-11:2.6
	V4-10:2.6
	V3-43:2.6
	M4-00:2.6
	V3-41:2.6
	V3-40-PlusGM57:2.6.0.2
	V2-24-NRT-04:2.5
	V3-33:2.6
	V2-24:2.5
	V3-31:2.6
	V3-30-NRT-05:2.6
	cfm-01-00:2.6
	V3-30:2.6
	V3-20:2.6
	V3-10:2.6
	V2-23-NRT-02:2.5
	V2-23:2.5
	V2-22-NRT-01:2.5
	V2-22:2.5
	V2-21:2.5
	V2-20:2.5
	V2-11:2.5
	V2-10:2.5
	V2-00:2.5
	V1-51:2.4
	V1-50:2.4
	V1-45:2.4
	V1-44:2.4
	V1-43:2.4
	V1-32:2.4
	V1-31:2.4
	V1-30:2.3
	newfwm-feb03:1.1.0.2;
locks; strict;
comment	@# @;


2.6
date	2009.06.23.18.26.11;	author pwagner;	state Exp;
branches;
next	2.5;

2.5
date	2005.06.22.18.08.18;	author pwagner;	state Exp;
branches;
next	2.4;

2.4
date	2003.12.17.23.58.03;	author vsnyder;	state Exp;
branches;
next	2.3;

2.3
date	2003.06.03.00.29.30;	author vsnyder;	state Exp;
branches;
next	2.2;

2.2
date	2003.05.16.02.44.55;	author vsnyder;	state Exp;
branches;
next	2.1;

2.1
date	2003.05.05.23.00.25;	author livesey;	state Exp;
branches;
next	1.1;

1.1
date	2003.04.30.01.47.02;	author vsnyder;	state dead;
branches
	1.1.2.1;
next	;

1.1.2.1
date	2003.04.30.01.47.02;	author vsnyder;	state Exp;
branches;
next	1.1.2.2;

1.1.2.2
date	2003.04.30.02.07.41;	author vsnyder;	state Exp;
branches;
next	;


desc
@@


2.6
log
@Prevent Intel from optimizing ident string away
@
text
@! Copyright 2005, by the California Institute of Technology. ALL
! RIGHTS RESERVED. United States Government Sponsorship acknowledged. Any
! commercial use must be negotiated with the Office of Technology Transfer
! at the California Institute of Technology.

! This software may be subject to U.S. export control laws. By accepting this
! software, the user agrees to comply with all applicable U.S. export laws and
! regulations. User has the responsibility to obtain export licenses, or other
! export authority as may be required before exporting such information to
! foreign countries or providing access to foreign persons.

module dExDt_M

!---------------------------------------------------------------------
! This module computes the derivative of an exponential of a matrix.
! This isn't just the exponential of the matrix, as it would be for a
! scalar, because the argument and its derivative don't necessarily
! commute.  For example, the third term in the Taylor series for
! exp(z(x))) is z^2/2, so its derivative is ( z z' + z' z ) / 2, not z z'.

  implicit NONE
  private
  public :: dExDt

!---------------------------- RCS Module Info ------------------------------
  character (len=*), private, parameter :: ModuleName= &
       "$RCSfile: $"
  private :: not_used_here 
!---------------------------------------------------------------------------

contains

  subroutine dExDt ( A, dA, dEx )

    use CS_GetEv_M, only: CS_GetEvSD
    use MLSCommon, only: RK => Rp
    use SINHZ_Z_M, only: D_SINHZ_Z3, SINHZ_Z

    complex(rk), intent(in) :: A(2,2)
    complex(rk), intent(in) :: dA(2,2)
    complex(rk), intent(out) :: dEx(2,2)

    complex(rk) :: ACOF       ! Coefficients for A, A'
    complex(rk) :: dEv(2)     ! Sum = s', then difference**2 = h'
    complex(rk) :: Ev(2)      ! Sum = s,  then difference**2 = h
    complex(rk) :: D          ! 0.5(Difference between eigenvalues, z1 - z2)
    complex(rk) :: D_SINHD_D  ! exp(s) [ (sinh(d)/d)' / d ] =
    !                         ! exp(s) [ (d cosh d - sinh d) / d**3 ]
    complex(rk) :: DH2        ! h' / 2
    complex(rk) :: DIAG       ! Multiple of I to add to diagonal
    complex(rk) :: ES         ! exp(s)
    complex(rk) :: SINHD_D    ! exp(s) sinh(d)/d

!{\parskip 2pt
!  By applying the Hamilton-Cayley theorem (``A matrix satisfies its
!  characteristic polynomial'') to the Taylor series for a function of a
!  matrix, one can develop Sylvester's identity.  In the case of a function
!  of a $2 \times 2$ matrix A whose eigenvalues are $z_1$ and $z_2$ we have
!
!    $F({\bf A}) = \frac{F(z_1)}
!                       {z_1-z_2} ({\bf A} - z_2 {\bf I}) +
!                  \frac{F(z_2)}
!                       {z_2-z_1} ({\bf A} - z_1 {\bf I})$
!%
!  where {\bf I} is the $2 \times 2$ identity matrix,
!
!                              Or:
!
!    $F({\bf A}) = \frac{F(z_1) ({\bf A} - z_2 {\bf I}) - 
!                        F(z_2) ({\bf A} - z_1 {\bf I})}
!                       {z_1 - z_2}$
!
!  For any function $F()$ (in this case: $\exp()$ )
!
!  If you assume that {\bf A} is a function of some parameter $p$, and work
!  through $\frac{\text{d} F({\bf A})}{\text{d}p}$ you will eventually
!  find $\frac{\text{d}z_1}{\text{d}p}$ and $\frac{\text{d}z_2}{\text{d}p}$.
!  These derivatives approach infinity as the eigenvalues approach each other.
!  Using
!  $s = \frac12 ( z_1 + z_2 ) = \frac12 \text{tr}(\mathbf{A})$
!  and
!  $d = \frac12 ( z_1 - z_2 ) = \sqrt { s^2 - \det(\mathbf{A})}
!   = \sqrt h$,
!  this can be rewritten as
!%
!  $\exp({\bf A}) =
!    e^s \left[ \frac{\sinh d}d ( \mathbf{A} - s\, \mathbf{I}) +
!               \cosh d\, \mathbf{I} \right ]$.  After much work you will find
!
!  \begin{equation}\begin{split}\label{dexp}
!  \frac{\text{d} \exp(\mathbf{A})}{\text{d}p} =\;
!   e^s & \left\{ \frac{\sinh d}d
!         \left[ s^\prime \mathbf{A} + \mathbf{A}^\prime +
!                (\frac{h^\prime}2 - s^\prime s) \mathbf{I} \right]
!                 + \right.\\
!       & \phantom{\{}\, \left. \frac{d \cosh d - \sinh d}{d^3}
!           \left[ \frac{h^\prime}{2} \mathbf{A} +
!                  ( h s^\prime - \frac{h^\prime}2 s )\,\mathbf{I} ) \right]
!       \right \} \;.
!  \end{split}\end{equation}
!
!  Collecting terms, we have
! \begin{equation}\begin{split}
! \frac{\text{d} \exp(\mathbf{A})}{\text{d}p} =\;&
!   e^s \left \{ \left [ s^\prime \frac{\sinh d}d +
!           \frac{h^\prime}{2} \frac{d \cosh d - \sinh d}{d^3} \right ] \mathbf{A}
!   + \frac{\sinh d}d \mathbf{A}^\prime + \right . \\
! &  \phantom{e^s\{}\, \left . \left[ \frac{\sinh d}d
!                \left( \frac{h^\prime}{2} - s^\prime s \right) +
!                \frac{d \cosh d - \sinh d}{d^3}
!                \left( h s^\prime - \frac{h^\prime}{2} s \right) \right]
!         \mathbf{I} \right \}
! \end{split}\end{equation}
!
!  As the eigenvalues coalesce, no cancellations occur, and no infinities
!  arise if  the elements of $\mathbf{A}$ and $\mathbf{A}^\prime$ are
!  finite.  The $h^\prime$ and $s^\prime$ terms are clearly well behaved as
!  the eigenvalues coalesce.  To see that the functions of $d$ are well
!  behaved, write
!
!  $\frac{\sinh\,d}d = \sum_{k=0}^{\infty}
!  \frac{d^{2k}}{(2k+1)!}$ and
!  %
!  $\frac{d \cosh d - \sinh d}{d^3} =
!  \sum_{k=0}^{\infty} \frac{d^{2k}}{2^k k! (2k+3)!!}$, where $(2k+3)!! =
!  3 \cdot 5 \cdot 7 \cdot \cdot \cdot 2k+3$.
!
!  We can write $\frac{\sinh d}d$ as $e^{-d}\,\frac{e^{2d}-1}{2d}$ and use
!  the same software to evaluate this expression as in {\tt cs\_expmat\_m}.
!  The series for $\frac{d \cosh d - \sinh d}{d^3}$ converges extremely
!  rapidly for small $d$ (see {\tt sinhz\_z\_m}).

    call CS_GetEvSD ( A, Ev, dA, dEv )   ! Get the sums and differences of the
                                         ! eigenvalues and their derivatives

    es = exp(Ev(1))                      ! exp(s)
    d = sqrt(Ev(2))                      ! z1 - z2
    sinhd_d = es * sinhz_z(d)            ! exp(s) sinh(d)/d
    d_sinhd_d = es * d_sinhz_z3(d)       ! exp(s) [ (sinh(d)/d)' / d ] =
                                         ! exp(s) [ (d sinh(d) - cosh(d))/d^3 ]
    dh2 = 0.5 * dEv(2)                   ! h' / 2
    diag = sinhd_d * ( dh2 - Ev(1)*dEv(1) ) + &
      &    d_sinhd_d * ( Ev(2)*dEv(1) - dh2*Ev(1) )
    acof = sinhd_d * dEv(1) + d_sinhd_d * dh2

    dEx(1,1) = acof * A(1,1) + sinhd_d * dA(1,1) + diag
    dEx(1,2) = acof * A(1,2) + sinhd_d * dA(1,2)
    dEx(2,1) = acof * A(2,1) + sinhd_d * dA(2,1)
    dEx(2,2) = acof * A(2,2) + sinhd_d * dA(2,2) + diag

  end subroutine dExDt

!--------------------------- end bloc --------------------------------------
  logical function not_used_here()
  character (len=*), parameter :: IdParm = &
       "$Id: read_apriori.f90 is it here $"
  character (len=len(idParm)) :: Id = idParm
    not_used_here = (id(1:1) == ModuleName(1:1))
    print *, Id ! .mod files sometimes change if PRINT is added
  end function not_used_here
!---------------------------------------------------------------------------

end module dExDt_M

! $Log: dexdt_m.f90,v $
! Revision 2.5  2005/06/22 18:08:18  pwagner
! Reworded Copyright statement, moved rcs id
!
! Revision 2.4  2003/12/17 23:58:03  vsnyder
! Repair a LaTeX comment
!
! Revision 2.3  2003/06/03 00:29:30  vsnyder
! Prettify TeXnicalities
!
! Revision 2.2  2003/05/16 02:44:55  vsnyder
! Removed USE's for unreferenced symbols
!
! Revision 2.1  2003/05/05 23:00:25  livesey
! Merged in feb03 newfwm branch
!
! Revision 1.1.2.2  2003/04/30 02:07:41  vsnyder
! Fix a bogus comment
!
! Revision 1.1.2.1  2003/04/30 01:47:02  vsnyder
! Initial commit
!
@


2.5
log
@Reworded Copyright statement, moved rcs id
@
text
@d153 1
a154 1
!---------------------------- RCS Ident Info -------------------------------
d156 2
a157 3
       "$Id: $"
  character (len=len(idParm)), save :: Id = idParm
!---------------------------------------------------------------------------
d159 1
d161 1
d166 3
@


2.4
log
@Repair a LaTeX comment
@
text
@d1 10
a10 2
! Copyright (c) 1999, California Institute of Technology.  ALL RIGHTS RESERVED.
! U.S. Government Sponsorship under NASA Contract NAS7-1407 is acknowledged.
d25 3
a27 6
!---------------------------- RCS Ident Info -------------------------------
  character (len=*), parameter :: IdParm = &
    &  "$Id: dexdt_m.f90,v 2.3 2003/06/03 00:29:30 vsnyder Exp $"
  character (len=len(idParm)) :: Id = idParm
  character (len=*), parameter :: ModuleName= &
    &  "$RCSfile: dexdt_m.f90,v $"
d154 5
d165 3
@


2.3
log
@Prettify TeXnicalities
@
text
@d19 1
a19 1
    &  "$Id: dexdt_m.f90,v 2.2 2003/05/16 02:44:55 vsnyder Exp $"
d72 1
a72 1
!  find $\frac{\text{d}z_1}{\text{d}p}$ and $\frac{\text{d}z_1}{\text{d}p}$.
d155 3
@


2.2
log
@Removed USE's for unreferenced symbols
@
text
@d19 1
a19 1
    &  "$Id: dexdt_m.f90,v 2.1 2003/05/05 23:00:25 livesey Exp $"
d91 1
a91 1
!       & \left. \frac{d \cosh d - \sinh d}{d^3}
d100 1
a100 1
!   e^s \left [ s^\prime \frac{\sinh d}d +
d102 2
a103 2
!   + e^s \frac{\sinh d}d \mathbf{A}^\prime + \\
! &   e^s \left[ \frac{\sinh d}d
d107 1
a107 1
!         \mathbf{I}
d128 2
a129 2
    call CS_GetEvSD ( A, Ev, dA, dEv )   ! Get the eigenvalues and their
                                         ! derivatives
d134 2
a135 1
    d_sinhd_d = es * d_sinhz_z3(d)       ! exp(s) [ (sinh(d)/d)' / d ]
d155 3
@


2.1
log
@Merged in feb03 newfwm branch
@
text
@d19 1
a19 1
    &  "$Id$"
d22 1
a22 1
    &  "$RCSfile$"
d30 1
a30 1
    use CS_GetEv_M, only: CS_GetEvSD, dEdt
d153 4
a156 1
! $Log$
@


1.1
log
@file dexdt_m.f90 was initially added on branch newfwm-feb03.
@
text
@d1 159
@


1.1.2.1
log
@Initial commit
@
text
@a0 154
! Copyright (c) 1999, California Institute of Technology.  ALL RIGHTS RESERVED.
! U.S. Government Sponsorship under NASA Contract NAS7-1407 is acknowledged.

module dExDt_M

!---------------------------------------------------------------------
! This module computes the derivative of an exponential of a matrix.
! This isn't just the exponential of the matrix, as it would be for a
! scalar, because the argument and its derivative don't necessarily
! commute.  For example, the third term in the Taylor series for
! exp(z(x))) is z^2/2, so its derivative is ( z z' + z' z ) / 2, not z
!  z'.

  implicit NONE
  private
  public :: dExDt

!---------------------------- RCS Ident Info -------------------------------
  character (len=*), parameter :: IdParm = &
    &  "$Id: freq_avg_m.f90,v 2.5 2002/10/08 17:08:03 pwagner Exp $"
  character (len=len(idParm)) :: Id = idParm
  character (len=*), parameter :: ModuleName= &
    &  "$RCSfile: freq_avg_m.f90,v $"
  private :: not_used_here 
!---------------------------------------------------------------------------

contains

  subroutine dExDt ( A, dA, dEx )

    use CS_GetEv_M, only: CS_GetEvSD, dEdt
    use MLSCommon, only: RK => Rp
    use SINHZ_Z_M, only: D_SINHZ_Z3, SINHZ_Z

    complex(rk), intent(in) :: A(2,2)
    complex(rk), intent(in) :: dA(2,2)
    complex(rk), intent(out) :: dEx(2,2)

    complex(rk) :: ACOF       ! Coefficients for A, A'
    complex(rk) :: dEv(2)     ! Sum = s', then difference**2 = h'
    complex(rk) :: Ev(2)      ! Sum = s,  then difference**2 = h
    complex(rk) :: D          ! 0.5(Difference between eigenvalues, z1 - z2)
    complex(rk) :: D_SINHD_D  ! exp(s) [ (sinh(d)/d)' / d ] =
    !                         ! exp(s) [ (d cosh d - sinh d) / d**3 ]
    complex(rk) :: DH2        ! h' / 2
    complex(rk) :: DIAG       ! Multiple of I to add to diagonal
    complex(rk) :: ES         ! exp(s)
    complex(rk) :: SINHD_D    ! exp(s) sinh(d)/d

!{\parskip 2pt
!  By applying the Hamilton-Cayley theorem (``A matrix satisfies its
!  characteristic polynomial'') to the Taylor series for a function of a
!  matrix, one can develop Sylvester's identity.  In the case of a function
!  of a $2 \times 2$ matrix A whose eigenvalues are $z_1$ and $z_2$ we have
!
!    $F({\bf A}) = \frac{F(z_1)}
!                       {z_1-z_2} ({\bf A} - z_2 {\bf I}) +
!                  \frac{F(z_2)}
!                       {z_2-z_1} ({\bf A} - z_1 {\bf I})$
!%
!  where {\bf I} is the $2 \times 2$ identity matrix,
!
!                              Or:
!
!    $F({\bf A}) = \frac{F(z_1) ({\bf A} - z_2 {\bf I}) - 
!                        F(z_2) ({\bf A} - z_1 {\bf I})}
!                       {z_1 - z_2}$
!
!  For any function $F()$ (in this case: $\exp()$ )
!
!  If you assume that {\bf A} is a function of some parameter $p$, and work
!  through $\frac{\text{d} F({\bf A})}{\text{d}p}$ you will eventually
!  find $\frac{\text{d}z_1}{\text{d}p}$ and $\frac{\text{d}z_1}{\text{d}p}$.
!  These derivatives approach infinity as the eigenvalues approach each other.
!  Using
!  $s = \frac12 ( z_1 + z_2 ) = \frac12 \text{tr}(\mathbf{A})$
!  and
!  $d = \frac12 ( z_1 - z_2 ) = \sqrt { s^2 - \det(\mathbf{A})}
!   = \sqrt h$,
!  this can be rewritten as
!%
!  $\exp({\bf A}) =
!    e^s \left[ \frac{\sinh d}d ( \mathbf{A} - s\, \mathbf{I}) +
!               \cosh d\, \mathbf{I} \right ]$.  After much work you will find
!
!  \begin{equation}\begin{split}\label{dexp}
!  \frac{\text{d} \exp(\mathbf{A})}{\text{d}p} =\;
!   e^s & \left\{ \frac{\sinh d}d
!         \left[ s^\prime \mathbf{A} + \mathbf{A}^\prime +
!                (\frac{h^\prime}2 - s^\prime s) \mathbf{I} \right]
!                 + \right.\\
!       & \left. \frac{d \cosh d - \sinh d}{d^3}
!           \left[ \frac{h^\prime}{2} \mathbf{A} +
!                  ( h s^\prime - \frac{h^\prime}2 s )\,\mathbf{I} ) \right]
!       \right \} \;.
!  \end{split}\end{equation}
!
!  Collecting terms, we have
! \begin{equation}\begin{split}
! \frac{\text{d} \exp(\mathbf{A})}{\text{d}p} =\;&
!   e^s \left [ s^\prime \frac{\sinh d}d +
!           \frac{h^\prime}{2} \frac{d \cosh d - \sinh d}{d^3} \right ] \mathbf{A}
!   + e^s \frac{\sinh d}d \mathbf{A}^\prime + \\
! &   e^s \left[ \frac{\sinh d}d
!                \left( \frac{h^\prime}{2} - s^\prime s \right) +
!                \frac{d \cosh d - \sinh d}{d^3}
!                \left( h s^\prime - \frac{h^\prime}{2} s \right) \right]
!         \mathbf{I}
! \end{split}\end{equation}
!
!  As the eigenvalues coalesce, no cancellations occur, and no infinities
!  arise if  the elements of $\mathbf{A}$ and $\mathbf{A}^\prime$ are
!  finite.  The $h^\prime$ and $s^\prime$ terms are clearly well behaved as
!  the eigenvalues coalesce.  To see that the functions of $d$ are well
!  behaved, write
!
!  $\frac{\sinh\,d}d = \sum_{k=0}^{\infty}
!  \frac{d^{2k}}{(2k+1)!}$ and
!  %
!  $\frac{d \cosh d - \sinh d}{d^3} =
!  \sum_{k=0}^{\infty} \frac{d^{2k}}{2^k k! (2k+3)!!}$, where $(2k+3)!! =
!  3 \cdot 5 \cdot 7 \cdot \cdot \cdot 2k+3$.
!
!  We can write $\frac{\sinh d}d$ as $e^{-d}\,\frac{e^{2d}-1}{2d}$ and use
!  the same software to evaluate this expression as in {\tt cs\_expmat\_m}.
!  The series for $\frac{d \cosh d - \sinh d}{d^3}$ converges extremely
!  rapidly for small $d$ (see {\tt sinhz\_z\_m}).

    call CS_GetEvSD ( A, Ev, dA, dEv )   ! Get the eigenvalues and their
                                         ! derivatives

    es = exp(Ev(1))                      ! exp(s)
    d = sqrt(Ev(2))                      ! z1 - z2
    sinhd_d = es * sinhz_z(d)            ! exp(s) sinh(d)/d
    d_sinhd_d = es * d_sinhz_z3(d)       ! exp(s) [ (sinh(d)/d)' / d ]
    dh2 = 0.5 * dEv(2)                   ! h' / 2
    diag = sinhd_d * ( dh2 - Ev(1)*dEv(1) ) + &
      &    d_sinhd_d * ( Ev(2)*dEv(1) - dh2*Ev(1) )
    acof = sinhd_d * dEv(1) + d_sinhd_d * dh2

    dEx(1,1) = acof * A(1,1) + sinhd_d * dA(1,1) + diag
    dEx(1,2) = acof * A(1,2) + sinhd_d * dA(1,2)
    dEx(2,1) = acof * A(2,1) + sinhd_d * dA(2,1)
    dEx(2,2) = acof * A(2,2) + sinhd_d * dA(2,2) + diag

  end subroutine dExDt

  logical function not_used_here()
    not_used_here = (id(1:1) == ModuleName(1:1))
  end function not_used_here

end module dExDt_M

! $Log: $
@


1.1.2.2
log
@Fix a bogus comment
@
text
@d11 2
a12 1
! exp(z(x))) is z^2/2, so its derivative is ( z z' + z' z ) / 2, not z z'.
d20 1
a20 1
    &  "$Id: dexdt_m.f90,v 1.1.2.1 2003/04/30 01:47:02 vsnyder Exp $"
d23 1
a23 1
    &  "$RCSfile: dexdt_m.f90,v $"
d154 1
a154 4
! $Log: dexdt_m.f90,v $
! Revision 1.1.2.1  2003/04/30 01:47:02  vsnyder
! Initial commit
!
@


