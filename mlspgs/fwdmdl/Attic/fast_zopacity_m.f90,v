head	1.6;
access;
symbols
	V0-5-Level2:1.4
	V0-5-SIPS:1.4;
locks; strict;
comment	@# @;


1.6
date	2001.06.21.13.07.08;	author zvi;	state dead;
branches;
next	1.5;

1.5
date	2001.06.07.23.30.34;	author pwagner;	state Exp;
branches;
next	1.4;

1.4
date	2001.03.31.23.40.55;	author zvi;	state Exp;
branches;
next	1.3;

1.3
date	2001.03.29.08.51.01;	author zvi;	state Exp;
branches;
next	1.2;

1.2
date	2001.01.31.01.08.48;	author zvi;	state Exp;
branches;
next	1.1;

1.1
date	2000.11.22.23.07.26;	author zvi;	state Exp;
branches;
next	;


desc
@@


1.6
log
@Speed enhancement MAJOR update
@
text
@! Copyright (c) 1999, California Institute of Technology.  ALL RIGHTS RESERVED.
! U.S. Government Sponsorship under NASA Contract NAS7-1407 is acknowledged.

module FAST_ZOPACITY_M
  use MLSCommon, only: I4, R8
  implicit NONE
  private
  public :: FAST_ZOPACITY
!---------------------------- RCS Ident Info -------------------------------
  private ID, ModuleName
  CHARACTER (LEN=256) :: Id = &
     "$Id: fast_zopacity_m.f90,v 1.5 2001/06/07 23:30:34 pwagner Exp $"
  CHARACTER (LEN=*), PARAMETER :: ModuleName= &
     "$RCSfile: fast_zopacity_m.f90,v $"
!---------------------------------------------------------------------------
contains
! This subroutine computes the incremental opacity matrices.
!
  Subroutine FAST_ZOPACITY (n_sps,Ngp1,brkpt,no_ele,delta,del_opacity)
!
    integer(i4), intent(in) :: Ngp1,brkpt,no_ele
    integer(i4), intent(in) :: N_SPS
!
    real(r8), intent(in) :: DELTA(:,:)
!
    real(r8), intent(out) :: del_opacity(:)

    integer(i4) :: h_i,i,m,IndxR
!
! Cover all heights
!
! First, right hand side of the ray path:
!
    h_i = 0
    m = 1 - Ngp1
    IndxR = brkpt / Ngp1
    do i = 1, IndxR
      m = m + Ngp1
      if(m > brkpt) EXIT
      h_i = h_i + 1
      call sum_incremental_opacity
    end do
!
! Second, left hand side of the ray path:
!
    m = brkpt + 1
    do i = 1, IndxR
      m = m + Ngp1
      if(m > no_ele) EXIT
      h_i = h_i + 1
      call sum_incremental_opacity
    end do
!
    Return
!
  contains
! --------------------------------     SUM_INCREMENTAL_OPACITY     -----
!
    subroutine SUM_INCREMENTAL_OPACITY
!
      Integer(i4) :: J
!
      Real(r8) :: SUM
!
! Compute the total incremental opacity for the segment
!
      Sum = 0.0
      do j = 1, n_sps                  ! Run over the species list
        Sum = Sum + delta(h_i,j)
      end do
!
      del_opacity(h_i) = Sum
!
    end subroutine SUM_INCREMENTAL_OPACITY
!
  End subroutine FAST_ZOPACITY
!
end module FAST_ZOPACITY_M
! $Log: fast_zopacity_m.f90,v $
! Revision 1.5  2001/06/07 23:30:34  pwagner
! Added Copyright statement
!
! Revision 1.4  2001/03/31 23:40:55  zvi
! Eliminate l2pcdim (dimension parameters) move to allocatable ..
!
! Revision 1.3  2001/03/29 08:51:01  zvi
! Changing the (*) toi (:) everywhere
!
! Revision 1.2  2001/01/31 01:08:48  zvi
! New version of forward model
!
! Revision 1.1  2000/05/04 18:12:06  vsnyder
! Initial conversion to Fortran 90
@


1.5
log
@Added Copyright statement
@
text
@d12 1
a12 1
     "$Id: fast_zopacity_m.f90,v 1.4 2001/03/31 23:40:55 zvi Exp $"
d80 3
@


1.4
log
@Eliminate l2pcdim (dimension parameters) move to allocatable ..
@
text
@d1 3
d12 1
a12 1
     "$Id: fast_zopacity_m.f90,v 1.3 2001/03/29 08:51:01 zvi Exp $"
d80 3
@


1.3
log
@Changing the (*) toi (:) everywhere
@
text
@d9 1
a9 1
     "$Id: fast_zopacity_m.f90,v 1.2 2001/01/31 01:08:48 zvi Exp $"
d16 1
a16 2
  Subroutine FAST_ZOPACITY (n_sps, Ngp1, N2lvl, brkpt, &
 &                          no_ele, delta, del_opacity)
d18 1
a18 1
    integer(i4), intent(in) :: Ngp1,brkpt,no_ele,N2lvl
d77 3
@


1.2
log
@New version of forward model
@
text
@d9 1
a9 1
     "$Id: fast_zopacity_m.f90,v 1.1 2000/05/04 18:12:06 vsnyder Exp $"
d22 1
a22 1
    real(r8), intent(in) :: DELTA(N2lvl,*)
d24 1
a24 1
    real(r8), intent(out) :: del_opacity(*)
d78 3
@


1.1
log
@New version
@
text
@d16 1
a16 1
  Subroutine FAST_ZOPACITY (sps_tbl, n_sps, Ngp1, N2lvl, brkpt, &
d20 1
a20 1
    integer(i4), intent(in) :: SPS_TBL(*), N_SPS
d59 1
a59 1
      Integer(i4) :: J, SPS_I
d66 1
a66 2
      do sps_i = 1, n_sps             ! Run over the species list
        j = sps_tbl(sps_i)
@

