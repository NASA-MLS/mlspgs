head	1.15;
access;
symbols
	newfwm-sep01:1.14.0.2
	V0-7:1.14
	V0-5-Level2:1.11
	V0-5-SIPS:1.10
	V0_1:1.1;
locks; strict;
comment	@# @;


1.15
date	2001.09.17.20.26.28;	author livesey;	state dead;
branches;
next	1.14;

1.14
date	2001.06.22.04.05.28;	author zvi;	state Exp;
branches
	1.14.2.1;
next	1.13;

1.13
date	2001.06.21.13.07.09;	author zvi;	state Exp;
branches;
next	1.12;

1.12
date	2001.06.07.23.39.32;	author pwagner;	state Exp;
branches;
next	1.11;

1.11
date	2001.04.24.00.05.36;	author livesey;	state Exp;
branches;
next	1.10;

1.10
date	2001.04.11.00.51.44;	author livesey;	state Exp;
branches;
next	1.9;

1.9
date	2001.03.31.23.40.56;	author zvi;	state Exp;
branches;
next	1.8;

1.8
date	2001.03.30.20.28.21;	author zvi;	state Exp;
branches;
next	1.7;

1.7
date	2001.03.29.08.51.01;	author zvi;	state Exp;
branches;
next	1.6;

1.6
date	2001.03.26.17.56.14;	author zvi;	state Exp;
branches;
next	1.5;

1.5
date	2001.03.05.21.37.20;	author zvi;	state Exp;
branches;
next	1.4;

1.4
date	2001.01.31.01.08.48;	author zvi;	state Exp;
branches;
next	1.3;

1.3
date	2000.11.22.23.10.05;	author zvi;	state Exp;
branches;
next	1.2;

1.2
date	2000.11.22.23.07.31;	author zvi;	state dead;
branches;
next	1.1;

1.1
date	2000.05.04.18.12.06;	author vsnyder;	state Exp;
branches;
next	;

1.14.2.1
date	2001.09.10.10.01.07;	author zvi;	state dead;
branches;
next	;


desc
@@


1.15
log
@New forward model
@
text
@! Copyright (c) 1999, California Institute of Technology.  ALL RIGHTS RESERVED.
! U.S. Government Sponsorship under NASA Contract NAS7-1407 is acknowledged.

module TEMPERATURE_DERIV_M
  use ELLIPSE_M, only: ELLIPSE
  use D_DELTA_DT_M, only: D_DELTA_DT
  use GET_DRAD_M, only: GET_DRAD
  use MLSCommon, only: I4, R8
  use PATH_ENTITIES_M, only: PATH_VECTOR, PATH_BETA, PATH_DERIVATIVE
  implicit NONE
  private
  public :: TEMPERATURE_DERIV
!---------------------------- RCS Ident Info -------------------------------
  CHARACTER (LEN=256) :: Id = &
       "$Id: temperature_deriv_m.f90,v 1.14 2001/06/22 04:05:28 zvi Exp $"
  CHARACTER (LEN=*), PARAMETER :: ModuleName= &
       "$RCSfile: temperature_deriv_m.f90,v $"
!---------------------------------------------------------------------------
contains
!
    Subroutine temperature_deriv(mid,brkpt,no_ele,t_z_basis,z_path,  &
   &           t_path,h_path,phi_path,beta_path,dHdz_path,no_phi_t,  &
   &           no_t,N_lvls,n_sps,ref_corr,t_phi_basis,tau,t_script,  &
   &           dt_script_dc,spsfunc_path,ilo,ihi,frq_i,dh_dt_path,   &
   &           elvar,no_midval_ndx,midval_ndx,no_gl_ndx,gl_ndx,k_temp)
!
    Integer(i4), intent(in) :: MID,BRKPT,NO_ELE,NO_PHI_T,NO_T,ILO,IHI, &
   &                           N_LVLS,N_SPS,FRQ_I,no_midval_ndx,no_gl_ndx

    Integer(i4), intent(in) :: midval_ndx(:,:),gl_ndx(:,:)

    Type(ELLIPSE), intent(in out) :: elvar

    Type(path_beta), intent(in) :: BETA_PATH(:)      ! (Nsps)

    Type(path_vector), intent(in) :: SPSFUNC_PATH(:)
    Type(path_vector), intent(in) :: z_path, t_path, h_path, phi_path, &
   &                                 dhdz_path

    Real(r8), intent(in) :: dh_dt_path(:,:,:)
!
    Real(r8), intent(in) :: T_Z_BASIS(:), T_PHI_BASIS(:)
    Real(r8), intent(in) :: TAU(:), T_SCRIPT(:), REF_CORR(:)

    Real(r8), intent(in) :: DT_SCRIPT_DC(:,:,:)

    Type(path_derivative), INTENT(in out) :: k_temp
!
    Integer(i4) :: IN, IP, j
    Real(r8) :: D_DELTA_DTNP(Size(tau)), r
!
! Begin sweep through elements to see if user wants derivatives for this
! channel at this frequency
!
    j = lbound(k_temp%values,3) - 1
!
! Loop over the Temp. zeta coeffs.
!
    do in = 1, no_t
!
! Loop over the Temp. phi's coeffs.
!
      do ip = lbound(k_temp%values,3), ubound(k_temp%values,3)
!
! Compute the temperature derivative of delta:
!
        Call d_delta_dt(mid,brkpt,no_ele,z_path,t_path,h_path,phi_path, &
          &  beta_path,dHdz_path,dh_dt_path(:,ip-j,in),N_lvls,n_sps,    &
          &  ref_corr,t_z_basis,no_t,t_phi_basis,no_phi_t,spsfunc_path, &
          &  in,ip,elvar,no_midval_ndx,midval_ndx,no_gl_ndx,gl_ndx,     &
          &  d_delta_dtnp)
!
! Now assemble the derivative:
!
        Call get_drad(d_delta_dtnp,t_script,tau,dt_script_dc(1:,in,ip), &
       &              mid,ilo,ihi,r)
        k_temp%values(frq_i,in,ip) = r
!
      end do
!
    end do
!
    Return
  End Subroutine TEMPERATURE_DERIV
end module TEMPERATURE_DERIV_M
! $Log: temperature_deriv_m.f90,v $
! Revision 1.14  2001/06/22 04:05:28  zvi
! Fixing indexing error
!
! Revision 1.13  2001/06/21 13:07:09  zvi
! Speed enhancement MAJOR update
!
! Revision 1.12  2001/06/07 23:39:32  pwagner
! Added Copyright statement
!
! Revision 1.11  2001/04/24 00:05:36  livesey
! Update, phi window correction for Temperature
!
! Revision 1.10  2001/04/11 00:51:44  livesey
! Moving window implemented
!
! Revision 1.9  2001/03/31 23:40:56  zvi
! Eliminate l2pcdim (dimension parameters) move to allocatable ..
!
! Revision 1.8  2001/03/30 20:28:21  zvi
! General fix-up to get rid of COMMON BLOCK (ELLIPSE)
!
! Revision 1.7  2001/03/29 08:51:01  zvi
! Changing the (*) toi (:) everywhere
!
! Revision 1.6  2001/03/26 17:56:14  zvi
! New codes to deal with dh_dt_path issue.. now being computed on the fly
!
! Revision 1.5  2001/03/05 21:37:20  zvi
! New filter format
!
! Revision 1.1  2000/06/21 21:56:17  zvi
! First version D.P.
!
! Revision 1.1  2000/05/04 18:12:06  vsnyder
! Initial conversion to Fortran 90
@


1.14
log
@Fixing indexing error
@
text
@d15 1
a15 1
       "$Id: temperature_deriv_m.f90,v 1.13 2001/06/21 13:07:09 zvi Exp $"
d87 3
@


1.14.2.1
log
@*** empty log message ***
@
text
@d15 1
a15 1
       "$Id: temperature_deriv_m.f90,v 1.14 2001/06/22 04:05:28 zvi Exp $"
a86 3
! Revision 1.14  2001/06/22 04:05:28  zvi
! Fixing indexing error
!
@


1.13
log
@Speed enhancement MAJOR update
@
text
@d15 1
a15 1
       "$Id: temperature_deriv_m.f90,v 1.12 2001/06/07 23:39:32 pwagner Exp $"
d55 7
a61 3
    j = lbound(k_temp%values,3) + 1

    do in = 1, no_t              ! Loop over the Temp. zeta coeffs.
a63 1
        ! Loop over the Temp. phi's coeffs.
d87 3
@


1.12
log
@Added Copyright statement
@
text
@d15 1
a15 1
       "$Id: temperature_deriv_m.f90,v 1.11 2001/04/24 00:05:36 livesey Exp $"
d22 4
a25 4
   &           t_path,h_path,phi_path,beta_path,dHdz_path,dh_dt_path, &
   &           no_phi_t,no_t,N_lvls,n_sps,ref_corr,t_phi_basis, tau, &
   &           t_script,dt_script_dc,spsfunc_path,ilo,ihi,frq_i,     &
   &           elvar,k_temp)
d27 4
a30 2
    Integer(i4), intent(in) :: MID,BRKPT,NO_ELE,NO_PHI_T,NO_T, &
                               N_LVLS,N_SPS,ILO,IHI,FRQ_I
d49 1
a49 1
    Integer(i4) :: IN, IP
d55 2
d65 4
a68 5
       &     beta_path,dHdz_path,&
       &     dh_dt_path(:,ip-lbound(k_temp%values,3)+1,in),&
       &     N_lvls,n_sps, &
       &     ref_corr,t_z_basis,no_t,t_phi_basis,no_phi_t,spsfunc_path, &
       &     in,ip,elvar,d_delta_dtnp)
d84 3
@


1.11
log
@Update, phi window correction for Temperature
@
text
@d1 3
d15 1
a15 1
       "$Id: temperature_deriv_m.f90,v 1.10 2001/04/11 00:51:44 livesey Exp $"
d81 3
@


1.10
log
@Moving window implemented
@
text
@d12 1
a12 1
       "$Id: temperature_deriv_m.f90,v 1.9 2001/03/31 23:40:56 zvi Exp $"
d58 3
a60 1
       &     beta_path,dHdz_path,dh_dt_path(:,ip,in),N_lvls,n_sps,      &
d78 3
@


1.9
log
@Eliminate l2pcdim (dimension parameters) move to allocatable ..
@
text
@d12 1
a12 1
       "$Id: temperature_deriv_m.f90,v 1.8 2001/03/30 20:28:21 zvi Exp $"
d52 2
a53 1
      do ip = 1, no_phi_t        ! Loop over the Temp. phi's coeffs.
d76 3
@


1.8
log
@General fix-up to get rid of COMMON BLOCK (ELLIPSE)
@
text
@a4 2
  use L2PC_FILE_PARAMETERS, only: MXCO => max_no_elmnts_per_sv_component
  use L2PCdim, only: N2LVL, NLVL
d12 1
a12 1
       "$Id: temperature_deriv_m.f90,v 1.7 2001/03/29 08:51:01 zvi Exp $"
d45 1
a45 1
    Real(r8) :: D_DELTA_DTNP(N2lvl), r
d57 1
a57 1
       &     beta_path,dHdz_path,dh_dt_path(:,ip,in),N_lvls,n_sps,Nlvl, &
d75 3
@


1.7
log
@Changing the (*) toi (:) everywhere
@
text
@d2 1
d14 1
a14 1
       "$Id: temperature_deriv_m.f90,v 1.6 2001/03/26 17:56:14 zvi Exp $"
d23 2
a24 1
   &           t_script,dt_script_dc,spsfunc_path,ilo,ihi,frq_i,k_temp)
d29 2
d61 1
a61 1
       &     in,ip,d_delta_dtnp)
d77 3
@


1.6
log
@New codes to deal with dh_dt_path issue.. now being computed on the fly
@
text
@d13 1
a13 1
       "$Id: temperature_deriv_m.f90,v 1.5 2001/03/05 21:37:20 zvi Exp $"
d36 1
a36 1
    Real(r8), intent(in) :: TAU(*), T_SCRIPT(*), REF_CORR(*)
d38 1
a38 1
    Real(r8), intent(in) :: DT_SCRIPT_DC(N2lvl,mxco,*)
d73 3
@


1.5
log
@New filter format
@
text
@d13 1
a13 1
       "$Id: temperature_deriv_m.f90,v 1.1 2000/06/21 21:56:17 zvi Exp $"
d33 1
a33 1
    Type(path_derivative), INTENT(IN) :: dh_dt_path
d54 4
a57 4
        Call d_delta_dt(mid,brkpt,no_ele,z_path,t_path,h_path,phi_path,   &
       &     beta_path,dHdz_path,dh_dt_path,N_lvls,n_sps,        &
       &     Nlvl,ref_corr,t_z_basis,no_t,t_phi_basis,no_phi_t,           &
       &     spsfunc_path,in,ip,d_delta_dtnp)
d73 3
@


1.4
log
@New version of forward model
@
text
@@


1.3
log
@Re-add basic stuff
@
text
@d5 2
a6 2
  use L2PCdim, only: N2LVL, NLVL, NSPS, NPTG
  use MLSCommon, only: I4, R4, R8
d19 4
a22 5
    Subroutine temperature_deriv(mid,brkpt,no_ele,t_z_basis,band,z_path,  &
   &           t_path,h_path,phi_path,beta_path,dHdz_path,dh_dt_path,     &
   &           no_phi_t,no_t,N_lvls,n_sps,ptg_i,ref_corr,sps_tbl,         &
   &           t_phi_basis,tau,t_script,dt_script_dc,spsfunc_path,ilo,    &
   &           ihi,K_TEMP)
d25 1
a25 3
                               N_LVLS,N_SPS,BAND,PTG_I,ILO,IHI

    Integer(i4), intent(in) :: SPS_TBL(Nsps,*)
d40 1
a40 1
    Real(r4), intent(out) :: K_TEMP(Nptg,mxco,*)
d55 1
a55 1
       &     beta_path,dHdz_path,dh_dt_path,N_lvls,n_sps,sps_tbl(1:,band),&
d63 1
a63 1
        K_TEMP(ptg_i,in,ip) = r
a77 1
!
@


1.2
log
@New version
@
text
@d5 1
a5 2
  use L2PC_PFA_STRUCTURES, only: GEOPHYS_PARAM
  use L2PCdim, only: N2LVL, NLVL, NSPS
d7 1
a10 1

d13 1
a13 1
       "$Id: temperature_deriv_m.f90,v 1.1 2000/05/04 18:12:06 vsnyder Exp $"
d17 18
d36 1
a36 1
contains
d38 6
a43 49
  Subroutine TEMPERATURE_DERIV ( geophysic, tndx, band, cs, Frq,       & 
 &           f_basis, z_path, t_path, h_path, phi_path, dHdz_path,     &
 &           dh_dt_path, Kgp, mnp, mdb_freq, mdb_pres, mdb_temp, mr_f, &
 &           mr_g, no_coeffs_f, no_freqs_f, no_phi_f, no_phi_t, no_t,  &
 &           N_lvls,  n_sps, phi_basis_f, ptg_i, ref_corr, sps_tbl,    &
 &           t_phi_basis,  tau, t_script, dt_script_dc, mnf, ilo, ihi, &
 &           IndxR, IndxL, path_brkpt, K_star_geophys, Ier )
!
    integer(i4), intent(in) :: KGP
    integer(i4), intent(in) :: MNF
    integer(i4), intent(in) :: NO_PHI_T

    type(geophys_param), intent(in) :: GEOPHYSIC(*)
    integer(i4), intent(in) :: TNDX
    integer(i4), intent(in) :: BAND
    real(r4), intent(inout) :: CS(Nlvl,no_phi_t,mnf,*)
    real(r8), intent(in) :: FRQ
    real(r4), intent(in) :: F_BASIS(mxco,*)
    real(r4), intent(in) :: Z_PATH(*)
    real(r4), intent(in) :: T_PATH(*)
    real(r4), intent(in) :: H_PATH(*)
    real(r4), intent(in) :: PHI_PATH(*)
    real(r4), intent(in) :: DHDZ_PATH(*)
    real(r4), intent(in) :: DH_DT_PATH(Kgp,mnp,*)
    integer(i4), intent(in) :: MNP
    real(r8), intent(in) :: MDB_FREQ(mnf,*)
    real(r4), intent(in) :: MDB_PRES(*)
    real(r4), intent(in) :: MDB_TEMP(*)
    real(r4), intent(in) :: MR_F(mxco,mnp,*)
    real(r4), intent(in) :: MR_G(mxco,mnp,*)
    integer(i4), intent(in) :: NO_COEFFS_F(*)
    integer(i4), intent(in) :: NO_FREQS_F(*)
    integer(i4), intent(in) :: NO_PHI_F(*)
    integer(i4), intent(in) :: NO_T
    integer(i4), intent(in) :: N_LVLS
    integer(i4), intent(in) :: N_SPS
    real(r4), intent(in) :: PHI_BASIS_F(mnp,*)
    integer(i4), intent(in) :: PTG_I
    real(r4), intent(in) :: REF_CORR(*)
    integer(i4), intent(in) :: SPS_TBL(Nsps,*)
    real(r4), intent(in) :: T_PHI_BASIS(*)
    real(r4), intent(in) :: TAU(*)
    real(r4), intent(in) :: T_SCRIPT(*)
    real(r4), intent(in) :: DT_SCRIPT_DC(N2lvl,mxco,*)
    integer(i4), intent(in) :: ILO, IHI
    integer(i4), intent(in) :: INDXR, INDXL
    integer(i4), intent(in) :: PATH_BRKPT(*)
    real(r4), intent(out) :: K_STAR_GEOPHYS(Nlvl,mxco,mnp,*)
    integer(i4), intent(out) :: IER
d45 2
a46 2
    integer(i4) :: IN, IP
    real(r4) :: D_DELTA_DTNP(N2lvl)
d57 4
a60 8
        Call d_delta_dt(z_path,t_path,h_path,phi_path,dHdz_path,       &
   &         dh_dt_path,Kgp,N_lvls,cs,Frq,n_sps,no_coeffs_f,           &
   &         sps_tbl(1,band),mxco,Nlvl,f_basis,                        &
   &         ref_corr,geophysic(tndx)%basis_peaks,mr_g(1,1,tndx),      &
   &         no_t,t_phi_basis,no_phi_t,mdb_pres,mdb_temp,mdb_freq,     &
   &         mnp,mnf,no_freqs_f,no_phi_f,phi_basis_f,mr_f,in,ip,       &
   &         IndxR,IndxL,path_brkpt,d_delta_dtnp,Ier)
        if (Ier /= 0) Return
d64 3
a66 3
          Call get_drad(d_delta_dtnp,t_script,tau,                     &
     &                  dt_script_dc(1,in,ip),IndxR,IndxL,ilo,ihi,     &
     &                  K_star_geophys(ptg_i,in,ip,tndx))
d68 1
a68 1
        end do
d70 1
a70 1
      end do
a74 1

d76 3
@


1.1
log
@Initial conversion to Fortran 90
@
text
@d14 1
a14 1
       "$Id: TEMPERATURE_DERIV_M,v 1.12 2000/02/08 19:54:57 vsnyder Exp $"
d106 4
a109 1
! $Log: TEMPERATURE_DERIV_M,v $
@

