head	1.1;
access;
symbols
	newfwm-feb03:1.1.0.2;
locks; strict;
comment	@# @;


1.1
date	2003.03.28.18.38.40;	author jonathan;	state dead;
branches
	1.1.2.1;
next	;

1.1.2.1
date	2003.03.28.18.38.40;	author jonathan;	state Exp;
branches;
next	1.1.2.2;

1.1.2.2
date	2003.04.15.23.56.40;	author vsnyder;	state Exp;
branches;
next	1.1.2.3;

1.1.2.3
date	2003.04.16.17.25.42;	author vsnyder;	state Exp;
branches;
next	1.1.2.4;

1.1.2.4
date	2003.04.16.19.39.05;	author vsnyder;	state Exp;
branches;
next	1.1.2.5;

1.1.2.5
date	2003.04.16.19.57.09;	author vsnyder;	state dead;
branches;
next	;


desc
@@


1.1
log
@file Blackbody.f90 was initially added on branch newfwm-feb03.
@
text
@@


1.1.2.1
log
@moved from cloudfwm
@
text
@a0 50
! Copyright (c) 1999, California Institute of Technology.  ALL RIGHTS RESERVED.
! U.S. Government Sponsorship under NASA Contract NAS7-1407 is acknowledged.

module Blackbody

! ------------------------------------------------------
! USE PLANCK FUNCTION TO COMPUTE BRIGHTNESS TEMPERATURE
! ------------------------------------------------------

        use MLSCommon, only: r8
        IMPLICIT NONE
        Private
        Public :: planck

 !---------------------------- RCS Ident Info -------------------------------
  character (len=*), private, parameter :: IdParm =                          &
    "$Id: Blackbody.f90,v 1.3 2002/10/08 17:08:07 pwagner Exp $"
  character (len=len(idParm)), private :: Id = idParm
  character (len=*), private, parameter :: ModuleName=                       &
    "$RCSfile: Blackbody.f90,v $"
  private :: not_used_here 
 !---------------------------------------------------------------------------
      
contains

	subroutine planck(temp,freq,tb)
	real(r8) :: temp,tb,freq
	real(r8) :: h
	real(r8) :: k

	h = 6.6256
	k = 1.3805

        tb=h*freq*1.e-2_r8/(exp(h*freq*1.e-2_r8/k/temp)-1.)/k

	end subroutine planck

  logical function not_used_here()
    not_used_here = (id(1:1) == ModuleName(1:1))
  end function not_used_here

end module Blackbody

! $Log: Blackbody.f90,v $
! Revision 1.3  2002/10/08 17:08:07  pwagner
! Added idents to survive zealous Lahey optimizer
!
! Revision 1.2  2001/09/21 15:51:37  jonathan
! modified F95 version
!
@


1.1.2.2
log
@Move use down to procedure scope, get H_OVER_K from Physics module
@
text
@d10 4
a13 3
  IMPLICIT NONE
  Private
  Public :: Planck
d17 1
a17 1
    "$Id: Blackbody.f90,v 1.1.2.1 2003/03/28 18:38:40 jonathan Exp $"
d26 4
a29 1
  subroutine Planck ( Temp, Freq, TB )
d31 2
a32 2
    use MLSCommon, only: r8
    use Physics, only: H_OVER_K
d34 1
a34 2
    real(r8), intent(in) :: TEMP, FREQ
    real(r8), intent(out) :: TB
d36 1
a36 8
    real(r8), parameter :: H_O_K = H_Over_K / 100.0_r8
    real(r8) :: HXF  ! H_O_K * Freq

    hxf = h_o_k * freq

    tb = hxf / (exp(hxf/temp)-1.0_r8)

  end subroutine Planck
a44 3
! Revision 1.1.2.1  2003/03/28 18:38:40  jonathan
! moved from cloudfwm
!
@


1.1.2.3
log
@Correct scaling of h/k
@
text
@d16 1
a16 1
    "$Id: Blackbody.f90,v 1.1.2.2 2003/04/15 23:56:40 vsnyder Exp $"
d30 1
a30 1
    real(r8), intent(in) :: TEMP, FREQ   ! Kelvin, MHz
d33 1
a33 1
    real(r8), parameter :: H_O_K = H_Over_K
a48 3
! Revision 1.1.2.2  2003/04/15 23:56:40  vsnyder
! Move use down to procedure scope, get H_OVER_K from Physics module
!
@


1.1.2.4
log
@Use RREXP to avoid cancellation
@
text
@d10 3
a12 5
  implicit NONE
  private
  public :: Planck

  interface Planck; module procedure Planck_0, Planck_1; end interface
d16 1
a16 1
    "$Id: Blackbody.f90,v 1.1.2.3 2003/04/16 17:25:42 vsnyder Exp $"
d25 1
a25 1
  subroutine Planck_0 ( Temp, Freq, TB )
a26 1
    use CRREXP_m, only: RREXP    ! ( exp(x)-1 ) / x, for Planck fn.
d33 2
a34 18
    !{Planck black body function:
    ! $\frac{\frac{h \nu}k}{\exp\left(\frac{h \nu}{k T}\right)-1}$.
    ! We need to be careful how this is calculated because $\exp x -1$ has
    ! cancellation for small $x$.  $\frac{h \nu}{k T}$ is $\approx 0.04$ for
    ! $\nu \approx 240$ GHz and $T \approx 250$ K.

    tb = temp / rrexp(h_over_k * freq / temp)

  end subroutine Planck_0

  subroutine Planck_1 ( Temp, Freq, TB )

    use CRREXP_m, only: RREXP    ! ( exp(x)-1 ) / x, for Planck fn.
    use MLSCommon, only: r8
    use Physics, only: H_OVER_K

    real(r8), intent(in) :: TEMP(:), FREQ   ! Kelvin, MHz
    real(r8), intent(out) :: TB(:) ! Same size as TEMP!
d36 1
a36 5
    !{Planck black body function:
    ! $\frac{\frac{h \nu}k}{\exp\left(\frac{h \nu}{k T}\right)-1}$.
    ! We need to be careful how this is calculated because $\exp x -1$ has
    ! cancellation for small $x$.  $\frac{h \nu}{k T}$ is $\approx 0.04$ for
    ! $\nu \approx 240$ GHz and $T \approx 250$ K.
d38 1
a38 1
    tb = temp / rrexp(h_over_k * freq / temp)
d40 1
a40 1
  end subroutine Planck_1
a48 3
! Revision 1.1.2.3  2003/04/16 17:25:42  vsnyder
! Correct scaling of h/k
!
@


1.1.2.5
log
@Moved to ../lib
@
text
@d18 1
a18 1
    "$Id: Blackbody.f90,v 1.1.2.4 2003/04/16 19:39:05 vsnyder Exp $"
a71 3
! Revision 1.1.2.4  2003/04/16 19:39:05  vsnyder
! Use RREXP to avoid cancellation
!
@


