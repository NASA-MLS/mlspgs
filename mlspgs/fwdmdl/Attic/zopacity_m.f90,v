head	1.6;
access;
symbols
	V0_1:1.1;
locks; strict;
comment	@# @;


1.6
date	2001.04.06.01.37.00;	author zvi;	state dead;
branches;
next	1.5;

1.5
date	2001.03.29.08.51.01;	author zvi;	state Exp;
branches;
next	1.4;

1.4
date	2001.01.31.01.08.48;	author zvi;	state Exp;
branches;
next	1.3;

1.3
date	2000.11.22.23.10.05;	author zvi;	state Exp;
branches;
next	1.2;

1.2
date	2000.11.22.23.07.32;	author zvi;	state dead;
branches;
next	1.1;

1.1
date	2000.05.04.18.12.06;	author vsnyder;	state Exp;
branches;
next	;


desc
@@


1.6
log
@Remove zopacity_m.f90 ...noit needed
@
text
@module ZOPACITY_M
  use MLSCommon, only: I4, R8
  implicit NONE
  private
  public :: ZOPACITY
!---------------------------- RCS Ident Info -------------------------------
  private ID, ModuleName
  CHARACTER (LEN=256) :: Id = &
       "$Id: zopacity_m.f90,v 1.5 2001/03/29 08:51:01 zvi Exp $"
  CHARACTER (LEN=*), PARAMETER :: ModuleName= "$RCSfile: zopacity_m.f90,v $"
!---------------------------------------------------------------------------
contains
! This subroutine computes the incremental opacity matrices.
!
  Subroutine ZOPACITY ( mr_f, n_coeffs, n_sps, Ngp1, &
 &           N2lvl, Nc, mnp, no_phi_f, brkpt, no_ele, delta, del_opacity)
!
    integer(i4), intent(in) :: NC, MNP,Ngp1,brkpt,no_ele
    real(r8), intent(in) :: MR_F(:,:,:)
    integer(i4), intent(in) :: N_COEFFS(:), N_SPS
    integer(i4), intent(in) :: N2lvl, NO_PHI_F(:)
    real(r8), intent(in) :: DELTA(:,:,:,:)
    real(r8), intent(out) :: del_opacity(:)

    integer(i4) :: h_i,i,m,IndxR
!
! Cover all heights
!
! First, right hand side of the ray path:
!
    h_i = 0
    m = 1 - Ngp1
    IndxR = brkpt / Ngp1
    do i = 1, IndxR
      m = m + Ngp1
      if(m > brkpt) EXIT
      h_i = h_i + 1
      call sum_incremental_opacity
    end do
!
! Second, left hand side of the ray path:
!
    m = brkpt + 1
    do i = 1, IndxR
      m = m + Ngp1
      if(m > no_ele) EXIT
      h_i = h_i + 1
      call sum_incremental_opacity
    end do
!
    Return
  contains
! --------------------------------     SUM_INCREMENTAL_OPACITY     -----
    subroutine SUM_INCREMENTAL_OPACITY
      integer(i4) :: FI, J, K, NF, NO_C
    Real(r8) :: SUM
!
! initialize sums
!
      Sum = 0.0
!
      do j = 1, n_sps                  ! Run over the species list
        nf = no_phi_f(j)
        no_c = n_coeffs(j)
        do fi = 1, nf                  ! Loop over Phi's
          do k = 1, no_c               ! Run over the coefficients
!
! Compute the total incremental opacity for the segment
!
            Sum = Sum + mr_f(k,fi,j) * delta(h_i,k,fi,j)
!
          end do
        end do
      end do
!
      del_opacity(h_i) = Sum
    end subroutine SUM_INCREMENTAL_OPACITY
  End subroutine ZOPACITY
end module ZOPACITY_M
! $Log: zopacity_m.f90,v $
! Revision 1.5  2001/03/29 08:51:01  zvi
! Changing the (*) toi (:) everywhere
!
! Revision 1.4  2001/01/31 01:08:48  zvi
! New version of forward model
!
! Revision 1.1  2000/05/04 18:12:06  vsnyder
! Initial conversion to Fortran 90
@


1.5
log
@Changing the (*) toi (:) everywhere
@
text
@d9 1
a9 1
       "$Id: zopacity_m.f90,v 1.4 2001/01/31 01:08:48 zvi Exp $"
d81 3
@


1.4
log
@New version of forward model
@
text
@d9 1
a9 1
       "$Id: zopacity_m.f90,v 1.1 2000/05/04 18:12:06 vsnyder Exp $"
d19 5
a23 5
    real(r8), intent(in) :: MR_F(Nc,mnp,*)
    integer(i4), intent(in) :: N_COEFFS(*), N_SPS
    integer(i4), intent(in) :: N2lvl, NO_PHI_F(*)
    real(r8), intent(in) :: DELTA(N2lvl,Nc,mnp,*)
    real(r8), intent(out) :: del_opacity(*)
d81 3
@


1.3
log
@Re-add basic stuff
@
text
@d15 1
a15 1
  Subroutine ZOPACITY ( mr_f, sps_tbl, n_coeffs, n_sps, Ngp1, &
d20 1
a20 1
    integer(i4), intent(in) :: SPS_TBL(*), N_COEFFS(*), N_SPS
d55 1
a55 1
      integer(i4) :: FI, J, K, NF, NO_C, SPS_I
d62 1
a62 2
      do sps_i = 1, n_sps             ! Run over the species list
        j = sps_tbl(sps_i)
d65 2
a66 2
        do fi = 1, nf                 ! Loop over Phi's
          do k = 1, no_c              ! Run over the coefficients
@


1.2
log
@New version
@
text
@d2 1
a2 1
  use MLSCommon, only: I4, R4, R8
a5 1

a11 1

a12 1

d15 2
a16 2
  Subroutine ZOPACITY ( mr_f, sps_tbl, n_coeffs, n_sps, N_lvls, &
 &           N2lvl, Nc, mnp, no_phi_f, delta, del_opacity, IndxR, IndxL)
d18 3
a20 3
    integer(i4), intent(in) :: NC, MNP
    real(r4), intent(in) :: MR_F(Nc,mnp,*)
    integer(i4), intent(in) :: SPS_TBL(*), N_COEFFS(*), N_SPS, N_lvls
d22 2
a23 3
    real(r4), intent(in) :: DELTA(N2lvl,Nc,mnp,*)
    real(r4), intent(out) :: del_opacity(*)
    integer(i4), intent(in) :: IndxR, IndxL
d25 1
a25 1
    integer(i4) :: H_I
d31 7
a37 1
    do h_i = 1, IndxR
d43 5
a47 1
    do h_i = IndxL - 1, 2 * N_lvls - 2
a51 1

d71 1
a71 1
            Sum = Sum + dprod(mr_f(k,fi,j), delta(h_i,k,fi,j))
a80 1

a83 1
!
@


1.1
log
@Initial conversion to Fortran 90
@
text
@d10 1
a10 1
       "$Id: ZOPACITY_M,v 1.12 2000/02/08 19:54:57 vsnyder Exp $"
d77 4
a80 1
! $Log: ZOPACITY_M,v $
@

