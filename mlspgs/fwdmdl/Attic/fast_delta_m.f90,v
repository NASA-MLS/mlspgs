head	1.7;
access;
symbols
	V0-5-Level2:1.5
	V0-5-SIPS:1.5;
locks; strict;
comment	@# @;


1.7
date	2001.06.21.13.07.08;	author zvi;	state dead;
branches;
next	1.6;

1.6
date	2001.06.07.23.30.34;	author pwagner;	state Exp;
branches;
next	1.5;

1.5
date	2001.03.31.23.40.55;	author zvi;	state Exp;
branches;
next	1.4;

1.4
date	2001.03.30.20.28.21;	author zvi;	state Exp;
branches;
next	1.3;

1.3
date	2001.03.29.08.51.01;	author zvi;	state Exp;
branches;
next	1.2;

1.2
date	2001.01.31.01.08.48;	author zvi;	state Exp;
branches;
next	1.1;

1.1
date	2000.11.22.23.07.26;	author zvi;	state Exp;
branches;
next	;


desc
@@


1.7
log
@Speed enhancement MAJOR update
@
text
@! Copyright (c) 1999, California Institute of Technology.  ALL RIGHTS RESERVED.
! U.S. Government Sponsorship under NASA Contract NAS7-1407 is acknowledged.

module FAST_DELTA_M
  use MLSCommon, only: I4, R8
  use ELLIPSE_M, only: ELLIPSE
  use PATH_ENTITIES_M, only: PATH_VECTOR, PATH_BETA
  use GENERIC_DELTA_INTEGRAL_M, only: GENERIC_DELTA_INTEGRAL
  implicit NONE
  private
  public :: FAST_DELTA
!---------------------------- RCS Ident Info -------------------------------
  CHARACTER (LEN=256) :: Id = &
    "$Id: fast_delta_m.f90,v 1.6 2001/06/07 23:30:34 pwagner Exp $"
  CHARACTER (LEN=*), PARAMETER :: ModuleName= &
    "$RCSfile: fast_delta_m.f90,v $"
!---------------------------------------------------------------------------
contains
!---------------------------------------------------------------------
!  This routine computes the d_delta function. Integration is done
!  using the Gauss-Legendre method.
!
!  ** NOTE: This routine integrate in ZETA Space !
!
  Subroutine FAST_DELTA(mid,brkpt,no_ele,z_path,h_path,phi_path,    &
 &           beta_path,dHdz_path,spsfunc_path,n_sps,N_lvls,ref_corr,&
 &           elvar,delta,Ier)
!
    Integer(i4), intent(in) :: N_SPS, N_LVLS, MID, BRKPT, NO_ELE

    Real(r8), intent(in) :: REF_CORR(:)

    Real(r8), intent(inout) :: DELTA(:,:)     ! (N2lvl,Nsps)

    Integer(i4), intent(out) :: IER

    Type(ELLIPSE), intent(in out) :: elvar

    Type(path_beta), intent(in) :: BETA_PATH(:)      ! (Nsps)

    Type(path_vector), intent(in) :: Z_PATH, H_PATH, PHI_PATH, DHDZ_PATH
    Type(path_vector), intent(in) :: SPSFUNC_PATH(:)
!
! -----     Local variables     ----------------------------------------
!
    Integer(i4) :: J, K
!
    Integer(i4), SAVE :: NZ=1, NP=1, IZ=1, IP=1
!
    Real(r8), SAVE :: FQ = 1.0
    Real(r8), SAVE, DIMENSION(2) :: Z_BASIS = (/ -5.0, 5.0/)
    Real(r8), SAVE, DIMENSION(2) :: PHI_BASIS = (/-50.0, 50.0/)
!
    Real(r8), ALLOCATABLE, DIMENSION(:) :: Integrand
!
! -----     Executable statements     ----------------------------------
!
    Ier = 0
    DEALLOCATE(Integrand, STAT=k)
!
    ALLOCATE(Integrand(no_ele), STAT=ier)
    IF(ier /= 0) THEN
      Ier = 1
      Print *,'** Error: ALLOCATION error in FAST_DELTA routine ..'
      goto 99
    endif
!
    do j = 1, n_sps
!
      integrand(1:no_ele) = spsfunc_path(j)%values(1:no_ele) *  &
     &                      beta_path(j)%values(1:no_ele)
!
      Call generic_delta_integral(mid, brkpt, no_ele, z_path, h_path, &
 &         phi_path, dhdz_path, N_lvls, ref_corr, integrand, z_basis, &
 &         phi_basis, nz, np, iz, ip, fq, elvar, delta(1:,j), Ier)
      IF(ier /= 0) goto 99

    end do
!
 99  DEALLOCATE(Integrand, STAT=k)

    Return

  End Subroutine FAST_DELTA
!
end module FAST_DELTA_M
! $Log: fast_delta_m.f90,v $
! Revision 1.6  2001/06/07 23:30:34  pwagner
! Added Copyright statement
!
! Revision 1.5  2001/03/31 23:40:55  zvi
! Eliminate l2pcdim (dimension parameters) move to allocatable ..
!
! Revision 1.4  2001/03/30 20:28:21  zvi
! General fix-up to get rid of COMMON BLOCK (ELLIPSE)
!
! Revision 1.3  2001/03/29 08:51:01  zvi
! Changing the (*) toi (:) everywhere
!
! Revision 1.2  2001/01/31 01:08:48  zvi
! New version of forward model
!
! Revision 1.1  2000/06/21 21:56:13  zvi
! First version D.P.
!
! Revision 1.1  2000/05/04 18:12:05  vsnyder
! Initial conversion to Fortran 90
@


1.6
log
@Added Copyright statement
@
text
@d14 1
a14 1
    "$Id: fast_delta_m.f90,v 1.5 2001/03/31 23:40:55 zvi Exp $"
d88 3
@


1.5
log
@Eliminate l2pcdim (dimension parameters) move to allocatable ..
@
text
@d1 3
d14 1
a14 1
    "$Id: fast_delta_m.f90,v 1.4 2001/03/30 20:28:21 zvi Exp $"
d88 3
@


1.4
log
@General fix-up to get rid of COMMON BLOCK (ELLIPSE)
@
text
@d11 1
a11 1
    "$Id: fast_delta_m.f90,v 1.3 2001/03/29 08:51:01 zvi Exp $"
d22 3
a24 3
  Subroutine FAST_DELTA(mid,brkpt,no_ele,z_path,h_path,phi_path, &
 &           beta_path,dHdz_path,spsfunc_path,n_sps,N_lvls,      &
 &           Nlvl,ref_corr,elvar,delta,Ier)
d26 1
a26 1
    Integer(i4), intent(in) :: NLVL, N_SPS, N_LVLS, MID, BRKPT, NO_ELE
d85 3
@


1.3
log
@Changing the (*) toi (:) everywhere
@
text
@d3 1
d11 1
a11 1
    "$Id: fast_delta_m.f90,v 1.2 2001/01/31 01:08:48 zvi Exp $"
d24 1
a24 1
 &           Nlvl,ref_corr,delta,Ier)
d34 2
d72 1
a72 1
 &         phi_basis, nz, np, iz, ip, fq, delta(1:,j), Ier)
d85 3
@


1.2
log
@New version of forward model
@
text
@d10 1
a10 1
    "$Id: fast_delta_m.f90,v 1.1 2000/08/30 21:56:13 zvi Exp $"
d27 1
a27 1
    Real(r8), intent(in) :: REF_CORR(*)
d29 1
a29 1
    Real(r8), intent(inout) :: DELTA(2*Nlvl,*)     ! (N2lvl,Nsps)
d82 3
@


1.1
log
@New version
@
text
@d22 1
a22 1
 &           beta_path,dHdz_path,spsfunc_path,n_sps,N_lvls,sps_tbl, &
a25 1
    Integer(i4), intent(in) :: SPS_TBL(*)
d40 1
a40 1
    Integer(i4) :: J, K, SPS_I
d62 1
a62 3
    do sps_i = 1, n_sps
!
      j = sps_tbl(sps_i)
@

