head	2.9;
access;
symbols
	V1-32:2.7
	V1-31:2.7
	V1-30:2.6
	V1-13:2.4
	V1-12:2.4
	V1-11:2.4
	V1-10:2.4
	newfwm-feb03:2.4.0.2;
locks; strict;
comment	@# @;


2.9
date	2004.01.09.20.57.33;	author perun;	state dead;
branches;
next	2.8;

2.8
date	2004.01.09.17.46.23;	author perun;	state Exp;
branches;
next	2.7;

2.7
date	2003.09.29.18.27.19;	author pwagner;	state Exp;
branches;
next	2.6;

2.6
date	2003.09.15.17.15.54;	author perun;	state Exp;
branches;
next	2.5;

2.5
date	2003.08.15.14.25.04;	author perun;	state Exp;
branches;
next	2.4;

2.4
date	2003.01.31.18.13.34;	author perun;	state Exp;
branches;
next	2.3;

2.3
date	2002.11.25.05.34.30;	author jdone;	state Exp;
branches;
next	2.2;

2.2
date	2002.11.18.21.21.30;	author jdone;	state Exp;
branches;
next	2.1;

2.1
date	2002.11.07.21.36.57;	author jdone;	state Exp;
branches;
next	;


desc
@@


2.9
log
@Removed because not needed.
@
text
@!
! Copyright (c) 2003, California Institute of Technology.  ALL RIGHTS RESERVED.
! U.S. Government Sponsorship under NASA Contract NAS7-1407 is acknowledged.
!
MODULE OutputL1B_HDF5
  ! This module contains the subroutines needed to write L1B data to HDF5 files.

  USE OutputL1B_DataTypes, ONLY: LENUTC, L1BOAINDEX_T, L1BOASC_T, L1BOATP_T
  USE MLS_DataProducts, ONLY: DataProducts_T, Deallocate_DataProducts
  USE MLSAuxData, ONLY: Build_MLSAuxData, CreateGroup_MLSAuxData
  USE MLSCommon
  USE MLSL1Common, ONLY: L1BFileInfo_T
  USE MLSL1Config, ONLY: MIFsGHz, MIFsTHz
  USE MLSSignalNomenclature, ONLY:GetFullMLSSignalName

  IMPLICIT NONE

  PRIVATE

  PUBLIC :: OUTPUTL1B_CREATE_HDF5, OUTPUTL1B_INDEX_HDF5, OUTPUTL1B_SC_HDF5, &
       OUTPUTL1B_GHZ_HDF5, OUTPUTL1B_THZ_HDF5, OUTPUTL1B_RAD_HDF5, &
       OutputL1B_LatBinData
  !------------------- RCS Ident Info -----------------------------------------
  CHARACTER(LEN=130) :: Id = &                                                 
    "$Id: OutputL1B_HDF5.f90,v 2.8 2004/01/09 17:46:23 perun Exp $"
  CHARACTER (LEN=*), PARAMETER :: ModuleName="$RCSfile: OutputL1B_HDF5.f90,v $"
  !----------------------------------------------------------------------------
!---------------------------------------------------------Names of Dimensions:
CONTAINS

!------------------------------------------------------------- OutputL1B_Create
  SUBROUTINE OutputL1B_create_HDF5 (sdId)
    ! This routine assigns the groups and subgroups in the orbit and attitude 
    ! file handle, sdId%OAId
    ! Arguments
    TYPE( L1BFileInfo_T ), INTENT(IN) :: sdId

    CALL CreateGroup_MLSAuxData (sdId%OAId, 'sc')
    CALL CreateGroup_MLSAuxData (sdId%OAId, 'GHz')
    CALL CreateGroup_MLSAuxData (sdId%OAId, 'THz')

  END SUBROUTINE OutputL1B_create_HDF5

  !------------------------------------------------------------ OutputL1B_index
  SUBROUTINE OutputL1B_index_HDF5 (noMAF, sd_id, index)
    USE HDF5, ONLY: HID_T
    ! This subroutine writes the time/MIF indexing quantities to the HDF file. 
    ! Assumes HDF5 FORTRAN APIs have been invoked to open/create files.
    ! Arguments
    TYPE( L1BOAindex_T), INTENT(IN) :: index
    INTEGER, INTENT(IN) :: noMAF
    INTEGER(HID_T), INTENT(IN) :: sd_id
! Variables
    TYPE( DataProducts_T ) :: dataset
    INTEGER :: status
!------------------------------------------------------------------------------
    CALL Deallocate_DataProducts (dataset)

    ALLOCATE (dataset%Dimensions(1), stat=status)

    dataset%name      = 'MAFStartTimeUTC   '
    dataset%data_type = 'character         '
    dataset%Dimensions(1) = 'MAF                 '
    CALL Build_MLSAuxData (sd_id,dataset, index%MAFStartTimeUTC, & 
         char_length=lenUTC, lastIndex=noMAF)
    dataset%name      = 'MAFStartTimeTAI   '
    dataset%data_type = 'double            '
    CALL Build_MLSAuxData (sd_id,dataset, index%MAFStartTimeTAI, &
         lastIndex=noMAF)
    dataset%name      = 'noMIFs            '
    dataset%data_type = 'integer           '
    CALL Build_MLSAuxData (sd_id,dataset, index%noMIFs, lastIndex=noMAF)
    dataset%name      = 'counterMAF        '
    CALL Build_MLSAuxData (sd_id,dataset, index%counterMAF, lastIndex=noMAF)

    CALL Deallocate_DataProducts (dataset)

!------------------------------------------------------------------------------
  END SUBROUTINE OutputL1B_index_HDF5
!----------------------------------------------------------------- OutputL1B_sc
  SUBROUTINE OutputL1B_sc_HDF5 (noMAF, sd_id, sc)
    USE HDF5, ONLY: HID_T
    ! It writes the spacecraft quantities to a group in an HDF5 file.
    ! Assumes l1/Close_Files will close files.
    ! Arguments
    TYPE( L1BOAsc_T ), INTENT(IN) :: sc        
    INTEGER, INTENT(IN) :: noMAF
    INTEGER(HID_T), INTENT(IN) :: sd_id
    ! Variables
    TYPE( DataProducts_T ) :: dataset
    INTEGER :: status
!------------------------------------------------------------------------------
    CALL Deallocate_DataProducts (dataset)

! 2-d first:

    ALLOCATE (dataset%Dimensions(2), stat=status)

    dataset%name      = 'sc/GeocAlt        '
    dataset%data_type = 'double            '
    dataset%Dimensions(1) = 'MIF                '
    dataset%Dimensions(2) = 'MAF                '
    CALL Build_MLSAuxData (sd_id, dataset, sc%scGeocAlt, lastIndex=noMAF)
    dataset%name      = 'sc/GeocLat        '
    dataset%data_type = 'real              '
    CALL Build_MLSAuxData (sd_id, dataset, sc%scGeocLat, lastIndex=noMAF)
    dataset%name      = 'sc/GeodAlt        '
    dataset%data_type = 'double            '
    CALL Build_MLSAuxData (sd_id, dataset, sc%scGeodAlt, lastIndex=noMAF)
    dataset%name      = 'sc/GeodLat        '
    dataset%data_type = 'real              '    
    CALL Build_MLSAuxData (sd_id, dataset, sc%scGeodLat, lastIndex=noMAF)
    dataset%name      = 'sc/Lon            '
    CALL Build_MLSAuxData (sd_id, dataset, sc%scLon, lastIndex=noMAF)
    dataset%name      = 'sc/GeodAngle      '
    CALL Build_MLSAuxData (sd_id, dataset, sc%scGeodAngle, lastIndex=noMAF)
    dataset%name      = 'sc/OrbIncl        '
    CALL Build_MLSAuxData (sd_id, dataset, sc%scOrbIncl, lastIndex=noMAF)
    dataset%name      = 'sc/MIF_TAI        '
    dataset%data_type = 'double            '
    CALL Build_MLSAuxData (sd_id, dataset, sc%MIF_TAI, lastIndex=noMAF)

! 3-d next:

    DEALLOCATE (dataset%Dimensions, stat=status)
    ALLOCATE (dataset%Dimensions(3), stat=status)
    dataset%name      = 'sc/ECI            '
    dataset%data_type = 'double            '
    dataset%Dimensions(1) = 'xyz                 '
    dataset%Dimensions(2) = 'MIF                 '
    dataset%Dimensions(3) = 'MAF                 '
    CALL Build_MLSAuxData (sd_id, dataset, sc%scECI, lastIndex=noMAF)
    dataset%name      = 'sc/ECR            '
    CALL Build_MLSAuxData (sd_id, dataset, sc%scECR, lastIndex=noMAF)
    dataset%name      = 'sc/VelECI         '
    CALL Build_MLSAuxData (sd_id, dataset, sc%scVelECI, lastIndex=noMAF)
    dataset%name      = 'sc/ypr            '
    CALL Build_MLSAuxData (sd_id, dataset, sc%ypr, lastIndex=noMAF)
    dataset%name      = 'sc/yprRate        '
    CALL Build_MLSAuxData (sd_id, dataset, sc%yprRate, lastIndex=noMAF)
    CALL Deallocate_DataProducts (dataset)
    dataset%name      = 'sc/VelECR         '
    CALL Build_MLSAuxData (sd_id, dataset, sc%scVelECR, lastIndex=noMAF)

    CALL Deallocate_DataProducts (dataset)
!------------------------------------------------------------------------------
  END SUBROUTINE OutputL1B_sc_HDF5

!---------------------------------------------------------------- OutputL1B_GHz
  SUBROUTINE OutputL1B_GHz_HDF5 (noMAF, sd_id, tp)
    USE HDF5, ONLY: HID_T
  ! This subroutine writes the GHz tangent point quantities to a group 
  ! in an HDF5 file.  Assumes HDF5 FORTRAN APIs have been invoked by 
  ! l1/OpenInit to open files. Assumes l1/Close_Files will close files.
  ! Arguments
    TYPE( L1BOAtp_T ), INTENT(IN) :: tp
    INTEGER, INTENT(IN) :: noMAF
    INTEGER(HID_T), INTENT(IN) :: sd_id
    ! Variables
    TYPE( DataProducts_T ) :: dataset
    INTEGER :: status
!------------------------------------------------------------------------------
    CALL Deallocate_DataProducts (dataset)

! 2-d first:

    ALLOCATE (dataset%Dimensions(2), stat=status)

    dataset%name      = 'GHz/encoderAngle  '
    dataset%data_type = 'double            '
    dataset%Dimensions(1) = 'MIF                 '
    dataset%Dimensions(2) = 'MAF                 '
    CALL Build_MLSAuxData (sd_id,dataset, tp%encoderAngle, lastIndex=noMAF)
    dataset%name      = 'GHz/scAngle       '
    CALL Build_MLSAuxData (sd_id,dataset, tp%scAngle, lastIndex=noMAF)
    dataset%name      = 'GHz/scanAngle     '
    CALL Build_MLSAuxData (sd_id,dataset, tp%scanAngle, lastIndex=noMAF)
    dataset%name      = 'GHz/scanRate      '
    dataset%data_type = 'real              '
    CALL Build_MLSAuxData (sd_id,dataset, tp%scanRate, lastIndex=noMAF)
    dataset%name      = 'GHz/OrbY          '
    dataset%data_type = 'real              '
    dataset%Dimensions(1) = 'GHz.MIF              '
    CALL Build_MLSAuxData (sd_id,dataset, tp%tpOrbY, lastIndex=noMAF)
    dataset%name      = 'GHz/GeocAlt       '
    dataset%data_type = 'double            '
    CALL Build_MLSAuxData (sd_id,dataset, tp%tpGeocAlt, lastIndex=noMAF)
    dataset%name      = 'GHz/GeocLat       '
    dataset%data_type = 'real              '
    CALL Build_MLSAuxData (sd_id,dataset, tp%tpGeocLat, lastIndex=noMAF)
    dataset%name      = 'GHz/GeocAltRate   '
    CALL Build_MLSAuxData (sd_id,dataset, tp%tpGeocAltRate, lastIndex=noMAF)
    dataset%name      = 'GHz/GeodAlt       '
    dataset%data_type = 'double            '
    CALL Build_MLSAuxData (sd_id,dataset, tp%tpGeodAlt, lastIndex=noMAF)
    dataset%name      = 'GHz/GeodLat       '
    dataset%data_type = 'real              '
    CALL Build_MLSAuxData (sd_id,dataset, tp%tpGeodLat, lastIndex=noMAF)
    dataset%name      = 'GHz/GeodAltRate   '
    CALL Build_MLSAuxData (sd_id,dataset, tp%tpGeodAltRate, lastIndex=noMAF)
    dataset%name      = 'GHz/Lon           '
    CALL Build_MLSAuxData (sd_id,dataset, tp%tpLon, lastIndex=noMAF)
    dataset%name      = 'GHz/GeodAngle     '
    CALL Build_MLSAuxData (sd_id,dataset, tp%tpGeodAngle, lastIndex=noMAF)
    dataset%name      = 'GHz/SolarTime     '
    CALL Build_MLSAuxData (sd_id,dataset, tp%tpSolarTime, lastIndex=noMAF)
    dataset%name      = 'GHz/SolarZenith   '
    CALL Build_MLSAuxData (sd_id,dataset, tp%tpSolarZenith, lastIndex=noMAF)
    dataset%name      = 'GHz/LosAngle      '
    CALL Build_MLSAuxData (sd_id,dataset, tp%tpLosAngle, lastIndex=noMAF)
    dataset%name      = 'GHz/LosVel        '
    dataset%data_type = 'double            '
    CALL Build_MLSAuxData (sd_id,dataset, tp%tpLosVel, lastIndex=noMAF)

! 3-d next:

    DEALLOCATE (dataset%Dimensions, stat=status)
    ALLOCATE (dataset%Dimensions(3), stat=status)
    dataset%name      = 'GHz/ECI           '
    dataset%data_type = 'double            '
    dataset%Dimensions(1) = 'xyz                 '
    dataset%Dimensions(2) = 'GHz.MIF             '
    dataset%Dimensions(3) = 'MAF                 '
    CALL Build_MLSAuxData (sd_id,dataset, tp%tpECI, lastIndex=noMAF)
    dataset%name      = 'GHz/ECR           '
    CALL Build_MLSAuxData (sd_id,dataset, tp%tpECR, lastIndex=noMAF)
    dataset%name      = 'GHz/ECRtoFOV      '
    dataset%Dimensions(1) = '3x3                 '
    CALL Build_MLSAuxData (sd_id,dataset, tp%tpECRtoFOV, lastIndex=noMAF)

    CALL Deallocate_DataProducts (dataset)
!------------------------------------------------------------------------------
  END SUBROUTINE OutputL1B_GHz_HDF5

!---------------------------------------------------------------- OutputL1B_THz
  SUBROUTINE OutputL1B_THz_HDF5 (noMAF, sd_id, tp)
    USE HDF5, ONLY: HID_T
    ! This subroutine writes the THz tangent point quantities to a 
    ! group in an HDF5 file.
    ! Assumes HDF5 FORTRAN APIs have been invoked by l1/OpenInit to open files.
    ! Assumes l1/Close_Files will close files.
    ! Arguments
    TYPE( L1BOAtp_T ), INTENT(IN) :: tp
    INTEGER, INTENT(IN) :: noMAF
    INTEGER(HID_T), INTENT(IN) :: sd_id
    ! Variables
    TYPE( DataProducts_T ) :: dataset
    INTEGER :: status
!------------------------------------------------------------------------------
    CALL Deallocate_DataProducts (dataset)

! 2-d first:

    ALLOCATE (dataset%Dimensions(2), stat=status)
    dataset%name      = 'THz/encoderAngle  '
    dataset%data_type = 'double            '
    dataset%Dimensions(1) = 'MIF'
    dataset%Dimensions(2) = 'MAF' 
    CALL Build_MLSAuxData (sd_id, dataset, tp%encoderAngle, lastIndex=noMAF)
    dataset%name      = 'THz/scAngle       '
    CALL Build_MLSAuxData (sd_id, dataset, tp%scAngle, lastIndex=noMAF)
    dataset%name      = 'THz/scanAngle     '
    CALL Build_MLSAuxData (sd_id, dataset, tp%scanAngle, lastIndex=noMAF)
    dataset%name      = 'THz/scanRate      '
    dataset%data_type = 'real              '
    CALL Build_MLSAuxData (sd_id, dataset, tp%scanRate, lastIndex=noMAF)
    dataset%name      = 'THz/OrbY          '
    dataset%Dimensions(1) = 'THz.MIF'
    CALL Build_MLSAuxData (sd_id, dataset, tp%tpOrbY, lastIndex=noMAF)
    dataset%name      = 'THz/GeocAlt       '
    dataset%data_type = 'double            '
    CALL Build_MLSAuxData (sd_id, dataset, tp%tpGeocAlt, lastIndex=noMAF)
    dataset%name      = 'THz/GeocLat       '
    dataset%data_type = 'real              '
    CALL Build_MLSAuxData (sd_id, dataset, tp%tpGeocLat, lastIndex=noMAF)
    dataset%name      = 'THz/GeocAltRate   '
    CALL Build_MLSAuxData (sd_id, dataset, tp%tpGeocAltRate, lastIndex=noMAF)
    dataset%name      = 'THz/GeodAlt       '
    dataset%data_type = 'double            '
    CALL Build_MLSAuxData (sd_id, dataset, tp%tpGeodAlt, lastIndex=noMAF)
    dataset%name      = 'THz/GeodLat       '
    dataset%data_type = 'real              '
    CALL Build_MLSAuxData (sd_id, dataset, tp%tpGeodLat, lastIndex=noMAF)
    dataset%name      = 'THz/GeodAltRate   '
    CALL Build_MLSAuxData (sd_id, dataset, tp%tpGeodAltRate, lastIndex=noMAF)
    dataset%name      = 'THz/Lon           '
    CALL Build_MLSAuxData (sd_id, dataset, tp%tpLon, lastIndex=noMAF)
    dataset%name      = 'THz/GeodAngle     '
    CALL Build_MLSAuxData (sd_id, dataset, tp%tpGeodAngle, lastIndex=noMAF)
    dataset%name      = 'THz/SolarTime     '
    CALL Build_MLSAuxData (sd_id, dataset, tp%tpSolarTime, lastIndex=noMAF)
    dataset%name      = 'THz/SolarZenith   '
    CALL Build_MLSAuxData (sd_id, dataset, tp%tpSolarZenith, lastIndex=noMAF)
    dataset%name      = 'THz/LosAngle      '
    CALL Build_MLSAuxData (sd_id, dataset, tp%tpLosAngle, lastIndex=noMAF)
    dataset%name      = 'THz/LosVel        '
    dataset%data_type = 'double            '
    CALL Build_MLSAuxData (sd_id,dataset, tp%tpLosVel, lastIndex=noMAF)

! 3-d next:

    DEALLOCATE (dataset%Dimensions, stat=status)
    ALLOCATE (dataset%Dimensions(3), stat=status)
    dataset%name      = 'THz/ECI           '
    dataset%data_type = 'double            '
    dataset%Dimensions(1) = 'xyz'
    dataset%Dimensions(2) = 'THz.MIF'
    dataset%Dimensions(3) = 'MAF' 
    CALL Build_MLSAuxData (sd_id, dataset,tp%tpECI, lastIndex=noMAF)
    dataset%name      = 'THz/ECR           '
    CALL Build_MLSAuxData (sd_id, dataset,tp%tpECR, lastIndex=noMAF)

    CALL Deallocate_DataProducts (dataset)
!------------------------------------------------------------------------------
  END SUBROUTINE OutputL1B_THz_HDF5

!---------------------------------------------------------------- OutputL1B_rad
  SUBROUTINE OutputL1B_rad_HDF5 (noMAF, sdId, counterMAF, Reflec, &
       MAFStartTimeGIRD, rad)
    USE HDF5, ONLY: HID_T
    ! This subroutine writes an MAF's worth of data to the L1BRad D & F files
    ! Assumes HDF5 FORTRAN APIs have been invoked by l1/OpenInit to open files.
    ! Assumes l1/Close_Files will close files.
    ! Arguments

    USE EngTbls, ONLY: Reflec_T
    USE MLSL1Rad, ONLY: Radiance_T, Rad_Name

    TYPE (L1BFileInfo_T) :: sdId
    TYPE (Radiance_T) :: rad(:)
    TYPE (Reflec_T) :: Reflec
    INTEGER, INTENT(IN) :: counterMAF, noMAF
    REAL(r8), INTENT(IN) :: MAFStartTimeGIRD

    ! Variables
    TYPE( DataProducts_T ) :: dataset    
    CHARACTER (LEN=64) :: dim_chan, dim_mif, name, prec
    INTEGER, DIMENSION(3) :: dims
    INTEGER(HID_T) :: sd_id
    INTEGER :: i, status

! For use in determining filling missing radiance records

    INTEGER, PARAMETER :: max_rad_nos = SIZE (Rad_Name)
    INTEGER, SAVE :: rad_sdid(max_rad_nos) = -999
    INTEGER, SAVE :: rad_dim1(max_rad_nos) = 0
    INTEGER, SAVE :: rad_dim2(max_rad_nos) = 0
    LOGICAL, SAVE :: rad_out(max_rad_nos) = .FALSE. ! whether rad has output
    LOGICAL, SAVE :: fill_last(max_rad_nos)   ! whether to fill last record
    CHARACTER(len=10), SAVE :: rad_chan(max_rad_nos) = " "
    CHARACTER(len=10), SAVE :: rad_mif(max_rad_nos) = " "

    REAL, PARAMETER :: RAD_FILL = -999.9, RAD_ERR_FILL = -1.0
    REAL, PARAMETER :: RAD_FILL_ARR(129,148) = RAD_FILL
    REAL, PARAMETER :: RAD_ERR_FILL_ARR(129,148) = RAD_ERR_FILL

! Find the sds_id number for counterMAF in the file RADG, write the data to it,
! terminate access to the data set
!------------------------------------------------------------------------------
    CALL Deallocate_DataProducts (dataset)

    ALLOCATE (dataset%Dimensions(1), stat=status)
    dataset%name      = 'counterMAF        '
    dataset%data_type = 'integer           '
    dataset%Dimensions(1) = 'MAF'
    IF (sdId%RADDID /= 0) THEN
       CALL Build_MLSAuxData (sdId%RADDID, dataset, counterMAF, lastIndex=noMAF)
       CALL Build_MLSAuxData (sdId%RADGID, dataset, counterMAF, lastIndex=noMAF)
    ELSE
       CALL Build_MLSAuxData (sdId%RADTID, dataset, counterMAF, lastIndex=noMAF)
    ENDIF

!------------------------------------------------------------------------------

    dataset%name      = 'MAFStartTimeGIRD  '
    dataset%data_type = 'double            '
    dataset%Dimensions(1) = 'MAF'
    IF (sdId%RADDID /= 0) THEN
       CALL Build_MLSAuxData (sdId%RADDID, dataset, MAFStartTimeGIRD, &
            lastIndex=noMAF)
       CALL Build_MLSAuxData (sdId%RADGID, dataset, MAFStartTimeGIRD, &
            lastIndex=noMAF)
    ELSE
       CALL Build_MLSAuxData (sdId%RADTID, dataset, MAFStartTimeGIRD, &
            lastIndex=noMAF)
    ENDIF

! Reflector temperatures:

    dataset%data_type = 'real              '
    dataset%name      = 'Pri_Reflec        '
    IF (sdId%RADDID /= 0) THEN
       CALL Build_MLSAuxData (sdId%RADDID, dataset, Reflec%Pri, lastIndex=noMAF)
       CALL Build_MLSAuxData (sdId%RADGID, dataset, Reflec%Pri, lastIndex=noMAF)
    ENDIF
    dataset%name      = 'Sec_Reflec        '
    IF (sdId%RADDID /= 0) THEN
       CALL Build_MLSAuxData (sdId%RADDID, dataset, Reflec%Sec, lastIndex=noMAF)
       CALL Build_MLSAuxData (sdId%RADGID, dataset, Reflec%Sec, lastIndex=noMAF)
    ENDIF
    dataset%name      = 'Ter_Reflec        '
    IF (sdId%RADDID /= 0) THEN
       CALL Build_MLSAuxData (sdId%RADDID, dataset, Reflec%Ter, lastIndex=noMAF)
       CALL Build_MLSAuxData (sdId%RADGID, dataset, Reflec%Ter, lastIndex=noMAF)
    ENDIF

    DEALLOCATE (dataset%Dimensions, stat=status)

! Prepare for radiance output

    fill_last = .TRUE.   ! will fill last record unless good data

    ALLOCATE (dataset%Dimensions(3), stat=status)
    dataset%data_type = 'real'
    dataset%Dimensions(3) = 'MAF                 '

!------------------------------------------------------------------------------
    DO i = 1, SIZE (rad) ! Loop on number of SDs per MAF

       CALL GetFullMLSSignalName(rad(i)%signal, name) ! Concatenate SD names
       prec = TRIM(name) // ' precision'
       ! Set parameters based on input data dimensions
       ! Based on the SD name, set dim name for channel, get Id of output file
       IF (INDEX(name, 'FB') /= 0 ) THEN
          dim_chan = 'chanFB              '
          IF (sdId%RADGID /= 0) THEN
             sd_id = sdId%RADGID
          ELSE
             sd_id = sdId%RADTID
          ENDIF
       ELSE IF (INDEX(name, 'MB') /= 0 ) THEN
          dim_chan = 'chanMB              '
          sd_id = sdId%RADGID
       ELSE IF (INDEX(name, 'WF') /= 0 ) THEN
          dim_chan = 'chanWF              '
          sd_id = sdId%RADGID
       ELSE IF (INDEX(name, 'DACS') /= 0 ) THEN
          dim_chan = 'chanDACS            '
          sd_id = sdId%RADDID
       ELSE
          dim_chan = ''
          sd_id = -999
       ENDIF

       IF ((ANY(rad(i)%value /= 0.0)) .AND. (sd_id /= -999)) THEN   
          ! if good radiance data exists 
          ! Create/Open the value SDs
          dims(1) = SIZE (rad(i)%value,1)
          dims(2) = SIZE (rad(i)%value,2)
          dims(3) = 1
          IF (INDEX(name,'R5') /= 0 ) THEN
             dim_mif = 'THz.MIF              '
             dims(2) = MIFsTHz      !! lenT
          ELSE
             dim_mif = 'GHz.MIF              '
             dims(2) = MIFsGHz      !! lenG
          ENDIF
!------------------------------------------------Create/Open the value datasets
          dataset%Dimensions(1) = dim_chan
          dataset%Dimensions(2) = dim_mif
          dataset%name = TRIM(name)
          CALL Build_MLSAuxData (sd_id, dataset, rad(i)%value, &
               lastIndex=noMAF, dims=dims, fill_value=RAD_FILL)

!------------------------------------------ Create/Open the precision datasets

          dataset%name = TRIM(prec)
          CALL Build_MLSAuxData (sd_id, dataset, rad(i)%precision, &
               lastIndex=noMAF, dims=dims, fill_value=RAD_ERR_FILL)
!-----------------------------------------------------------------------------


! Save matching table entries

          WHERE (name == Rad_Name)
             rad_out = .TRUE.
             fill_last = .FALSE.
             rad_dim1 = dims(1)
             rad_dim2 = dims(2)
             rad_chan = dim_chan
             rad_mif = dim_mif
             rad_sdid = sd_id
          ENDWHERE

       ENDIF
    ENDDO

! Determine filling the radiance file record:

    DO i = 1, max_rad_nos
       IF (rad_out(i) .AND. fill_last(i)) THEN
          dataset%Dimensions(1) = rad_chan(i)
          dataset%Dimensions(2) = rad_mif(i)
          dataset%name = TRIM(Rad_Name(i))
          dims(1) = rad_dim1(i)
          dims(2) = rad_dim2(i)
          dims(3) = 1
          CALL Build_MLSAuxData (rad_sdid(i), dataset, RAD_FILL_ARR, &
               lastIndex=noMAF, dims=dims, fill_value=RAD_FILL)
          dataset%name = TRIM(Rad_Name(i))// ' precision'
          CALL Build_MLSAuxData (rad_sdid(i), dataset, RAD_ERR_FILL_ARR, &
               lastIndex=noMAF, dims=dims, fill_value=RAD_ERR_FILL)
       ENDIF
    ENDDO

    CALL Deallocate_DataProducts (dataset)

  END SUBROUTINE OutputL1B_rad_HDF5

!=============================================================================
  SUBROUTINE OutputL1B_LatBinData (noMAF, sd_id, AscDescIndx, LatBinIndx, &
       LatBinChanAvg, BaselineAlt, LatBin)
!=============================================================================

    USE MLSHDF5, ONLY: SaveAsHDF5DS, MakeHDF5Attribute

    INTEGER, INTENT(IN) :: noMAF
    INTEGER(HID_T), INTENT(IN) :: sd_id
    INTEGER, DIMENSION(:), OPTIONAL :: AscDescIndx
    INTEGER, DIMENSION(:), OPTIONAL :: LatBinIndx
    REAL, DIMENSION(:,:,:,:), OPTIONAL :: LatBinChanAvg
    REAL, DIMENSION(:,:,:), OPTIONAL :: LatBin
    REAL, DIMENSION(:,:), OPTIONAL :: BaselineAlt

    TYPE( DataProducts_T ) :: dataset
    CHARACTER(LEN=16) :: DimName(4)
    INTEGER :: dims(3), status

    CALL Deallocate_DataProducts (dataset)

    IF (PRESENT (AscDescIndx) .AND. PRESENT (LatBinIndx)) THEN

       ALLOCATE (dataset%Dimensions(2), stat=status)
       dataset%name = 'AscDescIndx   '
       dataset%data_type = 'integer           '
       dataset%Dimensions(1) = 'GHz.MIF             '
       dims = 1
       dims(1) = SIZE (AscDescIndx)
       CALL Build_MLSAuxData (sd_id, dataset, AscDescIndx, lastIndex=noMAF, &
            dims=dims)
       dataset%name = 'LatBinIndx    '
       CALL Build_MLSAuxData (sd_id, dataset, LatBinIndx, lastIndex=noMAF, &
            dims=dims)

    ENDIF

    IF (PRESENT (LatBinChanAvg)) THEN
       CALL SaveAsHDF5DS (sd_id, 'LatBinChanAvg', LatBinChanAvg)
       DimName(1) = 'FBChan'
       DimName(2) = 'GHzBand'
       DimName(3) = 'LatBin'
       DimName(4) = 'AscDesc'
       CALL MakeHDF5Attribute (sd_id, 'LatBinChanAvg', 'Dimensions', DimName)
    ENDIF

    IF (PRESENT (LatBin)) THEN
       CALL SaveAsHDF5DS (sd_id, 'BaselineLatBin', LatBin)
       DimName(1) = 'Min/Max lat'
       DimName(2) = 'LatBin'
       DimName(3) = 'AscDesc'
       CALL MakeHDF5Attribute (sd_id, 'BaselineLatBin', 'Dimensions', &
            DimName(1:3))
    ENDIF

    IF (PRESENT (BaselineAlt)) THEN
       CALL SaveAsHDF5DS (sd_id, 'BaselineAlt', BaselineAlt)
       DimName(1) = 'FBchan'
       DimName(2) = 'GHzBand'
       CALL MakeHDF5Attribute (sd_id, 'BaselineAlt', 'Dimensions', DimName(1:2))
    ENDIF

    CALL Deallocate_DataProducts (dataset)

 END SUBROUTINE OutputL1B_LatBinData

END MODULE OutputL1B_HDF5

! $Log: OutputL1B_HDF5.f90,v $
! Revision 2.8  2004/01/09 17:46:23  perun
! Version 1.4 commit
!
! Revision 2.7  2003/09/29 18:27:19  pwagner
! Moved hdf5 stuff to work around IFC internal compiler error
!
! Revision 2.6  2003/09/15 17:15:54  perun
! Version 1.3 commit
!
! Revision 2.5  2003/08/15 14:25:04  perun
! Version 1.2 commit
!
! Revision 2.4  2003/01/31 18:13:34  perun
! Version 1.1 commit
!
! Revision 2.3  2002/11/25 05:34:30  jdone
! Added dimension names.
!
! Revision 2.2  2002/11/18 21:21:30  jdone
! Used trim for names of radiance and supporting precision files.
!
! Revision 2.1  2002/11/07 21:36:57  jdone
! File holds all HDF5 output routines for Level 1
!
! Revision 2.6  2002/03/29 20:18:34  perun
! Version 1.0 commit
!
! Revision 2.4  2001/12/06 01:03:46  pwagner
! Now writes orbit incline angle in ECR
!
! Revision 2.3  2001/12/04 00:29:16  pwagner
! Made public things needed by sids
!
! Revision 2.2  2001/10/12 22:11:05  livesey
! Tidied things up a bit, added scVelECR, but not filled yet
!
! Revision 2.1  2001/02/23 18:26:11  perun
! Version 0.5 commit
!
! Revision 2.0  2000/09/05 18:55:14  ahanzel
! Changing file revision to 2.0.
!
! Revision 1.4  2000/02/22 15:00:16  nakamura
! Incorporated GetFullMLSSignalName subroutine to concatenate SD names from signal input.
!
@


2.8
log
@Version 1.4 commit
@
text
@d25 1
a25 1
    "$Id: OutputL1B_HDF5.f90,v 2.7 2003/09/29 18:27:19 pwagner Exp $"
d579 3
@


2.7
log
@Moved hdf5 stuff to work around IFC internal compiler error
@
text
@d21 2
a22 1
       OUTPUTL1B_GHZ_HDF5, OUTPUTL1B_THZ_HDF5, OUTPUTL1B_RAD_HDF5
d25 1
a25 1
    "$Id: OutputL1B_HDF5.f90,v 2.6 2003/09/15 17:15:54 perun Exp $"
d31 1
a31 1
  !----------------------------------------------------------- OutputL1B_Create
d510 66
d579 3
@


2.6
log
@Version 1.3 commit
@
text
@a10 1
  USE HDF5, ONLY: HID_T
d24 1
a24 1
    "$Id: OutputL1B_HDF5.f90,v 2.5 2003/08/15 14:25:04 perun Exp $"
d45 1
d81 1
d150 1
d236 1
d319 1
d512 3
@


2.5
log
@Version 1.2 commit
@
text
@a14 1
  USE MLSL1Rad, ONLY: Radiance_T
d25 1
a25 1
    "$Id: OutputL1B_HDF5.f90,v 2.4 2003/01/31 18:13:34 perun Exp $"
d71 1
a71 1
    CALL Build_MLSAuxData (sd_id,dataset, index%noMIFs,lastIndex=noMAF)
d273 1
a273 1
    CALL Build_MLSAuxData (sd_id, dataset, tp%tpGeocAltRate,lastIndex=noMAF)
d322 1
d329 1
d336 17
a352 1
! Find the sds_id number for counterMAF in the file RADF, write the data to it,
d362 2
a363 4
       CALL Build_MLSAuxData (sdId%RADDID, dataset, counterMAF, &
            lastIndex=noMAF)
       CALL Build_MLSAuxData (sdId%RADFID, dataset, counterMAF, &
            lastIndex=noMAF)
d365 1
a365 2
       CALL Build_MLSAuxData (sdId%RADTID, dataset, counterMAF, &
            lastIndex=noMAF)
d376 1
a376 1
       CALL Build_MLSAuxData (sdId%RADFID, dataset, MAFStartTimeGIRD, &
d389 1
a389 1
       CALL Build_MLSAuxData (sdId%RADFID, dataset, Reflec%Pri, lastIndex=noMAF)
d394 1
a394 1
       CALL Build_MLSAuxData (sdId%RADFID, dataset, Reflec%Sec, lastIndex=noMAF)
d399 1
a399 1
       CALL Build_MLSAuxData (sdId%RADFID, dataset, Reflec%Ter, lastIndex=noMAF)
d406 2
d413 1
a413 1
    DO i = 1, SIZE(rad) ! Loop on number of SDs per MAF
d419 1
a419 1
       IF (INDEX(name,'FB') /= 0 ) THEN
d421 2
a422 2
          IF (sdId%RADFID /= 0) THEN
             sd_id = sdId%RADFID
d426 1
a426 1
       ELSE IF (INDEX(name,'MB') /= 0 ) THEN
d428 2
a429 2
          sd_id = sdId%RADFID
       ELSE IF (INDEX(name,'WF') /= 0 ) THEN
d431 2
a432 2
          sd_id = sdId%RADFID
       ELSE IF (INDEX(name,'DACS') /= 0 ) THEN
d439 1
d443 2
a444 2
          dims(1) = SIZE(rad(i)%value,1)
          dims(2) = SIZE(rad(i)%value,2)
a453 1
          dataset%name = TRIM(name)
d456 1
d458 1
a458 1
               lastIndex=noMAF, dims=dims)
d464 1
a464 1
               lastIndex=noMAF, dims=dims)
d466 32
d508 3
@


2.4
log
@Version 1.1 commit
@
text
@d2 1
a2 1
! Copyright (c) 2002, California Institute of Technology.  ALL RIGHTS RESERVED.
d6 3
a8 3
  ! This module contains the subroutines needed to write L1B data to HDF files.
  USE OutputL1B_DataTypes, ONLY: LENG, LENT, LENUTC, LENCOORD, & 
       L1BOAINDEX_T, L1BOASC_T, L1BOATP_T
d17 1
d19 1
d21 1
d26 1
a26 1
    "$Id: OutputL1B_HDF5.f90,v 2.3 2002/11/25 05:34:30 jdone Exp $"
d31 1
d44 1
d57 21
a77 26
     CALL Deallocate_DataProducts (dataset)
     dataset%name      = 'MAFStartTimeUTC   '
     dataset%data_type = 'character         '
     ALLOCATE (dataset%Dimensions(1), stat=status)
     dataset%Dimensions(1) = 'MAF                 '
     CALL Build_MLSAuxData (sd_id,dataset,index%MAFStartTimeUTC, & 
          char_length=lenUTC, lastIndex=noMAF)
     CALL Deallocate_DataProducts (dataset)
     dataset%name      = 'MAFStartTimeTAI   '
     dataset%data_type = 'double            '
     ALLOCATE (dataset%Dimensions(1), stat=status)
     dataset%Dimensions(1) = 'MAF                 '
     CALL Build_MLSAuxData (sd_id,dataset,index%MAFStartTimeTAI,lastIndex=noMAF)
     CALL Deallocate_DataProducts (dataset)
     dataset%name      = 'noMIFs            '
     dataset%data_type = 'integer           '
     ALLOCATE (dataset%Dimensions(1), stat=status)
     dataset%Dimensions(1) = 'MAF                 '
     CALL Build_MLSAuxData (sd_id,dataset,index%noMIFs,lastIndex=noMAF)
     CALL Deallocate_DataProducts (dataset)
     dataset%name      = 'counterMAF        '
     dataset%data_type = 'integer           '
     ALLOCATE (dataset%Dimensions(1), stat=status)
     dataset%Dimensions(1) = 'MAF                 '
     CALL Build_MLSAuxData (sd_id,dataset,index%counterMAF, lastIndex=noMAF)
     CALL Deallocate_DataProducts (dataset)
d92 53
a144 98
     CALL Deallocate_DataProducts (dataset)
     dataset%name      = 'sc/ECI            '
     dataset%data_type = 'double            '
     ALLOCATE (dataset%Dimensions(3), stat=status)
     dataset%Dimensions(1) = 'xyz                 '
     dataset%Dimensions(2) = 'MIF                 '
     dataset%Dimensions(3) = 'MAF                 '
     CALL Build_MLSAuxData (sd_id, dataset, sc%scECI, lastIndex=noMAF)
     CALL Deallocate_DataProducts (dataset)
     dataset%name      = 'sc/ECR            '
     dataset%data_type = 'double            '
     ALLOCATE (dataset%Dimensions(3), stat=status)
     dataset%Dimensions(1) = 'xyz                 '
     dataset%Dimensions(2) = 'MIF                 '
     dataset%Dimensions(3) = 'MAF                 '
     CALL Build_MLSAuxData (sd_id, dataset, sc%scECR, lastIndex=noMAF)
     CALL Deallocate_DataProducts (dataset)
     dataset%name      = 'sc/GeocAlt        '
     dataset%data_type = 'double            '
     ALLOCATE (dataset%Dimensions(2), stat=status)
     dataset%Dimensions(1) = 'MIF                '
     dataset%Dimensions(2) = 'MAF                '
     CALL Build_MLSAuxData (sd_id, dataset, sc%scGeocAlt, lastIndex=noMAF)
     CALL Deallocate_DataProducts (dataset)
     dataset%name      = 'sc/GeocLat        '
     dataset%data_type = 'real              '
     ALLOCATE (dataset%Dimensions(2), stat=status)
     dataset%Dimensions(1) = 'MIF                '
     dataset%Dimensions(2) = 'MAF                '
     CALL Build_MLSAuxData (sd_id, dataset, sc%scGeocLat, lastIndex=noMAF)
     CALL Deallocate_DataProducts (dataset)
     dataset%name      = 'sc/GeodAlt        '
     dataset%data_type = 'double            '
     ALLOCATE (dataset%Dimensions(2), stat=status)
     dataset%Dimensions(1) = 'MIF                 '
     dataset%Dimensions(2) = 'MAF                 '
     CALL Build_MLSAuxData (sd_id, dataset, sc%scGeodAlt, lastIndex=noMAF)
     CALL Deallocate_DataProducts (dataset)
     dataset%name      = 'sc/GeodLat        '
     dataset%data_type = 'real              '    
     ALLOCATE (dataset%Dimensions(2), stat=status)
     dataset%Dimensions(1) = 'MIF                 '
     dataset%Dimensions(2) = 'MAF                 '          
     CALL Build_MLSAuxData (sd_id, dataset, sc%scGeodLat, lastIndex=noMAF)
     CALL Deallocate_DataProducts (dataset)
     dataset%name      = 'sc/Lon            '
     dataset%data_type = 'real              '
     ALLOCATE (dataset%Dimensions(2), stat=status)
     dataset%Dimensions(1) = 'MIF                 '
     dataset%Dimensions(2) = 'MAF                 '          
     CALL Build_MLSAuxData (sd_id, dataset, sc%scLon, lastIndex=noMAF)
     CALL Deallocate_DataProducts (dataset)
     dataset%name      = 'sc/GeodAngle      '
     dataset%data_type = 'real              '
     ALLOCATE (dataset%Dimensions(2), stat=status)
     dataset%Dimensions(1) = 'MIF                 '
     dataset%Dimensions(2) = 'MAF                 '          
     CALL Build_MLSAuxData (sd_id, dataset, sc%scGeodAngle,lastIndex=noMAF)
     CALL Deallocate_DataProducts (dataset)
     dataset%name      = 'sc/VelECI         '
     dataset%data_type = 'double            '
     ALLOCATE (dataset%Dimensions(3), stat=status)
     dataset%Dimensions(1) = 'xyz                 '
     dataset%Dimensions(2) = 'MIF                 '
     dataset%Dimensions(3) = 'MAF                 '
     CALL Build_MLSAuxData (sd_id, dataset, sc%scVelECI,lastIndex=noMAF)
     CALL Deallocate_DataProducts (dataset)
     dataset%name      = 'sc/ypr            '
     dataset%data_type = 'double            '
     ALLOCATE (dataset%Dimensions(3), stat=status)
     dataset%Dimensions(1) = 'xyz                 '
     dataset%Dimensions(2) = 'MIF                 '
     dataset%Dimensions(3) = 'MAF                 '
     CALL Build_MLSAuxData (sd_id, dataset, sc%ypr, lastIndex=noMAF)
     CALL Deallocate_DataProducts (dataset)
     dataset%name      = 'sc/yprRate        '
     dataset%data_type = 'double            '
     ALLOCATE (dataset%Dimensions(3), stat=status)
     dataset%Dimensions(1) = 'xyz                 '
     dataset%Dimensions(2) = 'MIF                 '
     dataset%Dimensions(3) = 'MAF                 '
     CALL Build_MLSAuxData (sd_id, dataset, sc%yprRate, lastIndex=noMAF)
     CALL Deallocate_DataProducts (dataset)
     dataset%name      = 'sc/VelECR         '
     dataset%data_type = 'double            '
     ALLOCATE (dataset%Dimensions(3), stat=status)
     dataset%Dimensions(1) = 'xyz                 '
     dataset%Dimensions(2) = 'MIF                 '
     dataset%Dimensions(3) = 'MAF                 '
     CALL Build_MLSAuxData (sd_id, dataset, sc%scVelECR,lastIndex=noMAF)
     CALL Deallocate_DataProducts (dataset)
     dataset%name      = 'sc/OrbIncl        '
     dataset%data_type = 'real              '
     ALLOCATE (dataset%Dimensions(2), stat=status)
     dataset%Dimensions(1) = 'MIF                 '
     dataset%Dimensions(2) = 'MAF                 '
     CALL Build_MLSAuxData (sd_id, dataset, sc%scOrbIncl,lastIndex=noMAF)
     CALL Deallocate_DataProducts (dataset)
d147 2
a148 1
  !-------------------------------------------------------------- OutputL1B_GHz
d161 69
a229 129
     CALL Deallocate_DataProducts (dataset)
     dataset%name      = 'GHz/encoderAngle  '
     dataset%data_type = 'double            '
     ALLOCATE (dataset%Dimensions(2), stat=status)
     dataset%Dimensions(1) = 'MIF                 '
     dataset%Dimensions(2) = 'MAF                 '
     CALL Build_MLSAuxData (sd_id,dataset,tp%encoderAngle,lastIndex=noMAF)
     CALL Deallocate_DataProducts (dataset)
     dataset%name      = 'GHz/scAngle       '
     dataset%data_type = 'double            '
     ALLOCATE (dataset%Dimensions(2), stat=status)
     dataset%Dimensions(1) = 'MIF                 '
     dataset%Dimensions(2) = 'MAF                 '
     CALL Build_MLSAuxData (sd_id,dataset,tp%scAngle,lastIndex=noMAF)
     CALL Deallocate_DataProducts (dataset)
     dataset%name      = 'GHz/scanAngle     '
     dataset%data_type = 'double            '
     ALLOCATE (dataset%Dimensions(2), stat=status)
     dataset%Dimensions(1) = 'MIF                 '
     dataset%Dimensions(2) = 'MAF                 '
     CALL Build_MLSAuxData (sd_id,dataset,tp%scanAngle,lastIndex=noMAF)
     CALL Deallocate_DataProducts (dataset)
     dataset%name      = 'GHz/scanRate      '
     dataset%data_type = 'real              '
     ALLOCATE (dataset%Dimensions(2), stat=status)
     dataset%Dimensions(1) = 'MIF                 '
     dataset%Dimensions(2) = 'MAF                 '
     CALL Build_MLSAuxData (sd_id,dataset,tp%scanRate,lastIndex=noMAF)
     CALL Deallocate_DataProducts (dataset)
     dataset%name      = 'GHz/ECI           '
     dataset%data_type = 'double            '
     ALLOCATE (dataset%Dimensions(3), stat=status)
     dataset%Dimensions(1) = 'xyz                 '
     dataset%Dimensions(2) = 'GHz.MIF             '
     dataset%Dimensions(3) = 'MAF                 '
     CALL Build_MLSAuxData (sd_id,dataset,tp%tpECI,lastIndex=noMAF)
     CALL Deallocate_DataProducts (dataset)
     dataset%name      = 'GHz/ECR           '
     dataset%data_type = 'double            '
     ALLOCATE (dataset%Dimensions(3), stat=status)
     dataset%Dimensions(1) = 'xyz                 '
     dataset%Dimensions(2) = 'GHz.MIF             '
     dataset%Dimensions(3) = 'MAF                 '
     CALL Build_MLSAuxData (sd_id,dataset,tp%tpECR,lastIndex=noMAF)
     CALL Deallocate_DataProducts (dataset)
     dataset%name      = 'GHz/OrbY          '
     dataset%data_type = 'real              '
     ALLOCATE (dataset%Dimensions(2), stat=status)
     dataset%Dimensions(1) = 'GHz.MIF              '
     dataset%Dimensions(2) = 'MAF                  '
     CALL Build_MLSAuxData (sd_id,dataset,tp%tpOrbY,lastIndex=noMAF)
     CALL Deallocate_DataProducts (dataset)
     dataset%name      = 'GHz/GeocAlt       '
     dataset%data_type = 'double            '
     ALLOCATE (dataset%Dimensions(2), stat=status)
     dataset%Dimensions(1) = 'GHz.MIF              '
     dataset%Dimensions(2) = 'MAF                  '
     CALL Build_MLSAuxData (sd_id,dataset,tp%tpGeocAlt,lastIndex=noMAF)
     CALL Deallocate_DataProducts (dataset)
     dataset%name      = 'GHz/GeocLat       '
     dataset%data_type = 'real              '
     ALLOCATE (dataset%Dimensions(2), stat=status)
     dataset%Dimensions(1) = 'GHz.MIF             '
     dataset%Dimensions(2) = 'MAF                 '
     CALL Build_MLSAuxData (sd_id,dataset,tp%tpGeocLat,lastIndex=noMAF)
     CALL Deallocate_DataProducts (dataset)
     dataset%name      = 'GHz/GeocAltRate   '
     dataset%data_type = 'real              '
     ALLOCATE (dataset%Dimensions(2), stat=status)
     dataset%Dimensions(1) = 'GHz.MIF             '
     dataset%Dimensions(2) = 'MAF                 '
     CALL Build_MLSAuxData (sd_id,dataset,tp%tpGeocAltRate,lastIndex=noMAF)
     CALL Deallocate_DataProducts (dataset)
     dataset%name      = 'GHz/GeodAlt       '
     dataset%data_type = 'double            '
     ALLOCATE (dataset%Dimensions(2), stat=status)
     dataset%Dimensions(1) = 'GHz.MIF             '
     dataset%Dimensions(2) = 'MAF                 '
     CALL Build_MLSAuxData (sd_id,dataset,tp%tpGeodAlt,lastIndex=noMAF)
     CALL Deallocate_DataProducts (dataset)
     dataset%name      = 'GHz/GeodLat       '
     dataset%data_type = 'real              '
     ALLOCATE (dataset%Dimensions(2), stat=status)
     dataset%Dimensions(1) = 'GHz.MIF             '
     dataset%Dimensions(2) = 'MAF                 '
     CALL Build_MLSAuxData (sd_id,dataset,tp%tpGeodLat,lastIndex=noMAF)
     CALL Deallocate_DataProducts (dataset)
     dataset%name      = 'GHz/GeodAltRate   '
     dataset%data_type = 'real              '
     ALLOCATE (dataset%Dimensions(2), stat=status)
     dataset%Dimensions(1) = 'GHz.MIF             '
     dataset%Dimensions(2) = 'MAF                 '
     CALL Build_MLSAuxData (sd_id,dataset,tp%tpGeodAltRate,lastIndex=noMAF)
     CALL Deallocate_DataProducts (dataset)
     dataset%name      = 'GHz/Lon           '
     dataset%data_type = 'real              '
     ALLOCATE (dataset%Dimensions(2), stat=status)
     dataset%Dimensions(1) = 'GHz.MIF             '
     dataset%Dimensions(2) = 'MAF                 '
     CALL Build_MLSAuxData (sd_id,dataset,tp%tpLon,lastIndex=noMAF)
     CALL Deallocate_DataProducts (dataset)
     dataset%name      = 'GHz/GeodAngle     '
     dataset%data_type = 'real              '
     ALLOCATE (dataset%Dimensions(2), stat=status)
     dataset%Dimensions(1) = 'GHz.MIF             '
     dataset%Dimensions(2) = 'MAF                 '
     CALL Build_MLSAuxData (sd_id,dataset,tp%tpGeodAngle,lastIndex=noMAF)
     CALL Deallocate_DataProducts (dataset)
     dataset%name      = 'GHz/SolarTime     '
     dataset%data_type = 'real              '
     ALLOCATE (dataset%Dimensions(2), stat=status)
     dataset%Dimensions(1) = 'GHz.MIF            '
     dataset%Dimensions(2) = 'MAF                '
     CALL Build_MLSAuxData (sd_id,dataset,tp%tpSolarTime,lastIndex=noMAF)
     CALL Deallocate_DataProducts (dataset)
     dataset%name      = 'GHz/SolarZenith   '
     dataset%data_type = 'real              '
     ALLOCATE (dataset%Dimensions(2), stat=status)
     dataset%Dimensions(1) = 'GHz.MIF            '
     dataset%Dimensions(2) = 'MAF                '
     CALL Build_MLSAuxData (sd_id,dataset,tp%tpSolarZenith,lastIndex=noMAF)
     CALL Deallocate_DataProducts (dataset)
     dataset%name      = 'GHz/LosAngle      '
     dataset%data_type = 'real              '
     ALLOCATE (dataset%Dimensions(2), stat=status)
     dataset%Dimensions(1) = 'GHz.MIF            '
     dataset%Dimensions(2) = 'MAF                '
     CALL Build_MLSAuxData (sd_id,dataset,tp%tpLosAngle,lastIndex=noMAF)
     CALL Deallocate_DataProducts (dataset)
d232 1
d247 64
a310 129
     CALL Deallocate_DataProducts (dataset)
     dataset%name      = 'THz/encoderAngle  '
     dataset%data_type = 'double            '
     ALLOCATE (dataset%Dimensions(2), stat=status)
     dataset%Dimensions(1) = 'MIF'
     dataset%Dimensions(2) = 'MAF' 
     CALL Build_MLSAuxData (sd_id, dataset,tp%encoderAngle,lastIndex=noMAF)
     CALL Deallocate_DataProducts (dataset)
     dataset%name      = 'THz/scAngle       '
     dataset%data_type = 'double            '
     ALLOCATE (dataset%Dimensions(2), stat=status)
     dataset%Dimensions(1) = 'MIF'
     dataset%Dimensions(2) = 'MAF' 
     CALL Build_MLSAuxData (sd_id, dataset,tp%scAngle,lastIndex=noMAF)
     CALL Deallocate_DataProducts (dataset)
     dataset%name      = 'THz/scanAngle     '
     dataset%data_type = 'double            '
     ALLOCATE (dataset%Dimensions(2), stat=status)
     dataset%Dimensions(1) = 'MIF'
     dataset%Dimensions(2) = 'MAF' 
     CALL Build_MLSAuxData (sd_id, dataset,tp%scanAngle,lastIndex=noMAF)
     CALL Deallocate_DataProducts (dataset)
     dataset%name      = 'THz/scanRate      '
     dataset%data_type = 'real              '
     ALLOCATE (dataset%Dimensions(2), stat=status)
     dataset%Dimensions(1) = 'MIF'
     dataset%Dimensions(2) = 'MAF' 
     CALL Build_MLSAuxData (sd_id, dataset,tp%scanRate, lastIndex=noMAF)
     CALL Deallocate_DataProducts (dataset)
     dataset%name      = 'THz/ECI           '
     dataset%data_type = 'double            '
     ALLOCATE (dataset%Dimensions(3), stat=status)
     dataset%Dimensions(1) = 'xyz'
     dataset%Dimensions(2) = 'THz.MIF'
     dataset%Dimensions(3) = 'MAF' 
     CALL Build_MLSAuxData (sd_id, dataset,tp%tpECI, lastIndex=noMAF)
     CALL Deallocate_DataProducts (dataset)
     dataset%name      = 'THz/ECR           '
     dataset%data_type = 'double            '
     ALLOCATE (dataset%Dimensions(3), stat=status)
     dataset%Dimensions(1) = 'xyz'
     dataset%Dimensions(2) = 'THz.MIF'
     dataset%Dimensions(3) = 'MAF' 
     CALL Build_MLSAuxData (sd_id, dataset,tp%tpECR, lastIndex=noMAF)
     CALL Deallocate_DataProducts (dataset)
     dataset%name      = 'THz/OrbY          '
     dataset%data_type = 'real              '
     ALLOCATE (dataset%Dimensions(2), stat=status)
     dataset%Dimensions(1) = 'THz.MIF'
     dataset%Dimensions(2) = 'MAF' 
     CALL Build_MLSAuxData (sd_id, dataset,tp%tpOrbY, lastIndex=noMAF)
     CALL Deallocate_DataProducts (dataset)
     dataset%name      = 'THz/GeocAlt       '
     dataset%data_type = 'double            '
     ALLOCATE (dataset%Dimensions(2), stat=status)
     dataset%Dimensions(1) = 'THz.MIF'
     dataset%Dimensions(2) = 'MAF' 
     CALL Build_MLSAuxData (sd_id, dataset,tp%tpGeocAlt, lastIndex=noMAF)
     CALL Deallocate_DataProducts (dataset)
     dataset%name      = 'THz/GeocLat       '
     dataset%data_type = 'real              '
     ALLOCATE (dataset%Dimensions(2), stat=status)
     dataset%Dimensions(1) = 'THz.MIF'
     dataset%Dimensions(2) = 'MAF' 
     CALL Build_MLSAuxData (sd_id, dataset,tp%tpGeocLat, lastIndex=noMAF)
     CALL Deallocate_DataProducts (dataset)
     dataset%name      = 'THz/GeocAltRate   '
     dataset%data_type = 'real              '
     ALLOCATE (dataset%Dimensions(2), stat=status)
     dataset%Dimensions(1) = 'THz.MIF'
     dataset%Dimensions(2) = 'MAF' 
     CALL Build_MLSAuxData (sd_id, dataset,tp%tpGeocAltRate,lastIndex=noMAF)
     CALL Deallocate_DataProducts (dataset)
     dataset%name      = 'THz/GeodAlt       '
     dataset%data_type = 'double            '
     ALLOCATE (dataset%Dimensions(2), stat=status)
     dataset%Dimensions(1) = 'THz.MIF'
     dataset%Dimensions(2) = 'MAF' 
     CALL Build_MLSAuxData (sd_id, dataset,tp%tpGeodAlt, lastIndex=noMAF)
     CALL Deallocate_DataProducts (dataset)
     dataset%name      = 'THz/GeodLat       '
     dataset%data_type = 'real              '
     ALLOCATE (dataset%Dimensions(2), stat=status)
     dataset%Dimensions(1) = 'THz.MIF'
     dataset%Dimensions(2) = 'MAF' 
     CALL Build_MLSAuxData (sd_id, dataset,tp%tpGeodLat, lastIndex=noMAF)
     CALL Deallocate_DataProducts (dataset)
     dataset%name      = 'THz/GeodAltRate   '
     dataset%data_type = 'real              '
     ALLOCATE (dataset%Dimensions(2), stat=status)
     dataset%Dimensions(1) = 'THz.MIF'
     dataset%Dimensions(2) = 'MAF' 
     CALL Build_MLSAuxData (sd_id, dataset,tp%tpGeodAltRate,lastIndex=noMAF)
     CALL Deallocate_DataProducts (dataset)
     dataset%name      = 'THz/Lon           '
     dataset%data_type = 'real              '
     ALLOCATE (dataset%Dimensions(2), stat=status)
     dataset%Dimensions(1) = 'THz.MIF'
     dataset%Dimensions(2) = 'MAF' 
     CALL Build_MLSAuxData (sd_id, dataset,tp%tpLon, lastIndex=noMAF)
     CALL Deallocate_DataProducts (dataset)
     dataset%name      = 'THz/GeodAngle     '
     dataset%data_type = 'real              '
     ALLOCATE (dataset%Dimensions(2), stat=status)
     dataset%Dimensions(1) = 'THz.MIF'
     dataset%Dimensions(2) = 'MAF' 
     CALL Build_MLSAuxData (sd_id, dataset,tp%tpGeodAngle, lastIndex=noMAF)
     CALL Deallocate_DataProducts (dataset)
     dataset%name      = 'THz/SolarTime     '
     dataset%data_type = 'real              '
     ALLOCATE (dataset%Dimensions(2), stat=status)
     dataset%Dimensions(1) = 'THz.MIF'
     dataset%Dimensions(2) = 'MAF' 
     CALL Build_MLSAuxData (sd_id, dataset,tp%tpSolarTime, lastIndex=noMAF)
     CALL Deallocate_DataProducts (dataset)
     dataset%name      = 'THz/SolarZenith   '
     dataset%data_type = 'real              '
     ALLOCATE (dataset%Dimensions(2), stat=status)
     dataset%Dimensions(1) = 'THz.MIF'
     dataset%Dimensions(2) = 'MAF' 
     CALL Build_MLSAuxData (sd_id, dataset,tp%tpSolarZenith, lastIndex=noMAF)
     CALL Deallocate_DataProducts (dataset)
     dataset%name      = 'THz/LosAngle      '
     dataset%data_type = 'real              '
     ALLOCATE (dataset%Dimensions(2), stat=status)
     dataset%Dimensions(1) = 'THz.MIF'
     dataset%Dimensions(2) = 'MAF' 
     CALL Build_MLSAuxData (sd_id, dataset,tp%tpLosAngle, lastIndex=noMAF)
     CALL Deallocate_DataProducts (dataset)
d313 1
d315 2
a316 1
  SUBROUTINE OutputL1B_rad_HDF5 (noMAF, sdId, counterMAF, MAFStartTimeGIRD, rad)
d321 6
a326 2
    TYPE( L1BFileInfo_T ) :: sdId
    TYPE( Radiance_T    ) :: rad(:)
d338 14
a351 29
     CALL Deallocate_DataProducts (dataset)
     dataset%name      = 'counterMAF        '
     dataset%data_type = 'integer           '
     ALLOCATE (dataset%Dimensions(1), stat=status)
     dataset%Dimensions(1) = 'MAF'
     IF (sdId%RADDID /= 0) THEN
        CALL Build_MLSAuxData (sdId%RADDID, dataset, counterMAF, &
             lastIndex=noMAF)
        CALL Build_MLSAuxData (sdId%RADFID, dataset, counterMAF, &
             lastIndex=noMAF)
     ELSE
        CALL Build_MLSAuxData (sdId%RADTID, dataset, counterMAF, &
             lastIndex=noMAF)
     ENDIF
     CALL Deallocate_DataProducts (dataset)
!------------------------------------------------------------------------------
     CALL Deallocate_DataProducts (dataset)
     dataset%name      = 'MAFStartTimeGIRD  '
     dataset%data_type = 'double            '
     ALLOCATE (dataset%Dimensions(1), stat=status)
     dataset%Dimensions(1) = 'MAF'
     IF (sdId%RADDID /= 0) THEN
        CALL Build_MLSAuxData (sdId%RADDID, dataset, MAFStartTimeGIRD, &
             lastIndex=noMAF)
        CALL Build_MLSAuxData (sdId%RADFID, dataset, MAFStartTimeGIRD, &
             lastIndex=noMAF)
     ELSE
         CALL Build_MLSAuxData (sdId%RADTID, dataset, MAFStartTimeGIRD, &
             lastIndex=noMAF)
d353 43
a395 1
     CALL Deallocate_DataProducts (dataset)
d398 1
d403 1
a403 1
       IF ( INDEX(name,'FB') /= 0 ) THEN
d410 1
a410 1
       ELSE IF ( INDEX(name,'MB') /= 0 ) THEN
d413 1
a413 1
       ELSE IF ( INDEX(name,'WF') /= 0 ) THEN
d416 1
a416 1
       ELSE IF ( INDEX(name,'DACS') /= 0 ) THEN
d423 1
a423 1
       IF ((ANY(rad(i)%value /= 0.0)).AND.(sd_id /= -999)) THEN   
d429 1
a429 1
          IF ( INDEX(name,'R5') /= 0 ) THEN
a436 1
          CALL Deallocate_DataProducts (dataset)
a437 2
          dataset%data_type = 'real'
          ALLOCATE (dataset%Dimensions(3), stat=status)
d440 3
a442 4
          dataset%Dimensions(3) = 'MAF                 '
          CALL Build_MLSAuxData (sd_id, dataset, rad(i)%value, lastIndex=noMAF,&
               dims=dims)
          CALL Deallocate_DataProducts (dataset)
d444 1
a444 1
          CALL Deallocate_DataProducts (dataset)
a445 5
          dataset%data_type = 'real' 
          ALLOCATE (dataset%Dimensions(3), stat=status)
          dataset%Dimensions(1) = dim_chan
          dataset%Dimensions(2) = dim_mif
          dataset%Dimensions(3) = 'MAF                 '
d447 1
a447 3
               lastIndex=noMAF,&
               dims=dims)
          CALL Deallocate_DataProducts (dataset)
d451 3
d455 1
d459 3
@


2.3
log
@Added dimension names.
@
text
@d7 1
a7 1
  USE OutputL1B_DataTypes, only: LENG, LENT, LENUTC, LENCOORD, & 
d9 3
a11 3
  USE MLS_DataProducts, only: DataProducts_T, Deallocate_DataProducts
  USE MLSAuxData, only: Build_MLSAuxData, CreateGroup_MLSAuxData
  USE HDF5, only: HID_T
d13 4
a16 4
  USE MLSL1Common, only: L1BFileInfo_T
  USE MLSL1Config, only: MIFsGHz, MIFsTHz
  USE MLSL1Rad, only: Radiance_T
  USE MLSSignalNomenclature, only:GetFullMLSSignalName
d23 1
a23 1
    "$Id: OutputL1B_HDF5.f90,v 2.2 2002/11/18 21:21:30 jdone Exp $"
d29 1
a29 1
  SUBROUTINE OutputL1B_create_HDF5(sdId)
d34 5
a38 3
    call CreateGroup_MLSAuxData( sdId%OAId, 'sc')
    call CreateGroup_MLSAuxData( sdId%OAId, 'GHz')
    call CreateGroup_MLSAuxData( sdId%OAId, 'THz')
d41 1
a41 1
  SUBROUTINE OutputL1B_index_HDF5(noMAF, sd_id, index)
d50 1
a50 1
    integer :: status
d52 1
a52 1
     call Deallocate_DataProducts(dataset)
d55 1
a55 1
     allocate(dataset%Dimensions(1), stat=status)
d57 1
a57 1
     call Build_MLSAuxData(sd_id,dataset,index%MAFStartTimeUTC, & 
d59 1
a59 1
     call Deallocate_DataProducts(dataset)
d62 1
a62 1
     allocate(dataset%Dimensions(1), stat=status)
d64 2
a65 2
     call Build_MLSAuxData(sd_id,dataset,index%MAFStartTimeTAI,lastIndex=noMAF)
     call Deallocate_DataProducts(dataset)
d68 1
a68 1
     allocate(dataset%Dimensions(1), stat=status)
d70 2
a71 2
     call Build_MLSAuxData(sd_id,dataset,index%noMIFs,lastIndex=noMAF)
     call Deallocate_DataProducts(dataset)
d74 1
a74 1
     allocate(dataset%Dimensions(1), stat=status)
d76 2
a77 2
     call Build_MLSAuxData(sd_id,dataset,index%counterMAF, lastIndex=noMAF)
     call Deallocate_DataProducts(dataset)
d81 1
a81 1
  SUBROUTINE OutputL1B_sc_HDF5(noMAF, sd_id, sc)
d90 1
a90 1
    integer :: status
d92 1
a92 1
     call Deallocate_DataProducts(dataset)
d95 1
a95 1
     allocate(dataset%Dimensions(3), stat=status)
d99 2
a100 2
     call Build_MLSAuxData(sd_id, dataset, sc%scECI, lastIndex=noMAF)
     call Deallocate_DataProducts(dataset)
d103 1
a103 1
     allocate(dataset%Dimensions(3), stat=status)
d107 2
a108 2
     call Build_MLSAuxData(sd_id, dataset, sc%scECR, lastIndex=noMAF)
     call Deallocate_DataProducts(dataset)
d111 1
a111 1
     allocate(dataset%Dimensions(2), stat=status)
d114 2
a115 2
     call Build_MLSAuxData(sd_id, dataset, sc%scGeocAlt, lastIndex=noMAF)
     call Deallocate_DataProducts(dataset)
d118 1
a118 1
     allocate(dataset%Dimensions(2), stat=status)
d121 2
a122 2
     call Build_MLSAuxData(sd_id, dataset, sc%scGeocLat, lastIndex=noMAF)
     call Deallocate_DataProducts(dataset)
d125 1
a125 1
     allocate(dataset%Dimensions(2), stat=status)
d128 2
a129 2
     call Build_MLSAuxData(sd_id, dataset, sc%scGeodAlt, lastIndex=noMAF)
     call Deallocate_DataProducts(dataset)
d132 1
a132 1
     allocate(dataset%Dimensions(2), stat=status)
d135 2
a136 2
     call Build_MLSAuxData(sd_id, dataset, sc%scGeodLat, lastIndex=noMAF)
     call Deallocate_DataProducts(dataset)
d139 1
a139 1
     allocate(dataset%Dimensions(2), stat=status)
d142 2
a143 2
     call Build_MLSAuxData(sd_id, dataset, sc%scLon, lastIndex=noMAF)
     call Deallocate_DataProducts(dataset)
d146 1
a146 1
     allocate(dataset%Dimensions(2), stat=status)
d149 2
a150 2
     call Build_MLSAuxData(sd_id, dataset, sc%scGeodAngle,lastIndex=noMAF)
     call Deallocate_DataProducts(dataset)
d153 1
a153 1
     allocate(dataset%Dimensions(3), stat=status)
d157 2
a158 2
     call Build_MLSAuxData(sd_id, dataset, sc%scVelECI,lastIndex=noMAF)
     call Deallocate_DataProducts(dataset)
d161 1
a161 1
     allocate(dataset%Dimensions(3), stat=status)
d165 2
a166 2
     call Build_MLSAuxData(sd_id, dataset, sc%ypr, lastIndex=noMAF)
     call Deallocate_DataProducts(dataset)
d169 1
a169 1
     allocate(dataset%Dimensions(3), stat=status)
d173 2
a174 2
     call Build_MLSAuxData(sd_id, dataset, sc%yprRate, lastIndex=noMAF)
     call Deallocate_DataProducts(dataset)
d177 1
a177 1
     allocate(dataset%Dimensions(3), stat=status)
d181 2
a182 2
     call Build_MLSAuxData(sd_id, dataset, sc%scVelECR,lastIndex=noMAF)
     call Deallocate_DataProducts(dataset)
d185 1
a185 1
     allocate(dataset%Dimensions(2), stat=status)
d188 2
a189 2
     call Build_MLSAuxData(sd_id, dataset, sc%scOrbIncl,lastIndex=noMAF)
     call Deallocate_DataProducts(dataset)
d193 1
a193 1
  SUBROUTINE OutputL1B_GHz_HDF5(noMAF, sd_id, tp)
d203 1
a203 1
    integer :: status
d205 1
a205 1
     call Deallocate_DataProducts(dataset)
d208 1
a208 1
     allocate(dataset%Dimensions(2), stat=status)
d211 2
a212 2
     call Build_MLSAuxData(sd_id,dataset,tp%encoderAngle,lastIndex=noMAF)
     call Deallocate_DataProducts(dataset)
d215 1
a215 1
     allocate(dataset%Dimensions(2), stat=status)
d218 2
a219 2
     call Build_MLSAuxData(sd_id,dataset,tp%scAngle,lastIndex=noMAF)
     call Deallocate_DataProducts(dataset)
d222 1
a222 1
     allocate(dataset%Dimensions(2), stat=status)
d225 2
a226 2
     call Build_MLSAuxData(sd_id,dataset,tp%scanAngle,lastIndex=noMAF)
     call Deallocate_DataProducts(dataset)
d229 1
a229 1
     allocate(dataset%Dimensions(2), stat=status)
d232 2
a233 2
     call Build_MLSAuxData(sd_id,dataset,tp%scanRate,lastIndex=noMAF)
     call Deallocate_DataProducts(dataset)
d236 1
a236 1
     allocate(dataset%Dimensions(3), stat=status)
d240 2
a241 2
     call Build_MLSAuxData(sd_id,dataset,tp%tpECI,lastIndex=noMAF)
     call Deallocate_DataProducts(dataset)
d244 1
a244 1
     allocate(dataset%Dimensions(3), stat=status)
d248 2
a249 2
     call Build_MLSAuxData(sd_id,dataset,tp%tpECR,lastIndex=noMAF)
     call Deallocate_DataProducts(dataset)
d252 1
a252 1
     allocate(dataset%Dimensions(2), stat=status)
d255 2
a256 2
     call Build_MLSAuxData(sd_id,dataset,tp%tpOrbY,lastIndex=noMAF)
     call Deallocate_DataProducts(dataset)
d259 1
a259 1
     allocate(dataset%Dimensions(2), stat=status)
d262 2
a263 2
     call Build_MLSAuxData(sd_id,dataset,tp%tpGeocAlt,lastIndex=noMAF)
     call Deallocate_DataProducts(dataset)
d266 1
a266 1
     allocate(dataset%Dimensions(2), stat=status)
d269 2
a270 2
     call Build_MLSAuxData(sd_id,dataset,tp%tpGeocLat,lastIndex=noMAF)
     call Deallocate_DataProducts(dataset)
d273 1
a273 1
     allocate(dataset%Dimensions(2), stat=status)
d276 2
a277 2
     call Build_MLSAuxData(sd_id,dataset,tp%tpGeocAltRate,lastIndex=noMAF)
     call Deallocate_DataProducts(dataset)
d280 1
a280 1
     allocate(dataset%Dimensions(2), stat=status)
d283 2
a284 2
     call Build_MLSAuxData(sd_id,dataset,tp%tpGeodAlt,lastIndex=noMAF)
     call Deallocate_DataProducts(dataset)
d287 1
a287 1
     allocate(dataset%Dimensions(2), stat=status)
d290 2
a291 2
     call Build_MLSAuxData(sd_id,dataset,tp%tpGeodLat,lastIndex=noMAF)
     call Deallocate_DataProducts(dataset)
d294 1
a294 1
     allocate(dataset%Dimensions(2), stat=status)
d297 2
a298 2
     call Build_MLSAuxData(sd_id,dataset,tp%tpGeodAltRate,lastIndex=noMAF)
     call Deallocate_DataProducts(dataset)
d301 1
a301 1
     allocate(dataset%Dimensions(2), stat=status)
d304 2
a305 2
     call Build_MLSAuxData(sd_id,dataset,tp%tpLon,lastIndex=noMAF)
     call Deallocate_DataProducts(dataset)
d308 1
a308 1
     allocate(dataset%Dimensions(2), stat=status)
d311 2
a312 2
     call Build_MLSAuxData(sd_id,dataset,tp%tpGeodAngle,lastIndex=noMAF)
     call Deallocate_DataProducts(dataset)
d315 1
a315 1
     allocate(dataset%Dimensions(2), stat=status)
d318 2
a319 2
     call Build_MLSAuxData(sd_id,dataset,tp%tpSolarTime,lastIndex=noMAF)
     call Deallocate_DataProducts(dataset)
d322 1
a322 1
     allocate(dataset%Dimensions(2), stat=status)
d325 2
a326 2
     call Build_MLSAuxData(sd_id,dataset,tp%tpSolarZenith,lastIndex=noMAF)
     call Deallocate_DataProducts(dataset)
d329 1
a329 1
     allocate(dataset%Dimensions(2), stat=status)
d332 2
a333 2
     call Build_MLSAuxData(sd_id,dataset,tp%tpLosAngle,lastIndex=noMAF)
     call Deallocate_DataProducts(dataset)
d337 1
a337 1
  SUBROUTINE OutputL1B_THz_HDF5(noMAF, sd_id, tp)
d348 1
a348 1
    integer :: status
d350 1
a350 1
     call Deallocate_DataProducts(dataset)
d353 1
a353 1
     allocate(dataset%Dimensions(2), stat=status)
d356 2
a357 2
     call Build_MLSAuxData(sd_id, dataset,tp%encoderAngle,lastIndex=noMAF)
     call Deallocate_DataProducts(dataset)
d360 1
a360 1
     allocate(dataset%Dimensions(2), stat=status)
d363 2
a364 2
     call Build_MLSAuxData(sd_id, dataset,tp%scAngle,lastIndex=noMAF)
     call Deallocate_DataProducts(dataset)
d367 1
a367 1
     allocate(dataset%Dimensions(2), stat=status)
d370 2
a371 2
     call Build_MLSAuxData(sd_id, dataset,tp%scanAngle,lastIndex=noMAF)
     call Deallocate_DataProducts(dataset)
d374 1
a374 1
     allocate(dataset%Dimensions(2), stat=status)
d377 2
a378 2
     call Build_MLSAuxData(sd_id, dataset,tp%scanRate, lastIndex=noMAF)
     call Deallocate_DataProducts(dataset)
d381 1
a381 1
     allocate(dataset%Dimensions(3), stat=status)
d385 2
a386 2
     call Build_MLSAuxData(sd_id, dataset,tp%tpECI, lastIndex=noMAF)
     call Deallocate_DataProducts(dataset)
d389 1
a389 1
     allocate(dataset%Dimensions(3), stat=status)
d393 2
a394 2
     call Build_MLSAuxData(sd_id, dataset,tp%tpECR, lastIndex=noMAF)
     call Deallocate_DataProducts(dataset)
d397 1
a397 1
     allocate(dataset%Dimensions(2), stat=status)
d400 2
a401 2
     call Build_MLSAuxData(sd_id, dataset,tp%tpOrbY, lastIndex=noMAF)
     call Deallocate_DataProducts(dataset)
d404 1
a404 1
     allocate(dataset%Dimensions(2), stat=status)
d407 2
a408 2
     call Build_MLSAuxData(sd_id, dataset,tp%tpGeocAlt, lastIndex=noMAF)
     call Deallocate_DataProducts(dataset)
d411 1
a411 1
     allocate(dataset%Dimensions(2), stat=status)
d414 2
a415 2
     call Build_MLSAuxData(sd_id, dataset,tp%tpGeocLat, lastIndex=noMAF)
     call Deallocate_DataProducts(dataset)
d418 1
a418 1
     allocate(dataset%Dimensions(2), stat=status)
d421 2
a422 2
     call Build_MLSAuxData(sd_id, dataset,tp%tpGeocAltRate,lastIndex=noMAF)
     call Deallocate_DataProducts(dataset)
d425 1
a425 1
     allocate(dataset%Dimensions(2), stat=status)
d428 2
a429 2
     call Build_MLSAuxData(sd_id, dataset,tp%tpGeodAlt, lastIndex=noMAF)
     call Deallocate_DataProducts(dataset)
d432 1
a432 1
     allocate(dataset%Dimensions(2), stat=status)
d435 2
a436 2
     call Build_MLSAuxData(sd_id, dataset,tp%tpGeodLat, lastIndex=noMAF)
     call Deallocate_DataProducts(dataset)
d439 1
a439 1
     allocate(dataset%Dimensions(2), stat=status)
d442 2
a443 2
     call Build_MLSAuxData(sd_id, dataset,tp%tpGeodAltRate,lastIndex=noMAF)
     call Deallocate_DataProducts(dataset)
d446 1
a446 1
     allocate(dataset%Dimensions(2), stat=status)
d449 2
a450 2
     call Build_MLSAuxData(sd_id, dataset,tp%tpLon, lastIndex=noMAF)
     call Deallocate_DataProducts(dataset)
d453 1
a453 1
     allocate(dataset%Dimensions(2), stat=status)
d456 2
a457 2
     call Build_MLSAuxData(sd_id, dataset,tp%tpGeodAngle, lastIndex=noMAF)
     call Deallocate_DataProducts(dataset)
d460 1
a460 1
     allocate(dataset%Dimensions(2), stat=status)
d463 2
a464 2
     call Build_MLSAuxData(sd_id, dataset,tp%tpSolarTime, lastIndex=noMAF)
     call Deallocate_DataProducts(dataset)
d467 1
a467 1
     allocate(dataset%Dimensions(2), stat=status)
d470 2
a471 2
     call Build_MLSAuxData(sd_id, dataset,tp%tpSolarZenith, lastIndex=noMAF)
     call Deallocate_DataProducts(dataset)
d474 1
a474 1
     allocate(dataset%Dimensions(2), stat=status)
d477 2
a478 2
     call Build_MLSAuxData(sd_id, dataset,tp%tpLosAngle, lastIndex=noMAF)
     call Deallocate_DataProducts(dataset)
d482 1
a482 1
  SUBROUTINE OutputL1B_rad_HDF5(noMAF, sdId, counterMAF, rad)
d490 1
d500 1
a500 1
     call Deallocate_DataProducts(dataset)
d503 17
a519 1
     allocate(dataset%Dimensions(1), stat=status)
d521 49
a569 38
     call Build_MLSAuxData(sdId%RADDID, dataset, counterMAF, lastIndex=noMAF)
     call Build_MLSAuxData(sdId%RADFID, dataset, counterMAF, lastIndex=noMAF)
     call Deallocate_DataProducts(dataset)
!------------------------------------------------------------------------------
    do i = 1, size(rad) ! Loop on number of SDs per MAF
      call GetFullMLSSignalName(rad(i)%signal, name) ! Concatenate SD names
      prec = trim(name) // ' precision'
      ! Set parameters based on input data dimensions
      ! Based on the SD name, set dim name for channel, get Id of output file
      IF ( INDEX(name,'FB') /= 0 ) THEN
        dim_chan = 'chanFB              '
        sd_id = sdId%RADFID
      ELSE IF ( INDEX(name,'MB') /= 0 ) THEN
        dim_chan = 'chanMB              '
        sd_id = sdId%RADFID
      ELSE IF ( INDEX(name,'WF') /= 0 ) THEN
        dim_chan = 'chanWF              '
        sd_id = sdId%RADFID
      ELSE IF ( INDEX(name,'DACS') /= 0 ) THEN
        dim_chan = 'chanDACS            '
        sd_id = sdId%RADDID
      ELSE
        dim_chan = ''
        sd_id = -999
      ENDIF
     IF ((any(rad(i)%value /= 0.0)).and.(sd_id /= -999)) THEN   
                                            ! if good radiance data exists 
                                            ! Create/Open the value SDs
      dims(1) = SIZE(rad(i)%value,1)
      dims(2) = SIZE(rad(i)%value,2)
      dims(3) = 1
      IF ( INDEX(name,'R5') /= 0 ) THEN
        dim_mif = 'THz.MIF              '
        dims(2) = MIFsTHz      !! lenT
      ELSE
        dim_mif = 'GHz.MIF              '
        dims(2) = MIFsGHz      !! lenG
      ENDIF
d571 22
a592 21
      call Deallocate_DataProducts(dataset)
      dataset%name = trim(name)
      dataset%data_type = 'real'
      allocate(dataset%Dimensions(3), stat=status)
      dataset%Dimensions(1) = dim_chan
      dataset%Dimensions(2) = dim_mif
      dataset%Dimensions(3) = 'MAF                 '
      call Build_MLSAuxData(sd_id, dataset, rad(i)%value, lastIndex=noMAF,&
           dims=dims)
      call Deallocate_DataProducts(dataset)
!------------------------------------------- Create/Open the precision datasets
      call Deallocate_DataProducts(dataset)
      dataset%name = trim(prec)
      dataset%data_type = 'real' 
      allocate(dataset%Dimensions(3), stat=status)
      dataset%Dimensions(1) = dim_chan
      dataset%Dimensions(2) = dim_mif
      dataset%Dimensions(3) = 'MAF                 '
      call Build_MLSAuxData(sd_id, dataset, rad(i)%precision, lastIndex=noMAF,&
           dims=dims)
      call Deallocate_DataProducts(dataset)
d594 2
a595 2
     endif
   enddo
d600 3
@


2.2
log
@Used trim for names of radiance and supporting precision files.
@
text
@d9 2
a10 1
  USE MLSAuxData, only:DataProducts_T, Build_MLSAuxData, CreateGroup_MLSAuxData
d19 2
a20 2
  PUBLIC :: OUTPUTL1B_CREATE_HDF5, OUTPUTL1B_INDEX_HDF5, OUTPUTL1B_SC_HDF5, OUTPUTL1B_GHZ_HDF5, & 
    & OUTPUTL1B_THZ_HDF5, OUTPUTL1B_RAD_HDF5
d23 1
a23 1
    "$Id: OutputL1B_HDF5.f90,v 2.1 2002/11/07 21:36:57 jdone Exp $"
a25 57
  TYPE( DataProducts_T ), DIMENSION(4), PUBLIC, PARAMETER :: sds_datasets=(/&
       DataProducts_T('MAFStartTimeUTC   ','character         '), & 
       DataProducts_T('MAFStartTimeTAI   ','double            '), & 
       DataProducts_T('noMIFs            ','integer           '), & 
       DataProducts_T('counterMAF        ','integer           ') /)
  TYPE( DataProducts_T ), DIMENSION(13), PUBLIC, PARAMETER::sc_sds_datasets=(/&
       DataProducts_T('sc/ECI            ','double            '), & 
       DataProducts_T('sc/ECR            ','double            '), & 
       DataProducts_T('sc/GeocAlt        ','double            '), & 
       DataProducts_T('sc/GeocLat        ','real              '), & 
       DataProducts_T('sc/GeodAlt        ','double            '), & 
       DataProducts_T('sc/GeodLat        ','real              '), & 
       DataProducts_T('sc/Lon            ','real              '), & 
       DataProducts_T('sc/GeodAngle      ','real              '), & 
       DataProducts_T('sc/VelECI         ','double            '), & 
       DataProducts_T('sc/ypr            ','double            '), & 
       DataProducts_T('sc/yprRate        ','double            '), & 
       DataProducts_T('sc/VelECR         ','double            '), & 
       DataProducts_T('sc/OrbIncl        ','real              ') /)
  TYPE( DataProducts_T ), DIMENSION(18),PUBLIC,PARAMETER::GHz_sds_datasets=(/&
       DataProducts_T('GHz/encoderAngle  ','double            '), & 
       DataProducts_T('GHz/scAngle       ','double            '), & 
       DataProducts_T('GHz/scanAngle     ','double            '), & 
       DataProducts_T('GHz/scanRate      ','real              '), & 
       DataProducts_T('GHz/tp/ECI        ','double            '), & 
       DataProducts_T('GHz/tp/ECR        ','double            '), & 
       DataProducts_T('GHz/tp/OrbY       ','real              '), & 
       DataProducts_T('GHz/tp/GeocAlt    ','double            '), & 
       DataProducts_T('GHz/tp/GeocLat    ','real              '), & 
       DataProducts_T('GHz/tp/GeocAltRate','real              '), & 
       DataProducts_T('GHz/tp/GeodAlt    ','double            '), & 
       DataProducts_T('GHz/tp/GeodLat    ','real              '), & 
       DataProducts_T('GHz/tp/GeodAltRate','real              '), & 
       DataProducts_T('GHz/tp/Lon        ','real              '), & 
       DataProducts_T('GHz/tp/GeodAngle  ','real              '), & 
       DataProducts_T('GHz/tp/SolarTime  ','real              '), & 
       DataProducts_T('GHz/tp/SolarZenith','real              '), & 
       DataProducts_T('GHz/tp/LosAngle   ','real              ') /)
  TYPE( DataProducts_T ), DIMENSION(18),PUBLIC,PARAMETER::THz_sds_datasets=(/&
       DataProducts_T('THz/encoderAngle  ','double            '), & 
       DataProducts_T('THz/scAngle       ','double            '), & 
       DataProducts_T('THz/scanAngle     ','double            '), & 
       DataProducts_T('THz/scanRate      ','real              '), & 
       DataProducts_T('THz/tp/ECI        ','double            '), & 
       DataProducts_T('THz/tp/ECR        ','double            '), & 
       DataProducts_T('THz/tp/OrbY       ','real              '), & 
       DataProducts_T('THz/tp/GeocAlt    ','double            '), & 
       DataProducts_T('THz/tp/GeocLat    ','real              '), & 
       DataProducts_T('THz/tp/GeocAltRate','real              '), & 
       DataProducts_T('THz/tp/GeodAlt    ','double            '), & 
       DataProducts_T('THz/tp/GeodLat    ','real              '), & 
       DataProducts_T('THz/tp/GeodAltRate','real              '), & 
       DataProducts_T('THz/tp/Lon        ','real              '), & 
       DataProducts_T('THz/tp/GeodAngle  ','real              '), & 
       DataProducts_T('THz/tp/SolarTime  ','real              '), & 
       DataProducts_T('THz/tp/SolarZenith','real              '), & 
       DataProducts_T('THz/tp/LosAngle   ','real              ') /)
a26 15
  CHARACTER(len=*), PUBLIC, PARAMETER :: DIM1_NAME  = 'MAF'
  CHARACTER(len=*), PUBLIC, PARAMETER :: DIM2_NAME  = 'MIF'
  CHARACTER(len=*), PUBLIC, PARAMETER :: DIM3_NAME  = 'GHz/MIF'
  CHARACTER(len=*), PUBLIC, PARAMETER :: DIM4_NAME  = 'THz/MIF'
  CHARACTER(len=*), PUBLIC, PARAMETER :: DIM5_NAME  = 'xyz'
  CHARACTER(len=*), PUBLIC, PARAMETER :: DIM6_NAME  = 'charUTC'
  CHARACTER(len=*), PUBLIC, PARAMETER :: DIM7_NAME  = 'chanFB'
  CHARACTER(len=*), PUBLIC, PARAMETER :: DIM8_NAME  = 'chanMB'
  CHARACTER(len=*), PUBLIC, PARAMETER :: DIM9_NAME  = 'chanWF'
  CHARACTER(len=*), PUBLIC, PARAMETER :: DIM10_NAME = 'chanDACS'
!---------------------------------------------------------Names of HDF5 Groups:
  CHARACTER(len=*), PUBLIC, PARAMETER :: SC_GROUP_NAME    = 'sc'
  CHARACTER(len=*), PUBLIC, PARAMETER :: GHZ_GROUP_NAME   = 'GHz'
  CHARACTER(len=*), PUBLIC, PARAMETER :: THZ_GROUP_NAME   = 'THz'
  CHARACTER(len=*), PUBLIC, PARAMETER :: TP_SUBGROUP_NAME = 'tp'
d30 2
a31 3
    ! This subroutine creates the structure of the output files, 
    ! and names the arrays and dimensions contained within them.
    ! Assumes HDF5 FORTRAN APIs have been invoked by l1/OpenInit to open files.
d34 3
a36 5
    call CreateGroup_MLSAuxData( sdId%OAId, SC_GROUP_NAME )
    call CreateGroup_MLSAuxData( sdId%OAId, GHZ_GROUP_NAME )
    call CreateGroup_MLSAuxData( sdId%OAId, GHZ_GROUP_NAME, TP_SUBGROUP_NAME )
    call CreateGroup_MLSAuxData( sdId%OAId, THZ_GROUP_NAME )
    call CreateGroup_MLSAuxData( sdId%OAId, THZ_GROUP_NAME, TP_SUBGROUP_NAME )
d46 3
d50 26
a75 5
     call Build_MLSAuxData(sd_id,sds_datasets(1),index%MAFStartTimeUTC, & 
          noMAF, lenUTC)
     call Build_MLSAuxData(sd_id,sds_datasets(2),index%MAFStartTimeTAI,noMAF)
     call Build_MLSAuxData(sd_id,sds_datasets(3),index%noMIFs,noMAF)
     call Build_MLSAuxData(sd_id,sds_datasets(4),index%counterMAF, noMAF)
d87 2
d90 98
a187 13
     call Build_MLSAuxData(sd_id, sc_sds_datasets(1),  sc%scECI, noMAF)
     call Build_MLSAuxData(sd_id, sc_sds_datasets(2),  sc%scECR, noMAF)
     call Build_MLSAuxData(sd_id, sc_sds_datasets(3),  sc%scGeocAlt, noMAF) 
     call Build_MLSAuxData(sd_id, sc_sds_datasets(4),  sc%scGeocLat, noMAF)
     call Build_MLSAuxData(sd_id, sc_sds_datasets(5),  sc%scGeodAlt, noMAF)
     call Build_MLSAuxData(sd_id, sc_sds_datasets(6),  sc%scGeodLat, noMAF)
     call Build_MLSAuxData(sd_id, sc_sds_datasets(7),  sc%scLon, noMAF)
     call Build_MLSAuxData(sd_id, sc_sds_datasets(8),  sc%scGeodAngle,noMAF)
     call Build_MLSAuxData(sd_id, sc_sds_datasets(9),  sc%scVelECI,noMAF)
     call Build_MLSAuxData(sd_id, sc_sds_datasets(10), sc%ypr, noMAF)
     call Build_MLSAuxData(sd_id, sc_sds_datasets(11), sc%yprRate, noMAF)
     call Build_MLSAuxData(sd_id, sc_sds_datasets(12), sc%scVelECR,noMAF)
     call Build_MLSAuxData(sd_id, sc_sds_datasets(13), sc%scOrbIncl,noMAF)
d199 3
d203 129
a331 18
     call Build_MLSAuxData(sd_id,GHz_sds_datasets(1) ,tp%encoderAngle,noMAF)
     call Build_MLSAuxData(sd_id,GHz_sds_datasets(2) ,tp%scAngle,noMAF)
     call Build_MLSAuxData(sd_id,GHz_sds_datasets(3) ,tp%scanAngle,noMAF)
     call Build_MLSAuxData(sd_id,GHz_sds_datasets(4) ,tp%scanRate,noMAF)
     call Build_MLSAuxData(sd_id,GHz_sds_datasets(5) ,tp%tpECI,noMAF)
     call Build_MLSAuxData(sd_id,GHz_sds_datasets(6) ,tp%tpECR,noMAF)
     call Build_MLSAuxData(sd_id,GHz_sds_datasets(7) ,tp%tpOrbY,noMAF)
     call Build_MLSAuxData(sd_id,GHz_sds_datasets(8) ,tp%tpGeocAlt,noMAF)
     call Build_MLSAuxData(sd_id,GHz_sds_datasets(9) ,tp%tpGeocLat,noMAF)
     call Build_MLSAuxData(sd_id,GHz_sds_datasets(10),tp%tpGeocAltRate,noMAF)
     call Build_MLSAuxData(sd_id,GHz_sds_datasets(11),tp%tpGeodAlt,noMAF)
     call Build_MLSAuxData(sd_id,GHz_sds_datasets(12),tp%tpGeodLat,noMAF)
     call Build_MLSAuxData(sd_id,GHz_sds_datasets(13),tp%tpGeodAltRate,noMAF)
     call Build_MLSAuxData(sd_id,GHz_sds_datasets(14),tp%tpLon,noMAF)
     call Build_MLSAuxData(sd_id,GHz_sds_datasets(15),tp%tpGeodAngle,noMAF)
     call Build_MLSAuxData(sd_id,GHz_sds_datasets(16),tp%tpSolarTime,noMAF)
     call Build_MLSAuxData(sd_id,GHz_sds_datasets(17),tp%tpSolarZenith,noMAF)
     call Build_MLSAuxData(sd_id,GHz_sds_datasets(18),tp%tpLosAngle,noMAF)
d344 3
d348 129
a476 18
     call Build_MLSAuxData(sd_id, THz_sds_datasets(1) ,tp%encoderAngle,noMAF)
     call Build_MLSAuxData(sd_id, THz_sds_datasets(2) ,tp%scAngle,noMAF)
     call Build_MLSAuxData(sd_id, THz_sds_datasets(3) ,tp%scanAngle,noMAF)
     call Build_MLSAuxData(sd_id, THz_sds_datasets(4) ,tp%scanRate, noMAF)
     call Build_MLSAuxData(sd_id, THz_sds_datasets(5) ,tp%tpECI, noMAF)
     call Build_MLSAuxData(sd_id, THz_sds_datasets(6) ,tp%tpECR, noMAF)
     call Build_MLSAuxData(sd_id, THz_sds_datasets(7) ,tp%tpOrbY, noMAF)
     call Build_MLSAuxData(sd_id, THz_sds_datasets(8) ,tp%tpGeocAlt, noMAF)
     call Build_MLSAuxData(sd_id, THz_sds_datasets(9) ,tp%tpGeocLat, noMAF)
     call Build_MLSAuxData(sd_id, THz_sds_datasets(10),tp%tpGeocAltRate,noMAF)
     call Build_MLSAuxData(sd_id, THz_sds_datasets(11),tp%tpGeodAlt, noMAF)
     call Build_MLSAuxData(sd_id, THz_sds_datasets(12),tp%tpGeodLat, noMAF)
     call Build_MLSAuxData(sd_id, THz_sds_datasets(13),tp%tpGeodAltRate,noMAF)
     call Build_MLSAuxData(sd_id, THz_sds_datasets(14),tp%tpLon, noMAF)
     call Build_MLSAuxData(sd_id, THz_sds_datasets(15),tp%tpGeodAngle, noMAF)
     call Build_MLSAuxData(sd_id, THz_sds_datasets(16),tp%tpSolarTime, noMAF)
     call Build_MLSAuxData(sd_id, THz_sds_datasets(17),tp%tpSolarZenith, noMAF)
     call Build_MLSAuxData(sd_id, THz_sds_datasets(18),tp%tpLosAngle, noMAF)
d493 1
a493 1
    INTEGER :: i
d497 8
a504 2
     call Build_MLSAuxData(sdId%RADDID, sds_datasets(4), counterMAF, noMAF)
     call Build_MLSAuxData(sdId%RADFID, sds_datasets(4), counterMAF, noMAF)
d512 1
a512 1
        dim_chan = DIM7_NAME
d515 1
a515 1
        dim_chan = DIM8_NAME
d518 1
a518 1
        dim_chan = DIM9_NAME
d521 1
a521 1
        dim_chan = DIM10_NAME
d534 1
a534 1
        dim_mif = DIM4_NAME
d537 1
a537 1
        dim_mif = DIM3_NAME
d541 1
d543 8
a550 2
      dataset%data_type = 'real' 
      call Build_MLSAuxData(sd_id, dataset, rad(i)%value, noMAF, dims)
d552 1
d555 7
a561 1
      call Build_MLSAuxData(sd_id, dataset, rad(i)%precision, noMAF, dims)
d569 3
@


2.1
log
@File holds all HDF5 output routines for Level 1
@
text
@d22 1
a22 1
    "$Id: OutputL1B_HDF5.f90,v 2.6 2002/03/29 20:18:34 perun Exp $"
d237 1
a237 1
      prec = TRIM(name) // ' precision'
d270 1
a270 1
      dataset%name = name
d274 1
a274 1
      dataset%name = prec
d283 4
a286 1
! $Log: OutputL1B.f90,v $
@

