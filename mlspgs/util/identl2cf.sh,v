head	1.3;
access;
symbols
	v5-02-NRT-19:1.3
	v6-00:1.3
	v5-02-NRT-18:1.3
	v5-02:1.2
	v5-01-NRT-17:1.3
	v5-01-NRT-16:1.3
	v5-01-NRT-15:1.3
	v5-01-NRT-14:1.3
	neuralnetworks-1-0:1.3.0.4
	cfm-single-freq-0-1:1.3.0.2
	v5-01:1.2
	v5-00:1.2
	v4-23-TA133:1.2.0.10
	mus-emls-1-70:1.2.0.8
	rel-1-0-englocks-work:1.2.0.6
	VUMLS1-00:1.2
	VPL1-00:1.2
	V4-22-NRT-08:1.2
	VAM1-00:1.2
	V4-21:1.2.0.4
	V4-13:1.2
	V4-12:1.2
	V4-11:1.2
	V4-10:1.2
	V3-43:1.2
	M4-00:1.2
	V3-41:1.2
	V3-40-PlusGM57:1.2.0.2
	V3-33:1.2
	V3-31:1.2
	V3-30-NRT-05:1.2
	cfm-01-00:1.2
	V3-30:1.2
	V3-20:1.2
	V3-10:1.1;
locks; strict;
comment	@# @;


1.3
date	2019.12.13.00.13.25;	author pwagner;	state Exp;
branches;
next	1.2;

1.2
date	2009.11.06.18.17.16;	author pwagner;	state Exp;
branches;
next	1.1;

1.1
date	2009.06.16.22.35.53;	author pwagner;	state Exp;
branches;
next	;


desc
@@


1.3
log
@More l2cfs in idents otherwise missed
@
text
@#!/bin/sh
#identl2cf.sh

# --------------- identl2cf.sh help
# Print to stdout idents for the l2cf fragments included in
# an l2cf file.  Takes the l2cf template as an arg. 

# Method:
# (1) Assemble list of l2cf fragments to be included
# (2) Extract '$Id' strings from fragments found in standard parts directory
# (3) Print strings to stdout

# Usage:
# identl2cf.sh [opt1] [opt2] ..  template
#
#     O p t i o n s
#    -dryrun              Merely echo the commands that would be executed
#    -I dir               Use dir as the standard parts directory
#                           default is ${HOME}/mlspgs/l2/l2cf/lib
#    -h[elp]              Print help; quit
#
# Bugs and limitations
# (1) It is assumed that all the l2cf fragments are included directly
#      from the l2cf fragment; it will miss any that are included indirectly
#      although we make a brave effort (see below)
# (2) All the l2cf fragments must be found in the standard parts directory
# (3) All the parts are included using syntax like
#     !include(name.l2cf)..
#     with possible exception of m4defs.l2cf
# (4) l2cf-formatted calibration files 
#     (like MLS-Aura_L2Cal-Tsys_v2-0-0_0000d000.l2cf)
#     are ignored (not explicitly, but because 
#     (a) they don't obey the syntax above, nor 
#     (b) they are not found in the standard parts directory
# --------------- End identl2cf.sh help
# Copyright 2009, by the California Institute of Technology. ALL
# RIGHTS RESERVED. United States Government Sponsorship acknowledged. Any
# commercial use must be negotiated with the Office of Technology Transfer
# at the California Institute of Technology.

# This software may be subject to U.S. export control laws. By accepting this
# software, the user agrees to comply with all applicable U.S. export laws and
# regulations. User has the responsibility to obtain export licenses, or other
# export authority as may be required before exporting such information to
# foreign countries or providing access to foreign persons.

# "$Id: identl2cf.sh,v 1.2 2009/11/06 18:17:16 pwagner Exp $"

#------------------------------- extant_files ------------
#
# Function to return only those files among the args
# that actually exist
# Useful when passed something like *.f which may 
# (1) expand to list of files, returned as extant_files_result, or
# (2) stay *.f, in which case a blank is returned as extant_files_result 
#     (unless you have perversely named a file '*.f')
# usage: extant_files arg1 [arg2] ..

extant_files()
{
   extant_files_result=
   # Trivial case ($# = 0)
   if [ "$1" != "" ]
   then
      for file
      do
         if [ -f "$file" ]
         then
               extant_files_result="$extant_files_result $file"
         fi
      done
   fi
}

#------------------------------- Main Program ------------

#****************************************************************
#                                                               *
#                  * * * Main Program  * * *                    *
#                                                               *
#                                                               *
#	The entry point where control is given to the script         *
#****************************************************************
#
files='m4defs.l2cf'
debug=0
#     ^  -- set this to 1 if worried
me="$0"
my_name=identl2cf.sh
I=identl2cf
dryrun="no"
stdparts="${HOME}/mlspgs/l2/l2cf/lib"
more_opts="yes"
while [ "$more_opts" = "yes" ] ; do

    case "$1" in

    -dryrun )
	    dryrun="yes"
	    shift
       ;;
    -I )
	    stdparts="$2"
	    shift
	    shift
       ;;
    -h | -help )
       sed -n '/'$my_name' help/,/End '$my_name' help/ p' $me \
           | sed -n 's/^.//p' | sed '1 d; $ d'
       exit
	     ;;
    * )
       more_opts="no"
       ;;
    esac
done

template="$1"
if [ "$debug" = 1 ]
then
  echo "template $template"
  echo "stdparts $stdparts"
fi
if [ ! -f "$template" ]
then
  echo "Sorry--the l2cf template $template not found"
  exit 1
elif [ ! -d "$stdparts" ]
then
  echo "Sorry--the standard parts directory $stdparts not found"
  exit 1
fi

# Extract names of files to be included
incfiles=`grep '\!include' $template | sed -n 's/\(.*\)\!include(\(.*\.l2cf\))\(?*\)/\2/p' | sed 's/}.*//'`

# Append any known to be missed by this syntax rule
# ---------------------------------------------------------------
# We can find some of these missed that are themselves !include-d
# by their siblings in the standard parts directory by doing this:
# grep '\!include' ${HOME}/mlspgs/l2/l2cf/lib/*.l2cf | \
#   sed -n 's/\(.*\)\!include(\(.*\.l2cf\))\(?*\)/\2/p' | \
#   sed 's/}.*//' | sort | uniq
files="filllesserstate.l2cf writeapriori.l2cf constructstandardgrids.l2cf copystdprods.l2cf $files"
# ---------------------------------------------------------------
files="$incfiles $files"

if [ "$debug" = 1 ]
then
  echo "files $files"
fi

cd $stdparts

for i in $files
do
  # echo $i
  extant_files $i
  # echo $extant_files_result
  if [ "$extant_files_result" != "" ]
  then
    # echo grep -i '\$Id' $i
    grep -i '\$Id' $i
  fi
done
exit
# $Log: identl2cf.sh,v $
# Revision 1.2  2009/11/06 18:17:16  pwagner
# Fixed bug in statement defining incfiles
#
# Revision 1.1  2009/06/16 22:35:53  pwagner
# First commit
#
@


1.2
log
@Fixed bug in statement defining incfiles
@
text
@d25 1
d30 5
a34 3
# (4) l2cf-formatted calibration files (like MLS-Aura_L2Cal-Tsys_v2-0-0_0000d000.l2cf)
#     are ignored (not explicitly, but because they are neither included by the
#     syntax above, nor are they found in the standard parts directory)
d47 1
a47 1
# "$Id: identl2cf.sh,v 1.1 2009/06/16 22:35:53 pwagner Exp $"
d138 8
d168 3
@


1.1
log
@First commit
@
text
@d44 1
a44 1
# "$Id: identl2cf.sh,v 1.4 2008/10/13 23:30:56 pwagner Exp $"
d132 1
a132 1
incfiles=`grep '\!include' v3-HO-238.m4 | sed -n 's/\(.*\)\!include(\(.*\.l2cf\))\(?*\)/\2/p' | sed 's/}.*//'`
d157 3
@

