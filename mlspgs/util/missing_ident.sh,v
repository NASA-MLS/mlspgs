head	1.4;
access;
symbols
	v5-02-NRT-19:1.4
	v6-00:1.4
	v5-02-NRT-18:1.4
	v5-02:1.4
	v5-01-NRT-17:1.4
	v5-01-NRT-16:1.4
	v5-01-NRT-15:1.4
	v5-01-NRT-14:1.4
	neuralnetworks-1-0:1.4.0.14
	cfm-single-freq-0-1:1.4.0.12
	v5-01:1.4
	v5-00:1.4
	v4-23-TA133:1.4.0.10
	mus-emls-1-70:1.4.0.8
	rel-1-0-englocks-work:1.4.0.6
	VUMLS1-00:1.4
	VPL1-00:1.4
	V4-22-NRT-08:1.4
	VAM1-00:1.4
	V4-21:1.4.0.4
	V4-13:1.4
	V4-12:1.4
	V4-11:1.4
	V4-10:1.4
	V3-43:1.4
	M4-00:1.4
	V3-41:1.4
	V3-40-PlusGM57:1.4.0.2
	V2-24-NRT-04:1.4
	V3-33:1.4
	V2-24:1.4
	V3-31:1.4
	V3-30-NRT-05:1.4
	cfm-01-00:1.4
	V3-30:1.4
	V3-20:1.4
	V3-10:1.4
	V2-23-NRT-02:1.4
	V2-23:1.4
	V2-22-NRT-01:1.4
	V2-22:1.4
	V2-21:1.4
	V2-20:1.4
	V2-11:1.4
	V2-10:1.4
	V2-00:1.4
	V1-51:1.3
	V1-50:1.3
	V1-45:1.3
	V1-44:1.3
	V1-43:1.3
	V1-42:1.3
	V1-41:1.3
	V1-32:1.3
	V1-40:1.3
	V1-31:1.3
	V1-30:1.3
	V1-13:1.3
	V1-12:1.3
	V1-11:1.3
	V1-10:1.2
	newfwm-feb03:1.2.0.2;
locks; strict;
comment	@# @;


1.4
date	2005.06.23.22.20.45;	author pwagner;	state Exp;
branches;
next	1.3;

1.3
date	2003.03.01.00.55.34;	author pwagner;	state Exp;
branches;
next	1.2;

1.2
date	2002.10.11.19.39.50;	author pwagner;	state Exp;
branches;
next	1.1;

1.1
date	2002.10.08.16.57.33;	author pwagner;	state Exp;
branches;
next	;


desc
@@


1.4
log
@Reworded Copyright statement
@
text
@#!/bin/sh
# missing_ident.sh

# Copyright 2005, by the California Institute of Technology. ALL
# RIGHTS RESERVED. United States Government Sponsorship acknowledged. Any
# commercial use must be negotiated with the Office of Technology Transfer
# at the California Institute of Technology.

# This software may be subject to U.S. export control laws. By accepting this
# software, the user agrees to comply with all applicable U.S. export laws and
# regulations. User has the responsibility to obtain export licenses, or other
# export authority as may be required before exporting such information to
# foreign countries or providing access to foreign persons.

# "$Id: missing_ident.sh,v 1.3 2003/03/01 00:55:34 pwagner Exp $"
# --------------- missing_ident.sh help
#Use(1) (default)
#Print list of files lacking $id and $RCS lines
#List compiled from args on command-line
#or else automatically computed to match pattern
#  *{$suffix} in supplied directory names
#
#Use(2)
#Print list of files lacking lines containing a user-supplied string
#List compiled from args on command-line
#or else automatically computed to match pattern
#  *{$suffix} in supplied directory names
#
#Use(3)
#Print list of files whose names do not appear among idents actually
#incorporated into executable
#Usage:
#missing_ident.sh [opt1 [arg1]] [opt2 [arg2]] .. [optm [argm]] [filelist]
#
#    O p t i o n s
# -d path       path of directory if automatic
# -suf suffix   file name suffix if automatic; e.g. ".f90"
# -h[elp]       print brief help message; exit
# -m string     the string, switching to use(2)
# -c            enforce case sensitivity with use (2); default is not
# -r            reverse sense of use (2); print list of files containing string
# -x executable the executable, switching to use(3)
#Notes:
#(1)If option -suf present but -d absent, will search current working directory
#(2)The options -suf and -d may be repeated; e.g.
#   missing_ident -d dir1 -d dir2 .. -suf sufx1 -suf sufx2 ..
# --------------- End missing_ident.sh help
#Another example of my regrettable tendency to bundle a number of
#different functionalities within a single multi-use file
#Isn't it cleaner to devote a single file to a single use?

#------------------------------- extant_files ------------
#
# Function to return only those files among the args
# that actually exist
# Useful when passed something like *.f which may 
# (1) expand to list of files, returned as extant_files_result, or
# (2) stay *.f, in which case a blank is returned as extant_files_result 
#     (unless you have perversely named a file '*.f')
# usage: extant_files arg1 [arg2] ..

extant_files()
{
   extant_files_result=
   # Trivial case ($# = 0)
   if [ "$1" != "" ]
   then
      for file
      do
         if [ -f "$file" ]
         then
               extant_files_result="$extant_files_result $file"
         fi
      done
   fi
}

#---------------------------- get_unique_name
#
# Function returns a unique name based on arg, PID and HOSTNAME
# e.g.,
#           temp_file_name=`get_unique_name foo`
#           echo $temp_file_name
# might print foo.colossus.21455
# if no arg, defaults to "temp" (very original name)
# if two args present, assumes second is punctuation to
# use in pace of "."

get_unique_name()
{

   # How many args?
      if [ $# -gt 1 ]
      then
        pt="$2"
        temp="$1"
      elif [ $# -gt 0 ]
      then
        pt="."
        temp="$1"
      else
        pt="."
        temp="temp"
      fi
   # Is $HOST defined?
      if [ "$HOST" != "" ]
      then
         our_host_name="$HOST"
      elif [ "$HOSTNAME" != "" ]
      then
         our_host_name="$HOSTNAME"
      else
         our_host_name="host"
      fi
    #  echo $our_host_name
   # if in form host.moon.planet.star.. extract host
      our_host_name=`echo $our_host_name | sed 's/\./,/g'`
      our_host_name=`perl -e '@@parts=split(",","$ARGV[0]"); print $parts[0]' $our_host_name`
      echo $temp${pt}$our_host_name${pt}$$
}

#------------------------------- Main Program ------------

#****************************************************************
#                                                               *
#                  * * * Main Program  * * *                    *
#                                                               *
#                                                               *
#	The entry point where control is given to the script         *
#****************************************************************
id_list=
RCS_list=
string_list=
# echo "All the args: $@@"
suffixes=""
directories=""
me="$0"
my_name=missing_ident.sh
ex_name=
string=
case_sens="no"
reverse="no"
# $the_splitter is split_path with me's path (if any) prepended
the_splitter="`echo $0 | sed 's/missing_ident/split_path/'`"
#
# Get arguments from command line
#

more_opts="yes"
while [ "$more_opts" = "yes" ] ; do
    case "$1" in
	-c )
	    case_sens="yes"
       shift
	;;
	-d )
	    directories="$directories $2"
	    shift
       shift
	;;
    -h | -help )
       sed -n '/'$my_name' help/,/End '$my_name' help/ p' $me \
           | sed -n 's/^.//p' | sed '1 d; $ d'
       exit
	;;
	-m )
	    string="$2"
	    shift
       shift
	;;
	-r )
	    reverse="yes"
       shift
	;;
	-suf )
	    suffixes="$suffixes $2"
	    shift
       shift
	;;
	-x )
	    ex_name="$2"
	    shift
       shift
	;;
	* )
       more_opts="no"
	;;
    esac
done
if [ "$string" = "" ]
then
  case_sens="none"
fi
extant_files "$@@"
arglist="$extant_files_result"
if [ "$suffixes" != "" ]
then
  # Assemble automatic list of files
  if [ "$directories" = "" ]
  then
    directories="."
  fi
  args_dir=`pwd`
  for dir in $directories
  do
    cd $dir
    for suffix in $suffixes
    do
      extant_files *"$suffix"
      if [ "$extant_files_result" != "" ]
      then
        for file in $extant_files_result
        do
          arglist="$arglist $dir/$file"
        done
      fi
    done
    cd $args_dir
  done
fi

temp1=`get_unique_name id`
temp2=`get_unique_name rcs`
if [ "$ex_name" != "" ]
then
  rm -f "$temp1"
  rm -f "$temp2"
  ident "$ex_name" | grep -i '\$id' > "$temp1"
  ident "$ex_name" | grep -i '\$rcs' > "$temp2"
  #ls -tl "$temp1" "$temp2"
fi

for file in $arglist
do
   #echo file is $file
   file_name=`$the_splitter -f $file`
   if [ "$ex_name" != "" ]
   then
     test=`grep "$file_name" "$temp1"`
   else
     test=`grep -i '\$id' $file`
   fi
   #echo "id test"
   #echo "file_name $file_name"
   #echo "test $test"
   if [ "$test" = "" ]           
   then                          
      id_list="$id_list $file"   
   fi                            
   if [ "$ex_name" != "" ]
   then
     test=`grep "$file_name" "$temp2"`
   else
     test=`grep -i '\$RCSFI' $file`
   fi
   #echo "rcs test"
   #echo "file_name $file_name"
   #echo "test $test"
   if [ "$test" = "" ]             
   then                            
      RCS_list="$RCS_list $file"   
   fi                              

   case "$case_sens" in
     yes)
       test=`grep "$string" $file`
       ;;
     no)
       test=`grep -i "$string" $file`
       ;;
     *)
       test="none"
       ;;
   esac
   #echo "string test"
   #echo "file_name $file_name"
   #echo "test $test"
   if [ "$reverse" = "yes" ]             
   then
     if [ "$test" != "" ] 
     then                          
      string_list="$string_list $file"   
     fi                              
   else                              
     if [ "$test" = "" ]             
     then                            
      string_list="$string_list $file"   
     fi                              
   fi                              
   
done
if [ "$ex_name" != "" ]   
then
  echo "These files do not appear as \$id lines in $ex_name"
  echo "$id_list"
  echo "These files do not appear as \$RCS lines in $ex_name"
  echo "$RCS_list"
  rm -f "$temp1" "$temp2"
elif [ "$string" != "" -a "$reverse" = "no" ]   
then
  echo "These files lack a line with $string"
  echo "$string_list"
elif [ "$string" != "" -a "$reverse" = "yes" ]   
then
  echo "These files contain a line with $string"
  echo "$string_list"
else                      
  echo "These files lack a \$id line"
  echo "$id_list"
  echo "These files lack a \$RCS line"
  echo "$RCS_list"
fi

exit 0
# $Log: missing_ident.sh,v $
# Revision 1.3  2003/03/01 00:55:34  pwagner
# Use (2) with user-supplied string added
#
# Revision 1.2  2002/10/11 19:39:50  pwagner
# Added use(2): print files not appearing as id/rcs lines in executable idents
#
# Revision 1.1  2002/10/08 16:57:33  pwagner
# First commit
#
@


1.3
log
@Use (2) with user-supplied string added
@
text
@d4 10
a13 2
# Copyright (c) 2003, California Institute of Technology.  ALL RIGHTS RESERVED.
# U.S. Government Sponsorship under NASA Contract NAS7-1407 is acknowledged.
d15 1
a15 1
# "$Id: missing_ident.sh,v 1.2 2002/10/11 19:39:50 pwagner Exp $"
d316 3
@


1.2
log
@Added use(2): print files not appearing as id/rcs lines in executable idents
@
text
@d4 1
a4 1
# Copyright (c) 2002, California Institute of Technology.  ALL RIGHTS RESERVED.
d7 1
a7 1
# "$Id: missing_ident.sh,v 1.1 2002/10/08 16:57:33 pwagner Exp $"
d16 6
d31 4
a34 1
# -x executable the executable, switching to use(2)
d125 1
d132 3
d144 4
d153 14
a171 5
    -h | -help )
       sed -n '/'$my_name' help/,/End '$my_name' help/ p' $me \
           | sed -n 's/^.//p' | sed '1 d; $ d'
       exit
	;;
d182 4
d227 1
a227 1
   # echo file is $file
d255 27
d291 8
d308 3
@


1.1
log
@First commit
@
text
@d7 1
a7 1
# "$Id: missing_ident.sh,v 1.6 2002/08/07 17:03:19 pwagner Exp $"
d9 1
d15 3
d25 1
d31 4
d61 44
d116 1
a116 1
echo "Who or what is $@@"
d121 3
d146 5
d183 12
d198 27
a224 10
   test=`grep -i '\$id' $file`
      if [ "$test" = "" ]
      then
         id_list="$id_list $file"
      fi
   test=`grep -i '\$RCSFI' $file`
      if [ "$test" = "" ]
      then
         RCS_list="$RCS_list $file"
      fi
d227 13
a239 4
echo "These files lack a \$id line"
echo "$id_list"
echo "These files lack a \$RCS line"
echo "$RCS_list"
d243 3
@

