head	1.30;
access;
symbols
	v5-02-NRT-19:1.30
	v6-00:1.30
	v5-02-NRT-18:1.30
	v5-02:1.30
	v5-01-NRT-17:1.30
	v5-01-NRT-16:1.30
	v5-01-NRT-15:1.30
	v5-01-NRT-14:1.30
	neuralnetworks-1-0:1.30.0.10
	cfm-single-freq-0-1:1.30.0.8
	v5-01:1.30
	v5-00:1.30
	v4-23-TA133:1.30.0.6
	mus-emls-1-70:1.30.0.4
	rel-1-0-englocks-work:1.30.0.2
	VUMLS1-00:1.26
	VPL1-00:1.25
	V4-22-NRT-08:1.24
	VAM1-00:1.23
	V4-21:1.21.0.2
	V4-13:1.21
	V4-12:1.21
	V4-11:1.21
	V4-10:1.21
	V3-43:1.17
	M4-00:1.19
	V3-41:1.17
	V3-40-PlusGM57:1.17.0.2
	V2-24-NRT-04:1.13
	V3-33:1.18
	V2-24:1.12
	V3-31:1.18
	V3-30-NRT-05:1.17
	cfm-01-00:1.17
	V3-30:1.17
	V3-20:1.17
	V3-10:1.16
	V2-23-NRT-02:1.13
	V2-23:1.12
	V2-22-NRT-01:1.13
	V2-22:1.12
	V2-21:1.8
	V2-20:1.8
	V2-11:1.8
	V2-10:1.8
	V2-00:1.8
	V1-51:1.3
	V1-50:1.3
	V1-45:1.3
	V1-44:1.3;
locks; strict;
comment	@# @;


1.30
date	2018.03.22.18.21.38;	author pwagner;	state Exp;
branches;
next	1.29;

1.29
date	2017.12.14.23.17.06;	author pwagner;	state Exp;
branches;
next	1.28;

1.28
date	2017.10.12.20.27.44;	author pwagner;	state Exp;
branches;
next	1.27;

1.27
date	2017.05.13.00.04.09;	author pwagner;	state Exp;
branches;
next	1.26;

1.26
date	2016.09.09.20.38.27;	author pwagner;	state Exp;
branches;
next	1.25;

1.25
date	2016.08.09.22.45.26;	author pwagner;	state Exp;
branches;
next	1.24;

1.24
date	2016.03.23.16.38.51;	author pwagner;	state Exp;
branches;
next	1.23;

1.23
date	2015.07.01.18.10.18;	author pwagner;	state Exp;
branches;
next	1.22;

1.22
date	2015.06.30.18.52.02;	author pwagner;	state Exp;
branches;
next	1.21;

1.21
date	2014.01.09.00.31.26;	author pwagner;	state Exp;
branches;
next	1.20;

1.20
date	2013.08.23.02.51.48;	author vsnyder;	state Exp;
branches;
next	1.19;

1.19
date	2012.02.13.23.42.42;	author pwagner;	state Exp;
branches;
next	1.18;

1.18
date	2010.11.17.01.26.44;	author pwagner;	state Exp;
branches;
next	1.17;

1.17
date	2009.09.11.23.24.47;	author pwagner;	state Exp;
branches;
next	1.16;

1.16
date	2009.06.16.22.37.59;	author pwagner;	state Exp;
branches;
next	1.15;

1.15
date	2008.09.25.23.11.54;	author pwagner;	state Exp;
branches;
next	1.14;

1.14
date	2008.04.10.20.23.03;	author pwagner;	state Exp;
branches;
next	1.13;

1.13
date	2007.11.28.18.59.58;	author pwagner;	state Exp;
branches;
next	1.12;

1.12
date	2007.10.12.23.37.31;	author pwagner;	state Exp;
branches;
next	1.11;

1.11
date	2007.06.27.19.30.59;	author pwagner;	state Exp;
branches;
next	1.10;

1.10
date	2007.06.14.21.48.41;	author pwagner;	state Exp;
branches;
next	1.9;

1.9
date	2007.02.27.00.05.33;	author pwagner;	state Exp;
branches;
next	1.8;

1.8
date	2006.03.15.19.18.37;	author pwagner;	state Exp;
branches;
next	1.7;

1.7
date	2006.01.14.00.59.12;	author pwagner;	state Exp;
branches;
next	1.6;

1.6
date	2005.09.23.21.01.13;	author pwagner;	state Exp;
branches;
next	1.5;

1.5
date	2005.08.19.23.41.08;	author pwagner;	state Exp;
branches;
next	1.4;

1.4
date	2005.06.22.19.27.33;	author pwagner;	state Exp;
branches;
next	1.3;

1.3
date	2004.08.07.00.15.55;	author pwagner;	state Exp;
branches;
next	1.2;

1.2
date	2004.07.22.17.10.46;	author pwagner;	state Exp;
branches;
next	1.1;

1.1
date	2004.06.16.17.55.06;	author pwagner;	state Exp;
branches;
next	;


desc
@@


1.30
log
@Added commandline option -crash to help catch errors
@
text
@! Copyright 2005, by the California Institute of Technology. ALL
! RIGHTS RESERVED. United States Government Sponsorship acknowledged. Any
! commercial use must be negotiated with the Office of Technology Transfer
! at the California Institute of Technology.

! This software may be subject to U.S. export control laws. By accepting this
! software, the user agrees to comply with all applicable U.S. export laws and
! regulations. User has the responsibility to obtain export licenses, or other
! export authority as may be required before exporting such information to
! foreign countries or providing access to foreign persons.

!=================================
program l2gpdiff ! show diffs between swaths in two different files
!=================================

   use Dump_Options, only: DumpDumpOptions, DumpTableSide, &
     & PrintNameAtLineEnd, StatsOnOneLine, RmsFormat
   use HighOutput, only: OutputNamedValue
   use Io_Stuff, only: Get_Lun
   use L2GPData, only: Diff, MaxSwathNamesBufSize
   use Machine, only: Hp, Getarg, NeverCrash
   use MLSFiles, only: MLS_Exists, HDFVersion_5, MLS_InqSwath
   use MLSHDF5, only: MLS_H5Open, MLS_H5Close
   use MLSMessageModule, only: MLSMessageConfig, MLSMessage, MLSMSG_Error
   use MLSStringLists, only: CatLists, ExpandStringRange
   use MLSStrings, only: LowerCase, WriteIntsToChars
   use Output_M, only: ResumeOutput, SuspendOutput, Output
   use PrintIt_M, only: Set_Config
   use Time_M, only: Time_Now, Time_Config
   
   implicit none

!---------------------------- RCS Ident Info ------------------------------
  character (len=*), parameter :: ModuleName= &
       "$RCSfile: l2gpdiff.f90,v $"
  character (len=*), parameter :: IdParm = &
       "$Id: l2gpdiff.f90,v 1.29 2017/12/14 23:17:06 pwagner Exp $"
  character (len=len(idParm)) :: Id = idParm
!---------------------------------------------------------------------------

  integer, parameter ::          MAXFIELDSLENGTH = 256
  type Options_T
    character(len=MAXFIELDSLENGTH) :: chunks = '*' ! wild card means 'all'
    character(len=MAXFIELDSLENGTH) :: pressures = '*' ! wild card means 'all'
    character(len=255) ::  geoBoxNames = '' ! which geolocation names to box
    character(len=MAXFIELDSLENGTH) :: fields = '*' ! wild card means 'all'
    character(len=8) :: HEADSIDE = 'left' ! on which side stats headers printed
    character(len=MAXSWATHNAMESBUFSIZE) :: swaths1 = '*'
    character(len=MAXSWATHNAMESBUFSIZE) :: swaths2 = '*'
    character(len=80) :: dumpOptions       = ' '
    integer            ::  nGeoBoxDims     = 0
    real, dimension(4) ::  geoBoxLowBound
    real, dimension(4) ::  geoBoxHiBound
    integer     ::         Details         = 1
    logical     ::         force           = .false.
    logical     ::         AuBrick         = .false.
    logical     ::         rms             = .false.
    logical     ::         stats           = .false.
    logical     ::         table           = .false.
    logical     ::         silent          = .false.
    logical     ::         timing          = .false.
    logical     ::         verbose         = .false.
    logical     ::         debug           = .false.
    logical     ::         matchTimes      = .false.
    logical     ::         showMissing     = .false.
    logical     ::         ignoreBadChunks = .false.
    integer     ::         numDiffs = 0
  end type Options_T
  
  type ( Options_T ) :: options

  integer, parameter                      :: MAXFILES = 100
  integer, parameter                      :: MAXNCHUNKS = 50

  integer, dimension(MAXNCHUNKS)          :: chunks
  ! character(len=8)                        :: dumpOptions
  character(len=255)                      :: filename          ! input filename
  character(len=255), dimension(MAXFILES) :: filenames
  integer                                 :: i, error ! Counting indices & Error flags
  integer                                 :: listSize
  integer                                 :: nChunks
  integer                                 :: n_filenames
  integer                                 :: nPressures
  integer                                 :: numDiffs
  integer                                 :: NUMSWATHSPERFILE
  real, dimension(MAXNCHUNKS)             :: pressures
  character(len=16)                       :: string
  character(len=MAXSWATHNAMESBUFSIZE)     :: swathList1
  real                                    :: t1
  real                                    :: t2
  real                                    :: tFile
  logical, parameter                      :: USEALLINPUTSWATHS = .true.
  ! 
  call set_config ( useToolkit = .false., logFileUnit = -1 )
  time_config%use_wall_clock = .true.
  CALL mls_h5open(error)
  statsOnOneLine = .false.
  ! PrintNameAtLineEnd = .true.
  n_filenames = 0
  do      ! Loop over filenames, options
     call get_filename(filename, options)
     if ( filename(1:1) == '-' ) cycle
     if ( filename == ' ' ) exit
     if ( mls_exists(trim(filename)) /= 0 ) then
       print *, 'Sorry--file not found: ', trim(filename)
       cycle
     endif
     n_filenames = n_filenames + 1
     filenames(n_filenames) = filename
  enddo
  dumpTableSide = options%headSide ! 'left'
  if ( options%debug ) call dumpProgramOptions
  if ( n_filenames < 2 ) then
    if ( options%verbose ) print *, 'Sorry -- need at least 2 input files to diff'
    stop
  elseif ( options%verbose .and. options%silent ) then
    print *, 'Sorry--either verbose or silent; cant be both'
    stop
  endif
  if ( USEALLINPUTSWATHS ) then
    NUMSWATHSPERFILE = mls_InqSwath ( trim(filenames(1)), &
      & swathList1, listSize, hdfVersion=HDFVERSION_5)
    if ( NUMSWATHSPERFILE < 1 ) then
      print *, ' NUMSWATHSPERFILE: ', NUMSWATHSPERFILE
      print *, ' file1: ', trim(filenames(1))
      print *, ' swathList1: ', trim(swathList1)
      print *, ' listSize: ', listSize
      stop
    endif
  else
    NUMSWATHSPERFILE = 2
    swathList1 = ''
  endif
  rmsFormat = '(1pe8.1)'
  if ( options%silent ) call suspendOutput
  ! dumpOptions = '-'
  if ( options%ignoreBadChunks ) options%dumpOptions = trim(options%dumpOptions) // 'i'
  if ( options%silent ) options%dumpOptions = trim(options%dumpOptions) // 'm'
  if ( options%rms ) options%dumpOptions = trim(options%dumpOptions) // 'r'
  if ( options%stats ) options%dumpOptions = trim(options%dumpOptions) // 's'
  if ( options%table ) options%dumpOptions = trim(options%dumpOptions) // 'b'
  if ( options%AuBrick ) options%dumpOptions = trim(options%dumpOptions) // '@@'
  if ( options%verbose ) options%dumpOptions = trim(options%dumpOptions) // 'v'
  call time_now ( t1 )
  ! print *, 'dumpOptions: ', trim(options%dumpOptions)
  do i = 2, n_filenames, 2
    call time_now ( tFile )
    if ( options%verbose ) then
      print *, 'diff (1): ', trim(filenames(i-1))
      print *, '     (2): ', trim(filenames(i))
    endif
    if ( options%nGeoBoxDims > 0 ) then
      call diff( trim(filenames(i-1)), trim(filenames(i)), &
      & options%geoBoxNames, options%geoBoxLowBound, options%geoBoxHiBound, &
      & details=options%Details, &
      & showMissing=options%showMissing, fields=options%fields, &
      & force=options%force, swaths1=options%swaths1, swaths2=options%swaths2, &
      & matchTimes=options%matchTimes, &
      & numDiffs=numDiffs, &
      & options=options%dumpOptions )
    elseif ( options%chunks == '*' .and. options%pressures == '*' ) then
      if ( options%debug ) call output( 'Standard diff', advance='yes' )
      call diff( trim(filenames(i-1)), trim(filenames(i)), &
      & details=options%Details, &
      & showMissing=options%showMissing, fields=options%fields, &
      & force=options%force, swaths1=options%swaths1, swaths2=options%swaths2, &
      & matchTimes=options%matchTimes, &
      & numDiffs=numDiffs, &
      & options=options%dumpOptions )
    elseif ( options%pressures == '*' ) then
      call ExpandStringRange(options%chunks, chunks, nchunks)
      if ( nchunks < 1 ) cycle
      call diff( trim(filenames(i-1)), trim(filenames(i)), &
      & chunks=chunks(1:nchunks), &
      & details=options%Details, &
      & showMissing=options%showMissing, fields=options%fields, &
      & force=options%force, swaths1=options%swaths1, swaths2=options%swaths2, &
      & matchTimes=options%matchTimes, &
      & numDiffs=numDiffs, &
      & options=options%dumpOptions )
    elseif ( options%chunks == '*' ) then
      call ExpandStringRange(options%pressures, pressures, npressures)
      if ( npressures < 1 ) cycle
      call diff( trim(filenames(i-1)), trim(filenames(i)), &
      & pressures=pressures(1:nPressures), &
      & details=options%Details, &
      & showMissing=options%showMissing, fields=options%fields, &
      & force=options%force, swaths1=options%swaths1, swaths2=options%swaths2, &
      & matchTimes=options%matchTimes, &
      & numDiffs=numDiffs, &
      & options=options%dumpOptions )
    else
      call ExpandStringRange(options%chunks, chunks, nchunks)
      if ( nchunks < 1 ) cycle
      call ExpandStringRange(options%pressures, pressures, npressures)
      if ( npressures < 1 ) cycle
      call diff( trim(filenames(i-1)), trim(filenames(i)), &
      & pressures=pressures(1:nPressures), chunks=chunks(1:nchunks), &
      & details=options%Details, &
      & showMissing=options%showMissing, fields=options%fields, &
      & force=options%force, swaths1=options%swaths1, swaths2=options%swaths2, &
      & matchTimes=options%matchTimes, &
      & numDiffs=numDiffs, &
      & options=options%dumpOptions )
    endif
    options%numDiffs = options%numDiffs + numDiffs
    if ( options%timing ) call sayTime('diff these files: ' // trim(filenames(i-1)) // &
      & ' and ' // trim(filenames(i)), tFile)
  enddo
  if ( options%timing ) call sayTime('diffing all files')
  call resumeOutput
  if ( options%silent .and. options%numDiffs > 0 ) then
    call WriteIntsToChars ( options%numDiffs, string )
    call print_string(string)
  endif
  call mls_h5close(error)
contains
!------------------------- get_filenames ---------------------
    subroutine get_filename( filename, options )
    ! Added for command-line processing
     character(len=255), intent(out)   :: filename
     type ( Options_T ), intent(inout) :: options
     ! Local variables
     integer ::                         error = 1
     integer, save ::                   i = 1
     character(LEN=160)              :: Chars
  ! Get inputfile name, process command-line args
  ! (which always start with -)
    do
      call getarg ( i+hp, filename )
      ! print *, i, ' th Arg: ', trim(filename)
      error = 0
      if ( filename(1:1) /= '-' ) exit
      if ( filename(1:3) == '-h ' ) then
        call print_help
      else if ( filename(1:6) == '-chunk' ) then
        call getarg ( i+1+hp, options%chunks )
        i = i + 1
        exit
      elseif ( filename(1:6) == '-crash' ) then
        MLSMessageConfig%crashOnAnyError = .true.
        neverCrash = .false.
        exit
      elseif ( filename(1:6) == '-force' ) then
        options%force = .true.
        exit
      else if ( filename(1:4) == '-geo' ) then
        call getarg ( i+1+hp, Chars )
        options%geoBoxNames = catLists( options%geoBoxNames, Chars )
        i = i + 1
        options%nGeoBoxDims = min( options%nGeoBoxDims + 1, 4 )
        call getarg ( i+1+hp, Chars )
        read( Chars, * ) options%geoBoxLowBound(options%nGeoBoxDims), &
          & options%geoBoxHiBound(options%nGeoBoxDims)
        i = i + 1
        exit
      else if ( filename(1:6) == '-press' ) then
        call getarg ( i+1+hp, options%pressures )
        i = i + 1
        exit
      elseif ( filename(1:8) == '-silent ' ) then
        options%silent = .true.
        exit
      elseif ( filename(1:3) == '-v ' ) then
        options%verbose = .true.
        exit
      elseif ( filename(1:4) == '-one' ) then
        statsOnOneLine = .true.
        exit
      else if ( filename(1:6) == '-field' ) then
        call getarg ( i+1+hp, options%fields )
        i = i + 1
        exit
      else if ( filename(1:3) == '-f ' ) then
        call getarg ( i+1+hp, filename )
        i = i + 1
        exit
      else if ( filename(1:3) == '-D ' ) then
        call getarg ( i+1+hp, Chars )
        read(Chars, *) options%Details
        i = i + 1
        exit
      else if ( filename(1:3) == '-d ' ) then
        call getarg ( i+1+hp, options%dumpOptions )
        if ( index( options%dumpOptions, '?' ) > 0 ) then
          call DumpDumpOptions( "?" )
          stop
        endif
        i = i + 1
        exit
      else if ( filename(1:4) == '-deb' ) then
        options%debug = .true.
        exit
      else if ( filename(1:4) == '-ign' ) then
        options%ignorebadchunks = .true.
        exit
      else if ( filename(1:4) == '-mat' ) then
        options%matchTimes = .true.
        exit
      else if ( lowercase(filename(1:3)) == '-au' ) then
        options%AuBrick = .true.
        exit
      else if ( filename(1:5) == '-rms ' ) then
        options%rms = .true.
        exit
      else if ( filename(1:5) == '-side' ) then
        call getarg ( i+1+hp, options%headSide )
        i = i + 1
        exit
      else if ( filename(1:3) == '-s ' ) then
        options%stats = .true.
        exit
      else if ( filename(1:3) == '-S1' ) then
        call getarg ( i+1+hp, Chars )
        call read_swath_names ( Chars, options%swaths1 )
        i = i + 1
        exit
      else if ( filename(1:3) == '-S2' ) then
        call getarg ( i+1+hp, Chars )
        call read_swath_names ( Chars, options%swaths2 )
        i = i + 1
        exit
      else if ( filename(1:3) == '-s1' ) then
        call getarg ( i+1+hp, options%swaths1 )
        i = i + 1
        exit
      else if ( filename(1:3) == '-s2' ) then
        call getarg ( i+1+hp, options%swaths2 )
        i = i + 1
        exit
      else if ( filename(1:2) == '-t' ) then
        options%table = .true.
        exit
      else if ( filename(1:6) == '-miss ' ) then
        options%showMissing = .true.
        exit
      else
        call print_help
      end if
      i = i + 1
    end do
    if ( error /= 0 ) then
      call print_help
    endif
    i = i + 1
    
  end subroutine get_filename
!------------------------- dumpProgramOptions ---------------------
  subroutine dumpProgramOptions
    ! dump options
    call outputNamedValue( 'chunks', trim(options%chunks)             )
    call outputNamedValue( 'pressures', trim(options%pressures)       )
    call outputNamedValue( 'geoBoxNames', trim(options%geoBoxNames)   )
    call outputNamedValue( 'fields', trim(options%fields)             )
    call outputNamedValue( 'headSide', trim(options%headSide)         )
    call outputNamedValue( 'swaths1', trim(options%swaths1)           )
    call outputNamedValue( 'swaths2', trim(options%swaths2)           )
    call outputNamedValue( 'nGeoBoxDims    ', options%nGeoBoxDims     )
    call outputNamedValue( 'geoBoxLowBound ', options%geoBoxLowBound  )
    call outputNamedValue( 'geoBoxHiBound  ', options%geoBoxHiBound   )
    call outputNamedValue( 'AuBrick        ', options%AuBrick         )
    call outputNamedValue( 'Details        ', options%Details         )
    call outputNamedValue( 'dumpOptions    ', options%dumpOptions     )
    call outputNamedValue( 'force          ', options%force           )
    call outputNamedValue( 'rms            ', options%rms             )
    call outputNamedValue( 'stats          ', options%stats           )
    call outputNamedValue( 'table          ', options%table           )
    call outputNamedValue( 'silent         ', options%silent          )
    call outputNamedValue( 'timing         ', options%timing          )
    call outputNamedValue( 'verbose        ', options%verbose         )
    call outputNamedValue( 'debug          ', options%debug           )
    call outputNamedValue( 'matchTimes     ', options%matchTimes      )
    call outputNamedValue( 'showMissing    ', options%showMissing     )
    call outputNamedValue( 'ignoreBadChunks', options%ignoreBadChunks )
  end subroutine dumpProgramOptions
!------------------------- print_help ---------------------
  subroutine print_help
  ! Print brief but helpful message
    write (*,*) &
    & 'Usage:l2gpdiff [options] [filenames]'
    write (*,*) &
    & ' diffs swaths between paired l2gp files [2k] and [2k - 1]'
    write (*,*) &
    & ' each file contains one or more swaths, each swath many named fields'
    write (*,*) &
    & ' optionally restrict diffs to certain fields, chunks, etc.'
    write (*,*) 'Options: -f filename => add filename to list of filenames'
    write (*,*) '                 (can do the same w/o the -f)'
    write (*,*) '  -chunks "c1,c2,.."'
    write (*,*) '              =>   diff only chunks c1, c2,..'
    write (*,*) '  -fields "f1,f2,.."'
    write (*,*) '              =>   diff only fields f1, f2,..'
    write (*,*) '  -geo name lo,hi  '
    write (*,*) '              => diff only geobox low <= geo <= hi'
    write (*,*) '                 where geo is one of'
    write (*,*) '                  {latitude, longitude, time, pressure}'
    write (*,*) '                 (may be repeated)'
    write (*,*) '                 if hi < lo then dump is outside geobox'
    write (*,*) '  -pressures "p1,p2,.."'
    write (*,*) '              =>   diff only at pressures p1,p2,..'
    write (*,*) '  -D details  => level of details to show'
    write (*,*) '  -d options  => pass options to dump routines'
    write (*,*) '                 e.g., "?" to list available ones'
    write (*,*) '  -force      => force diff even if swath names differ'
    write (*,*) '  -s1 "swath1,swath2,.."'
    write (*,*) '              =>   diff only swath1,swath2,..'
    write (*,*) '  -s2 "swath1,swath2,.."'
    write (*,*) '              =>   diff only swath1,swath2,..'
    write (*,*) '                   from even-numbered files in list'
    write (*,*) '  -S1 filename'
    write (*,*) '              => read -s1 swath names from filename'
    write (*,*) '  -S2 filename'
    write (*,*) '              => read -s2 swath names from filename'
    write (*,*) '  -v          => switch on verbose mode'
    write (*,*) '  -silent     => switch on silent mode'
    write (*,*) '                    (printing only if diffs found)'
    write (*,*) '  -crash      => crash with walkback on any error'
    write (*,*) '  -debug      => dump options, etc.'
    write (*,*) '  -ignore     => ignore bad chunks'
    write (*,*) '  -matchTimes => only matching profile times'
    write (*,*) '  -au         => format like goldbrick'
    write (*,*) '  -rms        => just print mean, rms'
    write (*,*) '  -s          => just show number of differences'
    write (*,*) '  -one        => print name on each line (dont)'
    write (*,*) '  -side "s"   => print stat headers on one of'
    write (*,*) '                  {"top", "left", "right", "bottom"}'
    write (*,*) '  -t[able]    => table of % vs. amount of differences (pdf)'
    write (*,*) '  -miss       => just show which swaths are missing'
    write (*,*) '  -h          => print brief help'
    write (*,*) '(Notes)'
    write (*,*) '(1) The -D and -fields options should be mutually exclusive'
    write (*,*) '(2) -s1 lets you pick out which swaths to diff'
    write (*,*) '(3) -s2 along with -force diffs swaths despite different names'
    write (*,*) '(4) the list of chunks may include the range operator "-"'
    stop
  end subroutine print_help

!------------------------- print_string ---------------------
  subroutine print_string(string)
    character(len=*), intent(in) :: string
    write(*,'(a)') trim(string)
  end subroutine print_string

!------------------------- read_swath_names ---------------------
  subroutine read_swath_names( filename, swathnames )
    character(len=*), intent(in)    :: filename
    character(len=*), intent(out)   :: swathnames
    !
    character(len=len(swathnames))  :: line
    integer                         :: lun
    integer                         :: stat
    !
    swathnames = ' '
      ! Find a free logical unit number
      call get_lun( lun, msg=.false. )
      if ( lun < 0 ) call MLSMessage ( MLSMSG_Error, moduleName, &
        & "No logical unit numbers available" )
      open ( unit=lun, file=filename,&
        & status='old', form='formatted', &
        & access='sequential', iostat=stat )
      if ( stat /= 0 ) call MLSMessage ( MLSMSG_Error, moduleName, &
        & "Unable to open swaths file " // filename )
      do
        read ( unit=lun, fmt=*, iostat=stat ) line
        if ( stat < 0 ) exit
        if ( line(1:1) /= '#' ) swathnames = trim(swathnames) // ',' // trim(line)
      enddo
      ! Crude hackery-quackery coming right up
      if ( swathnames(1:1) == ',' ) swathnames = swathnames(2:)

  end subroutine read_swath_names

!------------------------- SayTime ---------------------
  subroutine SayTime ( What, startTime )
    character(len=*), intent(in) :: What
    real, intent(in), optional :: startTime
    real :: myt1
    if ( present(startTime) ) then
      myt1 = startTime
    else
      myt1 = t1
    endif
    call time_now ( t2 )
    call output ( "Timing for " // what // " = " )
    call output ( dble(t2 - myt1), advance = 'yes' )
  end subroutine SayTime

!==================
end program l2gpdiff
!==================

! $Log: l2gpdiff.f90,v $
! Revision 1.29  2017/12/14 23:17:06  pwagner
! Fixed syntax error in help screen
!
! Revision 1.28  2017/10/12 20:27:44  pwagner
! Monkeyed with appearance of help page; removed outdated build notes
!
! Revision 1.27  2017/05/13 00:04:09  pwagner
! Added -S1 and -S2 cmdline options
!
! Revision 1.26  2016/09/09 20:38:27  pwagner
! Added Au (Gold) brick option removing some hay from the stack of statistics
!
! Revision 1.25  2016/08/09 22:45:26  pwagner
! Consistent with splitting of Dunp_0
!
! Revision 1.24  2016/03/23 16:38:51  pwagner
! Added -one commandline option
!
! Revision 1.23  2015/07/01 18:10:18  pwagner
! Stray print statement caused headaches for gold brick
!
! Revision 1.22  2015/06/30 18:52:02  pwagner
! -d '?' now dumps available dump otions
!
! Revision 1.21  2014/01/09 00:31:26  pwagner
! Some procedures formerly in output_m now got from highOutput
!
! Revision 1.20  2013/08/23 02:51:48  vsnyder
! Move PrintItOut to PrintIt_m
!
! Revision 1.19  2012/02/13 23:42:42  pwagner
! -d opts passes opts to underlying dump routines
!
! Revision 1.18  2010/11/17 01:26:44  pwagner
! debug option dumps commandline options
!
! Revision 1.17  2009/09/11 23:24:47  pwagner
! options now include -t to be consistent with diff apis
!
! Revision 1.16  2009/06/16 22:37:59  pwagner
! Changed api for dump, diff routines; now rely on options for most optional behavior
!
! Revision 1.15  2008/09/25 23:11:54  pwagner
! May confine diffs to a geolocation box
!
! Revision 1.14  2008/04/10 20:23:03  pwagner
! Less voluminous output
!
! Revision 1.13  2007/11/28 18:59:58  pwagner
! May choose where to print stat headers
!
! Revision 1.12  2007/10/12 23:37:31  pwagner
! Removed much unused stuff
!
! Revision 1.11  2007/06/27 19:30:59  pwagner
! -pressures option added
!
! Revision 1.10  2007/06/14 21:48:41  pwagner
! Overrides default rmsFormat
!
! Revision 1.9  2007/02/27 00:05:33  pwagner
! -matchTimes option diffs only profiles with matching times
!
! Revision 1.8  2006/03/15 19:18:37  pwagner
! Passes verbose option to L2GPData/diff
!
! Revision 1.7  2006/01/14 00:59:12  pwagner
! Added -silent, -chunks options
!
! Revision 1.6  2005/09/23 21:01:13  pwagner
! use_wall_clock now a component of time_config
!
! Revision 1.5  2005/08/19 23:41:08  pwagner
! May specify fields, swaths
!
! Revision 1.4  2005/06/22 19:27:33  pwagner
! Reworded Copyright statement, moved rcs id
!
! Revision 1.3  2004/08/07 00:15:55  pwagner
! All stringlist stuff was moved from mlsstrings to mlsstringlists
!
! Revision 1.2  2004/07/22 17:10:46  pwagner
! Added -ignore and -rms options
!
! Revision 1.1  2004/06/16 17:55:06  pwagner
! First commit
!
@


1.29
log
@Fixed syntax error in help screen
@
text
@d21 1
a21 1
   use Machine, only: Hp, Getarg
d24 1
a24 1
   use MLSMessageModule, only: MLSMessage, MLSMSG_Error
d37 1
a37 1
       "$Id: l2gpdiff.f90,v 1.28 2017/10/12 20:27:44 pwagner Exp $"
d240 4
d417 1
d493 3
@


1.28
log
@Monkeyed with appearance of help page; removed outdated build notes
@
text
@d37 1
a37 1
       "$Id: l2gpdiff.f90,v 1.27 2017/05/13 00:04:09 pwagner Exp $"
d391 1
a391 1
    write (*,*) '                 where geo is one of''
d488 3
@


1.27
log
@Added -S1 and -S2 cmdline options
@
text
@d17 1
a17 1
     & StatsOnOneLine, RmsFormat
d37 1
a37 1
       "$Id: l2gpdiff.f90,v 1.26 2016/09/09 20:38:27 pwagner Exp $"
a40 7
! To use this, copy it into
! mlspgs/tests/lib
! then enter "make depends" followed by "make"


! Then run it
! LF95.Linux/test [options] [input files]
d42 1
a42 1
  type options_T
d68 1
a68 1
  end type options_T
d70 1
a70 1
  type ( options_T ) :: options
d98 1
d221 2
a222 2
     character(LEN=255), intent(out) :: filename          ! filename
     type ( options_T ), intent(inout) :: options
d347 7
a353 7
    call outputNamedValue( 'chunks', trim(options%chunks) )
    call outputNamedValue( 'pressures', trim(options%pressures) )
    call outputNamedValue( 'geoBoxNames', trim(options%geoBoxNames) )
    call outputNamedValue( 'fields', trim(options%fields) )
    call outputNamedValue( 'headSide', trim(options%headSide) )
    call outputNamedValue( 'swaths1', trim(options%swaths1) )
    call outputNamedValue( 'swaths2', trim(options%swaths2) )
d375 56
a430 55
      write (*,*) &
      & 'Usage:l2gpdiff [options] [filenames]'
      write (*,*) &
      & ' diffs swaths between paired l2gp files [2k] and [2k - 1]'
      write (*,*) &
      & ' each file contains one or more swaths, each swath many named fields'
      write (*,*) &
      & ' optionally restrict diffs to certain fields, chunks, etc.'
      write (*,*) ' Options: -f filename => add filename to list of filenames'
      write (*,*) '                  (can do the same w/o the -f)'
      write (*,*) '   -chunks "c1,c2,.."'
      write (*,*) '               =>   diff only chunks c1, c2,..'
      write (*,*) '   -fields "f1,f2,.."'
      write (*,*) '               =>   diff only fields f1, f2,..'
      write (*,*) '   -geo name lo,hi  '
      write (*,*) '               => diff only geobox low <= geo <= hi'
      write (*,*) '               where geo in {latitude, longitude, time, pressure}'
      write (*,*) '               (may be repeated)'
      write (*,*) '               if hi < lo then dump is outside geobox'
      write (*,*) '   -pressures "p1,p2,.."'
      write (*,*) '               =>   diff only at pressures p1,p2,..'
      write (*,*) '   -D details  => level of details to show'
      write (*,*) '   -d options  => pass options to dump routines'
      write (*,*) '                  e.g., "?" to list available ones'
      write (*,*) '   -force      => force diff even if swath names differ'
      write (*,*) '   -s1 "swath1,swath2,.."'
      write (*,*) '               =>   diff only swath1,swath2,..'
      write (*,*) '   -s2 "swath1,swath2,.."'
      write (*,*) '               =>   diff only swath1,swath2,..'
      write (*,*) '                    from even-numbered files in list'
      write (*,*) '   -S1 filename'
      write (*,*) '               => read -s1 swath names from filename'
      write (*,*) '   -S2 filename'
      write (*,*) '               => read -s2 swath names from filename'
      write (*,*) '   -v          => switch on verbose mode'
      write (*,*) '   -silent     => switch on silent mode'
      write (*,*) '                     (printing only if diffs found)'
      write (*,*) '   -debug      => dump options, etc.'
      write (*,*) '   -ignore     => ignore bad chunks'
      write (*,*) '   -matchTimes => only matching profile times'
      write (*,*) '   -au         => format like goldbrick'
      write (*,*) '   -rms        => just print mean, rms'
      write (*,*) '   -s          => just show number of differences'
      write (*,*) '   -one        => print name on each line (dont)'
      write (*,*) '   -side "s"   => print stat headers on one of'
      write (*,*) '                   {"top", "left", "right", "bottom"}'
      write (*,*) '   -t[able]    => table of % vs. amount of differences (pdf)'
      write (*,*) '   -miss       => just show which swaths are missing'
      write (*,*) '   -h          => print brief help'
      write (*,*) ' (Notes)'
      write (*,*) ' (1) The -D and -fields options should be mutually exclusive'
      write (*,*) ' (2) -s1 lets you pick out which swaths to diff'
      write (*,*) ' (3) -s2 along with -force diffs swaths despite different names'
      write (*,*) ' (4) the list of chunks may include the range operator "-"'
      stop
d488 3
@


1.26
log
@Added Au (Gold) brick option removing some hay from the stack of statistics
@
text
@d16 6
a21 5
   use Dump_Options, only: dumpDumpOptions, dumpTableSide, &
     & StatsOnOneLine, rmsFormat
   use HighOutput, only: outputNamedValue
   use L2GPData, only: Diff, maxSwathNamesBufSize
   use Machine, only: hp, getarg
d24 2
a25 1
   use MLSStringLists, only: catLists, ExpandStringRange
d27 3
a29 3
   use Output_m, only: resumeOutput, suspendOutput, output
   use PrintIt_m, only: Set_Config
   use Time_M, only: Time_Now, time_config
d37 1
a37 1
       "$Id: l2gpdiff.f90,v 1.25 2016/08/09 22:45:26 pwagner Exp $"
d225 1
a225 1
    subroutine get_filename(filename, options)
d315 10
d411 4
d416 1
a416 1
      write (*,*) '   -silent         => switch on silent mode'
d444 29
d493 3
@


1.25
log
@Consistent with splitting of Dunp_0
@
text
@d17 1
a17 1
     & statsOnOneLine, rmsFormat
d21 1
a21 1
   use MLSFiles, only: mls_exists, HDFVersion_5, MLS_InqSwath
d24 1
a24 1
   use MLSStrings, only: WriteIntsToChars
d35 1
a35 1
       "$Id: l2gpdiff.f90,v 1.24 2016/03/23 16:38:51 pwagner Exp $"
d61 1
d146 1
d300 3
d351 1
d405 1
d448 3
@


1.24
log
@Added -one commandline option
@
text
@d16 2
a17 1
   use Dump_0, only: dumpDumpOptions, dumpTableSide, statsOnOneLine, rmsFormat
d21 1
a21 1
   use MLSFiles, only: mls_exists, HDFVERSION_5, MLS_INQSWATH
d35 1
a35 1
       "$Id: l2gpdiff.f90,v 1.23 2015/07/01 18:10:18 pwagner Exp $"
d441 3
@


1.23
log
@Stray print statement caused headaches for gold brick
@
text
@d16 1
a16 1
   use Dump_0, only: dumpDumpOptions, dumpTableSide, rmsFormat
d34 1
a34 1
       "$Id: l2gpdiff.f90,v 1.22 2015/06/30 18:52:02 pwagner Exp $"
d100 1
d264 3
d400 1
d440 3
@


1.22
log
@-d '?' now dumps available dump otions
@
text
@d34 1
a34 1
       "$Id: l2gpdiff.f90,v 1.21 2014/01/09 00:31:26 pwagner Exp $"
d145 1
a145 1
  print *, 'dumpOptions: ', trim(options%dumpOptions)
d435 3
@


1.21
log
@Some procedures formerly in output_m now got from highOutput
@
text
@d16 4
a19 4
   use dump_0, only: dumpTableSide, rmsFormat
   use HIGHOUTPUT, only: OUTPUTNAMEDVALUE
   use L2GPData, only: Diff, MAXSWATHNAMESBUFSIZE
   use MACHINE, only: HP, GETARG
d21 1
a21 2
   use MLSHDF5, only: mls_h5open, mls_h5close
   use MLSMessageModule, only: MLSMessageConfig
d24 1
a24 1
   use output_m, only: resumeOutput, suspendOutput, output
d34 1
a34 1
       "$Id: l2gpdiff.f90,v 1.20 2013/08/23 02:51:48 vsnyder Exp $"
a76 1
  character(len=*), parameter             :: SWATHPREFIX='R3:240.B25D:CO.S1.DACS-1 chisqBinned Core'
d145 1
d278 4
d381 1
d435 3
@


1.20
log
@Move PrintItOut to PrintIt_m
@
text
@d17 1
d25 1
a25 1
   use output_m, only: resumeOutput, suspendOutput, output, outputNamedValue
d35 1
a35 1
       "$Id: l2gpdiff.f90,v 1.19 2012/02/13 23:42:42 pwagner Exp $"
d431 3
@


1.19
log
@-d opts passes opts to underlying dump routines
@
text
@d25 1
d34 1
a34 1
       "$Id: l2gpdiff.f90,v 1.18 2010/11/17 01:26:44 pwagner Exp $"
d98 1
a98 2
  MLSMessageConfig%useToolkit = .false.
  MLSMessageConfig%logFileUnit = -1
d430 3
@


1.18
log
@debug option dumps commandline options
@
text
@d33 1
a33 1
       "$Id: l2gpdiff.f90,v 1.17 2009/09/11 23:24:47 pwagner Exp $"
d53 1
d79 1
a79 1
  character(len=8)                        :: dumpOptions
d138 7
a144 7
  dumpOptions = '-'
  if ( options%ignoreBadChunks ) dumpOptions = trim(dumpOptions) // 'i'
  if ( options%silent ) dumpOptions = trim(dumpOptions) // 'm'
  if ( options%rms ) dumpOptions = trim(dumpOptions) // 'r'
  if ( options%stats ) dumpOptions = trim(dumpOptions) // 's'
  if ( options%table ) dumpOptions = trim(dumpOptions) // 'b'
  if ( options%verbose ) dumpOptions = trim(dumpOptions) // 'v'
d160 1
a160 1
      & options=dumpOptions )
d162 1
d169 1
a169 1
      & options=dumpOptions )
d180 1
a180 1
      & options=dumpOptions )
d191 1
a191 1
      & options=dumpOptions )
d204 1
a204 1
      & options=dumpOptions )
d271 1
a271 1
      else if ( filename(1:3) == '-d ' ) then
a272 1
        ! read(detailChars, '(i)') options%Details
d276 4
d338 1
d363 35
a397 34
      write (*,*) '                         (can do the same w/o the -f)'
      write (*,*) '          -chunks "c1,c2,.."'
      write (*,*) '                      =>   diff only chunks c1, c2,..'
      write (*,*) '          -fields "f1,f2,.."'
      write (*,*) '                      =>   diff only fields f1, f2,..'
      write (*,*) '          -geo name lo,hi  '
      write (*,*) '                      => diff only geobox low <= geo <= hi'
      write (*,*) '                      where geo in {latitude, longitude, time, pressure}'
      write (*,*) '                      (may be repeated)'
      write (*,*) '                      if hi < lo then dump is outside geobox'
      write (*,*) '          -pressures "p1,p2,.."'
      write (*,*) '                      =>   diff only at pressures p1,p2,..'
      write (*,*) '          -d details  => level of details to show'
      write (*,*) '          -force      => force diff even if swath names differ'
      write (*,*) '          -s1 "swath1,swath2,.."'
      write (*,*) '                      =>   diff only swath1,swath2,..'
      write (*,*) '          -s2 "swath1,swath2,.."'
      write (*,*) '                      =>   diff only swath1,swath2,..'
      write (*,*) '                           from even-numbered files in list'
      write (*,*) '          -v          => switch on verbose mode'
      write (*,*) '          -silent         => switch on silent mode'
      write (*,*) '                            (printing only if diffs found)'
      write (*,*) '          -debug      => dump options, etc.'
      write (*,*) '          -ignore     => ignore bad chunks'
      write (*,*) '          -matchTimes => only matching profile times'
      write (*,*) '          -rms        => just print mean, rms'
      write (*,*) '          -s          => just show number of differences'
      write (*,*) '          -side "s"   => print stat headers on one of'
      write (*,*) '                          {"top", "left", "right", "bottom"}'
      write (*,*) '          -t[able]    => table of % vs. amount of differences (pdf)'
      write (*,*) '          -miss       => just show which swaths are missing'
      write (*,*) '          -h          => print brief help'
      write (*,*) '    (Notes)'
      write (*,*) ' (1) The -d and -fields options should be mutually exclusive'
d430 3
@


1.17
log
@options now include -t to be consistent with diff apis
@
text
@d24 1
a24 1
   use output_m, only: resumeOutput, suspendOutput, output
d33 1
a33 1
       "$Id: l2gpdiff.f90,v 1.16 2009/06/16 22:37:59 pwagner Exp $"
a48 4
    integer            ::  nGeoBoxDims = 0
    real, dimension(4) ::  geoBoxLowBound
    real, dimension(4) ::  geoBoxHiBound
    integer     :: Details = 1
a49 7
    logical     :: force = .false.
    logical     :: ignoreBadChunks = .false.
    logical     :: matchTimes = .false.
    logical     :: rms = .false.
    logical     :: showMissing = .false.
    logical     :: stats = .false.
    logical     :: table = .false.
d53 16
a68 4
    logical     :: silent = .false.
    logical     :: timing = .false.
    logical     :: verbose = .false.
    integer     :: numDiffs = 0
d113 1
d275 3
d319 26
d379 1
d423 3
@


1.16
log
@Changed api for dump, diff routines; now rely on options for most optional behavior
@
text
@d33 1
a33 1
       "$Id: l2gpdiff.f90,v 1.15 2008/09/25 23:11:54 pwagner Exp $"
d60 1
d140 1
d297 3
d351 1
a351 1
      write (*,*) '          -s          => just show statistics'
d354 1
d391 3
@


1.15
log
@May confine diffs to a geolocation box
@
text
@d33 1
a33 1
       "$Id: l2gpdiff.f90,v 1.14 2008/04/10 20:23:03 pwagner Exp $"
d71 3
a73 2
  integer, parameter ::          MAXFILES = 100
  integer, parameter :: MAXNCHUNKS = 50
d75 3
a77 2
  integer, dimension(MAXNCHUNKS) :: chunks
  character(len=255) :: filename          ! input filename
d79 14
a92 15
  integer     ::  i, error ! Counting indices & Error flags
  integer :: listSize
  integer            :: n_filenames
  integer :: nChunks
  integer :: nPressures
  integer :: numDiffs
  integer :: NUMSWATHSPERFILE
  real, dimension(MAXNCHUNKS) :: pressures
  character(len=16) :: string
  character(len=MAXSWATHNAMESBUFSIZE) :: swathList1
  character(len=*), parameter :: SWATHPREFIX='R3:240.B25D:CO.S1.DACS-1 chisqBinned Core'
  real        :: t1
  real        :: t2
  real        :: tFile
  logical, parameter :: USEALLINPUTSWATHS = .true.
d134 6
d150 1
a150 2
      & details=options%Details, stats=options%stats, &
      & rms=options%rms, ignoreBadChunks=options%ignoreBadChunks, &
d154 2
a155 1
      & silent=options%silent, verbose=options%verbose, numDiffs=numDiffs )
d158 1
a158 2
      & details=options%Details, stats=options%stats, &
      & rms=options%rms, ignoreBadChunks=options%ignoreBadChunks, &
d162 2
a163 1
      & silent=options%silent, verbose=options%verbose, numDiffs=numDiffs )
d169 1
a169 2
      & details=options%Details, stats=options%stats, &
      & rms=options%rms, ignoreBadChunks=options%ignoreBadChunks, &
d173 2
a174 1
      & silent=options%silent, verbose=options%verbose, numDiffs=numDiffs )
d180 1
a180 2
      & details=options%Details, stats=options%stats, &
      & rms=options%rms, ignoreBadChunks=options%ignoreBadChunks, &
d184 2
a185 1
      & silent=options%silent, verbose=options%verbose, numDiffs=numDiffs )
d193 1
a193 2
      & details=options%Details, stats=options%stats, &
      & rms=options%rms, ignoreBadChunks=options%ignoreBadChunks, &
d197 2
a198 1
      & silent=options%silent, verbose=options%verbose, numDiffs=numDiffs )
d385 3
@


1.14
log
@Less voluminous output
@
text
@d22 1
a22 1
   use MLSStringLists, only: ExpandStringRange
d33 1
a33 1
       "$Id: l2gpdiff.f90,v 1.13 2007/11/28 18:59:58 pwagner Exp $"
d48 4
d140 10
a149 1
    if ( options%chunks == '*' .and. options%pressures == '*' ) then
d185 1
a185 2
      & pressures(1:nPressures), &
      & chunks=chunks(1:nchunks), &
d213 1
a213 1
     character(LEN=16)              :: detailChars
d230 10
d259 1
a259 1
        call getarg ( i+1+hp, detailChars )
d261 1
a261 1
        read(detailChars, *) options%Details
d319 5
d378 3
@


1.13
log
@May choose where to print stat headers
@
text
@d33 1
a33 1
       "$Id: l2gpdiff.f90,v 1.12 2007/10/12 23:37:31 pwagner Exp $"
d60 1
d182 1
a182 1
    call sayTime('diff these files: ' // trim(filenames(i-1)) // &
d185 1
a185 1
  call sayTime('diffing all files')
d351 3
@


1.12
log
@Removed much unused stuff
@
text
@d16 1
a16 1
   use dump_0, only: rmsFormat
d33 1
a33 1
       "$Id: l2gpdiff.f90,v 1.11 2007/06/27 19:30:59 pwagner Exp $"
d56 1
d93 1
a93 1
  do      ! Loop over filenames
d104 1
d250 4
d312 2
d350 3
@


1.11
log
@-pressures option added
@
text
@d17 3
a19 10
   use Hdf, only: DFACC_CREATE, DFACC_RDWR, DFACC_READ
   use HDF5, only: h5fopen_f, h5fclose_f, h5fis_hdf5_f   
   use HDFEOS5, only: HE5T_NATIVE_CHAR
   use L2GPData, only: L2GPData_T, &
     & Diff, &
     & L2GPNameLen, MAXSWATHNAMESBUFSIZE
   use MACHINE, only: FILSEP, HP, IO_ERROR, GETARG
   use MLSCommon, only: R8
   use MLSFiles, only: mls_exists, &
     & HDFVERSION_4, HDFVERSION_5, MLS_INQSWATH
d22 1
a22 2
   use MLSStringLists, only: ExpandStringRange, &
     & GetStringElement, NumStringElements
a24 1
   use PCFHdr, only: GlobalAttributes
d33 1
a33 1
       "$Id: l2gpdiff.f90,v 1.10 2007/06/14 21:48:41 pwagner Exp $"
a68 1
  character(len=10) :: column_name
a71 3
  integer     ::  hdfversion1
  integer     ::  hdfversion2
  logical     :: is_hdf5
a80 2
  character(len=MAXSWATHNAMESBUFSIZE) :: swathList2
  character(len=10) :: swath_name
d93 1
a93 1
     call get_filename(filename, n_filenames, options)
d191 1
a191 1
    subroutine get_filename(filename, n_filenames, options)
a193 1
     integer, intent(in)             :: n_filenames
d342 3
@


1.10
log
@Overrides default rmsFormat
@
text
@d42 1
a42 1
       "$Id: l2gpdiff.f90,v 1.9 2007/02/27 00:05:33 pwagner Exp $"
d56 1
d88 1
d91 1
d148 24
a171 2
    if ( options%chunks == '*' ) then
      call diff(trim(filenames(i-1)), trim(filenames(i)), &
d181 5
a185 2
      call diff(trim(filenames(i-1)), trim(filenames(i)), &
      & chunks(1:nchunks), &
d231 4
d306 2
d358 3
@


1.9
log
@-matchTimes option diffs only profiles with matching times
@
text
@d16 1
d42 1
a42 1
       "$Id: l2gpdiff.f90,v 1.8 2006/03/15 19:18:37 pwagner Exp $"
d136 1
d324 3
@


1.8
log
@Passes verbose option to L2GPData/diff
@
text
@d41 1
a41 1
       "$Id: l2gpdiff.f90,v 1.7 2006/01/14 00:59:12 pwagner Exp $"
d59 1
d149 1
d160 1
d224 3
d283 1
d322 3
@


1.7
log
@Added -silent, -chunks options
@
text
@d41 1
a41 1
       "$Id: l2gpdiff.f90,v 1.6 2005/09/23 21:01:13 pwagner Exp $"
d148 1
a148 1
      & silent=options%silent, numDiffs=numDiffs )
d158 1
a158 1
      & silent=options%silent, numDiffs=numDiffs )
d315 3
@


1.6
log
@use_wall_clock now a component of time_config
@
text
@d28 4
a31 2
   use MLSStringLists, only: GetStringElement, NumStringElements
   use output_m, only: output
d41 1
a41 1
       "$Id: l2gpdiff.f90,v 1.5 2005/08/19 23:41:08 pwagner Exp $"
d54 1
d64 1
d66 1
d72 4
a75 1
  ! logical ::          columnsOnly
a76 1
  ! character(len=255) :: outputFile= 'default.he5'        ! output filename
d78 1
a78 2
  integer            :: n_filenames
  integer     ::  i, j, count, status, error ! Counting indices & Error flags
d82 6
a90 1
  character(len=10) :: column_name
a91 4
  logical, parameter :: USEALLINPUTSWATHS = .true.
  integer :: NUMSWATHSPERFILE
  integer :: listSize
  ! logical     :: verbose = .false.
d95 1
d116 3
d134 1
a135 1
  count = 0
d142 3
a144 2
    call diff(trim(filenames(i-1)), &
      & trim(filenames(i)), details=options%Details, stats=options%stats, &
d147 14
a160 1
      & force=options%force, swaths1=options%swaths1, swaths2=options%swaths2 )
d165 5
a177 2
     ! character(LEN=*), intent(inout) :: outputFile        ! output filename
     ! logical, intent(inout)          :: verbose
d191 4
d198 3
d258 2
d262 2
d274 2
d285 1
d288 7
d315 3
@


1.5
log
@May specify fields, swaths
@
text
@d24 1
a24 1
   use MLSFiles, only: mls_exists, MLS_IO_GEN_OPENF, MLS_IO_GEN_CLOSEF, &
d31 1
a31 1
   use Time_M, only: Time_Now, USE_WALL_CLOCK
d39 1
a39 1
       "$Id: l2gpdiff.f90,v 1.4 2005/06/22 19:27:33 pwagner Exp $"
d91 1
a91 1
  USE_WALL_CLOCK = .true.
d266 3
@


1.4
log
@Reworded Copyright statement, moved rcs id
@
text
@d37 1
a37 1
       "$RCSfile: MLSL2.f90,v $"
d39 1
a39 1
       "$Id: MLSL2.f90,v 2.138 2005/06/22 18:57:02 pwagner Exp $"
d50 1
a51 1
    logical     :: verbose = .false.
d53 3
a55 1
    logical     :: stats = .false.
a56 1
    logical     :: ignoreBadChunks = .false.
d58 4
d134 2
a135 1
      & showMissing=options%showMissing)
d163 3
d169 4
d192 8
d218 3
a220 1
      & 'Usage:l2gpcat [options] [filenames]'
d222 1
a222 1
      & ' If no filenames supplied, you will be prompted to supply one'
d225 2
d228 6
d240 4
d266 3
@


1.3
log
@All stringlist stuff was moved from mlsstrings to mlsstringlists
@
text
@d1 10
a10 2
! Copyright (c) 2004, California Institute of Technology.  ALL RIGHTS RESERVED.
! U.S. Government Sponsorship under NASA Contract NAS7-1407 is acknowledged.
d35 7
a41 5
!------------------- RCS Ident Info -----------------------
   CHARACTER(LEN=130) :: Id = &                                                    
   "$Id: l2gpdiff.f90,v 1.2 2004/07/22 17:10:46 pwagner Exp $"
   CHARACTER (LEN=*), PARAMETER :: ModuleName= "$RCSfile: l2gpdiff.f90,v $"
!----------------------------------------------------------
d231 3
@


1.2
log
@Added -ignore and -rms options
@
text
@d20 1
a20 1
   use MLSStrings, only: GetStringElement, NumStringElements
d29 1
a29 1
   "$Id: l2gpdiff.f90,v 1.1 2004/06/16 17:55:06 pwagner Exp $"
d221 3
@


1.1
log
@First commit
@
text
@d29 2
a30 2
   "$Id: l2gpdiff.f90,v 1.2 2004/03/03 19:11:17 pwagner Exp $"
   CHARACTER (LEN=*), PARAMETER :: ModuleName= "$RCSfile: L2GPcat.f90,v $"
d44 2
d118 1
d160 6
d194 2
d221 3
@

