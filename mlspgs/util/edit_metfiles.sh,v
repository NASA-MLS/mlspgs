head	1.7;
access;
symbols
	v5-02-NRT-19:1.7
	v6-00:1.7
	v5-02-NRT-18:1.7
	v5-02:1.7
	v5-01-NRT-17:1.7
	v5-01-NRT-16:1.7
	v5-01-NRT-15:1.7
	v5-01-NRT-14:1.7
	neuralnetworks-1-0:1.7.0.10
	cfm-single-freq-0-1:1.7.0.8
	v5-01:1.7
	v5-00:1.7
	v4-23-TA133:1.7.0.6
	mus-emls-1-70:1.7.0.4
	rel-1-0-englocks-work:1.7.0.2
	VUMLS1-00:1.7
	VPL1-00:1.7
	V4-22-NRT-08:1.6
	VAM1-00:1.6
	V4-21:1.6.0.2
	V4-13:1.6
	V4-12:1.6
	V4-11:1.6
	V4-10:1.6
	V3-43:1.5
	M4-00:1.5
	V3-41:1.5
	V3-40-PlusGM57:1.5.0.2
	V2-24-NRT-04:1.5
	V3-33:1.5
	V2-24:1.5
	V3-31:1.5
	V3-30-NRT-05:1.5
	cfm-01-00:1.5
	V3-30:1.5
	V3-20:1.5
	V3-10:1.5
	V2-23-NRT-02:1.5
	V2-23:1.5
	V2-22-NRT-01:1.5
	V2-22:1.5
	V2-21:1.5
	V2-20:1.5
	V2-11:1.5
	V2-10:1.5
	V2-00:1.5
	V1-51:1.4
	V1-50:1.4
	V1-45:1.4
	V1-44:1.4
	V1-43:1.4
	V1-42:1.4
	V1-41:1.4
	V1-32:1.4
	V1-40:1.4
	V1-31:1.4
	V1-30:1.4;
locks; strict;
comment	@# @;


1.7
date	2016.06.01.16.27.39;	author pwagner;	state Exp;
branches;
next	1.6;

1.6
date	2014.04.25.18.01.59;	author pwagner;	state Exp;
branches;
next	1.5;

1.5
date	2005.06.23.22.20.45;	author pwagner;	state Exp;
branches;
next	1.4;

1.4
date	2003.05.29.22.30.55;	author pwagner;	state Exp;
branches;
next	1.3;

1.3
date	2003.05.28.20.25.46;	author pwagner;	state Exp;
branches;
next	1.2;

1.2
date	2003.05.28.16.20.34;	author pwagner;	state Exp;
branches;
next	1.1;

1.1
date	2003.05.22.20.52.19;	author pwagner;	state Exp;
branches;
next	;


desc
@@


1.7
log
@Added special case myVALUE=ffiilleennaammee
@
text
@#!/bin/sh
# edit_metfiles.sh

# Copyright 2005, by the California Institute of Technology. ALL
# RIGHTS RESERVED. United States Government Sponsorship acknowledged. Any
# commercial use must be negotiated with the Office of Technology Transfer
# at the California Institute of Technology.

# This software may be subject to U.S. export control laws. By accepting this
# software, the user agrees to comply with all applicable U.S. export laws and
# regulations. User has the responsibility to obtain export licenses, or other
# export authority as may be required before exporting such information to
# foreign countries or providing access to foreign persons.

# "$Id: edit_metfiles.sh,v 1.6 2014/04/25 18:01:59 pwagner Exp $"
# --------------- edit_metfiles.sh help
#Use(1) (the default)
#edit .met files so that their INPUTPOINTER values
#match what we have decided level 1 hdf5 files should have
#The fix involves changing lines in each file to the following:
#  >  OBJECT                 = INPUTPOINTER
#  >    NUM_VAL              = 1
#  >    VALUE                = "Found at /PCF"
#  >  END_OBJECT             = INPUTPOINTER
#(where the changed lines have been marked with the ">")
#
#Use(2)
#As in use (1) except to
#match what we have decided level 2 hdfeos5 files should have
#The fix involves changing lines in each file to the following:
#  >  OBJECT                 = INPUTPOINTER
#  >    NUM_VAL              = 1
#  >    VALUE                = "Found at /HDFEOS/ADDITIONAL/FILE_ATTRIBUTES/PCF"
#  >  END_OBJECT             = INPUTPOINTER
#(where the changed lines have been marked with the ">")
#
#Use(3)
#Primarily for use with .mcf files
#More general than (1) and (2); given myOBJECT and myVALUE
#The fix involves changing one line in each file as the following illustrates:
#   OBJECT                 = myOBJECT
#    .  .  .
#  >    VALUE                = "myVALUE"
#   END_OBJECT             = myOBJECT
#(where only the changed line has been marked with the ">")
#
#Use(4)
#Primarily for use with .mcf files
#Bloc replacement; given myOBJECT and myFILE
#The fix involves replacing the bloc of lines in each file 
#with the contents of myFILE as the following illustrates:
# <<  OBJECT                 = myOBJECT
# <<   .  .  .
# <<  END_OBJECT             = myOBJECT
# >> 1st line of myFILE
# >> .   .   .
# >> last line of myFILE
#Usage:
#edit_metfiles.sh [opt1 [arg1]] [opt2 [arg2]] .. [optm [argm]] [filelist]
#
#    O p t i o n s
# -1            use(1)
# -2            use(2)
# -3            use(3)
# -4            use(4)
# -obj myOBJECT instead of INPUTPOINTER, change value of myOBJECT
# -val myVALUE  instead of use(1) or (2), change value of OBJECT to myVALUE
#               if myVALUE has the special "stuttered" value ffiilleennaammee
#               its value will be the filename
# -f myFILE     for use (4)
# -print        instead of creating new file(s), print results of sed to stdout
# -test         instead of creating new file(s), confirm that files already 
#                  match output of running script; i.e., diff would be null
# -h[elp]       print brief help message; exit
#Notes:
#(1) The default use is Use(1)
#(2) Options -1, -2, -val are mutually exclusive
#(3) Note special case when myVALUE = ffiilleennaammee, 
#    actual value will be the filename
#    If -obj is supplied, then -val should be, too
#(4) usage (4) requires that replacetext.sh exist, be executable, 
#    and in your PATH
# --------------- End edit_metfiles.sh help
#Another example of my regrettable tendency to bundle a number of
#different functionalities within a single multi-use file
#Isn't it cleaner to devote a single file to a single use?

#------------------------------- print_the_lines ------------
#
# Function to print the lines from a file bookended by 
# e.g. where object="INPUTPOINTER"
#'OBJECT     = INPUTPOINTER'
# . . .
#'END_OBJECT             = INPUTPOINTER'
#
# Optionally end each line (except the last) with a "\" 
# so it can serve as replacement text in a sed script
# usage: print_the_lines object file [opt]

print_the_lines()
{
object="$1"
file="$2"
if [ "$3" = "" ]
then
  sed -n \
  '/OBJECT * = *'$object'/,/END_OBJECT * = *'$object'/ p' $file 
else
  sed -n \
  '/OBJECT * = *'$object'/,/END_OBJECT * = *'$object'/ p' $file \
  | sed 's/.*$/&\\/' | sed '$ s/\\$//'

fi
}

#------------------------------- Main Program ------------

#****************************************************************
#                                                               *
#                  * * * Main Program  * * *                    *
#                                                               *
#                                                               *
#	The entry point where control is given to the script         *
#****************************************************************
id_list=
RCS_list=
# echo "All the args: $@@"
suffixes=""
directories=""
me="$0"
my_name=edit_metfiles.sh
I=edit_metfiles
unique_name="`echo $0 | sed 's/'$I'/unique_name/'`"
the_splitter="`echo $0 | sed 's/'$I'/split_path/'`"
reecho="`echo $0 | sed 's/'$I'/reecho/'`"
resed="`echo $0 | sed 's/'$I'/resed/'`"

print_to_stdout="no"
more_opts="yes"
usage="1"
myFILE=""
myOBJECT=""
myVALUE=""

#
# Get arguments from command line
#

while [ "$more_opts" = "yes" ] ; do

    case "$1" in

    -1 )
       usage="1"
       shift
       ;;
    -2 )
       usage="2"
       shift
       ;;
    -3 )
       usage="3"
       shift
       ;;
    -4 )
       usage="4"
       shift
       ;;
    -f )
       myFILE="$2"
       shift
       shift
       ;;
    -obj )
       myOBJECT="$2"
       shift
       shift
       ;;
    -val )
       myVALUE="$2"
       usage="3"
       shift
       shift
       ;;
    -print )
       print_to_stdout="yes"
       shift
       ;;
    -test )
       print_to_stdout="diff"
       shift
       ;;
    -h | -help )
       sed -n '/'$my_name' help/,/End '$my_name' help/ p' $me \
           | sed -n 's/^.//p' | sed '1 d; $ d'
       exit
       ;;
    * )
       more_opts="no"
       ;;
    esac
done
# Check for constraints on options
if [ "$myOBJECT" != "" ]
then
  if [ "$myVALUE" = "" -a "$usage" != "4" ]
  then
    echo "You must supply -val myVALUE to go with -obj myOBJECT"
    exit 1
  fi
fi
case "$usage" in
   1)
     myOBJECT="INPUTPOINTER"
     myVALUE="Found at /PCF"
     ;;
   2)
     myOBJECT="INPUTPOINTER"
     myVALUE="Found at /HDFEOS/ADDITIONAL/FILE_ATTRIBUTES/PCF"
     ;;
   4)
     if [ ! -r "$myFILE" ]
     then
       echo "Sorry, could not find $myFILE"
       exit 1
     fi
     ;;
   *)
     ;;
esac
# Prepare a file containing sed instructions to carry out
# the editing task
if [ "$usage" != "4" ]
then
  example_file="$1"
  rm -f temp.sed
  echo '/OBJECT * = *'$myOBJECT'/,/END_OBJECT * = *'$myOBJECT'/ c \' > temp.sed
  print_the_lines "$myOBJECT" "$example_file" "yes" >> temp.sed
  rm -f temp1.sed
  # sed '/VALUE/ s^".*"^"'"$myVALUE"'"^' temp.sed > temp1.sed
  sed '/[Vv][Aa][Ll][Uu][Ee]/ s^".*"^"'"vvaalluuee"'"^' temp.sed > temp1.sed
  mv temp1.sed temp.sed
  diff_list=""
  nodiff_list=""
fi
# Now use the file of sed instructions plus our resed script
# to act upon the args (which we hope are the filenames)
#if [ ! -x "$resed" ]
#then
#  chmod u+x "$resed"
#fi
#Hmmmm-skip using resed for now
#until problem of creating temp files in read-only directory is solved
#if [ "$print_to_stdout" = "yes" ]
#then
#  $resed -print -f temp.sed $@@
#else
#  $resed -f temp.sed $@@
#fi
mv temp.sed tteemmpp.sed
for the_file
do
  # Is myVALUE ffiilleennaammee?
  if [ "$myVALUE" = "ffiilleennaammee" ]
  then
    vvaalluuee="$the_file"
  else
    vvaalluuee="$myVALUE"
  fi
  # tansform vvaalluuee -> $vvaalluuee
  sed "s/vvaalluuee/$vvaalluuee/g" tteemmpp.sed > temp.sed
  if [ "$usage" = "4" ]
  then
    replacetext.sh "OBJECT = $myOBJECT" "END_OBJECT = $myOBJECT" "$the_file" "$myFILE" > temp1.rep.txt
    if [ "$print_to_stdout" = "yes" ]
    then
      cat temp1.rep.txt
    else
      mv temp1.rep.txt "$the_file"
    fi
    /bin/rm -f temp1.rep.txt
  elif [ "$print_to_stdout" = "yes" ]
  then
    sed -f temp.sed "$the_file"
  elif [ "$print_to_stdout" = "diff" ]
  then
    sed -f temp.sed "$the_file" > temp1.sed
    how_many=`diff "$the_file" temp1.sed | wc -l`
    if [ "$how_many" -gt 0 ]
    then
      diff_list="$diff_list $the_file"
    else
      nodiff_list="$nodiff_list $the_file"
    fi
    rm -f temp1.sed
  else
    sed -f temp.sed "$the_file" > temp1.sed
    mv temp1.sed "$the_file"
  fi
done
/bin/rm -f temp.sed tteemmpp.sed
if [ "$usage" = "4" ]
then
  exit 0
fi
if [ "$print_to_stdout" = "diff" ]
then
  if [ "$diff_list" = "" ]
  then
    echo "All the files pass the test"
  elif [ "$nodiff_list" = "" ]
  then
    echo "Sorry--none of the files pass the test"
  else
    echo "The following files failed the test"
    echo "$diff_list"
    echo "The following files passed the test"
    echo "$nodiff_list"
  fi
fi
exit 0
# $Log: edit_metfiles.sh,v $
# Revision 1.6  2014/04/25 18:01:59  pwagner
# Added Usage (4): replace bloc of lines with contents of myFILE
#
# Revision 1.5  2005/06/23 22:20:45  pwagner
# Reworded Copyright statement
#
# Revision 1.4  2003/05/29 22:30:55  pwagner
# Changed default value for usage(1); added -test option
#
# Revision 1.3  2003/05/28 20:25:46  pwagner
# Fixed embarrassing error where usage(2) no different from (1)
#
# Revision 1.2  2003/05/28 16:20:34  pwagner
# Small fix--not yet tested with resed script
#
# Revision 1.1  2003/05/22 20:52:19  pwagner
# First commit
#
@


1.6
log
@Added Usage (4): replace bloc of lines with contents of myFILE
@
text
@d15 1
a15 1
# "$Id: edit_metfiles.sh,v 1.5 2005/06/23 22:20:45 pwagner Exp $"
d20 1
a20 1
#The fix involves changing lines to each file to the following:
d30 1
a30 1
#The fix involves changing lines to each file to the following:
d38 1
d48 1
d68 2
d76 7
a82 4
#(1) Options -1, -2, -val are mutually exclusive
#(2) If -obj is supplied, then -val should be, too
#(3) The default use is Use(1)
#(4) usage (4) requires that replacetext.sh exist, be executable, and in your PATH
d240 2
a241 1
  sed '/VALUE/ s^".*"^"'"$myVALUE"'"^' temp.sed > temp1.sed
d260 1
d263 9
d301 1
a301 1
/bin/rm -f temp.sed
d323 3
@


1.5
log
@Reworded Copyright statement
@
text
@d15 1
a15 1
# "$Id: edit_metfiles.sh,v 1.4 2003/05/29 22:30:55 pwagner Exp $"
d45 11
d62 2
d66 1
d72 4
a75 3
#(1)Options -1, -2, -val are mutually exclusive
#(2)If -obj is supplied, then -val should be, too
#(3)The default use is Use(1)
d134 1
d154 13
d174 1
d199 1
a199 1
  if [ "$myVALUE" = "" ]
a204 4
if [ "$myVALUE" != "" ]
then
  usage="3"
fi
d214 7
d226 12
a237 9
example_file="$1"
rm -f temp.sed
echo '/OBJECT * = *'$myOBJECT'/,/END_OBJECT * = *'$myOBJECT'/ c \' > temp.sed
print_the_lines "$myOBJECT" "$example_file" "yes" >> temp.sed
rm -f temp1.sed
sed '/VALUE/ s^".*"^"'"$myVALUE"'"^' temp.sed > temp1.sed
mv temp1.sed temp.sed
diff_list=""
nodiff_list=""
d254 11
a264 1
  if [ "$print_to_stdout" = "yes" ]
d283 5
a287 1
rm temp.sed
d305 3
@


1.4
log
@Changed default value for usage(1); added -test option
@
text
@d4 10
a13 2
# Copyright (c) 2003, California Institute of Technology.  ALL RIGHTS RESERVED.
# U.S. Government Sponsorship under NASA Contract NAS7-1407 is acknowledged.
d15 1
a15 1
# "$Id: edit_metfiles.sh,v 1.3 2003/05/28 20:25:46 pwagner Exp $"
d255 3
@


1.3
log
@Fixed embarrassing error where usage(2) no different from (1)
@
text
@d7 1
a7 1
# "$Id: edit_metfiles.sh,v 1.2 2003/05/28 16:20:34 pwagner Exp $"
d15 1
a15 1
#  >    VALUE                = "Found at Dataset /TextPCF"
d46 2
a57 74
#------------------------------- change_the_lines_1 ------------
#
# Function to add the lines needed according to the usage
# usage: change_the_lines_1 file

change_the_lines_1()
{
file="$1"
test=`grep -i 'INPUTPOINTER' $file`                     
if [ "$test" != "" ]                                      
then                                                     
  rm -f temp
  sed '/INPUTPOINTER/,/INPUTPOINTER/ c\
 OBJECT                 = INPUTPOINTER \
   NUM_VAL              = 1 \
   VALUE                = "Found at Dataset /TextPCF" \
 END_OBJECT             = INPUTPOINTER \
 ' $file > temp
  mv temp $file                                     
else                                                
  echo "$file lacks INPUTPOINTER object to edit"  
fi                                                  
}

#------------------------------- change_the_lines_2 ------------
#
# Function to add the lines needed according to the usage
# usage: change_the_lines_2 file

change_the_lines_2()
{
file="$1"
test=`grep -i 'INPUTPOINTER' $file`                     
if [ "$test" != "" ]                                      
then                                                     
  rm -f temp
  sed '/INPUTPOINTER/,/INPUTPOINTER/ c\
 OBJECT                 = INPUTPOINTER \
   NUM_VAL              = 1 \
   VALUE                = "Found at /HDFEOS/ADDITIONAL/FILE_ATTRIBUTES/PCF" \
 END_OBJECT             = INPUTPOINTER \
 ' $file > temp
  mv temp $file                                     
else                                                
  echo "$file lacks INPUTPOINTER object to edit"  
fi                                                  
}

#------------------------------- extant_files ------------
#
# Function to return only those files among the args
# that actually exist
# Useful when passed something like *.f which may 
# (1) expand to list of files, returned as extant_files_result, or
# (2) stay *.f, in which case a blank is returned as extant_files_result 
#     (unless you have perversely named a file '*.f')
# usage: extant_files arg1 [arg2] ..

extant_files()
{
   extant_files_result=
   # Trivial case ($# = 0)
   if [ "$1" != "" ]
   then
      for file
      do
         if [ -f "$file" ]
         then
               extant_files_result="$extant_files_result $file"
         fi
      done
   fi
}

d66 2
a67 2
# Optionally end each line with a "\" so it can serve as
# replacement text in a sed script
a75 2
  #echo "Trying to print lines in $file, object $object"
  #echo '/=== (start of '$section') ===/,/=== (end of '$section') ===/ p' $file
a78 2
  #echo "Trying to print lines in $file, object $object"
  #echo '/=== (start of '$section') ===/,/=== (end of '$section') ===/ p' $file
d81 1
a81 1
  | sed 's/.*$/&\\/'
d144 4
d174 1
a174 1
     myVALUE="Found at Dataset /TextPCF"
d192 2
d213 11
d230 15
d247 3
@


1.2
log
@Small fix--not yet tested with resed script
@
text
@d7 1
a7 1
# "$Id: edit_metfiles.sh,v 1.1 2003/05/22 20:52:19 pwagner Exp $"
d203 1
a203 1
       usage="1"
d291 3
@


1.1
log
@First commit
@
text
@d7 1
a7 1
# "$Id: edit_metfiles.sh,v 1.3 2002/10/11 23:01:05 pwagner Exp $"
d284 1
a284 1
    $resed -f temp.sed "$the_file" > temp1.sed
d291 3
@

