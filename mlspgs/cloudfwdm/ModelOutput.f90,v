head	1.20;
access;
symbols
	v5-02-NRT-19:1.20
	v6-00:1.20
	v5-02-NRT-18:1.20
	v5-02:1.20
	v5-01-NRT-17:1.20
	v5-01-NRT-16:1.20
	v5-01-NRT-15:1.20
	v5-01-NRT-14:1.20
	neuralnetworks-1-0:1.20.0.14
	cfm-single-freq-0-1:1.20.0.12
	v5-01:1.20
	v5-00:1.20
	v4-23-TA133:1.20.0.10
	mus-emls-1-70:1.20.0.8
	rel-1-0-englocks-work:1.20.0.6
	VUMLS1-00:1.20
	VPL1-00:1.20
	V4-22-NRT-08:1.20
	VAM1-00:1.20
	V4-21:1.20.0.4
	V4-13:1.20
	V4-12:1.20
	V4-11:1.20
	V4-10:1.20
	V3-43:1.20
	M4-00:1.20
	V3-41:1.20
	V3-40-PlusGM57:1.20.0.2
	V2-24-NRT-04:1.19
	V3-33:1.20
	V2-24:1.19
	V3-31:1.20
	V3-30-NRT-05:1.20
	cfm-01-00:1.20
	V3-30:1.20
	V3-20:1.20
	V3-10:1.20
	V2-23-NRT-02:1.19
	V2-23:1.19
	V2-22-NRT-01:1.19
	V2-22:1.19
	V2-21:1.18
	V2-20:1.18
	V2-11:1.18
	V2-10:1.18
	V2-00:1.18
	V1-51:1.17
	V1-50:1.17
	V1-45:1.17
	V1-44:1.17
	V1-43:1.17
	V1-32:1.17
	V1-31:1.17
	V1-30:1.17
	V1-13:1.16
	V1-12:1.16
	V1-11:1.16
	V1-10:1.16
	newfwm-feb03:1.16.0.2
	V1-04:1.14
	V1-03:1.14
	V1-02:1.14
	JointForwardModel:1.15.0.2
	V1-00:1.14;
locks; strict;
comment	@# @;


1.20
date	2009.06.23.18.26.19;	author pwagner;	state Exp;
branches;
next	1.19;

1.19
date	2007.07.25.22.00.12;	author vsnyder;	state Exp;
branches;
next	1.18;

1.18
date	2005.06.22.18.27.38;	author pwagner;	state Exp;
branches;
next	1.17;

1.17
date	2003.05.14.23.33.33;	author dwu;	state Exp;
branches;
next	1.16;

1.16
date	2002.10.08.17.08.07;	author pwagner;	state Exp;
branches;
next	1.15;

1.15
date	2002.05.08.17.00.15;	author jonathan;	state Exp;
branches;
next	1.14;

1.14
date	2001.10.30.20.57.38;	author dwu;	state Exp;
branches;
next	1.13;

1.13
date	2001.10.24.22.50.26;	author dwu;	state Exp;
branches;
next	1.12;

1.12
date	2001.10.24.22.09.53;	author dwu;	state Exp;
branches;
next	1.11;

1.11
date	2001.10.19.19.39.49;	author dwu;	state Exp;
branches;
next	1.10;

1.10
date	2001.10.19.19.25.25;	author dwu;	state Exp;
branches;
next	1.9;

1.9
date	2001.10.19.19.16.14;	author dwu;	state Exp;
branches;
next	1.8;

1.8
date	2001.10.19.17.11.52;	author dwu;	state Exp;
branches;
next	1.7;

1.7
date	2001.10.12.22.38.24;	author dwu;	state Exp;
branches;
next	1.6;

1.6
date	2001.10.11.20.03.00;	author jonathan;	state Exp;
branches;
next	1.5;

1.5
date	2001.10.10.02.49.35;	author dwu;	state Exp;
branches;
next	1.4;

1.4
date	2001.10.09.22.12.36;	author jonathan;	state Exp;
branches;
next	1.3;

1.3
date	2001.09.21.15.51.37;	author jonathan;	state Exp;
branches;
next	1.2;

1.2
date	2001.09.20.23.31.07;	author jonathan;	state Exp;
branches;
next	1.1;

1.1
date	2001.09.20.18.27.19;	author jonathan;	state Exp;
branches;
next	;


desc
@@


1.20
log
@Prevent Intel from optimizing ident string away
@
text
@
! Copyright 2005, by the California Institute of Technology. ALL
! RIGHTS RESERVED. United States Government Sponsorship acknowledged. Any
! commercial use must be negotiated with the Office of Technology Transfer
! at the California Institute of Technology.

! This software may be subject to U.S. export control laws. By accepting this
! software, the user agrees to comply with all applicable U.S. export laws and
! regulations. User has the responsibility to obtain export licenses, or other
! export authority as may be required before exporting such information to
! foreign countries or providing access to foreign persons.
 
module ModelOutput

! ---------------------------------------------------------------------------  
! OUTPUT CLOUD EXTINCTION, EFFECTIVE OPTICAL DEPTH, AND RADIANCE SENSITIVITY
! ---------------------------------------------------------------------------

      use MLSCommon, only: r8
      use MLSNumerics, only: INTERPOLATEVALUES
      IMPLICIT NONE
      private
      public :: SENSITIVITY

!---------------------------- RCS Module Info ------------------------------
  character (len=*), private, parameter :: ModuleName= &
       "$RCSfile: $"
  private :: not_used_here 
!---------------------------------------------------------------------------

contains 

      SUBROUTINE SENSITIVITY(DTcir,ZT,NT,YP,YZ,NH,PRESSURE,NZ,   &
        &                    delTAU,delTAUc,delTAU100,TAUeff,SS, &
        &                    Trans_out,BETA,BETAc,DDm,Dm,DDZ,DZ, &
        &                    N, RE, noS, Slevl)
!----------------------------------------------------------------

      INTEGER :: NH, NZ, NT, N, noS

      REAL(r8) :: ZT(NT)                            ! TANGENT HEIGHT
      
      REAL(r8) :: YP(NH)                            ! MODEL PRESSURE LEVEL
      REAL(r8) :: YZ(NH)                            ! MODEL PRESSURE HEIGHT
      REAL(r8) :: Slevl(noS)                        ! Sgrid level (m)

      REAL(r8) :: PRESSURE(NZ)                      ! L2 PRESSURE LEVEL
      REAL(r8) :: DTcir(NT)                         ! CLOUD-INDUCED RADIANCE
      REAL(r8) :: SS(NT)                            ! CLOUD RADIANCE SENSITIVITY
      REAL(r8) :: TAUeff(NT)                        ! CLOUD EFFECTIVE OPTICAL DEPTH

      REAL(r8) :: Trans(2*NH)                       ! Clear Transmission Func 

      REAL(r8) :: delTAU100(NH-1)                   ! 100% AIR optical thickness 
      REAL(r8) :: delTAU(NH-1)                      ! TOTAL sky optical thickness 
      REAL(r8) :: delTAUc(NH-1)                     ! CLOUDY-SKY optical thickness

      REAL(r8) :: Trans_out(noS,NT)                 ! TOTAL Clear Trans Func
      REAL(r8) :: BETA(NZ)                        ! TOTAL EXTINCTION
      REAL(r8) :: BETAc(NZ)                       ! CLOUDY-SKY EXTINCTION
      REAL(r8) :: DDm(N,NH-1)                       ! MASS-MEAN-DIAMETER
      REAL(r8) :: Dm(N,NZ)                        ! MASS-MEAN-DIAMETER
      REAL(r8) :: DDZ(NH-1)                         ! MODEL LEYER THICKNESS
      REAL(r8) :: DZ(NZ-1)                          ! L2 LAYER THICKNESS

      REAL(r8) :: RE, sum
      REAL(r8) :: HT,C_EXT,A_EXT,TGT,DS,DTAU,A_COL
      REAL(r8) :: ZH(NH-1),ZA(NZ-1), S(2*NH)
      INTEGER :: I,K,J,iflag
!-----------------------------------------------------------------------------

!===============================================================
!     INTERPOLATE PARAMETERS FROM MODEL LEVEL NH TO L2 LEVEL NZ
!===============================================================
! COMPUTE TRANSMISSION FUNCTION

      trans = 0._r8                ! initialization
      trans_out = 0._r8            ! initialization

      do k=1,nt
        IF ( zt(k) .LE. 30000._r8) THEN 
        sum = 0._r8
        s = 0._r8    

            s(1) = - sqrt((re+yz(NH))**2-(re+zt(k))**2)
            s(2*NH) = sqrt((re+yz(NH))**2-(re+zt(k))**2)

        DO I=1,NH

          if(yz(NH-i+1) > zt(k) .and. i > 1) then
            ! s will zero for heights below zt
            s(i) = - sqrt((re+yz(NH-i+1))**2-(re+zt(k))**2)
            ds = s(i) - s(i-1)
            sum = sum +  deltau100(NH-i+1)*ds/(yz(NH-i+2)-yz(NH-i+1))
          endif
            trans(i) = sum     ! trans keeps constant for heights below zt
        ENDDO

        DO I=1,NH
          if(yz(i) > zt(k) .and. i < NH) then
            s(NH+i) = sqrt((re+yz(i))**2-(re+zt(k))**2)
            ds = s(NH+i) - s(NH+i-1)
            sum = sum +  deltau100(i)*ds/(yz(i+1)-yz(i))
          endif
            trans(NH+i) = sum
        ENDDO

        where(trans < 10._r8) 
         trans = exp(-trans)
        elsewhere 
         trans = 0._r8
        endwhere
        
      ! sLevl is defined differently from s
      CALL INTERPOLATEVALUES(s,trans, -Slevl,trans_out(:,k),method='Linear')
      ELSE
      ! DO NOTHING
      ENDIF
      enddo

! CONVERT DELTAU TO BETA
      DO I=1,NH-1
         ZH(I)=-(LOG10(YP(I+1))+LOG10(YP(I)))/2._r8
         delTAU(I) = delTAU(I)/DDZ(I)
         delTAUc(I) = delTAUc(I)/DDZ(I)
      END DO

      DO I=1,NZ-1
         ZA(I)=-(LOG10(PRESSURE(I+1))+LOG10(PRESSURE(I)))/2._r8
      END DO

      call INTERPOLATEVALUES(zh,deltau,za,beta(1:NZ-1),method='Linear')
      call INTERPOLATEVALUES(zh,deltauc,za,betac(1:NZ-1),method='Linear')
      call INTERPOLATEVALUES(zh,ddz,za,dz(1:NZ-1),method='Linear')
      
      do i=1,N
      call INTERPOLATEVALUES(zh,reshape(ddm(i,:),(/nh-1/)),&
        & za,dm(i,1:NZ-1),method='Linear')
      end do 

!==========================================================================
!     RADIANCE SENSITIVITY CALCULATIONS
!==========================================================================

      TAUeff = 0._r8
      SS = 0._r8
      
      DO I=1,NT
        IF ( zt(I) .LE. 30000._r8) THEN 
            HT = ZT(I)
            if(HT .gt. yz(nh-1)) cycle    ! don't compute for large Zt  
            
               do j=2,NH
                  if (yz(j) .GE. ht) then
                     iflag=j
                     goto 100
                  endif
               enddo

 100           continue

               C_EXT = 0._r8
               A_EXT = 0._r8
            
               DO K=NH-1,iflag,-1

                     TGT=YZ(K-1)
                     IF(TGT .LT. HT)THEN
                        TGT=HT
                     ENDIF
                     DS = SQRT((RE+YZ(K))**2-(RE+HT)**2)-    &
     &                    SQRT((RE+TGT)**2-(RE+HT)**2)
                     DTAU = DS * delTAU(K)*DDZ(k)/(YZ(K)-YZ(K-1))
                     A_COL = A_EXT + DTAU/2.
                     C_EXT=C_EXT + delTAUc(K)*DDZ(k)*EXP(-A_COL)*   &
     &                     DS/(YZ(K)-YZ(K-1))
                     A_EXT = A_EXT + DTAU

               ENDDO

               DO K=iflag,NH-1

                     TGT=YZ(K-1)
                     IF(TGT .LT. HT)THEN
                        TGT=HT
                     ENDIF
                     DS = SQRT((RE+YZ(K))**2-(RE+HT)**2)-    &
     &                    SQRT((RE+TGT)**2-(RE+HT)**2)
                     DTAU = DS * delTAU(K)*DDZ(k)/(YZ(K)-YZ(K-1))
                     A_COL = A_EXT + DTAU/2.
                     C_EXT=C_EXT + delTAUc(K)*DDZ(k)*EXP(-A_COL)*   &
     &                     DS/(YZ(K)-YZ(K-1))
                     A_EXT = A_EXT + DTAU

               ENDDO

               
               TAUeff(I)=C_EXT
               if (TAUeff(I) .gt. 0._r8) then
                  SS(I)=DTcir(I)/TAUeff(I)
               else
                  SS(I)=0._r8
               endif
        ELSE
        ! DO NOTHING
        ENDIF

      ENDDO
      

!--------------------------------------------------------------------------

      END SUBROUTINE SENSITIVITY

!--------------------------- end bloc --------------------------------------
  logical function not_used_here()
  character (len=*), parameter :: IdParm = &
       "$Id: read_apriori.f90 is it here $"
  character (len=len(idParm)) :: Id = idParm
    not_used_here = (id(1:1) == ModuleName(1:1))
    print *, Id ! .mod files sometimes change if PRINT is added
  end function not_used_here
!---------------------------------------------------------------------------

end module ModelOutput

! $Log: ModelOutput.f90,v $
! Revision 1.19  2007/07/25 22:00:12  vsnyder
! Delete USE for unreferenced entity and declarations for unused variables
!
! Revision 1.18  2005/06/22 18:27:38  pwagner
! Cant have access declared outside module scope
!
! Revision 1.17  2003/05/14 23:33:33  dwu
! fix a dimension problem with ddm
!
! Revision 1.16  2002/10/08 17:08:07  pwagner
! Added idents to survive zealous Lahey optimizer
!
! Revision 1.15  2002/05/08 17:00:15  jonathan
! fix tangent height bug
!
! Revision 1.14  2001/10/30 20:57:38  dwu
! minor on transmission function
!
! Revision 1.13  2001/10/24 22:50:26  dwu
! revise teff calculation
!
! Revision 1.12  2001/10/24 22:09:53  dwu
! provent cases where tangent heights are greater than model top
!
! Revision 1.11  2001/10/19 19:39:49  dwu
! fix bug after changes
!
! Revision 1.10  2001/10/19 19:25:25  dwu
! follow-on fixes
!
! Revision 1.9  2001/10/19 19:16:14  dwu
! change Nz-1 to NZ
!
! Revision 1.8  2001/10/19 17:11:52  dwu
! revise teff calculation
!
! Revision 1.7  2001/10/12 22:38:24  dwu
! rewrite transmission function calculation
!
! Revision 1.6  2001/10/11 20:03:00  jonathan
! *** empty log message ***
!
! Revision 1.5  2001/10/10 02:49:35  dwu
! fix problem in trans calculation
!
! Revision 1.4  2001/10/09 22:12:36  jonathan
! fix trans func
!
! Revision 1.3  2001/09/21 15:51:37  jonathan
! modified F95 version
!
@


1.19
log
@Delete USE for unreferenced entity and declarations for unused variables
@
text
@d27 1
a27 1
       "$RCSfile: ModelOutput.f90,v $"
d215 1
a216 1
!---------------------------- RCS Ident Info -------------------------------
d218 2
a219 3
       "$Id: ModelOutput.f90,v 1.18 2005/06/22 18:27:38 pwagner Exp $"
  character (len=len(idParm)), save :: Id = idParm
!---------------------------------------------------------------------------
d221 1
d223 1
d228 3
@


1.18
log
@Cant have access declared outside module scope
@
text
@a18 1
      use Interpack, only: LOCATE
d27 1
a27 1
       "$RCSfile: $"
d66 1
a66 1
      REAL(r8) :: RE, xout, sum
d69 1
a69 1
      INTEGER :: I,K,J,iflag, JM
d218 1
a218 1
       "$Id: $"
d227 3
@


1.17
log
@fix a dimension problem with ddm
@
text
@d2 10
a11 2
! Copyright (c) 1999, California Institute of Technology.  ALL RIGHTS RESERVED.
! U.S. Government Sponsorship under NASA Contract NAS7-1407 is acknowledged.
d26 3
a28 6
 !---------------------------- RCS Ident Info -------------------------------
  character (len=*), private, parameter :: IdParm =                          &
    "$Id: ModelOutput.f90,v 1.16 2002/10/08 17:08:07 pwagner Exp $"
  character (len=len(idParm)), private :: Id = idParm
  character (len=*), private, parameter :: ModuleName=                       &
    "$RCSfile: ModelOutput.f90,v $"
d30 1
a30 1
 !---------------------------------------------------------------------------
d217 5
d228 3
@


1.16
log
@Added idents to survive zealous Lahey optimizer
@
text
@d20 1
a20 1
    "$Id: ModelOutput.f90,v 1.15 2002/05/08 17:00:15 jonathan Exp $"
d131 5
a135 4
      call INTERPOLATEVALUES(zh,reshape(ddm(1,:),(/nh-1/)),&
        & za,dm(1,1:NZ-1),method='Linear')
      call INTERPOLATEVALUES(zh,reshape(ddm(2,:),(/nh-1/)),&
        & za,dm(2,1:NZ-1),method='Linear')
d218 3
@


1.15
log
@fix tangent height bug
@
text
@d20 1
a20 1
    "$Id: ModelOutput.f90,v 1.14 2001/10/30 20:57:38 dwu Exp $"
d24 1
d210 4
d217 3
@


1.14
log
@minor on transmission function
@
text
@d20 1
a20 1
    "$Id: ModelOutput.f90,v 1.13 2001/10/24 22:50:26 dwu Exp $"
d31 1
a31 1
        &                    N,RE, noS, Slevl)
d72 2
a73 1
      trans = 0._r8            ! initialization
d76 1
d79 1
d82 1
d111 3
d143 1
a143 1

d198 3
d212 3
@


1.13
log
@revise teff calculation
@
text
@d20 1
a20 1
    "$Id: ModelOutput.f90,v 1.12 2001/10/24 22:09:53 dwu Exp $"
d99 6
a104 2
        where(trans < 10._r8) trans = exp(-trans)
        where(trans > 10._r8) trans = 0._r8
d202 3
@


1.12
log
@provent cases where tangent heights are greater than model top
@
text
@d20 1
a20 1
    "$Id: ModelOutput.f90,v 1.11 2001/10/19 19:39:49 dwu Exp $"
d136 2
a137 2
               do j=nh,2,-1
                  if (yz(j) .le. ht) then
d198 3
@


1.11
log
@fix bug after changes
@
text
@d20 1
a20 1
    "$Id: ModelOutput.f90,v 1.10 2001/10/19 19:25:25 dwu Exp $"
d128 4
a131 3
         DO I=1,NT

            HT = ZT(I)   
d133 3
d148 1
a148 1
               DO K=NH-1,iflag+1,-1
d164 1
a164 1
               DO K=iflag+1,NH-1
d188 1
a188 1
         ENDDO
d198 3
@


1.10
log
@follow-on fixes
@
text
@d20 1
a20 1
    "$Id: ModelOutput.f90,v 1.9 2001/10/19 19:16:14 dwu Exp $"
d144 1
a144 1
               DO K=NH-1,iflag,-1
d160 1
a160 1
               DO K=iflag,NH-1
d194 3
@


1.9
log
@change Nz-1 to NZ
@
text
@d20 1
a20 1
    "$Id: ModelOutput.f90,v 1.8 2001/10/19 17:11:52 dwu Exp $"
d116 3
a118 3
      call INTERPOLATEVALUES(zh,deltau,za,beta,method='Linear')
      call INTERPOLATEVALUES(zh,deltauc,za,betac,method='Linear')
      call INTERPOLATEVALUES(zh,ddz,za,dz,method='Linear')
d120 1
a120 1
        & za,dm(1,:),method='Linear')
d122 1
a122 1
        & za,dm(2,:),method='Linear')
d194 3
@


1.8
log
@revise teff calculation
@
text
@d20 1
a20 1
    "$Id: ModelOutput.f90,v 1.7 2001/10/12 22:38:24 dwu Exp $"
d54 2
a55 2
      REAL(r8) :: BETA(NZ-1)                        ! TOTAL EXTINCTION
      REAL(r8) :: BETAc(NZ-1)                       ! CLOUDY-SKY EXTINCTION
d57 1
a57 1
      REAL(r8) :: Dm(N,NZ-1)                        ! MASS-MEAN-DIAMETER
d194 3
@


1.7
log
@rewrite transmission function calculation
@
text
@d20 1
a20 1
    "$Id: ModelOutput.f90,v 1.6 2001/10/11 20:03:00 jonathan Exp $"
d107 1
a107 1
         ZH(I)=-(LOG10(YP(I+1))+LOG10(YP(I)))/2.
d113 1
a113 1
         ZA(I)=-(LOG10(PRESSURE(I+1))+LOG10(PRESSURE(I)))/2.
d132 2
a133 4
            IF (HT .GE. 0.) THEN

               do j=1,nh
                  if (yz(j) .ge. ht) then
d141 2
a142 2
               C_EXT = 0.
               A_EXT = 0.
d144 1
a144 1
               DO K=NH-1,iflag+1,-1
d146 2
a147 3
                  IF (YZ(K) .GT. HT) THEN
                     TGT=YZ(K-1) 
                     IF(YZ(K).EQ.HT)THEN
a156 1
                  ENDIF
d160 1
a160 1
               DO K=iflag+1,NH-1
a161 1
                  IF (YZ(K) .LT. HT) THEN
d163 1
a163 1
                     IF(YZ(K).EQ.HT)THEN
d165 1
a165 1
                     ENDIF 
a172 1
                  ENDIF
d178 1
a178 1
               if (TAUeff(I) .gt. 0.) then
d181 1
a181 1
                  SS(I)=0.
a182 1
            ENDIF
d194 3
@


1.6
log
@*** empty log message ***
@
text
@d20 1
a20 1
    "$Id: ModelOutput.f90,v 1.5 2001/10/10 02:49:35 dwu Exp $"
d47 1
a47 2
      REAL(r8) :: Trans(NH-1,NT)                       ! Clear Transmission Func 
      REAL(r8) :: YZavg(NH-1)                       ! Clear Transmission Func grid
d49 3
a51 3
      REAL(r8) :: delTAU100(NH-1)                   ! 100% AIR EXTINCTION 
      REAL(r8) :: delTAU(NH-1)                      ! TOTAL EXTINCTION 
      REAL(r8) :: delTAUc(NH-1)                     ! CLOUDY-SKY EXTINCTION
d63 1
a63 1
      REAL(r8) :: ZH(NH-1),ZA(NZ-1), ZS(NoS)
d76 19
a94 10
        do i=1,noS
          zs(i) = sqrt(Slevl(i)**2+(re+zt(k))**2) - (re+zt(k))
        enddo
      
        DO I=NH-1,1,-1
          yzavg(i) = (yz(i)+yz(i+1))/2
          if(yzavg(i) > zt(k)) then
            sum = sum +  deltau100(i)*sqrt(re/2/(yzavg(i)-zt(k)))
            trans(i,k) = sum
	    jm = i
d96 1
a97 1
        trans(jm:nh-1,k) = exp(-trans(jm:nh-1,k))
d99 4
a102 2
      CALL INTERPOLATEVALUES(yzavg(jm:nh-1),reshape(trans(jm:nh-1,k),(/nh-jm/)), &
	& zs, trans_out(:,k),method='Linear')
d201 3
@


1.5
log
@fix problem in trans calculation
@
text
@d20 1
a20 1
    "$Id: ModelOutput.f90,v 1.4 2001/10/09 22:12:36 jonathan Exp $"
d31 1
a31 1
        &                    N,ISWI,RE, noS, Slevl)
d65 1
a65 1
      INTEGER :: I,K,J,iflag, JM, ISWI
a117 2
      IF (ISWI .EQ. 0) THEN

a182 1
      ENDIF
d191 3
@


1.4
log
@fix trans func
@
text
@d20 1
a20 1
    "$Id: ModelOutput.f90,v 1.3 2001/09/21 15:51:37 jonathan Exp $"
d86 1
a87 1
          where(trans(:,k) .ne. 0._r8) trans(:,k) = exp(-trans(:,k))
d89 1
d91 2
a92 2
      CALL INTERPOLATEVALUES(yzavg,reshape(trans(:,k),(/nh-1/)),zs, &
        & trans_out(:,k),method='Linear')
d194 3
@


1.3
log
@modified F95 version
@
text
@d13 1
d20 1
a20 1
    "$Id: ModelOutput.f90,v 1.2 2001/09/20 23:31:07 jonathan Exp $"
d31 1
a31 1
        &                    N,ISWI,RE)
d34 1
a34 1
      INTEGER :: NH, NZ, NT, N
d37 1
d40 2
d47 3
a49 1
      REAL(r8) :: Trans(NH-1)                       ! Clear Transmission Func 
d54 1
a54 1
      REAL(r8) :: Trans_out(NZ-1)                   ! TOTAL Clear Trans Func
d62 1
a62 1
      REAL(r8) :: RE
d64 1
a64 1
      REAL(r8) :: ZH(NH-1),ZA(NH-1)
a71 7
      DO I=1,NH-1
        TRANS(I)=0._r8
      ENDDO
        TRANS(NH-1) = DELTAU100(NH-1)
      DO I=NH-2,1,-1
        TRANS(I)=TRANS(I+1)+DELTAU100(I)   ! only clear sky absorption
      ENDDO
d73 20
a92 1
      Trans = exp(- Trans)
d105 7
a111 25
      DO J=1,NZ-1
      
         CALL LOCATE (ZH,NH-1, NH-1, ZA(J),JM)
         
         Trans_out(J)=((ZH(JM+1)-ZA(J))*TRANS(JM)+(ZA(J)-ZH(JM))*   &
     &                TRANS(JM+1))/(ZH(JM+1)-ZH(JM))
     
         BETA(J)=((ZH(JM+1)-ZA(J))*delTAU(JM)+(ZA(J)-ZH(JM))*   &
     &                delTAU(JM+1))/(ZH(JM+1)-ZH(JM))

         BETAc(J)=((ZH(JM+1)-ZA(J))*delTAUc(JM)+(ZA(J)-ZH(JM))* &
     &                delTAUc(JM+1))/(ZH(JM+1)-ZH(JM))             


         Dm(1,J)=((ZH(JM+1)-ZA(J))*DDm(1,JM)+(ZA(J)-ZH(JM))*        &
     &                DDm(1,JM+1))/(ZH(JM+1)-ZH(JM))             

         Dm(2,J)=((ZH(JM+1)-ZA(J))*DDm(2,JM)+(ZA(J)-ZH(JM))*        &
     &                DDm(2,JM+1))/(ZH(JM+1)-ZH(JM))             

         DZ(J)=((ZH(JM+1)-ZA(J))*DDZ(JM)+(ZA(J)-ZH(JM))*            &
     &                DDZ(JM+1))/(ZH(JM+1)-ZH(JM))             

      ENDDO

d193 3
@


1.2
log
@*** empty log message ***
@
text
@d19 1
a19 1
    "$Id: ModelOutput.f90,v 1.1 2001/09/20 18:27:19 jonathan Exp $"
d192 1
a192 1
! $Log: ModelOutput.f90,v      
@


1.1
log
@*** empty log message ***
@
text
@d11 1
d19 1
a19 1
    "$Id: ModelOutput.f90,v 1.6 2001/09/20 17:56:13 jonathan Exp $"
@

