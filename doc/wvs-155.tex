% To make the graphics
% tgif -print -epsi wvs-128-QTM-1.obj; epstopdf wvs-128-QTM-1.eps
% tgif -print -jpeg wvs-128-QTM-1.obj
% tgif -print -epsi wvs-128-QTM-2.obj; epstopdf wvs-128-QTM-2.eps
% tgif -print -jpeg wvs-128-QTM-2.obj
% tgif -print -epsi wvs-128-QTM-3.obj; epstopdf wvs-128-QTM-3.eps
% tgif -print -jpeg wvs-128-QTM-3.obj
% tgif -print -epsi Barycentric.obj; epstopdf Barycentric.eps
% tgif -print -jpeg Barycentric.obj

\makeatletter\let\ifGm@compatii\relax\makeatother
\documentclass[landscape]{beamer}
\usepackage[nofancy,notoday]{rcsinfo}
\usepackage{color}
\usepackage{amsmath}
\usepackage{moreverb}
\usepackage{multicol}
\usepackage{graphicx}
\usepackage{floatflt}
%
\renewcommand{\b}{\mathbf}
\renewcommand{\d}{\text{d}}
\newcommand{\T}{^{T}}
\newcommand{\cs}[1]{$_{\text{#1}}$}
\newcommand{\inv}{^{\mathrm -1}}
\newcommand{\cp}[1]{$^{\text{#1}}$}
\newcommand{\degsym}{\ensuremath{^\circ}}
\newcommand{\newframe}[2][]{\begin{frame}\frametitle{\hfill #2 \hfil}}

\parskip 2pt
%
% -----------------------------------------------------------------------------
%
\title{Summary of QTM}
\subtitle{wvs-155r1}
\author{Van Snyder}
\date{24 September 2019}
\titlegraphic{\includegraphics[width=1.0in]{eos_mls_logo_onpink}}

\begin{document}
\sloppy
%
% -----------------------------------------------------------------------------
%
\begin{frame}
 \titlepage
\end{frame}
%
% -----------------------------------------------------------------------------
%
\newframe{Geoffrey Dutton}

In {\bf A Hierarchical Coordinate System for Geoprocessing and
Cartography}, Geoffrey Dutton described the {\bf Quaternary Triangular
Mesh}, or {\bf QTM}.

\begin{itemize}

\item The ratio of the area of the smallest facet to the area of the
      largest facet is bounded by about 6/11.
      
\item In a lat-lon grid, this ratio goes to zero at the poles.

\item Start with an inscribed octahedron, projecting triangular facets to
      octants on the Earth surface.

\item Where a facet is too big, divide it into four smaller ones by
      connecting the midpoints of the edges.

\end{itemize}

\end{frame}
%
% -----------------------------------------------------------------------------
%
\newframe{Geoffrey Dutton}

\begin{centering}
\includegraphics[scale=0.5]{wvs-128-QTM-1}\\
From Dutton's book, showing uniform refinement to the
fourth level \\
\end{centering}

\end{frame}
%
% -----------------------------------------------------------------------------
%
\newframe{Construction}

\begin{itemize}

\item By construction, in a globally-uniform refinement to level $\ell$,
      where $\ell = 1$ is the initial octahedron, the number of facets is
%
      \begin{equation*}
      f_\ell = 8 \times 4^{\ell-1} = 2^{2 \ell + 1}
      \end{equation*}

\item Smaller facets are formed by bisecting edges, so the number of
      vertices $v_\ell = v_{\ell-1} + e_{\ell-1}$, where $v_1 = 6$ and
      $e_1 = 12$.

\item From Euler's polyhedron formula, $e_\ell = f_\ell + v_\ell - 2$.

\item Solving these equations,
%
      \begin{equation*}\begin{split}
      v_\ell =\,& 2^{2\ell} + 2 \\
      e_\ell =\,& 3 \times 2^{2 \ell}
      \end{split}\end{equation*} 

\end{itemize}

\end{frame}
%
% -----------------------------------------------------------------------------
%
\newframe{Construction}

\begin{itemize}

\item Counting the poles and equator, vertices are on $2^{\ell+1}$
      equally-spaced parallels of latitude.\\[10pt]

\item Along the $k^\text{th}$ parallel of latitude from each pole,
      vertices are on $4k$ equally-spaced longitudes.\\[10pt]

\item Therefore, unlike on a lat-lon grid, the set of latitudes on one
      parallel of latitude is not the same as the set of latitudes on an
      adjacent parallel of latitude.

\end{itemize}

\end{frame}
%
% -----------------------------------------------------------------------------
%
\newframe{Facet identification}

Facet identifier, called \emph{QTM ID} or \emph{QID} consists of

\begin{itemize}

\itemsep 10pt

\item Octant number, followed by

\item a sequence of two-bit numbers that describe which sub-facet of a
      larger facet contains the smaller facet.

\item Two-bit numbers can be considered to be base-4 digits.

\item Too-large facets are divided into four smaller facets.

\item Hence: \emph{Quaternary
      Triangular Mesh}.

\end{itemize}

\end{frame}
%
% -----------------------------------------------------------------------------
%
\newframe{Resolution}

\begin{itemize}

\itemsep 10pt

\item Internally, the octant number is shifted from the range $1\cdots8$
      to the range $8 \cdots 15$, allowing to determine unambiguously the
      number of digits in the QID, and thereby the facet resolution.

\item Four-bit octant number and two-bit sub-facet number allows QIDs for
      thirteen levels of refinement to fit in a 31-bit integer.

\item At the $13^\text{th}$ level of refinement, the height of a facet
      (north- south extent) is about 1.2 km.

\item Using a 63-bit integer would allow 29 levels of refinement.

\item At the $29^\text{th}$ level of refinement, the height of a facet is
      about 4 cm.

\end{itemize}

\end{frame}
%
% -----------------------------------------------------------------------------
%
\newframe{ZOT projection and facet numbering}

Dutton developed a simple way, called the \emph{Zenithial OrthoTriangular}
projection, or ZOT projection, to identify facets within a QTM, and to
compute the facets within which a position is contained.

\begin{centering}
\includegraphics[scale=0.4,angle=270]{wvs-128-QTM-2}\\[5pt]
ZOT projections of refinements to levels 2 and 3, from Dutton's
book\\
\end{centering}

\end{frame}
%
% -----------------------------------------------------------------------------
%
\newframe{ZOT projection and facet numbering}

\begin{centering}
\includegraphics[scale=0.375,angle=270]{wvs-128-QTM-2}\\
\end{centering}

\begin{itemize}

\item Center is the north pole. Corners are the south pole.

\item Heavy lines are edges of the octahedron.

\item Outer boundary consists of southern-hemisphere meridians.

\item Halves of each outer boundary are aliased -- the same
      southern-hemisphere meridian.

\item Fold the corners under. The aliased edges come together, and the
      south pole corners all come to the center.

\end{itemize}

\end{frame}
%
% -----------------------------------------------------------------------------
%
\newframe{ZOT projection and facet numbering}

\begin{centering}
\includegraphics[scale=0.375,angle=270]{wvs-128-QTM-2}\\
\end{centering}

\begin{itemize}

\item Diagonal lines are parallels of latitide.

\item Diagonal heavy lines are the equator.

\item Meridians are straight lines from the poles to the equator.  The
      dotted red line is the $45^\circ$ meridian, and the dotted blue line
      is the $22.5^\circ$ meridian.

\item Narrow lines are boundaries of level-2 refinement. Dashed lines are
      boundaries of level-3 refinement.

\end{itemize}

\end{frame}
%
% -----------------------------------------------------------------------------
%
\newframe{ZOT projection and facet numbering}

\begin{centering}
\includegraphics[scale=0.4,angle=270]{wvs-128-QTM-2}\\
\end{centering}

\begin{itemize}

\item Vertices are assigned \emph{basis numbers} in $1 \cdots 3$.

\item To start, poles have basis number 1, $0^\circ$ and $180^\circ$
      equatorial vertices have 2, $90^\circ$ and $270^\circ$ have 3.

\end{itemize}

\end{frame}
%
% -----------------------------------------------------------------------------
%
\newframe{ZOT projection and facet numbering -- subdivision}

\begin{centering}
\includegraphics[scale=0.35,angle=270]{wvs-128-QTM-2}\\
\end{centering}

\begin{itemize}

\item The basis number of the midpoint is $B_n = 6 - (B_a + B_b)$ where
      $B_a$ and $B_b$ are basis numbers of its end points.

\item QID of each initial facet is its octant number.

\item QID of the central facet is the QID of the parent facet, with
      zero appended.

\item QID of each other facet is the QID of the parent facet with the
      basis number of the parent vertex appended.

\end{itemize}

\end{frame}
%
% -----------------------------------------------------------------------------
%
\newframe{ZOT projection}

\vspace*{-6pt}
\begin{centering}
\includegraphics[scale=0.375,angle=270]{wvs-128-QTM-2}\\
\end{centering}

\begin{itemize}

\item Each facet is an isosceles right triangle.

\item The right angle is at the vertex that is opposite to the edge that
      is a parallel of latitude, and is therefore not at the same distance
      from either pole as any other vertex; this vertex is called the
      \emph{pole node}.

\item One edge incident on the pole node is horizontal and incident on the
      \emph{xnode}; the other is vertical and incident on the
      \emph{ynode}.

\end{itemize}

\end{frame}
%
% -----------------------------------------------------------------------------
%
\newframe{ZOT co\"ordinates}

\begin{itemize}
\itemsep 5pt

\item ZOT co\"ordinates are in the range $-1 \cdots 1$.

\item North pole is at $(0,0)$ (center of the ZOT projection).

\item South pole is at $(\pm 1, \pm 1)$ (corners of the ZOT projection).

\item Mapping from longitude and latitude to ZOT co\"ordinates uses the
      $\ell_1$ metric and is computed by the function {\tt Geo\_to\_ZOT}
      in the module {\tt QTM\_m}.

\end{itemize}

\end{frame}
%
% -----------------------------------------------------------------------------
%
\newframe{ZOT co\"ordinates}

Given longitude $\lambda \geq 0$ in degrees and latitude $-90 \leq \theta
\leq 90$ in degrees, compute initial ZOT co\"ordinates using
%
\begin{equation*}\begin{split}
\delta x =\,& 1 - \frac{| \theta |}{ 90 }\\
x = \,& \delta x \,
    \frac{ \lfloor \lambda \rfloor \!\!\!\!\mod 90 + \lambda - \lfloor \lambda \rfloor }
    {90} \\
y = \,& \delta x - x \\
\end{split}\end{equation*}
%
\vspace*{-15pt}
%
\begin{itemize}

\item Then in the southern hemisphere, replace $x = 1 - y$ and $y = 1 - x$.

\item Then in even-numbered octants exchange $x$ and $y$.

\item Then in the top half of ZOT space, negate $y$, and in the left half,
      negate $x$.

\end{itemize}

No square roots or trigonometric functions are necessary.

(Maybe in {\tt Geo\_to\_ZOT} this should be done by an eight-way SELECT
CASE construct using the octant number.)

\end{frame}
%
% -----------------------------------------------------------------------------
%
\newframe{Computing QID for a facet}

To compute the QID of a facet containing a $(\lambda,\theta)$ point:

\begin{itemize}

\item Compute its $x$ and $y$ ZOT co\"ordinates.

\item Use its octant number as the initial QID.

\item While the level of the identified facet does not have sufficient
      resolution, determine a sub-facet QID:

  \begin{itemize}
    \itemsep 4pt

    \item Compute the distances $\d x$ and $\d y$ in ZOT co\"ordinates
          from the pole node.

    \item If $|\d x| + |\d y| < s/2$, where $s$ is the length in ZOT
          co\"ordinates of a horizontal or vertical edge of the parent
          facet, append the basis number of the \emph{pole node} to the
          QID of the parent facet,

    \item Otherwise if $|\d x| > s/2$ or $|\d y| > s/2$, append the basis
          number of the \emph{xnode} or \emph{ynode}, respectively,

    \item Otherwise append zero.

  \end{itemize}

\end{itemize}

If $|\d x| > s/2$ and $|\d y| > s/2$, you made a mistake along the way and
you're looking in the wrong facet.

\end{frame}
%
% -----------------------------------------------------------------------------
%
\newframe{Computing QID for a sub-facet}

\begin{centering}
\includegraphics{wvs-128-QTM-3}\\
Calculation of sub-facet and QID, from Dutton's book\\
\end{centering}

\end{frame}
%
% -----------------------------------------------------------------------------
%
\newframe{QTM in MLS}

\begin{itemize}
\itemsep 5pt

\item Assume polar circumference is 40,000 km (the original definition of
      the meter).

\item At level $\ell$ of refinement, the height of a facet, i.e., the
      distance from its pole node to the opposite edge, is
      20,000/$2^\ell$ km.

\item Same distance for every facet at the same level of refinement
      because diagonal edges are equally-spaced parallels of latitude.

\item With $\ell = 7$ the distance is 156.25 km, or $\approx 1.4^\circ$
      latitude.

\item QTM over entire Earth will not be used for MLS:

  \begin{itemize}

  \item $v_7 = 2^{14} + 2 = 16,386$ profiles.

  \item Solving for 20 quantities on 72 levels, Jacobian would have
        $16,386 \times 20 \times 72 = 23,585,840$ columns.

  \item QTM will be constructed within a specified polygon.

  \end{itemize}

\end{itemize}

\end{frame}
%
% -----------------------------------------------------------------------------
%
\newframe{Identifying vertices}

\begin{itemize}
\itemsep 8pt

\item Each facet is bounded by three vertices.

\item Each vertex that is not a vertex of the octahedron is a member of
      six facets.

\item Each vertex that is a vertex of the octahedron is a member of
      four facets.

\item Every vertex needs an unique sequential index number, which is used
      to calculate a column subscript in the Jacobian, and a subscript in
      the state vector.

\end{itemize}

\end{frame}
%
% -----------------------------------------------------------------------------
%
\newframe{Constructing a QTM within a polygon}

\begin{enumerate}

\item Specify a point that is within the polygon because ``inside''
      is ambiguous on the surface of the Earth.

\item If a polygon has an edge that crosses a southern-hemisphere meridian
      of the original octahedron, add edges in the ZOT projection of the
      polygon along the crossed meridian to join the aliased points. This
      closes the polygon in ZOT co\"ordinates.

\item Construct the QTM top down, starting with level 1.

\item If a facet has a vertex within the polygon, i.e., if a line from
      that vertex to the ``inside'' vertex crosses an even number
      (including zero) of the edges of the polygon,\\[4pt]

      or the polygon has a vertex in the facet,\\[4pt]
      
      or an edge of the polygon intersects an edge of the facet,\\[4pt]

      and the level of refinement of that facet is not sufficient, refine
      that facet.

\end{enumerate}

\end{frame}
%
% -----------------------------------------------------------------------------
%
\newframe{Constructing a QTM within a polygon}

\begin{enumerate}
\setcounter{enumi}{4}

\item When a facet is constructed, add its vertices that are within the
      polygon to the set of vertices that are geolocations for the state
      vectors.\\[5pt]

      If the facet is at the specified refinement level, and it has any
      vertices within the polygon, add all its vertices to the set, so
      that it is possible to interpolate within it, even if some of its
      vertices are outside the polygon.\\[5pt]

      Each added vertex gets an unique serial number -- its ordinal number
      among unique vertices as they are discovered to be members of the
      set. Its serial number is used to calculate a column subscript of
      the Jacobian, and a subscript of the state vector.\\[5pt]

\end{enumerate}

\end{frame}
%
% -----------------------------------------------------------------------------
%
\newframe{Constructing a QTM within a polygon}

\begin{itemize}

\item A QTM uniformly refined to level $\ell$ has at most $2^\ell$+1 ZOT
      $x$ and $y$ co\"ordinates, each set equally spaced in $[-1 \cdots 1]$.

\item Therefore $0 \leq 2^\ell ( 1+x) \leq 2^{\ell+1}$ and
                $0 \leq 2^\ell ( 1+y) \leq 2^{\ell+1}$ are integers.

\item If $|x| = 1$ use $\eta = |y|$; if $|y| = 1$ use $\xi = |x|$ \dots\
      because southern-hemisphere meridians are aliased. Otherwise, use
      $\xi = x$ and $\eta = y$.

\item Then $0 \leq 2^{\ell+1} ( 1 + \xi + ( 2^\ell + 1 ) ( 1 + \eta ))
      \leq 2^{2 \ell + 2}$ is an unique vertex identifier. This is
      computed by the function {\tt Condense\_ZOT} bound to the type {\tt
      QTM\_t} in the module {\tt QTM\_m}.

\item In MLS, $\ell\leq 7$.  Therefore, $2^{2\ell+2} \leq 2^{30}$ fits in
      a 31-bit integer.

\item A hash table containing these unique identifiers is used to prevent
      creating duplicate representations of QTM vertices.

\end{itemize}

\end{frame}
%
% -----------------------------------------------------------------------------
%
\newframe{Constructing a QTM within a polygon}

\begin{enumerate}
\setcounter{enumi}{5}

\item As the QTM is constructed, construct a quadtree -- a tree in which
      each vertex has four sons.  Each vertex represents a facet.\\[8pt]

      A vertex of the quadtree contains the serial numbers of QTM vertices
      of the facet that it represents, or zero for vertices that are
      outside the polygon and not vertices of a facet at the specified
      level of refinement.\\[8pt]

      All vertices of facets at the specified level of refinement have
      serial numbers, even if some are outside the polygon. Every facet at
      the specified level of refinement has at least one vertex in the
      polygon. Therefore, there might be geophysical values slightly
      outside the polygon.\\[8pt]

      Internal vertices of the quadtree represent facets that are not at
      the finest level of refinement.

\end{enumerate}

\end{frame}
%
% -----------------------------------------------------------------------------
%
\newframe{Using a QTM}

When a geophysical value is needed at a $(\lambda,\theta)$ point

\begin{enumerate}

\item Determine its ZOT co\"ordinates $(x,y)$.

\item Determine the QID of the facet at the desired level of
      refinement.

\item Use the digits of the QID to traverse the quadtree to find the facet
      that contains $(\lambda,\theta)$.\\[4pt]

      Cost is proportional to the level of refinement, not the size of the
      QTM.

\item If the facet containing $(\lambda,\theta)$ has serial numbers for
      its vertices, interpolate within that facet from the state vector to
      $(\lambda,\theta)$ or to ZOT co\"ordinates $(x,y)$.\\[4pt]

      $(\lambda,\theta)$ might be a tiny bit outside the polygon, but
      still within a facet having one vertex within the polygon.

\end{enumerate}

\end{frame}
%
% -----------------------------------------------------------------------------
%
\newframe{Interpolate to exterior points}

\begin{enumerate}
\setcounter{enumi}{4}

\item If the facet containing $(\lambda,\theta)$ does not have serial
      numbers for its vertices, we can't interpolate to
      $(\lambda,\theta)$.

  \begin{enumerate}

    \item\label{nearest} Choose a point $P$ on the polygon boundary that
      is nearest to $(\lambda,\theta)$:

    \begin{enumerate}

      \item Find the polygon vertex that is nearest to
            $(\lambda,\theta)$.

      \item Construct lines from $(\lambda,\theta)$ that are
            perpendicular to the two polygon edges incident on that
            polygon vertex.

      \item If either of those lines intersects an incident edge between
            the nearest vertex and an adjacent one, choose $P$ to be at
            the intersection that is closer to $(\lambda,\theta)$ (there
            might be two if the polygon is not convex).

      \item Otherwise choose $P$ to be at the polygon vertex nearest to
            $(\lambda,\theta)$.

    \end{enumerate}

  \item Find the facet $F$ containing $P$.

  \item Interpolate within $F$ to $P$ and use that value at
        $(\lambda,\theta)$.

  This is the 2-D generalization of constant extrapolation.

  \end{enumerate}

\end{enumerate}

This could be done in $(\lambda,\theta)$ or $(x,y)$ co\"ordinates.

\end{frame}
%
% -----------------------------------------------------------------------------
%
\newframe{Interpolate to exterior points -- alternative}


\begin{enumerate}
\setcounter{enumi}{4}

\item If the facet containing $(\lambda,\theta)$ does not have serial
      numbers for its vertices, we can't interpolate to
      $(\lambda,\theta)$.

  \begin{enumerate}

    \item\label{nearest} Choose a point $P$ on a facet boundary that
      is nearest to $(\lambda,\theta)$:

    \begin{enumerate}

      \item Find the vertex of a facet $F$ that is nearest to
            $(\lambda,\theta)$. This need only consider facets that have
            exactly one vertex within the polygon.

      \item Construct lines from $(\lambda,\theta)$ that are
            perpendicular to the two facet edges incident on that
            facet vertex.

      \item If either of those lines intersects an incident edge between
            the nearest vertex and an adjacent one, choose $P$ to be at
            the intersection that is closer to $(\lambda,\theta)$ (there
            might be two if the polygon is not convex).

      \item Otherwise choose $P$ to be at the facet vertex nearest to
            $(\lambda,\theta)$.

    \end{enumerate}

  \item Interpolate within $F$ to $P$ and use that value at
        $(\lambda,\theta)$.

  This is the 2-D generalization of constant extrapolation.

  \end{enumerate}

\end{enumerate}

I don't believe the code does this yet. It would be a bit more accurate
for points very near to but outside the polygon.

\end{frame}
%
% -----------------------------------------------------------------------------
%
\newframe{Using a QTM}

\parskip 8pt

ZOT polygons are not comformal to spherical polygons because edges of ZOT
polygons are straight lines in ZOT co\"ordinates, while edges of spherical
triangles are segments of great circles.

A point that is within (outwith) a ZOT polygon might be outwith (within) a
spherical polygon.

Assuming the specified polygon is defined by $(\lambda,\theta)$
co\"ordinates for its vertices, and its edges are great circles, rather
than worry about this, choose a slightly larger polygon that encloses the
interesting points (and maybe a few others).

There would (almost) always be facets at the specified level of refinement
that span the polygon boundary, resulting in vertices outside the polygon.
You'll (almost) always have a few more than the ``interesting'' points,
unless you choose a polygon such that every point (not just every vertex)
on its boundary is on a facet edge or at a facet vertex.

\end{frame}
%
% -----------------------------------------------------------------------------
%
\newframe{Barycentric co\"ordinates}

\parskip 6pt

The unnormalized barycentric co\"ordinates $\hat\lambda_{s_k}$ of a point
$(x,y)$ within a triangle having vertices $(x_{s_i},y_{s_i})$, where $i
\in \{1,2,3\}$ and $s_i$ is the serial number of the QTM facet's vertex
that has basis number $i$, are

\begin{equation*}
\hat\lambda_{s_k} = (y_{s_j}-y_{s_i})(x-x_{s_i}) -
                    (x_{s_j}-x_{s_i})(y-y_{s_i})
\end{equation*}

where $i$, $j$, $k$ are distinct and in $\{1,2,3\}$.

The signs depend upon the ordering of the vertices.

Normalized co\"ordinates $\lambda_{s_k}$ are obtained by dividing the
unnormalized co\"ordinates by their sum. Therefore, the ordering doesn't
matter.

If any normalized co\"ordinate is negative, the point $(x,y)$ is outside
the triangle.

\end{frame}
%
% -----------------------------------------------------------------------------
%
\newframe{Barycentric interpolation}

Assuming $(x,y)$ is within the facet, the value $f(x,y)$ interpolated from
$\{f(x_{s_k},y_{s_k}) \,|\, k = 1\cdots3 \}$ is

\begin{equation*}
f(x,y) = \sum_{k=1}^3 \lambda_{s_k} f(x_{s_k},y_{s_k})\,.
\end{equation*}

The system was introduced in 1827 by August Ferdinand M{\"o}bius (yeah,
THAT August Ferdinand M{\"o}bius).

Barycentric co\"ordinates can be computed using either longitude and
latitude, or ZOT co\"ordinates, which would result in slightly different
values for $\lambda_{s_k}$ and $f(x,y)$.

\end{frame}
%
% -----------------------------------------------------------------------------
%
\newframe{Barycentric interpolation}

The normalized barycentric interpolation coefficient $\lambda_a$ used to
interpolate from the point $a$ to the point $(x,y)$ is the same as the
ratio of the area of triangle $A$ to the area of triangle $abc$, and
similarly for the other vertices of the triangle.

\begin{centering}
\includegraphics[scale=0.6]{Barycentric}\\
\end{centering}

\end{frame}
%
% -----------------------------------------------------------------------------
%
\newframe{Three dimensions}

The state vector uses a stacked and coherent basis: The same QTM at every
level, and the same set of levels on every line perpendicular to a surface
QTM vertex.

To interpolate to a point $(x,y,z)$, compute the barycentric co\"ordinates
$\lambda_{s_k}$ of $(x,y)$. Use linear interpolation to compute an
interpolation coefficient $\mu_h = \frac{z_{h+1}-z}{z_{h+1}-z_h}$ from
$(z_h,z_{h+1})$ to $z$, assuming $z_h \leq z \leq z_{h+1}$, and $\mu_{h+1}
= 1 - \mu_h$.

This results in six interpolation weights $\eta_{s_k}j$ where $k
\in \{1,2,3\}$ and $j \in \{h,h+1\}$.  Then

\begin{equation*}
f(x,y,z) = \sum_{k=1}^3 \sum_{j=h}^{h+1} \lambda_{s_k}\mu_j
                                         f(x_{s_k},y_{s_k},z_j)
         = \sum_{k=1}^3 \sum_{j=h}^{h+1} \eta_{s_{k}j}
                                         f(x_{s_k},y_{s_k},z_j)
\end{equation*}

\end{frame}
%
% -----------------------------------------------------------------------------
%
\newframe{Three dimensions}

\dots\ and the derivative is

\begin{equation*}
\frac{\partial f(x,y,z)}{\partial f(x_{s_k},y_{s_k},z_j)} = \eta_{s_{k}j}
\,.
\end{equation*}

\end{frame}
%
% -----------------------------------------------------------------------------
%
\begin{frame}
 \titlepage
\end{frame}
%
% ----------------------------------------------------------------------------
%
\end{document}

% $Log$
% Revision 1.2  2019/09/24 02:35:04  vsnyder
% Correct some typos
%
% Revision 1.1  2019/09/24 01:58:55  vsnyder
% Initial commit
%
