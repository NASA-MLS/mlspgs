#	Makefile
#	targets: configure, clean, clean_objs, depends, tar, and SUBDIRS
#	true targets: the same make commands in $(SUBDIRS)
#	special treatment is reserved for srclib which contains
#	shared sources, but no Makefile: see 'depends' below
#
#special case:
#the 1st time through, before .configure exists yet,
#execute $(MLSBIN)/configure to create .configure

#This file name is usu. named Makefile but may be different;
#the same file names must be used in $(SUBDIRS)
#i.e., if you call are building this mls
#by calling make with a different Makefile name,
#say: make -f MakeFC
#then rename the Makefiles in /l2 and /lib also MakeFC

# "$Id$"

MakeFName = MakeFC
#
#To make mls with this file you must then use
#make -f $(MakeFName)

# where to store .configure
CONFDIR=.

# where configure and makemakedep.sh are stored
MLSBIN=util

# where the platforms directory is
PLATFORMS = .

# This will set our MLS platform, compiler. etc.
# w/o complaining if it does nor exist yet
-include $(CONFDIR)/.configure

SHELL = /bin/sh

#----------------------------------------------------------
#          Default levels
#You may choose whether "make -f MakeFC' defaults to making
#only l2 or all of l1 l2 and l3
#by commenting out exactly one of the following assignments
#(the prerequisite lib will always be made)

#comment out the following to make only l2
LEVELS = l1 l2 l3

#comment out the following to make l1, l2, and l3
#LEVELS = l2
#----------------------------------------------------------

SUBDIRS = lib $(LEVELS)

subdirs: $(SUBDIRS)

$(SUBDIRS):
	$(MAKE) -f $(MakeFName) -C $@

$(LEVELS): lib

tar: clean

.PHONY: configure depends subdirs $(SUBDIRS) clean clean_objs tar

configure:
	$(MLSBIN)/mlsconfigure -dc "$(CONFDIR)" -pc "$(PLATFORMS)" \
          -c "$(MLSF95)" -p "$(MLSPLAT)"

$(CONFDIR)/.configure:
	$(MLSBIN)/mlsconfigure -dc "$(CONFDIR)" -pc "$(PLATFORMS)" \
          -c "$(MLSF95)" -p "$(MLSPLAT)"

depends:
	@echo "Making dependencies for $(SUBDIRS)"; \
	 for dir in $(SUBDIRS); do \
	  $(MAKE) -f $(MakeFName) -C $$dir depends; \
	done; \
	echo "Making dependencies for srclib"; \
        cd srclib; \
        ../$(MLSBIN)/makemakedep.sh ../lib ../l2; \
        sed 's/OBJS =/srclib_objs =/' Makefile.dep > temp.dep; \
        mv temp.dep Makefile.dep

clean:
	@echo "Cleaning $(SUBDIRS)"; \
	 for dir in $(SUBDIRS); do \
	  $(MAKE) -f $(MakeFName) -C $$dir clean; \
	done

clean_objs:
	@echo "Cleaning objects from $(SUBDIRS)"; \
	 for dir in $(SUBDIRS); do \
	  $(MAKE) -f $(MakeFName) -C $$dir clean_objs; \
	done

tar:
	@echo "tar-ing $(SUBDIRS)"; \
	 for dir in $(SUBDIRS); do \
	  $(MAKE) -f $(MakeFName) -C $$dir tar; \
	done; \
	echo "tar-ing srclib"; \
        rm -f srclib.tgz; \
	tar hcvzf srclib.tgz srclib

# $Log$
# Revision 1.5  2000/11/06 23:26:58  pwagner
# Calculates srclib dependency
#
# Revision 1.4  2000/11/02 23:23:45  pwagner
# clean_objs option now available
#
# Revision 1.3  2000/10/24 21:08:22  pwagner
# Added tar option
#
# Revision 1.2  2000/10/23 17:16:34  pwagner
# Remove extra echo commands
#
# Revision 1.1  2000/10/18 21:57:35  pwagner
# First commit
#
