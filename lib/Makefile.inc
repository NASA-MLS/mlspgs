# Copyright (c) 1999, California Institute of Technology.  ALL RIGHTS RESERVED.
# U.S. Government Sponsorship under NASA Contract NAS7-1407 is acknowledged.

# $Id$
# $RCSfile$

# Notice that SDPToolkitSubstitute is not in SRCS or OBJS. The intent is
# that you will put SDPToolkitSubstitute.o into your build explicitly.
# When libmls.a is searched, the entry points in SDPToolkit will already
# be satisfied, so SDPToolkit will not be included from libmls.a

# Notice that tree_checker and getCF are not in SRCS or OBJS.  This is
# because they need entities from init_tables_module, which specifies the
# type-checking requirements for the configuration file for a particular
# application.  These modules should be compiled by the Makefile for that
# application.

# Notice that declaration_table, error_handler, string_table, symbol_table
# and tree depend on machine.  Since machine is not here, but in the
# several next-lower-level platform-dependent directories, it may not be
# included in dependencies that are generated by an automatic tool that
# looks only in the current working directory.

# Notice that test_multiply and test_sparsify are not in SRCS or OBJS.
# These are test drivers that are not part of the library.

SRCS =	Allocate_Deallocate.f90 GriddedData.f90 HDF-EOS.f90 Hdf.f90 \
        L1BData.f90 L2GPData.f90 MLSCF.f90 MLSCommon.f90 \
        MLSMessageModule.f90 MLSNumerics.f90 MLSPCF.f90 \
        MLSSignalNomenclature.f90 MLSStrings.f90 MatrixModule_0.f90 \
        Units.f90 dates_module.f90 declaration_table.f90 dump_0.f90 \
        error_handler.f90 expr_m.f90 gridded_data_module.f90 hash.f90 \
        heights_module.f90 intrinsic.f90 io_stuff.f90 lexer_core.f90 \
        lexer_m.f90 output_m.f90 parser.f90 string_table.f90 swapi.f90 \
        swapi_character_array.f90 swapi_character_scalar.f90 \
        swapi_double.f90 swapi_integer.f90 swapi_real.f90 \
        symbol_table.f90 symbol_types.f90 table_dumper.f90 \
        table_generator.f90 \
        toggles_core.f90 trace_m.f90 tree.f90 tree_types.f90 units.f90

OBJS =	Allocate_Deallocate.o GriddedData.o HDF-EOS.o Hdf.o L1BData.o \
        L2GPData.o MLSCF.o MLSCommon.o MLSMessageModule.o MLSNumerics.o \
        MLSPCF.o MLSSignalNomenclature.o MLSStrings.o MatrixModule_0.o \
        Units.o dates_module.o declaration_table.o dump_0.o \
        error_handler.o expr_m.o gridded_data_module.o hash.o \
        heights_module.o intrinsic.o io_stuff.o lexer_core.o lexer_m.o \
        output_m.o parser.o string_table.o swapi.o \
        swapi_character_array.o swapi_character_scalar.o swapi_double.o \
        swapi_integer.o swapi_real.o symbol_table.o symbol_types.o \
        table_dumper.o table_generator.o \
        toggles_core.o trace_m.o tree.o tree_types.o units.o

all: libmls.a SDPToolkitSubstitute.a

libmls.a: $(OBJS) machine.o
	ar ru $@ $?

SDPToolkitSubstitute.a: SDPToolkitSubstitute.o
	ar ru $@ $?

clean:
	rm -f *.o *.mod *.a

.SUFFIXES: .o .f90

#.f90.o:
%.o: %.f90
	$(F90) $(FOPTS) -c $I$S $I$(TOOLKIT) $<

# The following files have special build requirements.  If you regenerate
# the dependencies using an automatic tool, make sure you re-create these
# actions:

L1BData.o: MLSCommon.o MLSMessageModule.o
	$(F90) $(FOPTS) -c $I$S $(DUSTY) $S/L1BData.f90
L2GPData.o: Allocate_Deallocate.o HDF-EOS.o Hdf.o MLSCommon.o \
	MLSMessageModule.o swapi.o addItemToDatabase.f9h
	$(F90) $(FOPTS) -c $I$S $(DUSTY) $S/L2GPData.f90
dump_0.o: $(CF)/output_m.o
	$(F90) $(FOPTS) -c $I$S $S/dump_0.f90


# SDPToolkit needs several "include" files that aren't here.  If you
# regenerate the dependencies using an automatic tool, make sure you
# re-create these:

T = $(TOOLKIT)/include
SDPToolkit.o: MLSCommon.o $T/PGS_CBP.f $T/PGS_CBP_6.f $T/PGS_CSC_4.f \
        $T/PGS_EPH_5.f $T/PGS_IO.f $T/PGS_IO_1.f $T/PGS_MEM_7.f \
	$T/PGS_MET.f $T/PGS_MET_13.f $T/PGS_PC.f $T/PGS_PC_9.f \
	$T/PGS_SMF.f $T/PGS_TD.f $T/PGS_TD_3.f
	$(F90) $(FOPTS) -c $I$T $S/SDPToolkit.f90

# None of the following dependencies are special, and none of them have
# special build requirements.  It should be OK to replace them with
# automatically generated ones:

Allocate_Deallocate.o: MLSMessageModule.o
GriddedData.o: MLSCommon.o MLSMessageModule.o MLSStrings.o
Hdf.o: MLSCommon.o
MLSMessageModule.o: SDPToolkit.o
MLSNumerics.o: MLSCommon.o MLSMessageModule.o MLSStrings.o
MLSSignalNomenclature.o: MLSCommon.o MLSMessageModule.o MLSStrings.o
MLSStrings.o: MLSMessageModule.o
MatrixModule_0.o: Allocate_Deallocate.o MLSCommon.o MLSMessageModule.o \
	dump_0.o output_m.o
Units.o: MLSCommon.o MLSMessageModule.o MLSStrings.o
dates_module.o: MLSMessageModule.o MLSStrings.o
declaration_table.o: intrinsic.o machine.o output_m.o string_table.o \
	toggles_core.o
dump_0.o: output_m.o
error_handler.o: machine.o output_m.o
expr_m.o: declaration_table.o intrinsic.o string_table.o toggles_core.o \
	trace_m.o tree.o tree_types.o
getCF_m.o: MLSCF.o declaration_table.o lexer_core.o output_m.o parser.o \
	string_table.o table_dumper.o table_generator.o toggles_core.o tree.o \
	tree_checker.o units.o
gridded_data_module.o: MLSCommon.o MLSMessageModule.o MLSStrings.o \
	dates_module.o
heights_module.o: MLSCommon.o MLSMessageModule.o
intrinsic.o: symbol_table.o symbol_types.o
lexer_core.o: output_m.o string_table.o symbol_table.o toggles_core.o
lexer_m.o: error_handler.o lexer_core.o output_m.o string_table.o \
	symbol_table.o symbol_types.o toggles_core.o
output_m.o: MLSMessageModule.o
parser.o: lexer_core.o lexer_m.o output_m.o symbol_table.o symbol_types.o \
	toggles_core.o tree.o tree_types.o
string_table.o: hash.o io_stuff.o machine.o output_m.o
swapi.o: swapi_character_array.o swapi_character_scalar.o swapi_double.o \
	swapi_integer.o swapi_real.o
symbol_table.o: machine.o output_m.o string_table.o symbol_types.o \
	toggles_core.o
symbol_types.o: string_table.o
table_dumper.o: MLSCF.o declaration_table.o intrinsic.o output_m.o \
	string_table.o
table_generator.o: MLSCF.o declaration_table.o expr_m.o intrinsic.o \
	lexer_core.o output_m.o string_table.o toggles_core.o trace_m.o \
	tree.o tree_types.o
test_multiply.o: MatrixModule_0.o
test_sparsify.o: MatrixModule_0.o
trace_m.o: lexer_core.o output_m.o tree.o
tree.o: error_handler.o machine.o output_m.o string_table.o symbol_table.o \
	symbol_types.o toggles_core.o tree_types.o
tree_checker.o: declaration_table.o lexer_core.o output_m.o string_table.o \
	toggles_core.o trace_m.o tree.o tree_types.o
tree_types.o: string_table.o symbol_types.o
units.o: declaration_table.o intrinsic.o tree.o

# ========================================================================
# Test harnesses

test_multiply.o: $S/test_multiply.f90 MatrixModule_0.o MLSCommon.o
	$(F90) -c $(FOPTS) $S/test_multiply.f90

test_multiply: test_multiply.o libmls.a
	$(F90) $(LDOPTS) -o test_multiply test_multiply.o -L. -lmls \
                 -L$(PGSTK) -lPGSTK \

test_sparsify.o: $S/test_sparsify.f90 MatrixModule_0.o MLSCommon.o
	$(F90) -c $(FOPTS) $S/test_sparsify.f90

test_sparsify: test_sparsify.o libmls.a
	$(F90) $(LDOPTS) -o test_sparsify test_sparsify.o -L. -lmls \
                 -L$(PGSTK) -lPGSTK \

# ========================================================================

# $Log$
# Revision 2.12  2000/10/12 00:30:57  vsnyder
# Add dependency of libmls.a on machine.o
#
# Revision 2.11  2000/10/11 19:30:06  vsnyder
# Incorporate lib/cf_parser into lib; insert copyright notice
#
# Revision 2.10  2000/10/10 23:11:56  vsnyder
# Correct dependencies for test_sparsify and test_multiply
#
# Revision 2.9  2000/10/10 22:44:22  vsnyder
# Correct actions for test_sparsify and test_multiply
#
# Revision 2.8  2000/10/09 23:31:49  vsnyder
# Must have changed something -- permissions weren't r--r--r--.
#
# Revision 2.7  2000/10/09 22:18:35  vsnyder
# Added machine.f90 to SRCS and machine.o to OBJS.  machine.f90 is in
# the next-layer-down of machine/compiler/OS directories.  If you
# automatically re-make the make file, ensure that machine is still here.
#
# Revision 2.6  2000/10/05 01:35:34  vsnyder
# Revised to account for moving test_multiply from mlspgs/l2.  Also,
# mlslib.a was deleted, because libraries are required to begin with
# lib, so we have libmls.a instead.
#
# Revision 2.5  2000/10/04 20:24:21  vsnyder
# Account for moving Allocate_Deallocate, MatrixModule_0 and test_sparsify
# from mlspgs/l2
#
# Revision 2.4  2000/10/04 18:03:06  vsnyder
# Added a rule to make libmls.a from mlslib.a
#
# Revision 2.3  2000/10/04 01:25:11  vsnyder
# Added an explicit action for L1BData, to specify the DUSTY option,
# because sfrdata is called with inconsistent argument lists.
#
# Revision 2.2  2000/09/29 18:05:32  vsnyder
# Add CVS comments.  Replace inference rule ".f90.o" with "%.o: %.f90"
# because the former sometimes didn't "make" out-of-date files, but the
# latter seems always to do so.
#
